---
layout: default
title: TechnicalReference_Asr_Dem
nav_order: 15
parent: Fiasa_326_327_EPS_TMS570
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR Diagnostic Event Manager </b></p>
<p><b>(DEM) </b></p>
<p>Technical Reference </p>
<p> </p>
<p>Vector </p>
<p>Version 2.2.0 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>P. Speidel, A. Ditte, S. Hübner </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>1 </b></p>
<p><b>Document Information </b></p>
<p><b>1.1 </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>P. Stöhr </p>
<p>2008-04-08 </p>
<p>1.0 </p>
<p>Created for OEM “Vector” base of </p>
<p>TechnicalReference_DEM_&lt;OEM&gt;.doc </p>
<p>P. Stöhr </p>
<p>2008-06-18 </p>
<p>1.0.1 </p>
<p>Updated to AUTOSAR Release 3 </p>
<p>P. Stöhr </p>
<p>2008-06-19 </p>
<p>1.0.2 </p>
<p>Added reference <i>[8] </i></p>
<p>P. Stöhr </p>
<p>2008-06-27 </p>
<p>1.0.3 </p>
<p>Modified description of configuration  </p>
<p>P. Stöhr </p>
<p>2009-01-08 </p>
<p>2.0.10 </p>
<p>Modified include structure, added chapter NvRAM </p>
<p>Demand, added FreezeFrame descriptions, updated </p>
<p>description of configuration, added description of </p>
<p>scheduling DEM and DCM </p>
<p>P. Stöhr </p>
<p>2009-02-16 </p>
<p>2.0.13 </p>
<p>Added internal OccurrenceCounter implementation </p>
<p>A. Ditte </p>
<p>2009-04-14 </p>
<p>2.0.14 </p>
<p>Added description for event de-bouncing </p>
<p>Added </p>
<p>DEM_E_INV_TIMER_SLOT_VAL </p>
<p>in chapter <i>4.6.1 </i></p>
<p>S. Hübner </p>
<p>2009-08-21 </p>
<p>2.1.2 </p>
<p>Update R7, DEM 2.08.00 </p>
<p>Added Variant Handling (Single Identity/VSG mode) </p>
<p>B. Freiberger </p>
<p>2009-11-11 </p>
<p>2.1.3 </p>
<p>Add detailed description of AUTOSAR APIs </p>
<p>P. Speidel </p>
<p>2010-03-03 </p>
<p>2.1.4 </p>
<p>Add information to “post-build settings” description, </p>
<p>Add ApiId of Xxx_DemGetExtededDtataRecford in </p>
<p>chapter <i>4.6.1</i>, </p>
<p>Update caller context information, </p>
<p>Updated indicator description (configuration of </p>
<p>IndicatorBit is now possible in CANdela and GENy) </p>
<p>S. Hübner </p>
<p>2010-08-23 </p>
<p>2.1.5 </p>
<p>Release Dem in config variant link-time, only </p>
<p>S. Hübner </p>
<p>2010-12-01 </p>
<p>2.2.0 </p>
<p>Due sleep/wakeup constraints, no check any more for </p>
<p>NV-Block status in Dem 2.14.00, see chapter <i>4.2 </i>for </p>
<p>mandatory configuration/initialization. </p>
<p>GENy (Diag_AsrDem.dll 3.3.0.0) now separates </p>
<p>Internal/External Events (Event Destination) from </p>
<p>creation of PortInterface (Event Kind). Reworked </p>
<p>chapter 8.1.1, 8.2.12.5 and 10.1 </p>
<p>Table 1-1  </p>
<p>History of the Document </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>2 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>1.2 </b></p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1]  AUTOSAR - Specification of Diagnostics Event Manager </p>
<p>(AUTOSAR_SWS_DEM.pdf) </p>
<p>V2.2.1 </p>
<p>[2]  AUTOSAR – Specification of Development Error Tracer </p>
<p>(AUTOSAR_SWS_DET.pdf)  </p>
<p>V2.2.0 </p>
<p>[3]  AUTOSAR – Specification of Diagnostic Communication Manager </p>
<p>(AUTOSAR_SWS_DCM.pdf) </p>
<p>V3.0.0 </p>
<p>[4]  AUTOSAR – Specification of NVRAM Manager </p>
<p>(AUTOSAR_SWS_NVRAMManager.pdf) </p>
<p>V2.2.0 </p>
<p>[5]  AUTOSAR – Specification of Standard Types </p>
<p>(AUTOSAR_SWS_StandardTypes.pdf) </p>
<p>V1.2.0 </p>
<p>[6]  AUTOSAR_BasicSoftwareModules.pdf </p>
<p>V1.0.0 </p>
<p>[7]  ISO 14229-1:2006 Road vehicles – Unified diagnostic services (UDS) – Part 1: </p>
<p>Specification and Requirements </p>
<p>- </p>
<p>[8]  Vector internal PostBuild_GeneralProcedure.pdf </p>
<p>V1.x </p>
<p>[9]  Application Note  AN-ISC-8-1118, Vector GmbH </p>
<p>MICROSAR BSW Compatibility Check </p>
<p>V1.0 </p>
<p>Table 1-2  </p>
<p>Reference Documents </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>3 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Document Information..................................................................................................... 2</b></p>
<p> </p>
<p>1.1</p>
<p> </p>
<p>History............................................................................................................... 2</p>
<p> </p>
<p>1.2</p>
<p> </p>
<p>Reference Documents ...................................................................................... 3</p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Component History........................................................................................................ 12</b></p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Introduction .................................................................................................................... 13</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Architecture Overview..................................................................................... 13</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Functional Description .................................................................................................. 15</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Features.......................................................................................................... 15</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Initialization ..................................................................................................... 16</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>States .............................................................................................................. 17</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Main Functions ............................................................................................... 18</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>Event De-bouncing ......................................................................................... 20</p>
<p> </p>
<p>4.5.1</p>
<p> </p>
<p>Via Counter Based Algorithm.......................................................................... 20</p>
<p> </p>
<p>4.5.2</p>
<p> </p>
<p>Via Time Based Algorithm............................................................................... 20</p>
<p> </p>
<p>4.6</p>
<p> </p>
<p>Error Handling................................................................................................. 21</p>
<p> </p>
<p>4.6.1</p>
<p> </p>
<p>Development Error Reporting ......................................................................... 21</p>
<p> </p>
<p>4.6.1.1</p>
<p> </p>
<p>Parameter Checking ....................................................................................... 28</p>
<p> </p>
<p>4.6.2</p>
<p> </p>
<p>Production Code Error Reporting ................................................................... 31</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>Integration....................................................................................................................... 32</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Scope of Delivery............................................................................................ 32</p>
<p> </p>
<p>5.1.1</p>
<p> </p>
<p>Static Files ...................................................................................................... 32</p>
<p> </p>
<p>5.1.2</p>
<p> </p>
<p>Dynamic Files ................................................................................................. 32</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Include Structure............................................................................................. 33</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Compiler Abstraction and Memory Mapping................................................... 34</p>
<p> </p>
<p>5.4</p>
<p> </p>
<p>Critical Sections .............................................................................................. 35</p>
<p> </p>
<p>5.4.1</p>
<p> </p>
<p>Startup Phase ................................................................................................. 35</p>
<p> </p>
<p>5.4.2</p>
<p> </p>
<p>Call of Callback Functions .............................................................................. 36</p>
<p> </p>
<p>5.5</p>
<p> </p>
<p>Call Context .................................................................................................... 36</p>
<p> </p>
<p>5.6</p>
<p> </p>
<p>Scheduling of DEM and DCM......................................................................... 37</p>
<p> </p>
<p>5.7</p>
<p> </p>
<p>NvRAM Demand............................................................................................. 37</p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>API Description .............................................................................................................. 39</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Type Definitions .............................................................................................. 39</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Services Provided by DEM ............................................................................. 39</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>4 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>6.2.1</p>
<p> </p>
<p>Dem_GetVersionInfo ...................................................................................... 39</p>
<p> </p>
<p>6.2.2</p>
<p> </p>
<p>Interface ECU State Manager </p>
<p>Ù</p>
<p> DEM ........................................................... 39</p>
<p> </p>
<p>6.2.2.1</p>
<p> </p>
<p>Dem_PreInit .................................................................................................... 39</p>
<p> </p>
<p>6.2.2.2</p>
<p> </p>
<p>Dem_Init ......................................................................................................... 41</p>
<p> </p>
<p>6.2.2.3</p>
<p> </p>
<p>Dem_Shutdown .............................................................................................. 41</p>
<p> </p>
<p>6.2.2.4</p>
<p> </p>
<p>Dem_InitDiagnosticVariant.............................................................................. 42</p>
<p> </p>
<p>6.2.3</p>
<p> </p>
<p>Interface SW-Components via RTE </p>
<p>Ù</p>
<p> DEM .................................................. 44</p>
<p> </p>
<p>6.2.3.1</p>
<p> </p>
<p>Dem_SetEventStatus...................................................................................... 44</p>
<p> </p>
<p>6.2.3.2</p>
<p> </p>
<p>Dem_ResetEventStatus.................................................................................. 45</p>
<p> </p>
<p>6.2.3.3</p>
<p> </p>
<p>Dem_PrestoreFreezeFrame ........................................................................... 46</p>
<p> </p>
<p>6.2.3.4</p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame ................................................................ 47</p>
<p> </p>
<p>6.2.3.5</p>
<p> </p>
<p>Dem_SetOperationCycleState ........................................................................ 47</p>
<p> </p>
<p>6.2.3.6</p>
<p> </p>
<p>Dem_GetEventStatus ..................................................................................... 49</p>
<p> </p>
<p>6.2.3.7</p>
<p> </p>
<p>Dem_GetEventFailed ..................................................................................... 50</p>
<p> </p>
<p>6.2.3.8</p>
<p> </p>
<p>Dem_GetEventTested..................................................................................... 50</p>
<p> </p>
<p>6.2.3.9</p>
<p> </p>
<p>Dem_GetDTCOfEvent .................................................................................... 52</p>
<p> </p>
<p>6.2.3.10</p>
<p> </p>
<p>Dem_SetValueByOemId ................................................................................. 52</p>
<p> </p>
<p>6.2.3.11</p>
<p> </p>
<p>Dem_SetEnableCondition .............................................................................. 52</p>
<p> </p>
<p>6.2.3.12</p>
<p> </p>
<p>Dem_GetFaultDetectionCounter .................................................................... 53</p>
<p> </p>
<p>6.2.3.13</p>
<p> </p>
<p>Dem_GetIndicatorStatus................................................................................. 53</p>
<p> </p>
<p>6.2.3.14</p>
<p> </p>
<p>Dem_GetOccurrenceCounter ......................................................................... 55</p>
<p> </p>
<p>6.2.4</p>
<p> </p>
<p>Interface BSW-Components </p>
<p>Ù</p>
<p> DEM ............................................................. 56</p>
<p> </p>
<p>6.2.4.1</p>
<p> </p>
<p>Dem_ReportErrorStatus ................................................................................. 56</p>
<p> </p>
<p>6.2.5</p>
<p> </p>
<p>Interface DCM </p>
<p>Ù</p>
<p> DEM................................................................................... 57</p>
<p> </p>
<p>6.2.5.1</p>
<p> </p>
<p>Access DTCs and Status Information ............................................................. 57</p>
<p> </p>
<p>6.2.5.1.1</p>
<p> </p>
<p>Dem_SetDTCFilter ......................................................................................... 58</p>
<p> </p>
<p>6.2.5.1.2</p>
<p> </p>
<p>Dem_SetDTCFilterForRecords....................................................................... 59</p>
<p> </p>
<p>6.2.5.1.3</p>
<p> </p>
<p>Dem_SetViewFilter ......................................................................................... 60</p>
<p> </p>
<p>6.2.5.1.4</p>
<p> </p>
<p>Dem_GetStatusOfDTC ................................................................................... 60</p>
<p> </p>
<p>6.2.5.1.5</p>
<p> </p>
<p>Dem_GetDTCStatusAvailabilityMask.............................................................. 61</p>
<p> </p>
<p>6.2.5.1.6</p>
<p> </p>
<p>Dem_GetNumberOfFilteredDTC .................................................................... 61</p>
<p> </p>
<p>6.2.5.1.7</p>
<p> </p>
<p>Dem_GetNextFilteredDTC.............................................................................. 62</p>
<p> </p>
<p>6.2.5.1.8</p>
<p> </p>
<p>Dem_GetDTCByOccurrenceTime .................................................................. 63</p>
<p> </p>
<p>6.2.5.1.9</p>
<p> </p>
<p>Dem_GetViewIDOfDTC .................................................................................. 64</p>
<p> </p>
<p>6.2.5.1.10</p>
<p> </p>
<p>Dem_GetNextFilteredRecord ......................................................................... 64</p>
<p> </p>
<p>6.2.5.1.11</p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndFDC ................................................................ 65</p>
<p> </p>
<p>6.2.5.1.12</p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndSeverity .......................................................... 66</p>
<p> </p>
<p>6.2.5.1.13</p>
<p> </p>
<p>Dem_GetTranslationType ............................................................................... 66</p>
<p> </p>
<p>6.2.5.1.14</p>
<p> </p>
<p>Dem_GetSeverityOfDTC ................................................................................ 67</p>
<p> </p>
<p>6.2.5.2</p>
<p> </p>
<p>Access Extended Data Records and FreezeFrame Data ............................... 68</p>
<p> </p>
<p>6.2.5.2.1</p>
<p> </p>
<p>Dem_DisableDTCRecordUpdate.................................................................... 68</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>5 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>6.2.5.2.2</p>
<p> </p>
<p>Dem_EnableDTCRecordUpdate .................................................................... 68</p>
<p> </p>
<p>6.2.5.2.3</p>
<p> </p>
<p>Dem_GetDTCOfFreezeFrameRecord ............................................................ 69</p>
<p> </p>
<p>6.2.5.2.4</p>
<p> </p>
<p>Dem_GetFreezeFrameDataByDTC................................................................ 70</p>
<p> </p>
<p>6.2.5.2.5</p>
<p> </p>
<p>Dem_GetFreezeFrameDataIdentifierByDTC .................................................. 71</p>
<p> </p>
<p>6.2.5.2.6</p>
<p> </p>
<p>Dem_GetSizeOfFreezeFrame ........................................................................ 72</p>
<p> </p>
<p>6.2.5.2.7</p>
<p> </p>
<p>Dem_GetExtendedDataRecordByDTC........................................................... 73</p>
<p> </p>
<p>6.2.5.2.8</p>
<p> </p>
<p>Dem_GetSizeOfExtendedDataRecordByDTC................................................ 74</p>
<p> </p>
<p>6.2.5.3</p>
<p> </p>
<p>Clear DTC Information.................................................................................... 75</p>
<p> </p>
<p>6.2.5.3.1</p>
<p> </p>
<p>Dem_ClearDTC .............................................................................................. 75</p>
<p> </p>
<p>6.2.5.4</p>
<p> </p>
<p>Control DTC Storage ...................................................................................... 76</p>
<p> </p>
<p>6.2.5.4.1</p>
<p> </p>
<p>Dem_DisableDTCStorage .............................................................................. 77</p>
<p> </p>
<p>6.2.5.4.2</p>
<p> </p>
<p>Dem_EnableDTCStorage ............................................................................... 78</p>
<p> </p>
<p>6.2.5.4.3</p>
<p> </p>
<p>Dem_DisableEventStatusUpdate.................................................................... 79</p>
<p> </p>
<p>6.2.5.4.4</p>
<p> </p>
<p>Dem_EnableEventStatusUpdate .................................................................... 79</p>
<p> </p>
<p>6.3</p>
<p> </p>
<p>Services Used by DEM................................................................................... 81</p>
<p> </p>
<p>6.4</p>
<p> </p>
<p>Callback Functions ......................................................................................... 81</p>
<p> </p>
<p>6.4.1</p>
<p> </p>
<p>Dem_NvDataInit ............................................................................................. 81</p>
<p> </p>
<p>6.5</p>
<p> </p>
<p>Configurable Interfaces................................................................................... 82</p>
<p> </p>
<p>6.5.1</p>
<p> </p>
<p>Notifications .................................................................................................... 82</p>
<p> </p>
<p>6.5.1.1</p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent.............................. 83</p>
<p> </p>
<p>6.5.1.2</p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged ........................... 84</p>
<p> </p>
<p>6.5.1.3</p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged ............................. 86</p>
<p> </p>
<p>6.5.2</p>
<p> </p>
<p>Callout Functions ............................................................................................ 86</p>
<p> </p>
<p>6.5.2.1</p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier ............. 87</p>
<p> </p>
<p>6.5.2.2</p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord ..................... 88</p>
<p> </p>
<p>6.6</p>
<p> </p>
<p>Service Ports .................................................................................................. 88</p>
<p> </p>
<p>6.6.1</p>
<p> </p>
<p>Client Server Interface .................................................................................... 88</p>
<p> </p>
<p>6.6.1.1</p>
<p> </p>
<p>Provide Ports on DEM Side ............................................................................ 88</p>
<p> </p>
<p>6.6.1.1.1</p>
<p> </p>
<p>DiagnosticMonitor ........................................................................................... 89</p>
<p> </p>
<p>6.6.1.1.2</p>
<p> </p>
<p>OperationCycle ............................................................................................... 89</p>
<p> </p>
<p>6.6.1.1.3</p>
<p> </p>
<p>ValueByOemId ................................................................................................ 89</p>
<p> </p>
<p>6.6.1.1.4</p>
<p> </p>
<p>EnableCondition ............................................................................................. 90</p>
<p> </p>
<p>6.6.1.1.5</p>
<p> </p>
<p>IndicatorStatus ................................................................................................ 90</p>
<p> </p>
<p>6.6.1.2</p>
<p> </p>
<p>Require Ports on DEM Side............................................................................ 90</p>
<p> </p>
<p>6.6.1.2.1</p>
<p> </p>
<p>Notification CallbackInitMonitorForEvent........................................................ 90</p>
<p> </p>
<p>6.6.1.2.2</p>
<p> </p>
<p>Notification CallbackInitMonitorForFunction ................................................... 90</p>
<p> </p>
<p>6.6.1.2.3</p>
<p> </p>
<p>Notification CallbackEventStatusChange ....................................................... 90</p>
<p> </p>
<p>6.6.1.2.4</p>
<p> </p>
<p>Notification CallbackDTCStatusChange ......................................................... 90</p>
<p> </p>
<p>6.6.1.2.5</p>
<p> </p>
<p>Callout Function CallbackGetDataValueByDataID{DataId}............................. 91</p>
<p> </p>
<p>6.6.1.2.6</p>
<p> </p>
<p>Callout Function CallbackGetExtendedDataRecord{RecordNumber} ............ 91</p>
<p> </p>
<p>6.6.1.2.7</p>
<p> </p>
<p>Callout Function CallbackGetFaultDetectCounter .......................................... 91</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>6 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Additional Features........................................................................................................ 92</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Multi-Identity Support...................................................................................... 92</p>
<p> </p>
<p>7.1.1</p>
<p> </p>
<p>Functionality.................................................................................................... 92</p>
<p> </p>
<p>7.1.2</p>
<p> </p>
<p>Single-Identity Mode ....................................................................................... 92</p>
<p> </p>
<p>7.1.2.1</p>
<p> </p>
<p>Configuration in CANdela ............................................................................... 93</p>
<p> </p>
<p>7.1.2.2</p>
<p> </p>
<p>Configuration in GENy .................................................................................... 93</p>
<p> </p>
<p>7.1.3</p>
<p> </p>
<p>Vehicle System Group (VSG) Mode ............................................................... 94</p>
<p> </p>
<p>7.1.3.1</p>
<p> </p>
<p>Configuration in CANdela ............................................................................... 94</p>
<p> </p>
<p>7.1.3.2</p>
<p> </p>
<p>Configuration in GENy .................................................................................... 96</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>Configuration.................................................................................................................. 97</b></p>
<p> </p>
<p>8.1</p>
<p> </p>
<p>Configuration with CANdelaStudio.................................................................. 97</p>
<p> </p>
<p>8.1.1</p>
<p> </p>
<p>DTC Settings .................................................................................................. 97</p>
<p> </p>
<p>8.1.2</p>
<p> </p>
<p>Freeze Frame Types (Snapshot Records)...................................................... 99</p>
<p> </p>
<p>8.1.3</p>
<p> </p>
<p>Extended Records .......................................................................................... 99</p>
<p> </p>
<p>8.1.3.1</p>
<p> </p>
<p>OccurrenceCounter ........................................................................................ 99</p>
<p> </p>
<p>8.1.4</p>
<p> </p>
<p>Pre de-bounce algorithms............................................................................. 101</p>
<p> </p>
<p>8.2</p>
<p> </p>
<p>Configuration with GENy .............................................................................. 101</p>
<p> </p>
<p>8.2.1</p>
<p> </p>
<p>Start the Configuration .................................................................................. 102</p>
<p> </p>
<p>8.2.2</p>
<p> </p>
<p>Import CDD................................................................................................... 102</p>
<p> </p>
<p>8.2.2.1</p>
<p> </p>
<p>Single Identity Mode ..................................................................................... 102</p>
<p> </p>
<p>8.2.2.2</p>
<p> </p>
<p>Vehicle System Group (VSG) Mode ............................................................. 103</p>
<p> </p>
<p>8.2.2.3</p>
<p> </p>
<p>Automatic Configuration via CANdelaStudio Files........................................ 104</p>
<p> </p>
<p>8.2.3</p>
<p> </p>
<p>Tree View...................................................................................................... 105</p>
<p> </p>
<p>8.2.4</p>
<p> </p>
<p>Main Configuration Window.......................................................................... 106</p>
<p> </p>
<p>8.2.5</p>
<p> </p>
<p>Common ....................................................................................................... 107</p>
<p> </p>
<p>8.2.6</p>
<p> </p>
<p>Software Component Template..................................................................... 107</p>
<p> </p>
<p>8.2.7</p>
<p> </p>
<p>Postbuild Settings ......................................................................................... 108</p>
<p> </p>
<p>8.2.8</p>
<p> </p>
<p>Miscellaneous ............................................................................................... 108</p>
<p> </p>
<p>8.2.9</p>
<p> </p>
<p>BSW Error Buffer .......................................................................................... 109</p>
<p> </p>
<p>8.2.10</p>
<p> </p>
<p>DTC Groups.................................................................................................. 109</p>
<p> </p>
<p>8.2.11</p>
<p> </p>
<p>NvRam Block IDs...........................................................................................110</p>
<p> </p>
<p>8.2.12</p>
<p> </p>
<p>Manual Configuration.....................................................................................110</p>
<p> </p>
<p>8.2.12.1</p>
<p> </p>
<p>Operation Cycles Window .............................................................................111</p>
<p> </p>
<p>8.2.12.2</p>
<p> </p>
<p>Data Object Window ......................................................................................112</p>
<p> </p>
<p>8.2.12.3</p>
<p> </p>
<p>Extended Data Records.................................................................................112</p>
<p> </p>
<p>8.2.12.4</p>
<p> </p>
<p>Indicator Window ...........................................................................................113</p>
<p> </p>
<p>8.2.12.5</p>
<p> </p>
<p>Event Configuration Window .........................................................................113</p>
<p> </p>
<p>8.2.12.5.1</p>
<p> </p>
<p>DTC Settings .................................................................................................118</p>
<p> </p>
<p>8.2.12.5.2</p>
<p> </p>
<p>Event Pre-Debouncing...................................................................................119</p>
<p> </p>
<p>8.2.12.5.3</p>
<p> </p>
<p>Snapshot Records (FreezeFrames)...............................................................119</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>7 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>8.2.12.5.4</p>
<p> </p>
<p>Extended Data Records................................................................................ 120</p>
<p> </p>
<p>8.2.12.5.5</p>
<p> </p>
<p>Indicators ...................................................................................................... 121</p>
<p> </p>
<p>8.2.12.5.6</p>
<p> </p>
<p>TriggerOnEvent Callback Functions ............................................................. 121</p>
<p> </p>
<p>8.2.12.5.7</p>
<p> </p>
<p>TriggerOnDtc Callback Functions................................................................. 121</p>
<p> </p>
<p>8.2.13</p>
<p> </p>
<p>Software Component Template..................................................................... 121</p>
<p> </p>
<p><b>9</b></p>
<p> </p>
<p><b>AUTOSAR Standard Compliance................................................................................ 122</b></p>
<p> </p>
<p>9.1</p>
<p> </p>
<p>Deviations ..................................................................................................... 122</p>
<p> </p>
<p>9.1.1</p>
<p> </p>
<p>APIs and Features not Supported ................................................................ 122</p>
<p> </p>
<p>9.1.2</p>
<p> </p>
<p>AUTOSAR Defined APIs that Differ in this Implementation .......................... 122</p>
<p> </p>
<p>9.1.2.1</p>
<p> </p>
<p>Service Dem_ClearDTC ............................................................................... 122</p>
<p> </p>
<p>9.1.2.2</p>
<p> </p>
<p>Service Dem_SetEventStatus....................................................................... 122</p>
<p> </p>
<p>9.1.2.3</p>
<p> </p>
<p>Service Dem_ResetEventStatus................................................................... 122</p>
<p> </p>
<p>9.1.2.4</p>
<p> </p>
<p>Service Dem_SetOperationCycleState......................................................... 122</p>
<p> </p>
<p>9.1.2.5</p>
<p> </p>
<p>Service Dem_ReportErrorStatus................................................................... 122</p>
<p> </p>
<p>9.1.2.6</p>
<p> </p>
<p>Interface Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged ............ 122</p>
<p> </p>
<p>9.1.3</p>
<p> </p>
<p>Require Ports not Supported ........................................................................ 122</p>
<p> </p>
<p>9.2</p>
<p> </p>
<p>Additions/ Extensions ................................................................................... 123</p>
<p> </p>
<p>9.2.1</p>
<p> </p>
<p>Development Error Reporting – Include Structure ........................................ 123</p>
<p> </p>
<p>9.2.2</p>
<p> </p>
<p>Development Error Reporting – Internal Debug Codes ................................ 123</p>
<p> </p>
<p>9.2.3</p>
<p> </p>
<p>Service Dem_GetOccurrenceCounter .......................................................... 123</p>
<p> </p>
<p>9.2.4</p>
<p> </p>
<p>Name Description of Configurable Interfaces (Notifications) ........................ 123</p>
<p> </p>
<p>9.2.5</p>
<p> </p>
<p>Interface </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier ........... 123</p>
<p> </p>
<p>9.2.6</p>
<p> </p>
<p>Port Names Length Limitation....................................................................... 123</p>
<p> </p>
<p>9.2.7</p>
<p> </p>
<p>Version Information....................................................................................... 123</p>
<p> </p>
<p>9.3</p>
<p> </p>
<p>Limitations..................................................................................................... 124</p>
<p> </p>
<p>9.3.1</p>
<p> </p>
<p>Limits Checked During Configuration ........................................................... 124</p>
<p> </p>
<p><b>10</b></p>
<p> </p>
<p><b>Glossary and Abbreviations........................................................................................ 125</b></p>
<p> </p>
<p>10.1</p>
<p> </p>
<p>Glossary........................................................................................................ 125</p>
<p> </p>
<p>10.2</p>
<p> </p>
<p>Abbreviations ................................................................................................ 126</p>
<p> </p>
<p><b>11</b></p>
<p> </p>
<p><b>Contact .......................................................................................................................... 127</b></p>
<p> </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>8 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Illustrations </b></p>
<p>Figure </p>
<p> </p>
<p>3-1</p>
<p> </p>
<p>AUTOSAR architecture .............................................................................. 13</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>3-2</p>
<p> </p>
<p>Interfaces to Adjacent Modules of the DEM ............................................... 14</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>4-1</p>
<p> </p>
<p>DEM States ................................................................................................ 17</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>4-2</p>
<p> </p>
<p>Event De-bouncing via counter based algorithm ....................................... 20</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>4-3</p>
<p> </p>
<p>Event De-bouncing via time based algorithm............................................. 21</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>5-1</p>
<p> </p>
<p>Include Structure ........................................................................................ 33</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>7-1</p>
<p> </p>
<p>DEM single identity mode .......................................................................... 93</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>7-2</p>
<p> </p>
<p>DEM Vehicle System Group (VSG) mode.................................................. 94</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>7-3</p>
<p> </p>
<p>Defining VSGs in CANdelaStudio .............................................................. 95</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>7-4</p>
<p> </p>
<p>Assigning VSGs to a DTC in CANdelaStudio............................................. 95</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-1</p>
<p> </p>
<p>OccurrenceCounter .................................................................................. 100</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-2</p>
<p> </p>
<p>This CDD supports the internal Occurrence Counter............................... 101</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-3</p>
<p> </p>
<p>This CDD does NOT support the internal Occurrence Counter ............... 101</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-4</p>
<p> </p>
<p>Switching DCM/DEM in GENy to single-identity mode ............................ 102</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-5</p>
<p> </p>
<p>Select the CDD and the variant in the CDD ............................................. 103</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-6</p>
<p> </p>
<p>Switching DCM in GENy to VSG mode.................................................... 103</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-7</p>
<p> </p>
<p>Select the CDD and the variant in the CDD ............................................. 104</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-8</p>
<p> </p>
<p>Tree View ................................................................................................. 105</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-9</p>
<p> </p>
<p>Main Configuration Window ..................................................................... 106</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-10</p>
<p> </p>
<p>Manual Configuration of the DEM via Main Configuration Window ..........110</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-11</p>
<p> </p>
<p>Manual Configuration of the DEM via Right-Mouse-Button in Tree View..111</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-12</p>
<p> </p>
<p>Operation Cycles Window.........................................................................111</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-13</p>
<p> </p>
<p>Data Object Window .................................................................................112</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-14</p>
<p> </p>
<p>ExtendedData Records .............................................................................112</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-15</p>
<p> </p>
<p>Indicator Window.......................................................................................113</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-16</p>
<p> </p>
<p>Event Configuration Window.....................................................................114</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-17</p>
<p> </p>
<p>Configurable Options of an Event .............................................................116</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-18</p>
<p> </p>
<p>Create New Snapshot Record ................................................................. 120</p>
<p> </p>
<p>Figure </p>
<p> </p>
<p>8-19</p>
<p> </p>
<p>Snapshot Record Window........................................................................ 120</p>
<p> </p>
<p> </p>
<p><b>Tables </b></p>
<p>Table </p>
<p> </p>
<p>1-1 </p>
<p> </p>
<p>History of the Document............................................................................... 2</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>1-2 </p>
<p> </p>
<p>Reference Documents ................................................................................. 3</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>2-1 </p>
<p> </p>
<p>Component History .................................................................................... 12</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-1 </p>
<p> </p>
<p>Supported SWS features ........................................................................... 15</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-2</p>
<p> </p>
<p>Not Supported SWS Features.................................................................... 16</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-3 </p>
<p> </p>
<p>Mapping of Service IDs to Services and Corresponding Errors................. 27</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-4 </p>
<p> </p>
<p>Mapping of additional Service IDs to Services and Corresponding Errors 27</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-5 </p>
<p> </p>
<p>Errors Reported to DET ............................................................................. 27</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-6 </p>
<p> </p>
<p>Errors Reported to DET – Internal Debug Codes....................................... 28</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>4-7 </p>
<p> </p>
<p>Development Error Reporting: Assignment of Checks to Services ............ 30</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>5-1 </p>
<p> </p>
<p>Static Files of Delivery................................................................................ 32</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>5-2 </p>
<p> </p>
<p>Generated (Dynamic) Files of Delivery ...................................................... 33</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>5-3 </p>
<p> </p>
<p>Compiler Abstraction and Memory Mapping .............................................. 34</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-1</p>
<p> </p>
<p>Dem_GetVersionInfo .................................................................................. 39</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-2</p>
<p> </p>
<p>Dem_PreInit ............................................................................................... 40</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>9 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-3 </p>
<p> </p>
<p>Dem_Init ..................................................................................................... 41</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-4 </p>
<p> </p>
<p>Dem_Shutdown.......................................................................................... 42</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-5 </p>
<p> </p>
<p>Dem_InitDiagnosticVariant ......................................................................... 44</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-6 </p>
<p> </p>
<p>Dem_SetEventStatus ................................................................................. 45</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-7 </p>
<p> </p>
<p>Dem_ResetEventStatus ............................................................................. 45</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-8 </p>
<p> </p>
<p>Dem_PrestoreFreezeFrame ...................................................................... 46</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-9 </p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame ............................................................ 47</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-10 </p>
<p> </p>
<p>Dem_SetOperationCycleState ................................................................... 48</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-11</p>
<p> </p>
<p>Dem_GetEventStatus................................................................................. 50</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-12 </p>
<p> </p>
<p>Dem_GetEventFailed ................................................................................. 50</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-13 </p>
<p> </p>
<p>Dem_GetEventTested ................................................................................ 51</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-14</p>
<p> </p>
<p>Dem_GetDTCOfEvent ............................................................................... 52</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-15</p>
<p> </p>
<p>Dem_GetFaultDetectionCounter ................................................................ 53</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-16</p>
<p> </p>
<p>Dem_GetIndicatorStatus ............................................................................ 54</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-17 </p>
<p> </p>
<p>Dem_GetOccurrenceCounter .................................................................... 55</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-18</p>
<p> </p>
<p>Dem_ReportErrorStatus ............................................................................. 56</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-19</p>
<p> </p>
<p>Dem_SetDTCFilter ..................................................................................... 59</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-20</p>
<p> </p>
<p>Dem_SetDTCFilterForRecords .................................................................. 59</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-21</p>
<p> </p>
<p>Dem_GetStatusOfDTC............................................................................... 61</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-22</p>
<p> </p>
<p>Dem_GetDTCStatusAvailabilityMask ......................................................... 61</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-23</p>
<p> </p>
<p>Dem_GetNumberOfFilteredDTC ................................................................ 62</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-24</p>
<p> </p>
<p>Dem_GetNextFilteredDTC ......................................................................... 62</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-25</p>
<p> </p>
<p>Dem_GetDTCByOccurrenceTime .............................................................. 63</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-26</p>
<p> </p>
<p>Dem_GetViewIDOfDTC ............................................................................. 64</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-27</p>
<p> </p>
<p>Dem_GetNextFilteredRecord ..................................................................... 65</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-28</p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndFDC ........................................................... 65</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-29 </p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndSeverity...................................................... 66</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-30</p>
<p> </p>
<p>Dem_GetTranslationType .......................................................................... 67</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-31</p>
<p> </p>
<p>Dem_GetSeverityOfDTC............................................................................ 68</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-32</p>
<p> </p>
<p>Dem_DisableDTCRecordUpdate ............................................................... 68</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-33</p>
<p> </p>
<p>Dem_EnableDTCRecordUpdate ................................................................ 69</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-34</p>
<p> </p>
<p>Dem_GetDTCOfFreezeFrameRecord ....................................................... 70</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-35</p>
<p> </p>
<p>Dem_GetFreezeFrameDataByDTC ........................................................... 71</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-36</p>
<p> </p>
<p>Dem_GetFreezeFrameDataIdentifierByDTC ............................................. 72</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-37</p>
<p> </p>
<p>Dem_GetSizeOfFreezeFrame ................................................................... 73</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-38</p>
<p> </p>
<p>Dem_GetExtendedDataRecordByDTC ...................................................... 74</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-39</p>
<p> </p>
<p>Dem_GetSizeOfExtendedDataRecordByDTC ........................................... 75</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-40</p>
<p> </p>
<p>Dem_ClearDTC.......................................................................................... 76</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-41</p>
<p> </p>
<p>Dem_DisableDTCStorage .......................................................................... 77</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-42</p>
<p> </p>
<p>Dem_EnableDTCStorage........................................................................... 78</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-43</p>
<p> </p>
<p>Dem_DisableEventStatusUpdate ............................................................... 79</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-44</p>
<p> </p>
<p>Dem_EnableEventStatusUpdate................................................................ 80</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-45 </p>
<p> </p>
<p>Services Used by the DEM ........................................................................ 81</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-46 </p>
<p> </p>
<p>Dem_NvDataInit ......................................................................................... 82</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-47 </p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent ......................... 83</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-48 </p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged....................... 85</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-49 </p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged ........................ 86</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-50 </p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier......... 87</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-51 </p>
<p> </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord ................ 88</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>10 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-52 </p>
<p> </p>
<p>DiagnosticMonitor ...................................................................................... 89</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-53 </p>
<p> </p>
<p>OperationCycle .......................................................................................... 89</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-54 </p>
<p> </p>
<p>IndicatorStatus ........................................................................................... 90</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-55 </p>
<p> </p>
<p>CallbackInitMonitorForEvent ...................................................................... 90</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-56 </p>
<p> </p>
<p>CallbackEventStatusChange...................................................................... 90</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-57 </p>
<p> </p>
<p>CallbackDTCStatusChange ....................................................................... 91</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-58 </p>
<p> </p>
<p>CallbackGetDataValueByDataID{DataId} ................................................... 91</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>6-59 </p>
<p> </p>
<p>CallbackGetExtendedDataRecord{RecordNumber} .................................. 91</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>8-1 </p>
<p> </p>
<p>Equivalence of DTC Settings in CANdelaStudio and GENy ...................... 98</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>10-1 </p>
<p> </p>
<p>Glossary ................................................................................................... 125</p>
<p> </p>
<p>Table </p>
<p> </p>
<p>10-2 </p>
<p> </p>
<p>Abbreviations ........................................................................................... 126</p>
<p> </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>11 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>2 </b></p>
<p><b>Component History </b></p>
<p>The component history gives an overview of the important milestones that are supported in </p>
<p>the different versions of the component. </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>[ 01.xx.yy ]  </p>
<p>Evaluation version based on AUTOSAR release 2.1 (V2.1.1) of </p>
<p>Specification of Diagnostics Event Manager </p>
<p>[ 02.xx.yy ] </p>
<p>Evaluation version based on AUTOSAR release 3 (V2.2.1) of </p>
<p>Specification of Diagnostics Event Manager </p>
<p>[ 02.05.yy ] </p>
<p>1</p>
<p>st</p>
<p> Release Version </p>
<p>Table 2-1  </p>
<p>Component History </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>12 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>3 </b></p>
<p><b>Introduction </b></p>
<p>This document describes the functionality, API and configuration of the AUTOSAR BSW </p>
<p>module Diagnostic Event Manager (DEM) as specified in [1]. </p>
<p> </p>
<p><b>Supported AUTOSAR Release*: </b></p>
<p>3 </p>
<p><b>Supported Configuration Variants: </b></p>
<p>link-time (library) </p>
<p><b> </b></p>
<p> </p>
<p><b>Vendor ID: </b></p>
<p>DEM_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= </p>
<p>Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>DEM_MODULE_ID   </p>
<p>54 decimal </p>
<p>(according to ref. [6]) </p>
<p>* For the precise AUTOSAR Release 3.x please see the release specific documentation. </p>
<p> </p>
<p>The DEM is responsible for processing and storing diagnostic events (both DTCs and </p>
<p>events reported by other BSW modules) and associated environmental data. </p>
<p><b>3.1 </b></p>
<p><b>Architecture Overview </b></p>
<p>The following figure shows where the DEM is located in the AUTOSAR architecture. </p>
<p> </p>
<p>Figure 3-1 </p>
<p>AUTOSAR architecture </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>13 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>The next figure shows the interfaces to adjacent modules of the DEM. These interfaces </p>
<p>are described in chapter 6.  </p>
<p> </p>
<p> </p>
<p><b>cmp Dem_ReportErrorStatus</b></p>
<p><b>SW-C / Indicator-SW-C</b></p>
<p><b>ECU-SM</b></p>
<p><b>Det</b></p>
<p><b>DCM</b></p>
<p><b>DEM</b></p>
<p>Dem_GetVersionInfo</p>
<p><b>NVRAM</b></p>
<p><b>BSW</b></p>
<p><b>SchM</b></p>
<p><b>EcuM</b></p>
<p>Dem_GetDTCOfEvent</p>
<p>SchM_Exit_Dem</p>
<p>SchM_Enter_Dem</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataReco</p>
<p>Det_ReportError</p>
<p>«optional»</p>
<p>Rte_Call_Dem_&lt;configuredName&gt;_InitMonitorForEvent</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChange</p>
<p>EcuM_GeneratorCompatibilityErro</p>
<p>«optional»</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataI</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitFunctio</p>
<p>NvM_SetRamBlockStatus</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChange</p>
<p>Dem_SetEventStatus</p>
<p>Dem_ReportErrorStatus</p>
<p>Dem_GetDTCOfFreezeFrameRecor</p>
<p>Dem_GetEventStatus</p>
<p>Dem_SetEnableCondition</p>
<p>Dem_SetValueByOemId</p>
<p>Dem_GetFaultDetectionCounte</p>
<p>Dem_ResetEventStatus</p>
<p>Dem_GetEventFailed</p>
<p>Dem_ClearPrestoredFreezeFram</p>
<p>Dem_GetIndicatorStatus</p>
<p>«optional»</p>
<p>Dem_PrestoreFreezeFrame</p>
<p>Dem_GetEventTested</p>
<p>Dem_SetOperationCycleStat</p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetFaultDetectionCo</p>
<p>Dem_SetDTCFilterForRecord</p>
<p>Dem_PreInit</p>
<p>Dem_ShutDown</p>
<p>Dem_GetNumberOfFilteredDT</p>
<p>Dem_GetExtendedDataRecordByDT</p>
<p>Dem_DisableDTCStorage</p>
<p>Dem_GetFreezeFrameDataIdentifierByDT</p>
<p>Dem_GetNextFilteredDTCAndFD</p>
<p>Dem_ClearDTC</p>
<p>Dem_SetDTCFilter</p>
<p>Dem_GetSizeOfFreezeFrame</p>
<p>Dem_EnableDTCRecordUpdate</p>
<p>Dem_GetNextFilteredDTC</p>
<p>Dem_GetSeverityOfDTC</p>
<p>Dem_DisableDTCRecordUpdat</p>
<p>Dem_SetViewFilter</p>
<p>Dem_GetDTCByOccurrenceTiim</p>
<p>Dem_GetDTCStatusAvailabilityMas</p>
<p>Dem_EnableEventStatusUpdat</p>
<p>Dem_GetSizeOfExtendedDataRecordByDT</p>
<p>Dem_GetStatusOfDTC</p>
<p>Dem_GetFreezeFrameDataByDT</p>
<p>Dem_EnableDTCStorage</p>
<p>Dem_GetTranslationType</p>
<p>Dem_GetViewIDOfDTC</p>
<p>Dem_DisableEventStatusUpdat</p>
<p>Dem_Init</p>
<p>Dem_GetNextFilteredRecord</p>
<p>Dem_NvDataInit</p>
<p> </p>
<p>Figure 3-2 </p>
<p>Interfaces to Adjacent Modules of the DEM </p>
<p>Applications do not access the services of the BSW modules directly. They use the service </p>
<p>ports provided by the BSW modules via the RTE. The service ports provided by the DEM </p>
<p>are listed in chapter <i>6.6 </i>and are defined in [1]. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>14 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>4 </b></p>
<p><b>Functional Description </b></p>
<p><b>4.1 </b></p>
<p><b>Features </b></p>
<p>Vector’s DEM solution is based on [1]. </p>
<p>The &quot;supported&quot; and &quot;not supported&quot; features are presented in the following two tables. </p>
<p>For further information of not supported features also see chapter 9. </p>
<p>The current implementation offers all basic features of the DEM specification. Some of the </p>
<p>optional features (e.g. event combination or OBD) are still not well defined and therefore </p>
<p>not supported – refer to the following table for more details. </p>
<p>The following features described in [1] are supported: </p>
<p><b>Supported Features </b></p>
<p>All non-optional features described in [1], except features described below </p>
<p>Table 4-1  </p>
<p>Supported SWS features </p>
<p>The following features described in [1] are not supported: </p>
<p><b>Not Supported Features </b></p>
<p>Event combination </p>
<p>The event combination is not supported. </p>
<p>Event mapping </p>
<p>The mapping of events to DTCs is “1 to 1” or “1 to 0” and not </p>
<p>“n to 1” or “1 to n”</p>
<p>. </p>
<p>OBD support </p>
<p>The OBD support is postponed by AUTOSAR to AUTOSAR phase II. </p>
<p>Mirror / secondary memory support </p>
<p>Mirror memory solutions are typically manufacturer specific, for this implementation no support of </p>
<p>secondary and/or mirror memory is required. </p>
<p>NvRAM-Manager interface </p>
<p>There are pending discussions about the NvRAM manager interface, due to an incomplete SWS </p>
<p>specification. Final solution is postponed to AUTOSAR phase II. </p>
<p>Vector’s solution awaits an updated RAM mirror before </p>
<p>Dem_Init()</p>
<p> is called and an automatic </p>
<p>NvRAM update by the system shut down sequence via </p>
<p>NvM_WriteAll()</p>
<p> after </p>
<p>Dem_Shutdown()</p>
<p> call. </p>
<p>Dem_SetValueByOemId </p>
<p>This optional API is not supported by Vector specific DEM (it is implemented, but returns always </p>
<p>E_NOT_OK). </p>
<p>Dem_SetEnableCondition </p>
<p>This optional API is not supported by Vector specific DEM (it is implemented, but returns always </p>
<p>E_NOT_OK).  </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>15 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>16 / 127</p>
<p><b>Not Supported Features </b></p>
<p>CallbackInitMonitorForFunction </p>
<p>To initialize monitors the AUTOSAR API CallbackInitMonitorForEvent is used. Therefore the </p>
<p>~ForFunction callback is not supported by Vector DEM. </p>
<p>ViewId </p>
<p>Dem_SetViewFilter is not supported by Vector DEM. </p>
<p>CallbackGetFaultDetectCounter </p>
<p>The FaultDetectionCounter is implemented in the DEM. Therefore there is no need to support </p>
<p>this API. </p>
<p>Synchronous execution </p>
<p>AUTOSAR recommends a synchronous execution of all event based functions. To keep the call </p>
<p>context of these functions, the actions are logged synchronously but are executed cyclically </p>
<p>during </p>
<p>Dem_MainFunction()</p>
<p> (see 4.4 for more details). </p>
<p>External event de-bouncing </p>
<p>The external de-bouncing according AUTOSAR can not be implemented in DEM, because the </p>
<p>callback to retrieve the fault detection counter from the application is not compatible with the </p>
<p>RTE. (see http://www.autosar.org/bugzilla/show_bug.cgi?id=34183) </p>
<p>The counter based de-bouncing can be used instead. If the qualification starts, the fault detection </p>
<p>counter has to be update only once with ‘prepassed’ or ‘prefailed’. If the event monitor internal </p>
<p>de-bouncing algorithm qualifies the event, it is always possible to pass that result to the DEM </p>
<p>with the parameter ‘passed’ or ‘failed’. </p>
<p>Table 4-2 </p>
<p>Not Supported SWS Features </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>For supporting Vehicle System Group (VSG) Mode (see chapter <i>7.1 Multi-Identity </i></p>
<p><i>Support </i>and chapter <i>7.1.3 Vehicle System Group (VSG) Mode</i>) together with ECU-C </p>
<p>file format to store the configuration, the use of Vector’s DCM is mandatory. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.2 </b></p>
<p><b>Initialization </b></p>
<p>The DEM startup behavior conforms to [1].  </p>
<p>The function </p>
<p>Dem_PreInit()</p>
<p> shall be used during the startup phase to prepare the </p>
<p>internal states of the DEM.</p>
<p>1</p>
<p> </p>
<p>The function </p>
<p>Dem_Init()</p>
<p> shall be used during the startup phase of the ECU after the </p>
<p>NvRAM Manager has finished the restoration of NvRAM data. </p>
<p> </p>
<p>                                            </p>
<p>1</p>
<p> In multiple identity mode (see chapter <i>7.1</i>) the active configuration must be chosen before calling </p>
<p>Dem_PreInit by using the additional API </p>
<p>Dem_InitDiagnosticVariant()</p>
<p>. Details in chapter <i>6.2.2.2 </i></p>
<p><i>Dem_Init </i>and in chapter  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>If a new pre-compile configuration is used, the NvRAM must be initialized externally </p>
<p>e.g. via </p>
<p>Dem_NvDataInit()</p>
<p>.</p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p>SW-Components including Monitor Functions are initialized afterwards. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Starting with DEM 2.14.00 you must take special care that the NvRAM block(s) were </p>
<p>either correctly restored from a previously stored state or you (resp. the NvM) must call </p>
<p>the corresponding initialization function before calling </p>
<p>Dem_Init()</p>
<p>. </p>
<p><b>Starting the Dem with corrupt or uninitialized data will trigger undefined </b></p>
<p><b>behaviour. </b></p>
<p>The Dem will not check any more the block’s </p>
<p>NvM_GetErrorStatus() </p>
<p>as this might </p>
<p>result in unintentional data clearing when there were NV write problems during ECU </p>
<p>sleep/wakeup sequence. </p>
<p>For important information please refer to chapter <i>6.4.1 Dem_NvDataInit </i>and </p>
<p><i>8.2.11 NvRam Block IDs </i></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.3 </b></p>
<p><b>States </b></p>
<p>DEM_</p>
<p>IsUninitialized</p>
<p>DEM_IsEnabled</p>
<p>DEM_IsEnabled</p>
<p>AndRunning</p>
<p>DEM_</p>
<p>IsDisabled</p>
<p>(Re)Start/Dem_PreInit()</p>
<p>Dem_Init()</p>
<p>Dem_PreInit()</p>
<p>Dem_Init()</p>
<p>Dem_Main</p>
<p>Function()</p>
<p>Dem_</p>
<p>Shutdown()</p>
<p> </p>
<p>Figure 4-1 </p>
<p>DEM States </p>
<p>After  the  (re)start  of  the  ECU  or  the  call  of </p>
<p>Dem_PreInit()</p>
<p>  the  DEM</p>
<p> </p>
<p>is  in  state </p>
<p>DEM_IsUnitialized</p>
<p>. </p>
<p>In </p>
<p>this </p>
<p>state, </p>
<p>only </p>
<p>BSW </p>
<p>errors </p>
<p>can </p>
<p>be </p>
<p>reported </p>
<p>via </p>
<p>Dem_ReportErrorStatus()</p>
<p>.  </p>
<p>During  initialization  via </p>
<p>Dem_Init() </p>
<p>the  DEM  switches  to  the  state </p>
<p>DEM_IsEnabled</p>
<p>. </p>
<p>The DTC storage is activated and the first task of </p>
<p>Dem_MainFunction()</p>
<p> is to execute </p>
<p>(and empty) the BSW queue. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>17 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Thus, </p>
<p>normal </p>
<p>operation </p>
<p>mode </p>
<p>(</p>
<p>DEM_IsEnabledAndRunning</p>
<p>) </p>
<p>is </p>
<p>started, </p>
<p>until </p>
<p>Dem_Shutdown()</p>
<p> will finalize all pending operations in the DEM and deactivate the DTC </p>
<p>storage (</p>
<p>Dem_IsDisabled</p>
<p>).  </p>
<p><b>4.4 </b></p>
<p><b>Main Functions </b></p>
<p>The function </p>
<p>Dem_MainFunction() </p>
<p>is used to process all DEM internal functions. It </p>
<p>shall be called periodically, e.g., every 10ms as cyclic task by the AUTOSAR Schedule </p>
<p>Manager. </p>
<p>All actions of event based APIs (e.g. </p>
<p>Dem_SetEventStatus()</p>
<p> and </p>
<p>Dem_SetOperationCycleState()</p>
<p>) are logged synchronously to the BSW event queue </p>
<p>and are executed during the next </p>
<p>Dem_MainFunction()</p>
<p> call. Thereby the logged </p>
<p>sequence will be kept except for first call of the main function. In this case stored operation </p>
<p>cycle changes will be brought forward to avoid that possibly reported BSW errors </p>
<p>(</p>
<p>Dem_ReportErrorStatus()</p>
<p>) are discarded due their OperationCycle being </p>
<p>DEM_CYCLE_STATE_END (default value after startup) and thus prohibiting the setting of </p>
<p>the events. </p>
<p>The number of actions to be queued is limited by the configurable values Bsw Error Buffer Size and  Add </p>
<p>Error Buffer Size  </p>
<p>The number of actions to be queued is limited by the configurable values</p>
<p> Bsw Error Buffer Size </p>
<p>and </p>
<p>Add Error Buffer Size </p>
<p>(see 8.2.9 for more details). </p>
<p><i><b>Functions logged in queue (state: DEM_IsEnabled): </b></i></p>
<p>Dem_ReportErrorStatus() </p>
<p>Dem_SetEventStatus() </p>
<p>Dem_ClearDTC() </p>
<p>Dem_EnableDTCStorage()  </p>
<p><i><b>Logged in queue for Operation cycles: </b></i></p>
<p>Dem_SetOperationCycleState() </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To notify the application that the queue is full and the API could not be added  </p>
<p>- </p>
<p>for the APIs </p>
<p>Dem_SetEventStatus(), Dem_ResetEventStatus() </p>
<p>and </p>
<p>Dem_SetOperationCycleState()</p>
<p>an additional return value is implemented:  </p>
<p>Without RTE: DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p>With RTE: </p>
<p> </p>
<p>RTE_E_DiagnosticMonitor_DEM_E_QUEUE_OVERFLOW </p>
<p>(15u) </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>RTE_E_OperationCycle_DEM_E_QUEUE_OVERFLOW  </p>
<p> </p>
<p>(15u) </p>
<p>- </p>
<p>the value </p>
<p>DEM_DTC_PENDING</p>
<p> is returned for the APIs </p>
<p>Dem_ClearDTC()</p>
<p> and</p>
<p> </p>
<p>Dem_EnableDTCStorage()</p>
<p>. So it is not necessary to implement an additional </p>
<p>return value for these APIs which are called by the DCM.  </p>
<p>a development error will be reported for the API </p>
<p>Dem_ReportErrorStatus()</p>
<p>: </p>
<p>ErrorId:  </p>
<p> </p>
<p> </p>
<p>DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>18 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The return value and the development error DEM_E_QUEUE_OVERFLOW are </p>
<p>extensions to AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>19 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>20 / 127</p>
<p><b>4.5 </b></p>
<p><b>Event De-bouncing </b></p>
<p>For event de-bouncing the DEM supports two different mechanisms which are described </p>
<p>below. . Please refer to chapter 8.1.1 and 8.2.12.5.2 for configuration details. </p>
<p> </p>
<p><b>4.5.1 </b></p>
<p><b>Via Counter Based Algorithm </b></p>
<p>Depended  on  the  configured  de-bounce  step  size,  the  DEM  must  be  triggered  actively </p>
<p>multiple times by application, until an event will be qualified as passed or failed. The step </p>
<p>sizes for count up and count down may have different values. An event will be qualified as </p>
<p>‘failed’,  if  the  fault  detection  counter  reaches  the  value  127.  If  the  value  -128  will  be </p>
<p>reached the event will be qualified as ‘passed’. Figure 4-2 gives an overview of event de-</p>
<p>bouncing by fault detection counter. </p>
<p> </p>
<p>SetEvent(#4, </p>
<p>prefailed) </p>
<p>1</p>
<p>time</p>
<p>100</p>
<p>100</p>
<p>#3</p>
<p>0</p>
<p>count</p>
<p>16</p>
<p>32</p>
<p>#2</p>
<p>0</p>
<p>count</p>
<p>4</p>
<p>2</p>
<p>#4</p>
<p>0</p>
<p>time</p>
<p>200</p>
<p>100</p>
<p>#1</p>
<p>TimeoutSlot</p>
<p>Index</p>
<p>Debounce</p>
<p>Algorithm</p>
<p>Passed</p>
<p>Threshold / </p>
<p>Step Down</p>
<p>Failed</p>
<p>Threshold</p>
<p>/ StepUp</p>
<p>EventId</p>
<p>~</p>
<p>SetEvent(#2, </p>
<p>prefailed) </p>
<p>SetEvent(#4, </p>
<p>prepassed) </p>
<p>Fault Detection</p>
<p>Counter</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>0</p>
<p>0</p>
<p>0</p>
<p>2</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>0</p>
<p>0</p>
<p>2</p>
<p>32</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>32</p>
<p>0</p>
<p>0</p>
<p>-2</p>
<p>96</p>
<p>0</p>
<p>0</p>
<p>~</p>
<p>0</p>
<p>0</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>reports</p>
<p>127</p>
<p>SetEvent(#4, </p>
<p>prepassed) </p>
<p>Fault Detection</p>
<p>Counter</p>
<p>0</p>
<p>0</p>
<p>-6</p>
<p>-10</p>
<p>-10</p>
<p>SetEvent(#2, </p>
<p>prefailed) </p>
<p>SetEvent(#4, </p>
<p>prepassed) </p>
<p>SetEvent(#2, </p>
<p>prefailed) </p>
<p>EventId #4 is</p>
<p>qualified as </p>
<p><b>failed</b></p>
<p>SetEvent(#2, </p>
<p>prefailed) </p>
<p>64</p>
<p> </p>
<p>Figure 4-2 </p>
<p>Event De-bouncing via counter based algorithm </p>
<p><b>4.5.2 </b></p>
<p><b>Via Time Based Algorithm </b></p>
<p>Time  based  de-bounced  events  must  be  triggered  only  once  by  application  to  set  a </p>
<p>qualification direction. The event will be qualified after the configured de-bounce time has </p>
<p>been elapsed. Multiple triggers for the same event and same qualification direction won’t </p>
<p>have any effects.  </p>
<p>If an event which was reported as ‘prefailed’ and has not been qualified yet will be reported </p>
<p>again as ‘prepassed’, the timer will be reloaded with the corresponding de-bounce timer </p>
<p>value. Hence, once an event was reported the timer can only be stopped with “clear DTC” </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>21 / 127</p>
<p>or “restart of Operation cycle”. Figure 4-3 gives an overview of the time based de-bounce </p>
<p>mechanism. </p>
<p>Timer</p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>SetEvent(#4, </p>
<p>prefailed) </p>
<p>1</p>
<p>time</p>
<p>100</p>
<p>100</p>
<p>#3</p>
<p>0</p>
<p>count</p>
<p>16</p>
<p>32</p>
<p>#2</p>
<p>2</p>
<p>time</p>
<p>200</p>
<p>100</p>
<p>#4</p>
<p>0</p>
<p>time</p>
<p>200</p>
<p>100</p>
<p>#1</p>
<p>TimeoutSlot</p>
<p>Index</p>
<p>Debounce</p>
<p>Algorithm</p>
<p>Passed</p>
<p>Threshold / </p>
<p>Step Down</p>
<p>Failed</p>
<p>Threshold</p>
<p>/ StepUp</p>
<p>EventId</p>
<p>~</p>
<p>~</p>
<p>Timer</p>
<p>Timer</p>
<p>118</p>
<p>Timer</p>
<p>Timer</p>
<p>Timer</p>
<p>219</p>
<p>220</p>
<p>19</p>
<p>18</p>
<p>17</p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>0</p>
<p>0</p>
<p>117</p>
<p>SetEvent(#1, </p>
<p>prefailed) </p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>0</p>
<p>117</p>
<p>118</p>
<p>SetEvent(#4, </p>
<p>prepassed) </p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>118</p>
<p>0</p>
<p>219</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>0</p>
<p>0</p>
<p>0</p>
<p>1</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>0</p>
<p>0</p>
<p>1</p>
<p>1</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>1</p>
<p>0</p>
<p>0</p>
<p>-1</p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>0</p>
<p>219</p>
<p>0</p>
<p>127</p>
<p>0</p>
<p>0</p>
<p>-1</p>
<p>~</p>
<p>~</p>
<p>Event Timeout</p>
<p>Slot Table</p>
<p>0</p>
<p>0</p>
<p>0</p>
<p>127</p>
<p>0</p>
<p>0</p>
<p>-128</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>Fault Detection</p>
<p>Counter</p>
<p>DEM cyclic task</p>
<p>reports</p>
<p>EventId #4 is</p>
<p>qualified as </p>
<p><b>passed</b></p>
<p>EventId #1 is</p>
<p>qualified as </p>
<p><b>failed</b></p>
<p> </p>
<p>Figure 4-3 </p>
<p>Event De-bouncing via time based algorithm </p>
<p><b>4.6 </b></p>
<p><b>Error Handling </b></p>
<p><b>4.6.1 </b></p>
<p><b>Development Error Reporting </b></p>
<p>Development errors are reported to DET using the service </p>
<p>Det_ReportError()</p>
<p>, when </p>
<p>the pre-compile parameter </p>
<p>DEM_DEV_ERROR_DETECT </p>
<p>is set to</p>
<p> STD_ON</p>
<p>. </p>
<p>This parameter is preconfigured and automatically generated into Dem_Cfg.h. If activated, </p>
<p>the file Dem.c will include the file Det.h to get the necessary prototype for above function </p>
<p>(see [2] for more details). </p>
<p>This include is an extension to AUTOSAR’s code/header file structure. </p>
<p>The reported </p>
<p>ModuleId</p>
<p> is </p>
<p>DEM_MODULE_ID</p>
<p> (54 dec). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>The  reported  service  IDs  identify  the  services  which  are  described  in  6.2. The  following </p>
<p>table presents the service IDs, the related services and corresponding errors: </p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x00 </p>
<p>Dem_GetVersionInfo </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>versioninfo </p>
<p>invalid </p>
<p>0x01 </p>
<p>Dem_PreInit </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Vehicle System Group (VSG) mode:  </p>
<p>no configuration defined at all – given </p>
<p>parameter is invalid </p>
<p>0x02 </p>
<p>Dem_Init </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid config: Dem_PBCfg.c was </p>
<p>compiled with different size for type </p>
<p>Dem_EventIdType (typedef'd by RTE)</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid config: Dem_PBCfg.c was </p>
<p>generated for a different DEM version </p>
<p>0x03 </p>
<p>Dem_Shutdown </p>
<p>- </p>
<p>- </p>
<p>- </p>
<p>0x04 </p>
<p>Dem_SetEventStatus </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventId</p>
<p> or invalid </p>
<p>EventStatus</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x05 </p>
<p>Dem_ResetEventStatus </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x06 </p>
<p>Dem_PrestoreFreezeFrame </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>EventId</p>
<p> is not configured for </p>
<p>prestoring FreezeFrame </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x07 </p>
<p>Dem_ClearPrestoredFreezeFrame </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>EventId</p>
<p> is not configured for </p>
<p>prestoring FreezeFrame </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>22 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>23 / 127</p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x08 </p>
<p>Dem_SetOperationCycleState </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>OperationCycleId</p>
<p> is not </p>
<p>configured </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>CycleState</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x0A </p>
<p>Dem_GetEventStatus </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x0B </p>
<p>Dem_GetEventFailed </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x0C </p>
<p>Dem_GetEventTested </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x0D </p>
<p>Dem_GetDTCOfEvent </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid </p>
<p>EventId</p>
<p> or DTC number not </p>
<p>configured for </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x0E </p>
<p>Dem_GetSeverityOfDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTCSeverity </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x0F </p>
<p>Dem_ReportErrorStatus </p>
<p>0x0F</p>
<p>DEM_E_QUEUE_ </p>
<p>OVERFLOW </p>
<p>API service call could not be added to </p>
<p>the action queue (overflow)  </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>EventStatus </p>
<p>or</p>
<p> EventId</p>
<p>  </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>24 / 127</p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x13 </p>
<p>Dem_SetDTCFilter </p>
<p>0x10</p>
<p> </p>
<p> </p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid argument(s) </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x14 </p>
<p>Dem_SetViewFilter </p>
<p>- </p>
<p>- </p>
<p>- </p>
<p>0x15 </p>
<p>Dem_GetStatusOfDTC </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTCStatus </p>
<p>invalid </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x16 </p>
<p>Dem_GetDTCStatusAvailabilityMask</p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTCStatusMask</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x17 </p>
<p>Dem_GetNumberOfFilteredDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>NumberOfFilteredDTC</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x18 </p>
<p>Dem_GetNextFilteredDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC </p>
<p>or</p>
<p> </p>
<p>DTCStatus </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x19 </p>
<p>Dem_GetDTCByOccurrenceTime </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC</p>
<p> </p>
<p>invalid </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCRequest</p>
<p> </p>
<p>or</p>
<p> </p>
<p>DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x1A </p>
<p>Dem_DisableDTCRecordUpdate </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x1B </p>
<p>Dem_EnableDTCRecordUpdate </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x1C </p>
<p>Dem_GetDTCOfFreezeFrame </p>
<p>Record </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p>or</p>
<p> </p>
<p>DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x1D </p>
<p>Dem_GetFreezeFrameDataByDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DestBuffer </p>
<p>or inout parameter</p>
<p> </p>
<p>BufSize</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>25 / 127</p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x1E </p>
<p>Dem_GetFreezeFrameDataIdentifier</p>
<p>ByDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>ArraySize </p>
<p>or</p>
<p> DataId</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x1F </p>
<p>Dem_GetSizeOfFreezeFrame </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>SizeOfFreezeFrame</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x20 </p>
<p>Dem_GetExtendedDataRecordBy </p>
<p>DTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DestBuffer </p>
<p>or inout parameter</p>
<p> </p>
<p>BufSize</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x21 </p>
<p>Dem_GetSizeOfExtendedData </p>
<p>RecordByDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>SizeOfExtendedDataRecord</p>
<p> </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x22 </p>
<p>Dem_ClearDTC </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCOrigin</p>
<p> </p>
<p>or</p>
<p> DTCKind</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x24 </p>
<p>Dem_DisableDTCStorage </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCKind</p>
<p> </p>
<p>or</p>
<p> DTCGroup</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x25 </p>
<p>Dem_EnableDTCStorage </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCKind</p>
<p> </p>
<p>or</p>
<p> DTCGroup</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x26 </p>
<p>Dem_DisableEventStatusUpdate </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCKind</p>
<p> </p>
<p>or</p>
<p> DTCGroup</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x27 </p>
<p>Dem_EnableEventStatusUpdate </p>
<p>0x12</p>
<p>DEM_E_PARAM_ </p>
<p>DATA </p>
<p>Invalid </p>
<p>DTCKind</p>
<p> </p>
<p>or</p>
<p> DTCGroup</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>26 / 127</p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x29 </p>
<p>Dem_GetIndicatorStatus </p>
<p>0x93</p>
<p>DEM_E_TOO_ </p>
<p>MANY_INDICATOR</p>
<p>_IDS </p>
<p>Too many indicators configured (&gt; </p>
<p>65534)  </p>
<p>0x36 </p>
<p>Dem_GetViewIDOfDTC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>ViewId </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x37 </p>
<p>Callback </p>
<p>GetExtendedDataRecord<i>{record-</i></p>
<p><i>Number} </i></p>
<p>0x30</p>
<p>DEM_E_NODATAAV</p>
<p>AILABLE </p>
<p>Configured function </p>
<p>Xxx_DemGetExtendedDataRecord</p>
<p><i>{recordNumber}</i>() </p>
<p>returned </p>
<p>E_NOT_OK</p>
<p> and DEM fills the record </p>
<p>with dummy value </p>
<p>0xFF</p>
<p> </p>
<p>0x38 </p>
<p>Dem_SetValueByOemId </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DataValue</p>
<p> invalid </p>
<p>0x39 </p>
<p>Dem_SetEnableCondition </p>
<p>- </p>
<p>- </p>
<p>- </p>
<p>0x3A </p>
<p>Dem_GetNextFilteredRecord </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC </p>
<p>or</p>
<p> </p>
<p>SnapshotRecord </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x3B </p>
<p>Dem_GetNextFilteredDTCAndFDC </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC </p>
<p>or</p>
<p> </p>
<p>DTCFaultDetectionCounter </p>
<p>invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x3C </p>
<p>Dem_GetTranslationType </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x3D </p>
<p>Dem_GetNextFilteredDTCAnd </p>
<p>Severity </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>DTC, </p>
<p>DTCStatus, DTCSeverity </p>
<p>or</p>
<p> </p>
<p>DTCFunctionalUnit</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0x3E </p>
<p>Dem_GetFaultDetectionCounter </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p> </p>
<p> </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in current </p>
<p>configuration </p>
<p>0x3F </p>
<p>Dem_SetDTCFilterForRecords </p>
<p>0x11</p>
<p>DEM_E_PARAM_ </p>
<p>ADDRESS </p>
<p>Address for out parameter </p>
<p>NumberOfFilteredRecords</p>
<p> invalid</p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>27 / 127</p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x55 </p>
<p>Dem_MainFunction </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: a </p>
<p>module called API </p>
<p>Dem_SetEventStatus()</p>
<p> or  API </p>
<p>Dem_ReportErrorStatus()</p>
<p> </p>
<p>with an </p>
<p>EventId</p>
<p>, which is not active </p>
<p>in current configuration </p>
<p>Table 4-3  </p>
<p>Mapping of Service IDs to Services and Corresponding Errors </p>
<p>The  reported  service  IDs  identify  the  services  which  are  described  in  6.2. The  following </p>
<p>table presents the service IDs of APIs not defined by AUTOSAR, the related services and </p>
<p>corresponding errors: </p>
<p><b>Servi</b></p>
<p><b>ce ID </b></p>
<p><b>Service </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0xE1 </p>
<p>Dem_GetOccurrenceCounter </p>
<p>0x10</p>
<p>DEM_E_PARAM_ </p>
<p>CONFIG </p>
<p>Invalid </p>
<p>EventId</p>
<p> </p>
<p> </p>
<p> </p>
<p>0x20 DEM_E_UNINIT </p>
<p>API service called before the DEM </p>
<p>module has been initialized </p>
<p>0xFE </p>
<p>Dem_InitDiagnosticVariant </p>
<p>0x96</p>
<p>DEM_E_NOT_IN_ </p>
<p>ACTIVE_VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>API was called twice or API was called </p>
<p>after calling </p>
<p>Dem_PreInit()</p>
<p> </p>
<p>Table 4-4  </p>
<p>Mapping of additional Service IDs to Services and Corresponding Errors </p>
<p>The errors reported to DET are described in the following table: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x10 </p>
<p>DEM_E_PARAM_CONFIG </p>
<p>API service called with wrong parameter – configuration error </p>
<p>0x11 </p>
<p>DEM_E_PARAM_ADDRESS </p>
<p>API service called with invalid address </p>
<p>0x12 </p>
<p>DEM_E_PARAM_DATA </p>
<p>API service called with wrong parameter – invalid value </p>
<p>0x13 </p>
<p>DEM_E_PARAM_LENGTH </p>
<p>API service called with wrong parameter – invalid length </p>
<p>0x20 </p>
<p>DEM_E_UNINIT </p>
<p>API service called before the DEM module has been initialized</p>
<p>0x30 </p>
<p>DEM_E_NODATAAVAILABLE </p>
<p>No valid data available by the SW-C </p>
<p>0x96 </p>
<p>DEM_E_NOT_IN_ACTIVE_ </p>
<p>VARIANT </p>
<p>Vehicle System Group (VSG) mode: </p>
<p>EventId</p>
<p> is not active in </p>
<p>current configuration </p>
<p>Table 4-5  </p>
<p>Errors Reported to DET </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Internal debug codes of the DEM use the range 0x80…0x9F to report errors to the DET: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x82 </p>
<p>DEM_E_DTC_NOT_FOUND </p>
<p>No DTC found for </p>
<p>EventId</p>
<p> </p>
<p>0x83 </p>
<p>DEM_E_ERASING_EMPTY_STACK </p>
<p>No entry found in chrono stack / primary memory </p>
<p>0x86 </p>
<p>DEM_E_INV_CSTACK_REF </p>
<p>Invalid chrono stack / primary memory reference </p>
<p>0x89 </p>
<p>DEM_E_INV_SFN </p>
<p>EventId</p>
<p> beyond configured range </p>
<p>0x8F </p>
<p>DEM_E_INV_SNAPSHOT_NUM </p>
<p>Snapshot record number / freeze frame record </p>
<p>number beyond configured range </p>
<p>0x90 </p>
<p>DEM_E_ZEROPTR_SOURCE </p>
<p>Source address for moving data NULL </p>
<p>0x91 </p>
<p>DEM_E_ZEROPTR_TARGET </p>
<p>Target address for moving data NULL </p>
<p>0x92 </p>
<p>Dem_E_TOO_MANY_DIDS_FOR_EVENT</p>
<p>Number of DIDs for event exceeds maximum </p>
<p>0x93 </p>
<p>DEM_E_TOO_MANY_INDICATOR_IDS </p>
<p>Too many indicators configured </p>
<p>0x95 </p>
<p>DEM_E_INV_TIMER_SLOT_VAL </p>
<p>Invalid timer slot value for the timer based de-bounce </p>
<p>algorithm </p>
<p>Table 4-6  </p>
<p>Errors Reported to DET – Internal Debug Codes </p>
<p><b>4.6.1.1 </b></p>
<p><b>Parameter Checking  </b></p>
<p>AUTOSAR requires that API functions check the validity of their parameters. The checks in </p>
<p>Table 4-7 are internal parameter checks of the API functions. AUTOSAR standard requires </p>
<p>to </p>
<p>en-/disable </p>
<p>the </p>
<p>complete </p>
<p>parameter </p>
<p>checking </p>
<p>via </p>
<p>the </p>
<p>parameter </p>
<p>DEM</p>
<p>_</p>
<p>DEV_ERROR_DETECT. </p>
<p> </p>
<p>The following table shows which parameter checks are performed on which services: </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>EventId </p>
<p>EventStatus </p>
<p>versioninfo </p>
<p>nvBlockStatus </p>
<p>Dem_SizeofEventId </p>
<p>Type </p>
<p>Dem_PBConfig.Dem_ </p>
<p>PBCfgLeader </p>
<p>Dem_PBConfig.Dem_ </p>
<p>PBCfgTrailer </p>
<p>PrestoreFFBufferOffset </p>
<p>OperationCycleId </p>
<p>CycleState </p>
<p>Dem_GetVersionInfo </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_PreInit </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_Init </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_Shutdown </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetEventStatus </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_ResetEventStatus </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_PrestoreFreezeFrame </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetOperationCycleState </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetEventStatus </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetEventFailed </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>28 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>29 / 127</p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>EventId </p>
<p>EventStatus </p>
<p>versioninfo </p>
<p>nvBlockStatus </p>
<p>Dem_SizeofEventId </p>
<p>Type </p>
<p>Dem_PBConfig.Dem_ </p>
<p>PBCfgLeader </p>
<p>Dem_PBConfig.Dem_ </p>
<p>PBCfgTrailer </p>
<p>PrestoreFFBufferOffset </p>
<p>OperationCycleId </p>
<p>CycleState </p>
<p>Dem_GetEventTested </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>EventId </p>
<p>EventStatus </p>
<p>DTCKind </p>
<p>DTCOrigin </p>
<p>DTCSeverity </p>
<p>DTC </p>
<p>DataValue </p>
<p>indicatorRef </p>
<p>FilterWithSeverity </p>
<p>FilterForFaultDetection </p>
<p>Counter </p>
<p>Dem_GetDTCOfEvent </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetValueByOemId </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetEnableCondition </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetFaultDetectionCounter </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetIndicatorStatus </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_ReportErrorStatus </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetDTCFilter </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>DTC </p>
<p>DTCKind </p>
<p>DTCOrigin </p>
<p>DTCStatus </p>
<p>DTCRequest </p>
<p>NumberOfFilteredRecord</p>
<p>s </p>
<p>DTCStatusMask </p>
<p>NumberOfFilteredDTC </p>
<p>ViewId </p>
<p>SnapshotRecord </p>
<p>Dem_SetDTCFilterForRecords </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_SetViewFilter </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetStatusOfDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetDTCStatusAvailabilityMask </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetNumberOfFilteredDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetNextFilteredDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetDTCByOccurrenceTime </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetViewIDOfDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetNextFilteredRecord </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>DTC </p>
<p>DTCKind </p>
<p>DTCOrigin </p>
<p>DTCStatus </p>
<p>DTCFaultDetectionCoun</p>
<p>ter </p>
<p>DTCSeverity </p>
<p>DTCFunctionalUnit </p>
<p>DTCSeverity </p>
<p>DestBuffer </p>
<p>BufSize </p>
<p>Dem_GetNextFilteredDTCAndFDC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndSeverit</p>
<p>y </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetTranslationType </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetSeverityOfDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_DisableDTCRecordUpdate </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_EnableDTCRecordUpdate </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetDTCOfFreezeFrameRecord </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetFreezeFrameDataByDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>Dem_InitializationStatus </p>
<p>DTCKind </p>
<p>DTCOrigin </p>
<p>DTCStatus </p>
<p>ArraySize </p>
<p>DataId </p>
<p>SizeOfFreezeFrame </p>
<p>DestBuffer </p>
<p>BufSize </p>
<p>SizeOfExtendedDataRec</p>
<p>ord </p>
<p>DTCGroup </p>
<p>Dem_GetFreezeFrameDataIdentifierB</p>
<p>yDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetSizeOfFreezeFrame </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetExtendedDataRecordByDT</p>
<p>C </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_GetSizeOfExtendedDataRecord</p>
<p>ByDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_ClearDTC </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_DisableDTCStorage </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_EnableDTCStorage </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_DisableEventStatusUpdate </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Dem_EnableEventStatusUpdate </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Table 4-7  </p>
<p>Development Error Reporting: Assignment of Checks to Services </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Using the DEM APIs with disabled DET and invalid parameters may result in an </p>
<p>undefined behavior. </p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>30 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>4.6.2 </b></p>
<p><b>Production Code Error Reporting </b></p>
<p>DEM does not report any production code related errors. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Production errors in general are errors which shall be saved through the DEM by </p>
<p>definition. Errors of DEM itself occurring during normal operation are not saved. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>31 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>5 </b></p>
<p><b>Integration </b></p>
<p>This chapter gives necessary information for the integration of the MICROSAR DEM into </p>
<p>an application environment of an ECU. </p>
<p><b>5.1 </b></p>
<p><b>Scope of Delivery </b></p>
<p>The delivery of the DEM contains the files which are described in the chapters 5.1.1 and </p>
<p>5.1.2. </p>
<p><b>5.1.1 </b></p>
<p><b>Static Files </b></p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>Dem.c </p>
<p>This is the source file of the DEM. It contains the main functionality of the DEM.</p>
<p> </p>
<p>Dem.h </p>
<p>This is the header file of the DEM. It provides the DEM API functions to other </p>
<p>modules. </p>
<p>Dem_Types.h </p>
<p>This is a header file of the DEM. It contains all DEM data types. </p>
<p>Table 5-1  </p>
<p>Static Files of Delivery </p>
<p> </p>
<p><b>5.1.2 </b></p>
<p><b>Dynamic Files </b></p>
<p>The dynamic files are generated by the configuration tool GENy. </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>Dem_PBcfg.c </p>
<p>This is a source file of the generated part of the DEM. It contains the post-build </p>
<p>configuration of the DEM. </p>
<p>Dem_PBcfg.h </p>
<p>This is a header file of the generated part of the DEM. It contains the post-build </p>
<p>time configurable parameters. </p>
<p>Dem_Lcfg.c </p>
<p>This is a source file of the generated part of the DEM. It contains the link-time </p>
<p>configuration of the DEM. </p>
<p>Dem_Lcfg.h </p>
<p>This is a header file of the generated part of the DEM. It contains the link-time </p>
<p>configurable parameters. </p>
<p>Dem_Cbk.h </p>
<p>This is a header file of the generated part of the DEM. It contains prototypes of </p>
<p>callback functions offered by other components (replacement for DEM's ClientPort </p>
<p>when no RTE available). </p>
<p> </p>
<p>- </p>
<p>Only generated when RTE is <b>not </b>part of the configuration - </p>
<p> </p>
<p>Dem_swc.arxml </p>
<p>This file is used for the RTE generation. It contains the information to get </p>
<p>prototypes of callback functions offered by other components. </p>
<p> </p>
<p>- Only generated when RTE is part of the configuration - </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>32 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>33 / 127</p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>Dem_Cfg.h </p>
<p>This is a header file of the generated part of the DEM. It contains the DEM </p>
<p>precompiled parameters. </p>
<p>Dem_IntErrId.h </p>
<p>This is a header file of the generated part of the DEM. It contains the BSW event Id </p>
<p>symbols. </p>
<p>Dem_IntEvtId.h </p>
<p>This is a header file of the generated part of the DEM. It contains the SW_C event </p>
<p>Id symbols. </p>
<p>Table 5-2  </p>
<p>Generated (Dynamic) Files of Delivery </p>
<p> </p>
<p><b>5.2 </b></p>
<p><b>Include Structure  </b></p>
<p><b>dm DEM 3.0 Include Structure</b></p>
<p><b>Dem.c</b></p>
<p><b>Dem.h</b></p>
<p><b>FiM.h {R3.0}</b></p>
<p><b>NvM.h {R3.0}</b></p>
<p><b>SchM_ Dem.h</b></p>
<p><b>MemMap.h {R3.0}</b></p>
<p><b>Dem_PBc fg.c *</b></p>
<p><b>Dem_Lc fg.h *</b></p>
<p><b>Dem_Types.h</b></p>
<p><b>Dem_IntE rrId.h *</b></p>
<p><b>notes</b></p>
<p><i>BSW event ID symbol</i></p>
<p><i>s</i></p>
<p><b>Det.h</b></p>
<p><b>Std_Types.h</b></p>
<p>{with RTE}</p>
<p><b>Dem_Cfg.h *</b></p>
<p><b>Dem_PBc fg.h *</b></p>
<p><b>Dem_IntE v tId.h *</b></p>
<p><b>notes</b></p>
<p><i>other event ID symbol</i></p>
<p><i>s</i></p>
<p>Legend:</p>
<p>*    generated file</p>
<p>{}  constraint</p>
<p><b>Rte_De m.h *</b></p>
<p><b>Rte_Type.h *</b></p>
<p><b>Dem_Lcfg.c *</b></p>
<p>{with RTE}</p>
<p><b>Dem_Cbk.h *</b></p>
<p><b>notes</b></p>
<p><i>Callback Prototypes fo</i></p>
<p><i>r</i></p>
<p><i>(external) ServerPorts </i></p>
<p><i>used by DEM</i></p>
<p>{without RTE}</p>
<p>{DEM_DEV_ERROR_DETECT}</p>
<p>{without RTE}:</p>
<p>additionally contains #defines and </p>
<p>typedefs equivalent to Rte_Type.h</p>
<p>MemMap.h is included by:</p>
<p>dem.c, dem_lcfg.c, dem_pbcfg.c,</p>
<p>dem_types.h, dem_lcfg.h, </p>
<p>dem_pbcfg.h</p>
<p>choose by preconfig:</p>
<p>#define DEM_USE_RTE STD_ON</p>
<p>#define DEM_USE_RTE STD_OFF</p>
<p><b>EcuM_ Cbk.h</b></p>
<p>{with DEM_CONFIGURATIO_VARIANT2 </p>
<p>(post-bui ld)}</p>
<p>{with RTE</p>
<p>(for consistency check)}</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p> </p>
<p>Figure 5-1 </p>
<p>Include Structure </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>5.3 </b></p>
<p><b>Compiler Abstraction and Memory Mapping  </b></p>
<p>The  objects  (e.g.  variables,  functions,  constants)  are  declared  by  compiler  independent </p>
<p>definitions  –  the  compiler  abstraction  definitions.  Each  compiler  abstraction  definition  is </p>
<p>assigned to a memory section. </p>
<p>The  following  table  contains  the  memory  section  names  and  the  compiler  abstraction </p>
<p>definitions defined for the DEM and illustrates their assignment among each other. </p>
<p><b>Compiler Abstraction</b></p>
<p><b>Definitions</b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b>Memory Mapping </b></p>
<p><b>Sections </b></p>
<p>DEM_CODE </p>
<p>DEM_VAR_NOINIT_FAST </p>
<p>DEM_VAR </p>
<p>DEM_VAR_NOINIT </p>
<p>DEM_CONST </p>
<p>DEM_APPL_CONST </p>
<p>DEM_APPL_DATA </p>
<p>DEM_PBCFG </p>
<p>DEM_START_SEC_CODE </p>
<p>DEM_STOP_SEC_CODE </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CONST_LCFG </p>
<p>DEM_STOP_SEC_CONST_LCFG </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_PBCONST </p>
<p>DEM_STOP_SEC_PBCONST </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CONST_8BIT </p>
<p>DEM_STOP_SEC_CONST_8BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CONST_32BIT </p>
<p>DEM_STOP_SEC_CONST_32BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CONST_UNSPECIFIED </p>
<p>DEM_STOP_SEC_CONST_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_8BIT </p>
<p>DEM_STOP_SEC_VAR_8BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_FAST_8BIT </p>
<p>DEM_STOP_SEC_VAR_FAST_8BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_NOINIT_8BIT </p>
<p>DEM_STOP_SEC_VAR_NOINIT_8BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_NOINIT_16BIT </p>
<p>DEM_STOP_SEC_VAR_NOINIT_16BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_NOINIT_UNSPECIFIED </p>
<p>DEM_STOP_SEC_VAR_NOINIT_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_VAR_SAVED_ZONE0_UNSPECIFIED</p>
<p>DEM_STOP_SEC_VAR_SAVED_ZONE0_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Table 5-3  </p>
<p>Compiler Abstraction and Memory Mapping </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>34 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>5.4 </b></p>
<p><b>Critical Sections </b></p>
<p>To protect internal data structures against unwanted modification, the DEM uses “Critical </p>
<p>Sections” for blocking concurrent access. Typically the function </p>
<p>Dem_EnterCritical()</p>
<p> </p>
<p>disables interrupt or the task switching and </p>
<p>Dem_LeaveCritical()</p>
<p> re-enables it again. </p>
<p>Dependent </p>
<p>on </p>
<p>the </p>
<p>customer’s </p>
<p>requirements, </p>
<p>the </p>
<p>delivery </p>
<p>uses </p>
<p>one </p>
<p>of </p>
<p>the </p>
<p>following </p>
<p>methods to handle the critical sections (the evaluation bundle has implemented AUTOSAR </p>
<p>Schedule Manager). Look in file Dem.c section “INCLUDES” for your solution. </p>
<p>- </p>
<p>Vector standard library (VStdLib.h is included) </p>
<p>- </p>
<p>AUTOSAR Schedule Manager (SchM_Dem.h is included) </p>
<p>- </p>
<p>Disable interrupts in CAN-Driver (can.h is included) </p>
<p>There are two issues you should take special care with the critical sections: first the startup </p>
<p>phase of the ECU, when the implementation of the EnterCritical/LeaveCritical functions </p>
<p>must be operable i.e. the component implementing them (e.g. AUTOSAR Schedule </p>
<p>Manager) must be already started. Second, when the DEM uses callback functions (e.g. </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged()</p>
<p>), as these callbacks </p>
<p>are triggered inside the critical section. </p>
<p> </p>
<p><b>5.4.1 </b></p>
<p><b>Startup Phase </b></p>
<p>In AUTOSAR’s “STARTUP_1” phase DEM’s pre-init function </p>
<p>Dem_PreInit()</p>
<p> is called </p>
<p>before starting the OS. Now DEM is able to collect events from other SW-C modules via </p>
<p>Dem_ReportErrorStatus()</p>
<p> and store them in a queue. This queue is protected against </p>
<p>concurrent access by using a critical section. </p>
<p>This critical section must be handled specially. A typical implementation for EnterCritical() </p>
<p>uses methods of the OS (semaphore, mutex, interrupt blocking, …) but at this time during </p>
<p>startup the OS isn’t initialized and is not running yet! </p>
<p>Most times, this is no problem as there is no task switch possible and the interrupts are </p>
<p>disabled (until in STARTUP_2 phase </p>
<p>Dem_Init()</p>
<p> is called and the queue is switched </p>
<p>off), so the function </p>
<p>Dem_ReportErrorStatus()</p>
<p> and therefore the contained critical </p>
<p>section can never be interrupted. In this case you could use an empty implementation for </p>
<p>the Enter/LeaveCritical function. </p>
<p>But your startup may differ, thus this critical section handling is implemented as </p>
<p>Dem_EnterCritical_PreInit() / Dem_LeaveCritical_PreInit</p>
<p>() and when </p>
<p>using the AUTOSAR Schedule Manager these macros are mapped to the </p>
<p>DEM_EXCLUSIVE_AREA_1</p>
<p>.  </p>
<p>All other critical section handling is implemented as </p>
<p>Dem_EnterCritical() / </p>
<p>Dem_LeaveCritical()</p>
<p> and when using the AUTOSAR Schedule Manager these </p>
<p>macros are mapped to the </p>
<p>DEM_EXCLUSIVE_AREA_0</p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Check your startup sequence and take special care for the correct handling of critical </p>
<p>sections between </p>
<p>Dem_PreInit() </p>
<p>and </p>
<p>Dem_Init()</p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>35 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>5.4.2 </b></p>
<p><b>Call of Callback Functions </b></p>
<p>When calling </p>
<p>Dem_SetEventStatus()</p>
<p> the DEM updates the status of the event during </p>
<p>the next call of </p>
<p>Dem_MainFunction()</p>
<p>. It uses the configured (callback-) functions to get </p>
<p>the environmental data to fill the extended data and snapshot record. Finally, the DEM </p>
<p>calls configured (callback-) functions to notify the status change to other components. A </p>
<p>similar sequence is executed when events are deleted or a new operation cycle is started </p>
<p>– thereby after signalling the status change (as written above) some configured callbacks </p>
<p>are used to trigger InitMonitor functions. </p>
<p>It is almost always fatal to call these callback functions with disabled interrupts, e.g. inside </p>
<p>a critical section. Therefore the critical section is left before the callback and re-entered </p>
<p>afterwards. Meanwhile the data is protected against modification by blocking the status </p>
<p>update (see API </p>
<p>Dem_DisableEventStatusUpdate()</p>
<p> chapter 6.2.5.4.3). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Neither call DEM API functions directly nor indirectly from inside callback functions, </p>
<p>which are triggered by the DEM itself. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>5.5 </b></p>
<p><b>Call Context </b></p>
<p>The </p>
<p>DEM </p>
<p>uses </p>
<p>critical </p>
<p>sections </p>
<p>(see </p>
<p>chapter </p>
<p>5.4) </p>
<p>to </p>
<p>protect </p>
<p>against </p>
<p>simultaneous </p>
<p>modification of internal data structures. </p>
<p>The DEM uses many callback functions of other modules when collecting its data. E.g. for </p>
<p>setting  an  event,  it  will  call  (potentially  several  times  –  dependent  on  the  configuration) </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier()</p>
<p> </p>
<p>and </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord()</p>
<p> </p>
<p>and </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged()</p>
<p> </p>
<p>and </p>
<p>afterwards </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged()</p>
<p>. </p>
<p>All </p>
<p>these </p>
<p>callback </p>
<p>calls </p>
<p>will </p>
<p>run </p>
<p>in </p>
<p>the </p>
<p>call </p>
<p>context </p>
<p>of </p>
<p>the </p>
<p>caller </p>
<p>of </p>
<p>Dem_SetEventStatus()</p>
<p>! </p>
<p>If one of the callbacks would directly or indirectly call </p>
<p>Dem_SetEventStatus()</p>
<p> again, we </p>
<p>get  an  recursive  call  tree,  that  might  cause  a  deadlock  situation  –  dependent  on  the </p>
<p>implementation of the protection of critical sections. </p>
<p>To  protect  against  this,  the  action  to  store  data  is  executed  during  the  next  call  of </p>
<p>Dem_MainFunction()</p>
<p> as described in chapter 4.4. </p>
<p>To get data consistency of DEM and user data without globally disabling of interrupts, you </p>
<p>must  </p>
<p><b>&gt; </b></p>
<p>not call DEM functions from inside a callback function, which was triggered from DEM, </p>
<p><b>&gt; </b></p>
<p>not call different APIs that will access the same EventId. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>36 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Do link each Diagnostic Monitor only once to one client </p>
<p>You must not call different operations of a Diagnostic Monitor port interface <i>for the </i></p>
<p><i>same event </i>simultaneously. </p>
<p>You must not call the same operation of a Diagnostic Monitor port interface <i>for the </i></p>
<p><i>same event </i>simultaneously. </p>
<p>You must not use any operation of a Diagnostic Monitor port interface for an event that </p>
<p>is modified by a BSW module using API Dem_ReportErrorStatus. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>5.6 </b></p>
<p><b>Scheduling of DEM and DCM </b></p>
<p>To get the data for the external tester responses, the DCM accesses APIs of the DEM. To </p>
<p>avoid simultaneous data access, the DCM must not interrupt </p>
<p>Dem_MainFunction()</p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Possible implementation: </p>
<p>-</p>
<p> </p>
<p>Configure </p>
<p>Dcm_StateTask()</p>
<p> to the same priority as </p>
<p>Dem_MainFunction()</p>
<p> </p>
<p>and make sure, they cannot interrupt each other (e.g. use cooperative tasks or </p>
<p>put both functions as sequence in a common SchM task) </p>
<p>Optionally: Configure </p>
<p>Dcm_TimerTask()</p>
<p> with higher priority </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The API functions of the interface DCM – DEM must be called always from same context. </p>
<p>Do not change between interrupt context / task context … This constraint will be always </p>
<p>fulfilled if you’re using DCM from Vector. </p>
<p><b>5.7 </b></p>
<p><b>NvRAM Demand </b></p>
<p>All data which shall be stored in the NvRAM are handled with the object</p>
<p> Dem_NvData</p>
<p> of </p>
<p>the struct </p>
<p>Dem_NonVolatileDataType</p>
<p>. </p>
<p>To get NvRAM demand (data structure size) of </p>
<p>the  DEM,  temporarily  add </p>
<p>sizeof(Dem_NvData)</p>
<p>  to  the  source  and  read  value  after </p>
<p>compilation (compiler and configuration dependent). </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>37 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>38 / 127</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>There  are  pending  discussions  about  the  NVRAM  manager  interface,  due  to  an </p>
<p>incomplete SWS specification. Final solution is postponed to AUTOSAR phase II. </p>
<p>Vector’s solution expects an updated RAM mirror before Dem_Init() is called, see </p>
<p>chapter 4.2 and an automatic NVRAM updated after Dem_Shutdown() call</p>
<p>2</p>
<p> (In </p>
<p>Dem_Shutdown() the DEM marks its NvRAM Block IDs as 'Modified' by calling API </p>
<p>NvM_SetRamBlockStatus(). The following system shutdown sequence now will save </p>
<p>the data by calling NvM_WriteAll().). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>                                            </p>
<p>2</p>
<p> As specified by Dem170 and Dem102 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6 </b></p>
<p><b>API Description </b></p>
<p>For an interfaces overview see Figure 3-2. </p>
<p><b>6.1 </b></p>
<p><b>Type Definitions </b></p>
<p>The types defined by the DEM are described in [1].  </p>
<p><b>6.2 </b></p>
<p><b>Services Provided by DEM </b></p>
<p>The DEM API consists of services, which are realized by function calls. </p>
<p><b>6.2.1 </b></p>
<p><b>Dem_GetVersionInfo </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_GetVersionInfo</b>(</p>
<p> </p>
<p>   </p>
<p>Std_VersionInfoType *  versioninfo </p>
<p>)</p>
<p> </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x00 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>versioninfo </p>
<p>Pointer to where to store the version information of this module. </p>
<p><b>Return code </b></p>
<p>None </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Returns the version information of this module. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-1 </p>
<p>Dem_GetVersionInfo </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>In the description of this API in [1] the parameter </p>
<p>instanceID</p>
<p> is missing. The </p>
<p>definition in [5] includes this parameter. The implementation uses the definition in [5]. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>6.2.2 </b></p>
<p><b>Interface ECU State Manager </b></p>
<p><b>Ù</b></p>
<p><b> DEM </b></p>
<p><b>6.2.2.1 </b></p>
<p><b>Dem_PreInit </b></p>
<p>For a description of the purpose and the arguments of the function, see [1]. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>39 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>For supporting Multi Identity Mode (see chapter <i>7.1.3 Vehicle System Group (VSG) Mode</i>) </p>
<p>the API was modified: </p>
<p><b>Prototype </b></p>
<p>Single Identity Mode </p>
<p>void <b>Dem_PreInit </b>( </p>
<p>) </p>
<p>Multi Identity Mode    or    GENy setting: “Dem_PreInit() has config parameter” </p>
<p>void <b>Dem_PreInit </b>( </p>
<p>  const Dem_ConfigType *  ActiveConfig </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x01 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>ActiveConfig </p>
<p>Pointer to one of the configuration sets declared in Dem_Lcfg.h. </p>
<p>(The definition of the configurations is in Dem_Lcfg.c) </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>If multiple configuration variants are supported, the base configuration variant parameter is expected by </p>
<p>this API. The base variant object is declared in the Dem_Lcfg.h file in section “</p>
<p><b>Config Sets</b></p>
<p>”. Its actual </p>
<p>name depends on your CDD settings. </p>
<p> </p>
<p>The multi identity (VSG) mode will be active only if the generated switch </p>
<p>DEM_SUPPORT_VARIANT_HANDLING</p>
<p> in (generated) file Dem_Cfg.h is set to </p>
<p>STD_ON</p>
<p>. </p>
<p> </p>
<p>If multiple identity (VSG) mode is active, this API must be called with the generated ConfigSet parameter </p>
<p>declared in Dem_Lcfg.h file, e.g.: </p>
<p>Dem_PreInit(&amp;CommonDiagnostics);</p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To ease the development and permit the switch between single (or no) CDD variant and multiple CDD </p>
<p>variant without API change, GENy offers the checkbox “<i>Dem_PreInit() has config parameter</i>”. </p>
<p>By activating this checkbox, you will always get the <i>Multi Identity Mode </i>API. When using Single Identity </p>
<p>the parameter is mandatory but silently ignored. </p>
<p><b>&gt; </b></p>
<p>You can not change the active configuration any more after calling </p>
<p>Dem_PreInit</p>
<p> until next ECU power-</p>
<p>on boot (or any reset situation). </p>
<p>The active configuration consists of the base variant (chosen with </p>
<p>Dem_PreInit(…)</p>
<p>) and optional, </p>
<p>additional variants (chosen prior with </p>
<p>Dem_InitDiagnosticVariant(…)</p>
<p>, see chapter 6.2.2.4). </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Only within disabled global interrupt call context </p>
<p>Table 6-2 </p>
<p>Dem_PreInit </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>40 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.2.2  Dem_Init </b></p>
<p><b>Prototype </b></p>
<p>void <b>Dem_Init </b>( </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x02 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>None </p>
<p> </p>
<p><b>Return code </b></p>
<p>None </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Initializes this module. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>The Dem assumes, that all non-volatile data was restored (or initialized) before calling Dem_Init(). </p>
<p>Typically this is automatically done during the startup of the ECU. Please see chapter <i>4.2 </i>for an </p>
<p>overview and chapter <i>6.4 </i>for correct configuration. </p>
<p><b>&gt; </b></p>
<p>If enabled Dem_Init() will use some patterns (“magic numbers”) to evaluate, if the non-volatile data </p>
<p>blocks of the Dem are initialized and completely restored. If not, the Dem will trigger the initialization of </p>
<p>the buffers itself, see </p>
<p>Dem_NvData…()</p>
<p> callbacks in chapter <i>6.4</i>. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-3  </p>
<p>Dem_Init </p>
<p>See [4] for more details of the NvM APIs. </p>
<p><b>6.2.2.3 </b></p>
<p><b>Dem_Shutdown </b></p>
<p><b>Prototype </b></p>
<p>void <b>Dem_Shutdown </b>( </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x03 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>None </p>
<p> </p>
<p><b>Return code </b></p>
<p>None </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Shutdowns this module. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>41 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-4  </p>
<p>Dem_Shutdown </p>
<p>During shutdown, the DEM calls </p>
<p>NvM_SetRamBlockStatus()</p>
<p> to change the state of the </p>
<p>NvRAM BlockIDs which have been modified. The system shutdown sequence will save the </p>
<p>labelled data by calling </p>
<p>NvM_WriteAll()</p>
<p>. </p>
<p>See [4] for more details of the NvM APIs. Configuration see chapter 8.2.11. </p>
<p><b>6.2.2.4 </b></p>
<p><b>Dem_InitDiagnosticVariant </b></p>
<p>Multi-Identity Support is a Vector extension for DCM and DEM to support multiple variants </p>
<p>in  an  ECU.  On  startup,  all  events  of  the  basic  variant  are  available  plus  additional  the </p>
<p>configured events (DTCs) of 0-30 additional variants. </p>
<p>Before </p>
<p>calling </p>
<p>Dem_PreInit()</p>
<p>, </p>
<p>the </p>
<p>additional </p>
<p>variants </p>
<p>are </p>
<p>selected </p>
<p>by </p>
<p>calling </p>
<p>Dem_InitDiagnosticVariant().</p>
<p>  </p>
<p> </p>
<p><b>Prototype </b></p>
<p>Multi Identity Mode    or    GENy setting: “Dem_PreInit() has config parameter” </p>
<p>void <b>Dem_InitDiagnosticVariant </b>( </p>
<p>  uint32  activeCfg </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>activeCfg</p>
<p> </p>
<p>A bit-mapped value where each set bit represents an active diagnostic </p>
<p>configuration. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>42 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>If a combination of multiple diagnostic configurations is supported, the application can activate, additionally </p>
<p>to the base variant, any combination of the other diagnostic configurations that are available.  </p>
<p>All configured configuration variant parameter values are located in the Dem_Lcfg.h file in section </p>
<p>“</p>
<p><b>Multiple Variant Initialization</b></p>
<p>”, with the naming convention: </p>
<p>DEM_CFGVARIANT_<i>&lt;VARIANT_QUALIFIER&gt;</i></p>
<p>. If you use a CDD file for the DEM configuration, then the </p>
<p>variant qualifiers are the qualifier of the vehicle system groups defined in the CDD file. </p>
<p> </p>
<p>Note:  </p>
<p><b>If the base variant only shall be supported, you can omit the call of this API. DEM always sets the </b></p>
<p><b>base variant, when calling </b></p>
<p><b>Dem_PreInit(…)</b></p>
<p><b> later with argument value ‘CommonDiagnostics’. </b></p>
<p><b>Usage Example: </b></p>
<p>#include &quot;Dem_Lcfg.h&quot; </p>
<p><b> </b></p>
<p>void SysStartupPhase1(void) </p>
<p>{ </p>
<p>  /* Compose supported diagnostic configurations */ </p>
<p>  uint32 demAddVariantMask = 0L;  </p>
<p> </p>
<p>  if (<i>&lt;EcuFeatureA_enabled&gt;</i>) </p>
<p>  { </p>
<p>    demAddVariantMask |= DEM_CFGVARIANT_<i>&lt;CDD_VSG_FEATRUREA&gt;</i>; </p>
<p>  } </p>
<p> </p>
<p>  if (<i>&lt;EcuFeatureB_enabled&gt;</i>) </p>
<p>  { </p>
<p>    demAddVariantMask |= DEM_CFGVARIANT_<i>&lt;CDD_VSG_FEATRUREB&gt;</i>; </p>
<p>  } </p>
<p>  /* Set additional variants */ </p>
<p>  <b>Dem_InitDiagnosticVariant</b>(demAddVariantMask); </p>
<p>  ... </p>
<p>  /* PreInit DEM now with base variant */ </p>
<p>  <b>Dem_PreInit</b>(&amp;<i>&lt;DemConfigSet from Dem_Lcfg.h&gt;</i>); </p>
<p>}</p>
<p><b> </b></p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>43 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Must be called prior Dem_PreInit(…) API. </p>
<p><b>&gt; </b></p>
<p>Can only be called once. A second call is ignored. </p>
<p><b>&gt; </b></p>
<p>You can not change the active configuration any more after calling </p>
<p>Dem_PreInit()</p>
<p> until next ECU </p>
<p>power-on boot (or any reset situation). </p>
<p>With a reset, the following sequence will be executed: </p>
<p>1. </p>
<p>Compiler startup code or </p>
<p>Dem_InitMemory()</p>
<p> is called. </p>
<p>2. </p>
<p>Dem_InitDiagnosticVariant(…)</p>
<p> is called </p>
<p>3. </p>
<p>Dem_PreInit(…)</p>
<p> is called </p>
<p>Call context </p>
<p><b>&gt; </b></p>
<p>Only within disabled global interrupt call context. </p>
<p>Table 6-5  </p>
<p>Dem_InitDiagnosticVariant </p>
<p><b>6.2.3 </b></p>
<p><b>Interface SW-Components via RTE </b></p>
<p><b>Ù</b></p>
<p><b> DEM </b></p>
<p><b>6.2.3.1 </b></p>
<p><b>Dem_SetEventStatus </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_SetEventStatus </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  uint8            EventStatus </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x04 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p>EventStatus </p>
<p>uint8 </p>
<p>{DEM_EVENT_STATUS_PASSED, </p>
<p>DEM_EVENT_STATUS_FAILED, </p>
<p>DEM_EVENT_STATUS_PREPASSED, </p>
<p>DEM_EVENT_STATUS_PREFAILED </p>
<p>[, Custom]} </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: set of event status was successful </p>
<p>E_NOT_OK: set of event status failed </p>
<p><b>Functional Description </b></p>
<p>Queue the status of an event. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>44 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Do not call this API for events, that are set by the BSW too (see chapter <i>5.5 Call Context</i>). </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-6  </p>
<p>Dem_SetEventStatus </p>
<p>This API accepts internal events as well as external events. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To notify the application whether it was successful to add this API to the action queue </p>
<p>(see chapter 4.4) an additional return value is introduced: </p>
<p>Without RTE: DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p>With RTE: </p>
<p> </p>
<p>RTE_E_DiagnosticMonitor_E_NOT_OK    (15u)  </p>
<p>This return value is an extension to AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>6.2.3.2 </b></p>
<p><b>Dem_ResetEventStatus </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_ResetEventStatus </b>( </p>
<p>  Dem_EventIdType  EventId </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x05 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event or Failure) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: reset of event status was successful </p>
<p>E_NOT_OK: reset of event status failed </p>
<p><b>Functional Description </b></p>
<p>Resets the Event Status stored in the Event Memory in the DEM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-7  </p>
<p>Dem_ResetEventStatus </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>45 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To notify the application whether it was successful to add this API to the action queue </p>
<p>(see chapter 4.4) an additional return value is introduced: </p>
<p>Without RTE: DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p>With RTE: </p>
<p> </p>
<p>RTE_E_DiagnosticMonitor_E_NOT_OK    (15u)  </p>
<p>This return value is an extension to AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>6.2.3.3 </b></p>
<p><b>Dem_PrestoreFreezeFrame </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_PrestoreFreezeFrame </b>( </p>
<p>  Dem_EventIdType  EventId </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x01 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event or Failure) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK PreStoreFreezeFrame was successful </p>
<p>E_NOT_OK PreStoreFreezeFrame failed </p>
<p><b>Functional Description </b></p>
<p>Captures the FreezeFrame data for a specific EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-8  </p>
<p>Dem_PrestoreFreezeFrame </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>46 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.3.4 </b></p>
<p><b>Dem_ClearPrestoredFreezeFrame </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_ClearPrestoredFreezeFrame </b>( </p>
<p>  Dem_EventIdType EventId </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x07 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event or Failure) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: ClearPreStoreFreezeFrame was successful </p>
<p>E_NOT_OK: ClearPreStoreFreezeFrame failed </p>
<p><b>Functional Description </b></p>
<p>Clears a prestored Freeze Frame </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p> </p>
<p>Table 6-9  </p>
<p>Dem_ClearPrestoredFreezeFrame </p>
<p> </p>
<p><b>6.2.3.5 </b></p>
<p><b>Dem_SetOperationCycleState </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_SetOperationCycleState </b>( </p>
<p>  uint8  OperationCycleId, </p>
<p>  uint8  CycleState </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x08 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>OperationCycleId </p>
<p>Identification of operation cycle, like power cycle, driving cycle. </p>
<p>CycleState </p>
<p>DEM_CYCLE_STATE_END 0x02 End of operation cycle, </p>
<p>DEM_CYCLE_STATE_START 0x01 Start of operation cycle </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: set of operation cycle was successful </p>
<p>E_NOT_OK: set of operation cycle failed </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>47 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Sets an operation cycle state. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-10  </p>
<p>Dem_SetOperationCycleState </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To notify the application whether it was successful to add this API to the action queue </p>
<p>(see chapter 4.4) an additional return value is introduced: </p>
<p>Without RTE: DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p>With RTE: </p>
<p> </p>
<p>RTE_E_OperationCycle_E_NOT_OK      </p>
<p>(15u)  </p>
<p>This return value is an extension to AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>48 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.3.6 </b></p>
<p><b>Dem_GetEventStatus </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetEventStatus </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  uint8 *          EventStatusExtended </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x0a </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p>EventStatusExtended </p>
<p>Bit 0 TestFailed is set to 1 if the last event status update by the function </p>
<p>Dem_SetEventStatus(Passed Failed) was called with failed. The status is set </p>
<p>to 0 if Dem_SetEventStatus is called with passed, on tester clear command </p>
<p>and by API Dem_ResetEventStatus. </p>
<p>Bit 0 and 6 is intended to set/reset monitor inhibit or default. </p>
<p>Bit 1 TestFailedThisOperationCycle is set if at least one time the function </p>
<p>Dem_SetEventStatus (passed | failed) is called with failed this cycle. Intended </p>
<p>to be used for defaults reset only at next key on. </p>
<p>Bit 2 PendingDTC is set when associated DTC becomes available in Mode07 </p>
<p>(currently corresponds to ISO pending bit 2 [9] Intended to be used for the </p>
<p>control of IUMPR counters. </p>
<p>Bit 3 ConfirmedDTC is set when associated DTC becomes available in </p>
<p>Mode03 (currently corresponds to ISO confirmed bit 3 [9] Could be used to set </p>
<p>e.g. service request message. </p>
<p>Bit 4 TestNotCompletedSinceLastClear is set to 0 if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called after last ClearDTC. </p>
<p>Bit 5 testFailedSinceLastClear is set to 0 if at least one time the function </p>
<p>Dem_SetEventStatus is caled with failed this cycle. </p>
<p>Bit 6 TestNotCompletedThisOperationCycle is set if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called within this cycle (the </p>
<p>usage of different cycles is application-specific, if only one cycle is used, the </p>
<p>differentiation is obsolete). </p>
<p>Bit 7 WarningIndicatorRequested reports the status of any warning indicators </p>
<p>associated with a particular DTC. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of event status was successful </p>
<p>E_NOT_OK: get of event status failed </p>
<p><b>Functional Description </b></p>
<p>Gets the extended event status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>49 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-11 </p>
<p>Dem_GetEventStatus </p>
<p><b>6.2.3.7 </b></p>
<p><b>Dem_GetEventFailed </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetEventFailed </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  boolean *        EventFailed </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x0b </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. Min.: 1 (0: Indication of no Event) Max.: Result of configuration of </p>
<p>EventId’s in DEM (Max is either 255 or 65535) </p>
<p>EventFailed </p>
<p>TRUE - Last Failed </p>
<p>FALSE - not Last Failed </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of “EventFailed” was successful </p>
<p>E_NOT_OK: get of “EventFailed” was not successful </p>
<p><b>Functional Description </b></p>
<p>Gets the event failed status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-12  </p>
<p>Dem_GetEventFailed </p>
<p><b>6.2.3.8 </b></p>
<p><b>Dem_GetEventTested </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetEventTested </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  boolean *        EventTested </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x0c </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>50 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p>EventTested </p>
<p>TRUE - event tested this cycle </p>
<p>FALSE - event not tested this cycle </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of event state “tested” successful </p>
<p> E_NOT_OK: get of event state “tested” failed </p>
<p><b>Functional Description </b></p>
<p>Gets the event tested status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-13  </p>
<p>Dem_GetEventTested </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>51 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.3.9 </b></p>
<p><b>Dem_GetDTCOfEvent </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetDTCOfEvent </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  uint8            DTCKind, </p>
<p>  uint32 *         DTCOfEvent </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x01 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned EventId. The EventId is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event or Failure) </p>
<p>Max.: Result of configuration of EventId’s in DEM (Max is either 255 or 65535) </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBDrelevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOfEvent </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than E_OK this parameter does not contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of DTC was successful </p>
<p>DEM_GET_DTCOFEVENT_WRONG_DTCKIND: 0x04 DTC kind wrong, </p>
<p>DEM_GET_DTCOFEVENT_WRONG_EVENTID: 0x05 Wrong EventId </p>
<p><b>Functional Description </b></p>
<p>Gets the DTC of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-14 </p>
<p>Dem_GetDTCOfEvent   </p>
<p><b>6.2.3.10 </b></p>
<p><b>Dem_SetValueByOemId </b></p>
<p>This optional API is not supported by Vector specific DEM (it is implemented, but returns always </p>
<p>E_NOT_OK).</p>
<p> </p>
<p><b>6.2.3.11 </b></p>
<p><b>Dem_SetEnableCondition </b></p>
<p>This optional API is not supported by Vector specific DEM (it is implemented, but returns always </p>
<p>E_NOT_OK).</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>52 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.3.12 </b></p>
<p><b>Dem_GetFaultDetectionCounter </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetFaultDetectionCounter </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  sint8 *          EventIdFaultDetectionCounter </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3e </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Provide the EventId value the fault detection counter is requested for. If the </p>
<p>return value of the function is other than OK this parameter does not contain </p>
<p>valid data. </p>
<p>EventIdFaultDetection-</p>
<p>Counter </p>
<p>This parameter receives the fault detection counter information of the </p>
<p>requested EventId. If the return value of the function call is other than E_OK </p>
<p>this parameter does not contain valid data. </p>
<p>-128dec...127dec PASSED... FAILED according to ISO 14229-1 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request of fault detection counter was successful </p>
<p>E_NOT_OK: request of fault detection counter failed </p>
<p><b>Functional Description </b></p>
<p>Gets the fault detection counter of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-15 </p>
<p>Dem_GetFaultDetectionCounter  </p>
<p> </p>
<p><b>6.2.3.13 </b></p>
<p><b>Dem_GetIndicatorStatus </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetIndicatorStatus </b>( </p>
<p>  uint8    IndicatorId, </p>
<p>  uint8 *  IndicatorStatus </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x29 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>IndicatorId </p>
<p>Number of indicator </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>53 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>IndicatorStatus </p>
<p>Status of the indicator, like on, off, blinking. </p>
<p>DEM_INDICATOR_BLINK_CONT 0x03 Continuous and blinking mode, </p>
<p>DEM_INDICATOR_CONTINUOUS 0x01 Continuous on, </p>
<p>DEM_INDICATOR_OFF 0x00 Indicator off, </p>
<p>DEM_INDICATOR_BLINKING 0x02 blinking mode </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed or is not supported </p>
<p><b>Functional Description </b></p>
<p>Gets the indicator status derived from the event status (Bit TestFailed) and the configured indicator states </p>
<p>(see <i>8.2.12.5.5 </i>to see how to configure indicators). It will be reported as a summary of the single indicator </p>
<p>states (usually an indicator is assigned to different events. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-16 </p>
<p>Dem_GetIndicatorStatus </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>When the RTE is part of the software, only valid IndicatorIDs can be used when </p>
<p>calling </p>
<p>Dem_GetIndicatorStatus()</p>
<p>. </p>
<p>Without RTE, the function </p>
<p>Dem_GetIndicatorStatus()</p>
<p> will accept all IDs </p>
<p>(result: E_OK) and returns the indicator status 0 (“not active”) not only when no event is </p>
<p>“failed”, but also if no event was assigned to this IndicatorID. Such &quot;Invalid&quot; </p>
<p>IndicatorIDs (result: E_NOT_OK) could be detected by expensive search only, as the </p>
<p>ID values are post-buildable. This search is not implemented. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>54 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.3.14 </b></p>
<p><b>Dem_GetOccurrenceCounter </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetOccurrenceCounter </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  uint8 *          OccurrenceCounterValue </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Provide the EventId value the occurrence counter is requested for. If the return </p>
<p>value of the function is other than E_OK this parameter does not contain valid </p>
<p>data. </p>
<p>OccurrenceCounterValue </p>
<p>This parameter receives the Occurrence Counter information of the requested </p>
<p>EventId. If the return value of the function call is other than E_OK this </p>
<p>parameter does not contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK:  </p>
<p> </p>
<p> </p>
<p>Operation was successful </p>
<p>E_NOT_OK:  Operation failed </p>
<p><b>Functional Description </b></p>
<p>Read the DEM internal implemented OccurrenceCounter of an event. The API shall be used to request the </p>
<p>current Occurrence Counter for a given EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This API is an extension to AUTOSAR. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-17  </p>
<p>Dem_GetOccurrenceCounter </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>This API is an extension to the AUTOSAR description. It is available, when a CDD is </p>
<p>used which supports the internally implemented occurrence counter (see 8.1.3.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>55 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.4 </b></p>
<p><b>Interface BSW-Components </b></p>
<p><b>Ù</b></p>
<p><b> DEM </b></p>
<p><b>6.2.4.1 </b></p>
<p><b>Dem_ReportErrorStatus </b></p>
<p><b>Prototype </b></p>
<p>void <b>Dem_ReportErrorStatus </b>( </p>
<p>  Dem_EventIdType  EventId, </p>
<p>  uint8            EventStatus </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x01 </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an Event by assigned Event ID. The Event ID is configured in </p>
<p>the DEM. </p>
<p>Min.: 1 (0: Indication of no Event or Failure) </p>
<p>Max.: Result of configuration of Event IDs in DEM (Max is either 255 or </p>
<p>65535) </p>
<p>EventStatus </p>
<p>uint8 </p>
<p>{DEM_EVENT_STATUS_PASSED, </p>
<p>DEM_EVENT_STATUS_FAILED, </p>
<p>DEM_EVENT_STATUS_PREPASSED, </p>
<p>DEM_EVENT_STATUS_PREFAILED </p>
<p>[, Custom]} </p>
<p><b>Return code </b></p>
<p>None </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Reports errors to the DEM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Do not call this API for events, that are set via RTE/application too (see chapter <i>5.5 Call Context</i>) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>If interrupt context can not be avoided, please ensure, that both critical sections can be called within </p>
<p>interrupt context (see chapter 5.4) </p>
<p>Table 6-18 </p>
<p>Dem_ReportErrorStatus    </p>
<p>This API accepts internal events as well as external events. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To notify the DET whether it was successful to add this API to the action queue (see </p>
<p>chapter 4.4) an additional development error is implemented: </p>
<p>ErrorId:  </p>
<p> </p>
<p> </p>
<p>DEM_E_QUEUE_OVERFLOW   </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>(0x0F) </p>
<p>This development error is an extension to AUTOSAR. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>56 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.2.5 </b></p>
<p><b>Interface DCM </b></p>
<p><b>Ù</b></p>
<p><b> DEM </b></p>
<p>A </p>
<p>further </p>
<p>description </p>
<p>of </p>
<p>the </p>
<p>usage </p>
<p>of </p>
<p>the </p>
<p>interface </p>
<p>between </p>
<p>DCM </p>
<p>(diagnostic </p>
<p>communication manager) and DEM can be found in chapter “Error Manager Interface” of </p>
<p>[3]. Here, especially the handling of FreezeFrame data is described. </p>
<p><b>6.2.5.1 </b></p>
<p><b>Access DTCs and Status Information </b></p>
<p>The  following  chapter  defines  the API  calls  that  shall  be  used  to  access  the  number  of </p>
<p>DTCs  as  well  as  the  DTCs  matching  specific  filter  criteria  and  the  associated  status </p>
<p>information. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>57 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.1.1 </b></p>
<p><b>Dem_SetDTCFilter </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnSetDTCFilterType <b>Dem_SetDTCFilter </b>( </p>
<p>  uint8  DTCStatusMask, </p>
<p>  uint8  DTCKind, </p>
<p>  uint8  DTCOrigin, </p>
<p>  uint8  FilterWithSeverity, </p>
<p>  uint8  DTCSeverity, </p>
<p>  uint8  FilterForFaultDetectionCounter </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x13 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCStatusMask </p>
<p>According ISO14229-1 StatusOfDTC Values: </p>
<p>0x00: Report all supported DTCs </p>
<p>0x01...0xFF: Match DTCStatusMask as defined in ISO14229-1 </p>
<p>DTCKind </p>
<p>Defines the functional group of DTCs to be reported (e.g. all DTC, </p>
<p>OBDrelevant DTC) </p>
<p>DEM_DTC_KIND_ALL_DTCS selects all DTCs, </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS selects OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information ocated in </p>
<p>the secondary memory,  </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>FilterWithSeverity </p>
<p>This flag defines whether severity information (ref. to parameter below) shall </p>
<p>be used for filtering. This is to allow for coexistence of DTCs with and without </p>
<p>severity information. </p>
<p>DEM_FILTER_WITH_SEVERITY_YES 0x00 Severity information used, </p>
<p>DEM_FILTER_WITH_SEVERITY_NO 0x01 Severity information not used </p>
<p>DTCSeverity </p>
<p>This parameter contains the DTCSeverityMask according to ISO14229-1. </p>
<p>DEM_SEVERITY_CHECK_IMMEDIATELY 0x80 Check immediately, </p>
<p>DEM_SEVERITY_NO_SEVERITY 0x00 No severity information available, </p>
<p>DEM_SEVERITY_CHECK_AT_NEXT_HALT 0x40 check at next halt, </p>
<p>DEM_SEVERITY_MAINTENANCE_ONLY 0x20 maintenance required </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>58 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>FilterForFaultDetection-</p>
<p>Counter </p>
<p>This flag defines whether Fault Detection Counter information shall be used </p>
<p>for filtering. This is to allow for coexistence of DTCs with and without Fault </p>
<p>Detection Counter information. If Fault Detection Counter information is filter </p>
<p>criteria, only those DTCs with a Fault Detection Counter value between 1 and </p>
<p>0x7E shall be reported. </p>
<p>Remark: If the event does not uses the debouncing inside DEM, then the DEM </p>
<p>must request this information via Xxx_DemGetFaultDetectionCounter. </p>
<p>DEM_FILTER_FOR_FDC_YES 0x00 Fault Detection Counter information </p>
<p>used, </p>
<p>DEM_FILTER_FOR_FDC_NO 0x01 Fault Detection Counter information not </p>
<p>used </p>
<p><b>Return code </b></p>
<p>Dem_ReturnSetDTCFilter </p>
<p>Type </p>
<p>Status of the operation of type Dem_ReturnSetDTCFilterType </p>
<p><b>Functional Description </b></p>
<p>Sets the filter mask over all DTCs. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-19 </p>
<p>Dem_SetDTCFilter   </p>
<p><b>6.2.5.1.2 </b></p>
<p><b>Dem_SetDTCFilterForRecords </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnSetDTCFilterType <b>Dem_SetDTCFilterForRecords </b>( </p>
<p>  uint16 *  NumberOfFilteredRecords </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3f </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>NumberOfFilteredRecords </p>
<p>Number of snapshot records currently stored in the event memory. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnSetDTCFilter-</p>
<p>Type </p>
<p>Status of the operation of type Dem_ReturnSetDTCFilterType </p>
<p><b>Functional Description </b></p>
<p>Sets DTC Filter for records. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-20 </p>
<p>Dem_SetDTCFilterForRecords   </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>59 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.1.3 </b></p>
<p><b>Dem_SetViewFilter </b></p>
<p>This optional API is not supported by Vector specific DEM (it is implemented, but returns always </p>
<p>DEM_WRONG_ID). </p>
<p> </p>
<p><b>6.2.5.1.4 </b></p>
<p><b>Dem_GetStatusOfDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetStatusOfDTCType <b>Dem_GetStatusOfDTC </b>( </p>
<p>  uint32   DTC, </p>
<p>  uint8    DTCKind, </p>
<p>  uint8    DTCOrigin, </p>
<p>  uint8 *  DTCStatus </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x15 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>For this DTC its status is requested </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information located in </p>
<p>the secondary memory,  </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory The definition and use of the different memory types is OEM </p>
<p>specific. </p>
<p>DTCStatus </p>
<p>This parameter receives the status information of the requested DTC. If the </p>
<p>return value of the function call is other than DEM_STATUS_OK this </p>
<p>parameter does not contain valid data. </p>
<p>0x00...0xFF match DTCStatusMask as defined in ISO14229-1 </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetStatusOf-</p>
<p>DTCType </p>
<p>Status of the operation of type Dem_ReturnGetStatusOfDTCType. </p>
<p><b>Functional Description </b></p>
<p>Gets the status of a DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>60 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-21 </p>
<p>Dem_GetStatusOfDTC  </p>
<p> </p>
<p>If the DTC is not stored in one of the available event memories the parameter DTCOrigin </p>
<p>is neglected e.g. when DTC status is pending.  </p>
<p> </p>
<p><b>6.2.5.1.5 </b></p>
<p><b>Dem_GetDTCStatusAvailabilityMask </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetDTCStatusAvailabilityMask </b>( </p>
<p>  uint8 *  DTCStatusMask </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x16 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCStatusMask </p>
<p>The value DTCStatusMask indicates the supported DTC status bits from the </p>
<p>DEM. All supported information is indicated by setting the corresponding </p>
<p>status bit to 1. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of DTC status mask was successful </p>
<p>E_NOT_OK: get of DTC status mask failed </p>
<p><b>Functional Description </b></p>
<p>Gets the DTC Status availability mask </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-22 </p>
<p>Dem_GetDTCStatusAvailabilityMask   </p>
<p><b>6.2.5.1.6 </b></p>
<p><b>Dem_GetNumberOfFilteredDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNumberOfFilteredDTCType <b>Dem_GetNumberOfFilteredDTC </b>( </p>
<p>  uint16 *  NumberOfFilteredDTC </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x17 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>NumberOfFilteredDTC </p>
<p>The number of DTCs matching the defined status mask. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>61 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNumber-</p>
<p>OfFilteredDTCType </p>
<p>Status of the operation to retrieve a number of DTC from the DEM </p>
<p><b>Functional Description </b></p>
<p>Gets the number of a filtered DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-23 </p>
<p>Dem_GetNumberOfFilteredDTC  </p>
<p> </p>
<p><b>6.2.5.1.7 </b></p>
<p><b>Dem_GetNextFilteredDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredDTCType <b>Dem_GetNextFilteredDTC </b>( </p>
<p>  uint32 *  DTC, </p>
<p>  uint8 *   DTCStatus </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x18 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>DTCStatus </p>
<p>This parameter receives the status information of the requested DTC. If the </p>
<p>return value of the function call is other than DEM_FILTERED_OK this </p>
<p>parameter does not contain valid data. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredDTCType </p>
<p>Status of the operation to retrieve a DTC from the DEM. </p>
<p><b>Functional Description </b></p>
<p>Gets the next filtered DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-24 </p>
<p>Dem_GetNextFilteredDTC  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>62 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.1.8 </b></p>
<p><b>Dem_GetDTCByOccurrenceTime </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetDTCByOccurrenceTimeType <b>Dem_GetDTCByOccurrenceTime </b>( </p>
<p>  uint8     DTCRequest, </p>
<p>  uint8     DTCKind, </p>
<p>  uint32 *  DTC </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x19 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCRequest </p>
<p>This parameter defines the request type of the DTC. </p>
<p>DEM_FIRST_DET_CONFIRMED_DTC 0x03 first detected confirmed DTC </p>
<p>requested, </p>
<p>DEM_MOST_RECENT_FAILED_DTC 0x02 most recent failed DTC </p>
<p>requested, </p>
<p>DEM_MOST_REC_DET_CONFIRMED_DTC 0x04 most recently detected </p>
<p>confirmed DTC requested, </p>
<p>DEM_FIRST_FAILED_DTC 0x01 first failed DTC requested </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTC S Select OBD-relevant DTCs </p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_OCCURR_OK this parameter does not contain </p>
<p>valid data. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetDTCBy-</p>
<p>OccurrenceTimeType </p>
<p>Status of the operation of type Dem_ReturnGetDTCByOccurrenceTimeType. </p>
<p><b>Functional Description </b></p>
<p>Gets the DTC by occurrence time. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-25 </p>
<p>Dem_GetDTCByOccurrenceTime   </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>63 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.1.9 </b></p>
<p><b>Dem_GetViewIDOfDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetViewIDOfDTCType <b>Dem_GetViewIDOfDTC </b>( </p>
<p>  uint32   DTC, </p>
<p>  uint8    DTCKind, </p>
<p>  uint8 *  ViewId </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x36 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This parameter defines the requested DTC. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBDrelevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>ViewId </p>
<p>The ViewId is a parameter used to select a specific view. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetViewIDOf-</p>
<p>DTCType </p>
<p>Status of the operation of type Dem_ReturnGetViewIDOfDTCType. </p>
<p><b>Functional Description </b></p>
<p>Gets the ViewID of a DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-26 </p>
<p>Dem_GetViewIDOfDTC  </p>
<p> </p>
<p><b>6.2.5.1.10 </b></p>
<p><b>Dem_GetNextFilteredRecord </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredDTCType <b>Dem_GetNextFilteredRecord </b>( </p>
<p>  uint32 *  DTC, </p>
<p>  uint8 *   SnapshotRecord </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3a </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>SnapshotRecord </p>
<p>Snapshot Record Number for the reported DTC. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>64 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredDTCType </p>
<p>Status of the operation to retrieve a DTC from the DEM. </p>
<p><b>Functional Description </b></p>
<p>Gets the current DTC and its associated snapshot record numbers from the DEM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-27 </p>
<p>Dem_GetNextFilteredRecord  </p>
<p> </p>
<p><b>6.2.5.1.11 </b></p>
<p><b>Dem_GetNextFilteredDTCAndFDC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredDTCType <b>Dem_GetNextFilteredDTCAndFDC </b>( </p>
<p>  uint32 *  DTC, </p>
<p>  sint8 *   DTCFaultDetectionCounter </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3b </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>DTCFaultDetection-</p>
<p>Counter </p>
<p>This parameter receives the Fault Detection Counter information of the </p>
<p>requested DTC. If the return value of the function call is other than </p>
<p>DEM_FILTERED_OK this parameter does not contain valid data. </p>
<p>-128dec...127dec PASSED...FAILED according to ISO 14229-1 </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredDTCType </p>
<p>Status of the operation to retrieve a DTC from the DEM. </p>
<p><b>Functional Description </b></p>
<p>Gets the current DTC and its associated Fault Detection Counter (FDC) from the DEM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-28 </p>
<p>Dem_GetNextFilteredDTCAndFDC </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>65 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.1.12 </b></p>
<p><b>Dem_GetNextFilteredDTCAndSeverity </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredDTCType <b>Dem_GetNextFilteredDTCAndSeverity</b>( </p>
<p>  uint32 *  DTC, </p>
<p>  uint8 *   DTCStatus, </p>
<p>  uint8 *   DTCSeverity, </p>
<p>  uint8 *   DTCFunctionalUnit </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3d </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>DTCStatus </p>
<p>Receives the status value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>DTCSeverity </p>
<p>Receives the severity value returned by the function. If the return value of the </p>
<p>function is other than DEM_FILTERED_OK this parameter does not contain </p>
<p>valid data. </p>
<p>DTCFunctionalUnit </p>
<p>Receives the functional unit value returned by the function. If the return value </p>
<p>of the function is other than DEM_FILTERED_OK this parameter does not </p>
<p>contain valid data. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredDTCType </p>
<p>Status of the operation to retrieve a DTC from the DEM. </p>
<p><b>Functional Description </b></p>
<p>Gets the current DTC and its Severity from the DEM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-29  </p>
<p>Dem_GetNextFilteredDTCAndSeverity </p>
<p><b>6.2.5.1.13 </b></p>
<p><b>Dem_GetTranslationType </b></p>
<p><b>Prototype </b></p>
<p>uint8 <b>Dem_GetTranslationType </b>( </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x3c </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>None </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>66 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Return code </b></p>
<p>uint8 </p>
<p>The TranslationFormat provides the configured translation formats </p>
<p>Bit 0: 2 byte ISO15031-6 DTC </p>
<p>Bit 1: 3 byte ISO14229-1 DTC </p>
<p>Bit 2: Customer specific DTC </p>
<p>Bit 3: SAEJ1939 </p>
<p>Bit 4: WWH-OBD-format </p>
<p>Set the according Bit to '1' means DTC format is supported. Combination of </p>
<p>different DTC formats is possible (e.g. ISO 15031-6 and ISO14229-1 is coded </p>
<p>by 0x0011b). </p>
<p><b>Functional Description </b></p>
<p>Gets the supported DTC formats of the ECU. The supported formats are configured via </p>
<p>DemTypeOfDTCSupported. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-30 </p>
<p>Dem_GetTranslationType  </p>
<p> </p>
<p><b>6.2.5.1.14 </b></p>
<p><b>Dem_GetSeverityOfDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetSeverityOfDTCType <b>Dem_GetSeverityOfDTC </b>( </p>
<p>  uint32   DTC, </p>
<p>  uint8 *  DTCSeverity </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x0e </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>The Severity assigned to this DTC should be returned </p>
<p>DTCSeverity </p>
<p>This parameter contains the DTCSeverityMask according to ISO14229-1. </p>
<p>DEM_SEVERITY_CHECK_IMMEDIATELY 0x80 Check immediately, </p>
<p>DEM_SEVERITY_NO_SEVERITY 0x00 No severity information available, </p>
<p>DEM_SEVERITY_CHECK_AT_NEXT_HALT 0x40 check at next halt, </p>
<p>DEM_SEVERITY_MAINTENANCE_ONLY 0x20 maintenance required </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetSeverity-</p>
<p>OfDTCType </p>
<p>Status of the operation of type Dem_ReturnGetSeverityOfDTCType. </p>
<p><b>Functional Description </b></p>
<p>Status of the operation of type Dem_ReturnGetSeverityOfDTCType. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>67 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-31 </p>
<p>Dem_GetSeverityOfDTC   </p>
<p><b>6.2.5.2 </b></p>
<p><b>Access Extended Data Records and FreezeFrame Data </b></p>
<p>This section defines the API-calls to be used to get access to the environmental data </p>
<p>stored with the DTCs in the records of the DEM. </p>
<p> </p>
<p><b>6.2.5.2.1 Dem_DisableDTCRecordUpdate </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_DisableDTCRecordUpdate </b>( </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1a </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>None </p>
<p> </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Disables the DTC record update. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-32 </p>
<p>Dem_DisableDTCRecordUpdate </p>
<p>  </p>
<p> </p>
<p><b>6.2.5.2.2 </b></p>
<p><b>Dem_EnableDTCRecordUpdate </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType Dem_EnableDTCRecordUpdate( </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1b </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>None </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>68 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Enables the DTC record update </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-33 </p>
<p>Dem_EnableDTCRecordUpdate  </p>
<p> </p>
<p><b>6.2.5.2.3 </b></p>
<p><b>Dem_GetDTCOfFreezeFrameRecord </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetDTCOfFreezeFrameRecordType <b>Dem_GetDTCOfFreezeFrameRecord </b>( </p>
<p>  uint8     RecordNumber, </p>
<p>  uint8     DTCOrigin, </p>
<p>  uint8     DTCKind, </p>
<p>  uint32 *  DTC </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1c </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a FreezeFrame record as defined in </p>
<p>ISO15031-5 and ISO14229-1. </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information located in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTC </p>
<p>Receives the DTC value returned by the function. If the return value of the </p>
<p>function is other than DEM_GET_DTCOFFF_OK this parameter does not </p>
<p>contain valid data. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>69 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetDTCOf-</p>
<p>FreezeFrameRecordType </p>
<p>Status of the operation of type Dem_ReturnGetDTCOfFreezeFrame </p>
<p>RecordType. </p>
<p><b>Functional Description </b></p>
<p>Gets a DTC associated with a FreezeFrame. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-34 </p>
<p>Dem_GetDTCOfFreezeFrameRecord  </p>
<p> </p>
<p><b>6.2.5.2.4 </b></p>
<p><b>Dem_GetFreezeFrameDataByDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetFreezeFrameDataByDTCType <b>Dem_GetFreezeFrameDataByDTC </b>( </p>
<p>  uint32   DTC, </p>
<p>  uint8    DTCKind, </p>
<p>  uint8    DTCOrigin, </p>
<p>  uint8    RecordNumber, </p>
<p>  uint16   DataId, </p>
<p>  uint8 *  DestBuffer, </p>
<p>  uint8 *  BufSize </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1d </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the FreezeFrame is assigned to. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information ocated in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a FreezeFrame record as defined in </p>
<p>ISO15031-5 and ISO14229-1. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>70 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>DataId </p>
<p>This parameter specifies the PID (ISO15031-5) (Mode2 individual parameter </p>
<p>or the whole FreezeFrame data set) or data identifier (ISO14229-1) that shall </p>
<p>be copied to the destination buffer. </p>
<p>DestBuffer </p>
<p>This parameter contains a byte pointer that points to the buffer to which the </p>
<p>FreezeFrame data shall be written. </p>
<p>BufSize </p>
<p>When the function is called this parameter contains the maximum number of </p>
<p>data bytes that can be written to the buffer. The function returns the actual </p>
<p>number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetFreeze-</p>
<p>FrameDataByDTCType </p>
<p>Status of the operation of type Dem_ReturnGetFreezeFrameDataBy </p>
<p>DTCType. </p>
<p><b>Functional Description </b></p>
<p>Gets a Freeze Frame Data by DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-35 </p>
<p>Dem_GetFreezeFrameDataByDTC    </p>
<p><b>6.2.5.2.5 </b></p>
<p><b>Dem_GetFreezeFrameDataIdentifierByDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetFreezeFrameDataIdentifierByDTCType </p>
<p><b>Dem_GetFreezeFrameDataIdentifierByDTC </b>( </p>
<p>  uint32           DTC, </p>
<p>  uint8            DTCKind, </p>
<p>  uint8            DTCOrigin, </p>
<p>  uint8            RecordNumber, </p>
<p>  uint8 *          ArraySize, </p>
<p>  const uint16 **  DataId </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1e </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the FreezeFrame is assigned to. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>71 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information located in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a FreezeFrame record as defined in </p>
<p>ISO15031-5 and ISO14229-1. </p>
<p>ArraySize </p>
<p>This parameter specifies the number of data identifiers for the selected </p>
<p>RecordNumber. </p>
<p>DataId </p>
<p>Pointer to an array with the supported data identifier for the selected </p>
<p>RecordNumber and DTC. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetFreeze-</p>
<p>FrameDataIdentifierBy-</p>
<p>DTCType </p>
<p>Status of the operation of type </p>
<p>Dem_ReturnGetFreezeFrameDataIdentifierByDTCType. </p>
<p><b>Functional Description </b></p>
<p>Gets a Freeze Frame Data identifier by DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-36 </p>
<p>Dem_GetFreezeFrameDataIdentifierByDTC </p>
<p> </p>
<p> </p>
<p><b>6.2.5.2.6 </b></p>
<p><b>Dem_GetSizeOfFreezeFrame </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetSizeOfFreezeFrameType <b>Dem_GetSizeOfFreezeFrame </b>( </p>
<p>  uint32    DTC, </p>
<p>  uint8     DTCKind, </p>
<p>  uint8     DTCOrigin, </p>
<p>  uint8     RecordNumber, </p>
<p>  uint16 *  SizeOfFreezeFrame </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x1f </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the FreezeFrame is assigned to. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>72 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBDrelevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information ocated in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a FreezeFrame record as defined in </p>
<p>ISO15031-5 and ISO14229-1. </p>
<p>SizeOfFreezeFrame </p>
<p>Number of bytes in the requested FreezeFrame. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetSizeOf-</p>
<p>FreezeFrameType </p>
<p>Status of the operation of type Dem_ReturnGetSizeOfFreezeFrameType </p>
<p><b>Functional Description </b></p>
<p>Gets the size of a FreezeFrame </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-37 </p>
<p>Dem_GetSizeOfFreezeFrame    </p>
<p><b>6.2.5.2.7 </b></p>
<p><b>Dem_GetExtendedDataRecordByDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetExtendedDataRecordByDTCType </p>
<p><b>Dem_GetExtendedDataRecordByDTC</b>( </p>
<p>  uint32   DTC, </p>
<p>  uint8    DTCKind, </p>
<p>  uint8    DTCOrigin, </p>
<p>  uint8    ExtendedDataNumber, </p>
<p>  uint8 *  DestBuffer, </p>
<p>  uint8 *  BufSize </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x20 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the 'Extended Data Record' is assigned to. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>73 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information located in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>ExtendedDataNumber </p>
<p>Identification of requested Extended data record. The requested record is </p>
<p>copied to the destination buffer. </p>
<p>DestBuffer </p>
<p>This parameter contains a byte pointer that points to the buffer to which the </p>
<p>Extended Data shall be written. </p>
<p>BufSize </p>
<p>When the function is called this parameter contains the maximum number of </p>
<p>data bytes that can be written to the buffer. The function returns the actual </p>
<p>number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetExtended-</p>
<p>DataRecordByDTCType </p>
<p>Status of the operation of type </p>
<p>Dem_ReturnGetExtendedDataRecordByDTCType </p>
<p><b>Functional Description </b></p>
<p>Gets extended data record by DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-38 </p>
<p>Dem_GetExtendedDataRecordByDTC   </p>
<p><b>6.2.5.2.8 </b></p>
<p><b>Dem_GetSizeOfExtendedDataRecordByDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetSizeOfExtendedDataRecordByDTCType </p>
<p><b>Dem_GetSizeOfExtendedDataRecordByDTC </b>( </p>
<p>  uint32    DTC, </p>
<p>  uint8     DTCKind, </p>
<p>  uint8     DTCOrigin, </p>
<p>  uint8     ExtendedDataNumber, </p>
<p>  uint16 *  SizeOfExtendedDataRecord </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x21 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>74 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the 'Extended Data Record' is assigned to. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information ocated in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory  </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p>ExtendedDataNumber </p>
<p>Identification of requested Extended data record. The requested record is </p>
<p>copied to the destination buffer. </p>
<p>SizeOfExtendedData-</p>
<p>Record </p>
<p>Pointer to Size of the requested data record </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetSizeOf-</p>
<p>ExtendedDataRecordBy-</p>
<p>DTCType </p>
<p>Status of the operation of type </p>
<p>Dem_ReturnGetSizeOfExtendedDataRecordByDTCType </p>
<p><b>Functional Description </b></p>
<p>Gets the size of an extended data record by DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-39 </p>
<p>Dem_GetSizeOfExtendedDataRecordByDTC  </p>
<p> </p>
<p><b>6.2.5.3 </b></p>
<p><b>Clear DTC Information </b></p>
<p>The  next  sections  define  the  usage  of  the  API-calls  to  delete  single  DTCs  as  well  as </p>
<p>groups of DTCs from the records of the DEM. </p>
<p><b>6.2.5.3.1 </b></p>
<p><b>Dem_ClearDTC </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnClearDTCType <b>Dem_ClearDTC </b>( </p>
<p>  uint32  DTC, </p>
<p>  uint8   DTCKind, </p>
<p>  uint8   DTCOrigin </p>
<p>) </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>75 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x22 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Defines the DTC that shall be cleared from the event memory. If the DTC fits </p>
<p>to a DTC group number, all DTCs of the group shall be cleared. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p>DTCOrigin </p>
<p>If the DEM supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY Event information located in the </p>
<p>mirror memory, </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY Event information ocated in </p>
<p>the secondary memory, </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY Event information located in the </p>
<p>primary memory </p>
<p>The definition and use of the different memory types is OEM specific. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnClearDTC-</p>
<p>Type </p>
<p>Status of the operation of type Dem_ReturnClearDTCType. </p>
<p><b>Functional Description </b></p>
<p>Clears a DTC </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-40 </p>
<p>Dem_ClearDTC    </p>
<p>When </p>
<p>the </p>
<p>API </p>
<p>is </p>
<p>called </p>
<p>with </p>
<p>the </p>
<p>wrong </p>
<p>DTCKind, </p>
<p>the </p>
<p>return </p>
<p>value </p>
<p>is </p>
<p>DEM_CLEAR_WRONG_DTC  and  not  DEM_CLEAR_WRONG_DTCKIND,  as  DTC  and </p>
<p>DTCKind  don't  fit  together,  and  it  cannot  be  determined  which  of  both  is  incorrect. </p>
<p>However, </p>
<p>if </p>
<p>an </p>
<p>invalid </p>
<p>DTCKind </p>
<p>is </p>
<p>used, </p>
<p>DEM_CLEAR_WRONG_DTCKIND </p>
<p>will </p>
<p>be </p>
<p>returned. </p>
<p><b>6.2.5.4 </b></p>
<p><b>Control DTC Storage </b></p>
<p>This section defines the API-calls to enable and disable DTC storage in the DEM. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>76 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.4.1 </b></p>
<p><b>Dem_DisableDTCStorage </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnControlDTCStorageType <b>Dem_DisableDTCStorage </b>( </p>
<p>  uint32  DTCGroup, </p>
<p>  uint8   DTCKind </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x24 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCGroup </p>
<p>Defines the group of DTC that shall be disabled to store in event memory. </p>
<p>DEM_DTC_GROUP_BODY_DTCS selects group of body DTCs, </p>
<p>DEM_DTC_GROUP_EMISSION_REL_DTCS selects group of OBD-relevant </p>
<p>DTCs, </p>
<p>DEM_DTC_GROUP_ALL_DTCS selects all DTCs, </p>
<p>DEM_DTC_GROUP_CHASSIS_DTCS selects group of chassis DTCs, </p>
<p>DEM_DTC_GROUP_NETWORK_COM_DTCS selects group of network </p>
<p>communication DTCs, </p>
<p> DEM_DTC_GROUP_POWERTRAIN_DTCS selects group of powertrain </p>
<p>DTCs </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p><b>Return code </b></p>
<p>Dem_ReturnControlDTC-</p>
<p>StorageType </p>
<p>Status of the operation of type Dem_ReturnControlDTCStorageType. </p>
<p><b>Functional Description </b></p>
<p>Disables the storage of a DTC group </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-41 </p>
<p>Dem_DisableDTCStorage </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Internal events can be disabled with the </p>
<p>DTCGroup</p>
<p> “all”. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>77 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.2.5.4.2 </b></p>
<p><b>Dem_EnableDTCStorage </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnControlDTCStorageType <b>Dem_EnableDTCStorage </b>( </p>
<p>  uint32  DTCGroup, </p>
<p>  uint8   DTCKind </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x25 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCGroup </p>
<p>Defines the group of DTC that shall be disabled to store in event memory. </p>
<p>DEM_DTC_GROUP_BODY_DTCS selects group of body DTCs, </p>
<p>DEM_DTC_GROUP_EMISSION_REL_DTCS selects group of OBD-relevant </p>
<p>DTCs, </p>
<p>DEM_DTC_GROUP_ALL_DTCS selects all DTCs, </p>
<p>DEM_DTC_GROUP_CHASSIS_DTCS selects group of chassis DTCs, </p>
<p>DEM_DTC_GROUP_NETWORK_COM_DTCS selects group of network </p>
<p>communication DTCs, </p>
<p>DEM_DTC_GROUP_POWERTRAIN_DTCS selects group of powertrain </p>
<p>DTCs </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p><b>Return code </b></p>
<p>Dem_ReturnControlDTC-</p>
<p>StorageType </p>
<p>Status of the operation of type Dem_ReturnControlDTCStorageType. </p>
<p><b>Functional Description </b></p>
<p>Enables the storage of a DTC group </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-42 </p>
<p>Dem_EnableDTCStorage  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>78 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.2.5.4.3 </b></p>
<p><b>Dem_DisableEventStatusUpdate </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnControlEventUpdateType <b>Dem_DisableEventStatusUpdate </b>( </p>
<p>  uint32  DTCGroup, </p>
<p>  uint8   DTCKind </p>
<p>) </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x26 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCGroup </p>
<p>Defines the group of DTC that shall be disabled to store in event memory. </p>
<p>DEM_DTC_GROUP_BODY_DTCS selects group of body DTCs, </p>
<p>DEM_DTC_GROUP_EMISSION_REL_DTCS selects group of OBD-relevant </p>
<p>DTCs, </p>
<p>DEM_DTC_GROUP_ALL_DTCS selects all DTCs, </p>
<p>DEM_DTC_GROUP_CHASSIS_DTCS selects group of chassis DTCs, </p>
<p>DEM_DTC_GROUP_NETWORK_COM_DTCS selects group of network </p>
<p>communication DTCs, </p>
<p>DEM_DTC_GROUP_POWERTRAIN_DTCS selects group of powertrain </p>
<p>DTCs </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p><b>Return code </b></p>
<p>Dem_ReturnControlEvent-</p>
<p>UpdateType </p>
<p>Status of the operation of type Status of the operation of type </p>
<p>Dem_ReturnControlEventUpdateType </p>
<p><b>Functional Description </b></p>
<p>Disables the event status update of a DTC group </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-43 </p>
<p>Dem_DisableEventStatusUpdate    </p>
<p><b>6.2.5.4.4 </b></p>
<p><b>Dem_EnableEventStatusUpdate </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnControlEventUpdateType <b>Dem_EnableEventStatusUpdate </b>( </p>
<p>  uint32  DTCGroup, </p>
<p>  uint8   DTCKind </p>
<p>) </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>79 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>0x27 </p>
<p>Synchronous </p>
<p>Non Reentrant </p>
<p><b>Parameter </b></p>
<p>DTCGroup </p>
<p>Defines the group of DTC that shall be disabled to store in event memory. </p>
<p>DEM_DTC_GROUP_BODY_DTCS selects group of body DTCs, </p>
<p>DEM_DTC_GROUP_EMISSION_REL_DTCS selects group of OBD-relevant </p>
<p>DTCs, </p>
<p>DEM_DTC_GROUP_ALL_DTCS selects all DTCs, </p>
<p>DEM_DTC_GROUP_CHASSIS_DTCS selects group of chassis DTCs, </p>
<p>DEM_DTC_GROUP_NETWORK_COM_DTCS selects group of network </p>
<p>communication DTCs, </p>
<p>DEM_DTC_GROUP_POWERTRAIN_DTCS selects group of powertrain </p>
<p>DTCs </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD-relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS Select all DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS Select OBD-relevant DTCs </p>
<p><b>Return code </b></p>
<p>Dem_ReturnControlEvent-</p>
<p>UpdateType </p>
<p>Status of the operation of type Status of the operation of type </p>
<p>Dem_ReturnControlEventUpdateType </p>
<p><b>Functional Description </b></p>
<p>Enables the event status update of a DTC group </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p>Table 6-44 </p>
<p>Dem_EnableEventStatusUpdate  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>80 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>81 / 127</p>
<p><b>6.3 </b></p>
<p><b>Services Used by DEM </b></p>
<p>In the following table services provided by other components, which are used by the DEM </p>
<p>are listed. For details about prototype and functionality refer to the documentation of the </p>
<p>providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>DET </p>
<p>Det_ReportError </p>
<p>EcuM </p>
<p>EcuM_GeneratorCompatibilityError</p>
<p>3</p>
<p> </p>
<p>NvM </p>
<p>NvM_SetRamBlockStatus </p>
<p>SchM </p>
<p>SchM_Enter_Dem </p>
<p>SchM </p>
<p>SchM_Exit_Dem </p>
<p>Table 6-45  </p>
<p>Services Used by the DEM </p>
<p><b>6.4 </b></p>
<p><b>Callback Functions </b></p>
<p>Callback  functions  are  functions  that  are  implemented  by  the  DEM  and  that  can  be </p>
<p>invoked  by  other  modules. The  prototypes  of  the  callback  functions  are  provided  in  the </p>
<p>header file </p>
<p>Dem.h</p>
<p> by the DEM. </p>
<p><b>6.4.1 </b></p>
<p><b>Dem_NvDataInit </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_NvDataInit</b></p>
<p> </p>
<p>( </p>
<p>  void </p>
<p>)</p>
<p> </p>
<p><b>Service ID (hex) </b></p>
<p><b>Sync/Async </b></p>
<p><b>Reentrancy </b></p>
<p>none </p>
<p>Synchronous </p>
<p>Reentrant </p>
<p><b>Parameter </b></p>
<p>- </p>
<p> </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK         to fulfill requirement NVM369 for InitBlockCallbackFunction </p>
<p><b>Functional Description </b></p>
<p>This callback shall be configured in the NvM as callback (NvmBlockDescriptor/NvmInitBlockCallback) to </p>
<p>initialize the buffer </p>
<p>Dem_NvData</p>
<p> (NvmBlockDescriptor/NvmRamBlockDataAddress). The NvM will trigger </p>
<p>this callback when either the stored non-volatile data block was never initialized before or when the non-</p>
<p>volatile data was corrupted. </p>
<p>It may be called directly to re-initialize the non-volatile data of the Dem during the startup phase after the </p>
<p>NvM has restored the previous data. </p>
<p>The initialization will clear all DTCs and data records from Dem and set all events to status untested (0x50).</p>
<p>                                            </p>
<p>3</p>
<p> See [9] </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>GENy will automatically configure the NvM in the EcuC file to use that callback: </p>
<p>/AUTOSAR/NvM/NvmBlockDescriptor/NvmRamBlockDataAddress</p>
<p> is set to </p>
<p>Dem_NvData</p>
<p> </p>
<p>/AUTOSAR/NvM/NvmBlockDescriptor/NvmInitBlockCallback</p>
<p> is set to </p>
<p>Dem_NvDataInit</p>
<p> </p>
<p>/AUTOSAR/NvM/NvmBlockDescriptor/NvmSelectBlockForReadall</p>
<p> is set to </p>
<p>true</p>
<p> </p>
<p><b>&gt; </b></p>
<p>This function will reset all stored (non volatile) data of the Dem (besides the ‘SuppressDTC’ data). </p>
<p><b>&gt; </b></p>
<p>Do not call this function after Dem was started, as this will corrupt the working data. </p>
<p>Only call this function after Dem_PreInit() and before calling Dem_Init(). </p>
<p><b>&gt; </b></p>
<p>When using this function additional to the NvM callback to reset the (non volatile) data of the Dem, take </p>
<p>care that the NvM may restore the data of the Dem inside the startup-sequence, too. To make an </p>
<p>impact, in this case you shall call this function after the NvM’s restoring and before Dem_Init(), </p>
<p>otherwise the last wins (and Dem will use NvM’s restored data). </p>
<p><b>&gt; </b></p>
<p>In Dem_Init() the </p>
<p>Dem_NvData</p>
<p> buffer is tested for a specific pattern at the begin and at the end of the </p>
<p>buffer. When either the pattern is missing or corrupt, the Dem itself will do a (re-)initialization of the </p>
<p>buffer by calling this function. </p>
<p><b>&gt; </b></p>
<p>This callback must be called before calling Dem_Init() each time when the non-volatile stored data is </p>
<p>either uninitialized or corrupt. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Must be called in startup phase only (task or interrupt context) </p>
<p>Table 6-46  </p>
<p>Dem_NvDataInit </p>
<p> </p>
<p><b>6.5 </b></p>
<p><b>Configurable Interfaces </b></p>
<p><b>6.5.1 </b></p>
<p><b>Notifications </b></p>
<p>At its configurable interfaces the DEM defines notifications that can be mapped to callback </p>
<p>functions provided by other modules. The mapping is not statically defined by the DEM but </p>
<p>can be performed at configuration time. The function prototypes that can be used for the </p>
<p>configuration  have  to  match  the  appropriate  function  prototype  signatures,  which  are </p>
<p>described in the following sub-chapters. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>If following interfaces are used as port interfaces without RTE, the function prefix </p>
<p><b>Rte_Call_Dem_</b></p>
<p> will be replaced by the prefix </p>
<p><b>Appl_Dem_</b></p>
<p>. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>82 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.5.1.1 </b></p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent </b>(  </p>
<p>  Dem_InitMonitorKindType  InitMonitorKind  </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>InitMonitorKind </p>
<p>{Clear, Restart} </p>
<p>Identification of the type of init function to be called from Monitor Function. </p>
<p>DEM_INIT_MONITOR_RESTART (0x02) Monitor Function of the EventId is </p>
<p>requested to restart, DEM_INIT_MONITOR_CLEAR (0x01) Monitor Function </p>
<p>of the EventId is cleared and all internal values and states are reset. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>(Re)initializes the Monitor Function of a specific Event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>AUTOSAR requires <i><b>CBInitEvt_&lt;EventName&gt; </b></i>as <i>&lt;ConfiguredName&gt;</i>. </p>
<p>In the configuration tool GENy the <i>&lt;ConfiguredName&gt; </i>is fully configurable by the user, you are not </p>
<p>restricted to this AUTOSAR requirement. </p>
<p>For full compliance with non-Vector components, choose the AUTOSAR required name. See “OnScreen </p>
<p>Help” window in GENy for hint. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>The specific Event has been cleared or the operation cycle of this Event has been (re)started </p>
<p>Table 6-47  </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>83 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.5.1.2 </b></p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged  </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged </b>(  </p>
<p>  Dem_EventStatusExtendedType  EventStatusOld, </p>
<p>  Dem_EventStatusExtendedType  EventStatusNew  </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>EventStatusOld </p>
<p>Event status before change </p>
<p>Bit 0 TestFailed is set to 1 if the last event status update by the function </p>
<p>Dem_SetEventStatus(Passed | Failed) was called with ‘failed’. The status is </p>
<p>set to 0 if Dem_SetEventStatus is called with ‘passed’, on tester clear </p>
<p>command and by API Dem_ResetEventStatus. </p>
<p>Bits 0 and 6 are intended to set/reset monitor ‘inhibit ‘or ‘default’. </p>
<p>Bit 1 TestFailedThisOperationCycle is set if at least one time the function </p>
<p>Dem_SetEventStatus (passed | failed) is called with ‘failed’ this cycle. Intended </p>
<p>to be used for defaults reset only at next key on.  </p>
<p>Bit 2 PendingDTC is set when associated DTC becomes available in Mode07 </p>
<p>(currently corresponds to ISO pending bit).  </p>
<p>Intended to be used for the control of IUMPR counters. </p>
<p>Bit 3 ConfirmedDTC is set when associated DTC becomes available in </p>
<p>Mode03 (currently corresponds to ISO confirmed bit). Could be used to set </p>
<p>e.g. service request message. </p>
<p>Bit 4 TestNotCompletedSinceLastClear is set to 0 if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called after last ClearDTC. </p>
<p>Bit 5 testFailedSinceLastClear is set to 0 if at least one time the function </p>
<p>Dem_SetEventStatus is called with ‘failed’ this cycle. </p>
<p>Bit 6 TestNotCompletedThisOperationCycle is set if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called within this cycle (the </p>
<p>usage of different cycles is application-specific, if only one cycle is used, the </p>
<p>differentiation is obsolete). </p>
<p>Bit 7 WarningIndicatorRequested reports the status of Bit 0 (TestFailed) when </p>
<p>the support of this bit is configured (see 8.2.12.5.1). </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>84 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>EventStatusNew </p>
<p>Event status after change </p>
<p>Bit 0 TestFailed is set to 1 if the last event status update by the function </p>
<p>Dem_SetEventStatus(Passed | Failed) was called with ‘failed’. The status is </p>
<p>set to 0 if Dem_SetEventStatus is called with ‘passed’, on tester clear </p>
<p>command and by API Dem_ResetEventStatus. </p>
<p>Bits 0 and 6 are intended to set/reset monitor ‘inhibit ‘or ‘default’. </p>
<p>Bit 1 TestFailedThisOperationCycle is set if at least one time the function </p>
<p>Dem_SetEventStatus (passed | failed) is called with ‘failed’ this cycle. Intended </p>
<p>to be used for defaults reset only at next key on.  </p>
<p>Bit 2 PendingDTC is set when associated DTC becomes available in Mode07 </p>
<p>(currently corresponds to ISO pending bit).  </p>
<p>Intended to be used for the control of IUMPR counters. </p>
<p>Bit 3 ConfirmedDTC is set when associated DTC becomes available in </p>
<p>Mode03 (currently corresponds to ISO confirmed bit). Could be used to set </p>
<p>e.g. service request message. </p>
<p>Bit 4 TestNotCompletedSinceLastClear is set to 0 if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called after last ClearDTC. </p>
<p>Bit 5 testFailedSinceLastClear is set to 0 if at least one time the function </p>
<p>Dem_SetEventStatus is called with ‘failed’ this cycle. </p>
<p>Bit 6 TestNotCompletedThisOperationCycle is set if at least one time the </p>
<p>function Dem_SetEventStatus (passed | failed) is called within this cycle (the </p>
<p>usage of different cycles is application-specific, if only one cycle is used, the </p>
<p>differentiation is obsolete). </p>
<p>Bit 7 WarningIndicatorRequested reports the status of Bit 0 (TestFailed) when </p>
<p>the support of this bit is configured (see 8.2.12.5.1). </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Triggers on changes of the extended Event status </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>None </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>The extended Event status of the specific Event has been changed </p>
<p>Table 6-48  </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>85 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>6.5.1.3 </b></p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged  </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged </b>( </p>
<p>  Dem_DTCType            DTC, </p>
<p>  Dem_DTCKindType        DTCKind, </p>
<p>  Dem_DTCStatusMaskType  DTCStatusOld, </p>
<p>  Dem_DTCStatusMaskType  DTCStatusNew </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>This is the DTC the change trigger is assigned to. </p>
<p>DTCKind </p>
<p>This parameter defines the requested DTC, either only OBD relevant DTCs or </p>
<p>all DTCs </p>
<p>DEM_DTC_KIND_ALL_DTCS: Select all DTCs  </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS: Select OBD-relevant DTCs </p>
<p>DTCStatusOld </p>
<p>DTC status before change </p>
<p>DTCStatusNew </p>
<p>DTC status after change </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Triggers on changes of the DTC status (the DTC status reports all supported status bits but the bits </p>
<p>disabled by the DTCStatusAvailabilityMask, see <i>8.1.1</i>). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>AUTOSAR requires <i><b>CBStatusDTC_&lt;EventName&gt; </b></i>as <i>&lt;ConfiguredName&gt;</i>. </p>
<p>In the configuration tool GENy the <i>&lt;ConfiguredName&gt; </i>is fully configurable by the user, you are not </p>
<p>restricted to this AUTOSAR requirement. </p>
<p>For full compliance with non-Vector components, choose the AUTOSAR required name. See “OnScreen </p>
<p>Help” window in GENy for hint. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>The status of the specific Event (DTC) has been changed </p>
<p>Table 6-49  </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The parameter DTCKind is an extension to the AUTOSAR description. This parameter </p>
<p>is needed to get a unique prototype (a DTC is not unambiguous) – see Bugzilla 24330. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.5.2 </b></p>
<p><b>Callout Functions </b></p>
<p>At  its  configurable  interfaces  the  DEM  defines  callout  functions. The  declarations  of  the </p>
<p>callout functions are provided by the BSW module. It is the integrator's task to provide the </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>86 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>corresponding function definitions. The definitions of the callouts can be adjusted to the </p>
<p>system's needs. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>If following interfaces are used as port interfaces without RTE, the function prefix </p>
<p><b>Rte_Call_Dem_</b></p>
<p>.will be replaced by the prefix </p>
<p><b>Appl_Dem_</b></p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.5.2.1 </b></p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType </p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier </b>( </p>
<p>  Dem_MaxDataValueType  Data  </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>Data  </p>
<p>Pointer to the buffer in the DEM which must be filled with the requested value. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>If the data value of the requested data identifier is available and successful </p>
<p>supplied as out parameter the API returns E_OK. If there is no data value </p>
<p>available for a certain data identifier the API returns E_NOT_OK. In case of </p>
<p>E_NOT_OK the DEM fills the missing data with the padding value 0xFF, </p>
<p>reports the development error DEM_E_NODATAAVAILABLE to the DET and </p>
<p>continues its normal operation. </p>
<p><b>Functional Description </b></p>
<p>Gets data value defined by a data identifier. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>AUTOSAR requires <i><b>CBValByDID_&lt;DataID&gt; </b></i>as <i>&lt;ConfiguredName&gt;</i>. </p>
<p>In the configuration tool GENy the <i>&lt;ConfiguredName&gt; </i>is fully configurable by the user, you are not </p>
<p>restricted to this AUTOSAR requirement. </p>
<p>For full compliance with non-Vector components, choose the AUTOSAR required name. See “OnScreen </p>
<p>Help” window in GENy for hint. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>Data values are required for a specific (pre-stored) FreezeFrame </p>
<p>Table 6-50  </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To get DCM compatible ports, use the option “Use Dcm Compatible Ports” described in </p>
<p>chapter 8.2.6. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>87 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>88 / 127</p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>When DCM compatible ports are used, the runnable may not return neither </p>
<p>E_PENDING nor E_NOT_OK. </p>
<p>In case of an error the SWC shall return E_OK and fill the whole data buffer with 0xFF </p>
<p>bytes instead of returning E_NOT_OK. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.5.2.2 </b></p>
<p><b>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord </b>(  </p>
<p>  Dem_MaxExtendedDataRecordType  Data  </p>
<p>) </p>
<p><b>Parameter </b></p>
<p>Data  </p>
<p>Pointer to the buffer in the DEM which must be filled with the requested value. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>The return value specifies whether the API call has been successful </p>
<p>(Extended Data Record available) or not (no Extended Data Record </p>
<p>available). In case of E_NOT_OK the DEM fills the missing Data with the </p>
<p>padding value 0xFF, reports the development error </p>
<p>DEM_E_NODATAAVAILABLE to the DET and continues its normal operation. </p>
<p><b>Functional Description </b></p>
<p>Gets an extended data record. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>AUTOSAR requires <i><b>CBExtDataRec_&lt;RecordNumber&gt; </b></i>as <i>&lt;ConfiguredName&gt;</i>. </p>
<p>In the configuration tool GENy the <i>&lt;ConfiguredName&gt; </i>is used as required by AUTOSAR. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task context </p>
<p><b>&gt; </b></p>
<p>ExtendedDataRecord is required </p>
<p>Table 6-51  </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord </p>
<p><b>6.6 </b></p>
<p><b>Service Ports </b></p>
<p><b>6.6.1 </b></p>
<p><b>Client Server Interface </b></p>
<p>A client server interface is related to a Provide Port at the server side and a Require Port </p>
<p>at the client side.  </p>
<p><b>6.6.1.1 </b></p>
<p><b>Provide Ports on DEM Side </b></p>
<p>At  the  Provide  Ports  of  the  DEM  the  API  functions  described  in  6.2  are  available  as </p>
<p>Runnable Entities. The Runnable Entities are invoked via operations. The mapping from a </p>
<p>SWC client call to an operation is performed by the RTE. In this mapping the RTE adds </p>
<p>Port Defined Argument Values to the client call of the SWC, if configured. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>89 / 127</p>
<p>The  following  sub-chapters  present  the  Provide  Ports  defined  for  the  DEM  and  the </p>
<p>operations defined for the Provide Ports, the API functions related to the operations and </p>
<p>the Port Defined Argument Values to be added by the RTE. </p>
<p><b>6.6.1.1.1 </b></p>
<p><b>DiagnosticMonitor </b></p>
<p> </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Port Defined Argument Values </b></p>
<p>SetEventStatus </p>
<p>Dem_SetEventStatus </p>
<p>IN Dem_EventStatusType EventStatus, </p>
<p>ERR{E_NOT_OK} </p>
<p>ResetEventStatus </p>
<p>s </p>
<p>Dem_ResetEventStatu</p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventStatus </p>
<p>Dem_GetEventStatus </p>
<p>dType </p>
<p>d, ERR{E_NOT_OK} </p>
<p>OUT Dem_EventStatusExtende</p>
<p>EventStatusExtende</p>
<p>GetEventFailed </p>
<p>Dem_GetEventFailed </p>
<p>OUT Boolean EventFailed, </p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventTested </p>
<p>Dem_GetEventTested </p>
<p>OUT Boolean EventTested, </p>
<p>ERR{E_NOT_OK} </p>
<p>GetDTCOfEvent </p>
<p>Dem_GetDTCOfEvent </p>
<p>IN Dem_DTCKindType DTCK</p>
<p>Dem_DTCType DTC, ERR{E_NO</p>
<p>DEM_GET_DTCOFEVE</p>
<p>ind, OUT </p>
<p>T_OK, </p>
<p>NT_WRONG_DT</p>
<p>CKIND, </p>
<p>DEM_GET_DTCOFEVENT_WRONG_EV</p>
<p>ENTID} </p>
<p>PrestoreFreezeFrame </p>
<p>Dem_PrestoreFreezeFrame </p>
<p>ERR{E_NOT_OK} </p>
<p>ClearPrestoredFreezeFrame </p>
<p>Dem_ClearPrestoredFreezeFrame</p>
<p>_OK} </p>
<p>ERR{E_NOT</p>
<p>GetFaultDetectionCounter </p>
<p>ter </p>
<p>tectionCounterType </p>
<p>Counter, </p>
<p>Dem_GetFaultDetectionCoun</p>
<p>OUT Dem_FaultDe</p>
<p>EventIdFaultDetection</p>
<p>ERR{E_NOT_OK} </p>
<p>GetOccurrenceCounter </p>
<p>Dem_GetOccurrenceCounter </p>
<p>OUT UInt8 OccurrenceCounterValue, </p>
<p>ERR{E_NOT_OK} </p>
<p>T</p>
<p><b>Cycle </b></p>
<p> </p>
<p>able 6-52  </p>
<p>DiagnosticMonitor </p>
<p><b>6.6.1.1.2 </b></p>
<p><b>Operation</b></p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Port Defined Argument Values </b></p>
<p>SetOperationCycleState </p>
<p>Dem_SetOperationCycleState </p>
<p>IN Dem_OperationCycleStateType </p>
<p>CycleState, ERR{E_NOT_OK} </p>
<p>T</p>
<p><b>OemId </b></p>
<p>This optional interface is not supported by Vector. </p>
<p>able 6-53  </p>
<p>OperationCycle </p>
<p><b>6.6.1.1.3 </b></p>
<p><b>ValueBy</b></p>
<p>See chapter 6.2.3.10. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>90 / 127</p>
<p><b>6.6.1.1.4 </b></p>
<p><b>EnableCondition </b></p>
<p>orted by Vector. </p>
<p><b>tatus </b></p>
<p>This optional interface is not supp</p>
<p>See chapter 6.2.3.11. </p>
<p><b>6.6.1.1.5 </b></p>
<p><b>IndicatorS</b></p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Port Defined Argument Values </b></p>
<p>GetIndicatorStatus </p>
<p>tatus </p>
<p>tus, </p>
<p>Dem_GetIndicatorS</p>
<p>OUT IndicatorStatusType IndicatorSta</p>
<p>ERR{E_NOT_OK} </p>
<p>T</p>
<p><b>6.6.1.2 </b></p>
<p><b>Require Ports on DEM Side </b></p>
<p>. These Operations have to be provided by </p>
<p>tities.  These  Runnable  Entities  implement  the </p>
<p> Notifications or Callouts, which are described in </p>
<p><b>otification CallbackInitMonitorForEvent </b></p>
<p>able 6-54  </p>
<p>IndicatorStatus </p>
<p>At its Require Ports the DEM calls Operations</p>
<p>the  SWCs  by  means  of  Runnable  En</p>
<p>callback functions expected by the DEM. </p>
<p>The following sub-chapters present the Require Ports defined for the DEM, the Operations </p>
<p>that are called by the DEM and the related</p>
<p>chapter 6.5. </p>
<p><b>6.6.1.2.1 </b></p>
<p><b>N</b></p>
<p><b>Operation </b></p>
<p><b>Notification </b></p>
<p>InitMonitorForEvent{EventName} </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_InitMonitorForEvent </p>
<p>T</p>
<p>Evt_&lt;EventName&gt; </p>
<p>as </p>
<p>&lt;ConfiguredName&gt;. </p>
<p>This </p>
<p>name </p>
<p>is </p>
<p>suggested by the configuration tool GENy but fully configurable by the user.  </p>
<p>This callback is not supported by Vector DEM. To initialize monitors use the AUTOSAR API </p>
<p>able 6-55  </p>
<p>CallbackInitMonitorForEvent </p>
<p>AUTOSAR </p>
<p>requires </p>
<p>CBInit</p>
<p><b>6.6.1.2.2 </b></p>
<p><b>Notification CallbackInitMonitorForFunction </b></p>
<p>CallbackInitMonitorForEvent instead. </p>
<p><b>6.6.1.2.3 </b></p>
<p><b>Notification CallbackEventStatusChange </b></p>
<p><b>Operation </b></p>
<p><b>Notification </b></p>
<p>EventStatusChanged </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_EventStatusChanged </p>
<p>T</p>
<p>tatusChange </p>
<p>usEvt_&lt;EventName&gt;  as  &lt;ConfiguredName&gt;.  This  name  is </p>
<p>suggested by the configuration tool GENy but fully configurable by the user.  </p>
<p>able 6-56  </p>
<p>CallbackEventS</p>
<p>AUTOSAR  requires  CBStat</p>
<p><b>6.6.1.2.4 </b></p>
<p><b>Notification CallbackDTCStatusChange </b></p>
<p><b>Operation </b></p>
<p><b>Notification </b></p>
<p>DTCStatusChanged </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>91 / 127</p>
<p>Table 6-57  </p>
<p>CallbackDTCStatusChange </p>
<p>A</p>
<p>requires  CBStatusDTC_&lt;EventName&gt;  as  &lt;ConfiguredName&gt;.  This  name  is </p>
<p>s</p>
<p>onfiguratio</p>
<p><b>6.6.1.2.5 </b></p>
<p><b>Callout Function CallbackGetDataValueByDataID{DataId} </b></p>
<p>UTOSAR </p>
<p>uggested by the c</p>
<p>n tool GENy but fully configurable by the user.  </p>
<p><b>Operation </b></p>
<p><b>Callout Function </b></p>
<p>GetDataValueByDataID </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataID </p>
<p>Table 6-58  </p>
<p>CallbackGetDataValueByDataID{DataId} </p>
<p>AUTOSAR </p>
<p>requires </p>
<p>CBValB</p>
<p>as </p>
<p>&lt;ConfiguredName&gt;. </p>
<p>This </p>
<p>name </p>
<p>is </p>
<p>s</p>
<p>iguration</p>
<p>yDID_&lt;DataID&gt; </p>
<p>uggested</p>
<p> by the conf</p>
<p> tool GENy but fully configurable by the user. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>To get DCM compatible ports, use the option “Use Dcm Compatible Ports” described in </p>
<p>chapter 8.2.6. </p>
<p><b>Info </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.6.1.2.6 </b></p>
<p><b>Callout Function CallbackGetExtendedDataRecord{RecordNumber} </b></p>
<p><b>Operation </b></p>
<p><b>Callout Function </b></p>
<p>GetExtend dDataRecord </p>
<p>Rte_Call_Dem_&lt;ConfiguredName&gt;_GetExtendedDataRecord </p>
<p>e</p>
<p>Table 6-59  </p>
<p>CallbackGetExtendedDataRecord{RecordNumber} </p>
<p>A</p>
<p>requires CBExtDa</p>
<p>umber&gt; as &lt;ConfiguredName&gt;. This name </p>
<p>i</p>
<p>tion to</p>
<p><b>FaultDetectCounter </b></p>
<p>As </p>
<p>debouncing </p>
<p>is </p>
<p>implemented </p>
<p>in </p>
<p>the </p>
<p>DEM, </p>
<p>the </p>
<p>SWC </p>
<p>does </p>
<p>not </p>
<p>have </p>
<p>to </p>
<p>deliver </p>
<p>the </p>
<p>PI. </p>
<p>UTOSAR </p>
<p>taRec_&lt;RecordN</p>
<p>s </p>
<p>used</p>
<p> by the configura</p>
<p>ol GENy. </p>
<p><b>6.6.1.2.7 </b></p>
<p><b>Callout Function CallbackGet</b></p>
<p>DTCFaultDetectionCounter via this callback function. </p>
<p>Therefore there is no need to support this A</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>7 </b></p>
<p><b>Additional Features </b></p>
<p><b>7.1 </b></p>
<p><b>Multi-Identity Support </b></p>
<p><b>7.1.1 </b></p>
<p><b>Functionality </b></p>
<p>Per specification the DEM has a static configuration set – once all events are configured, </p>
<p>and the program code is flashed into the ECU there are no more configuration changes </p>
<p>possible. This is the so called single identity mode. </p>
<p> </p>
<p>The DEM module, developed by Vector, additionally implements a dynamic configuration </p>
<p>mode  that  allows  switching  among  the  available  configuration  sets  at  run-time  (without </p>
<p>need to reprogram the ECU). This requires that the superset of all variants must be pre-</p>
<p>enabled during the software compilation and link process. </p>
<p>DEM/DCM supports the following kinds of diagnostic configuration set usage: </p>
<p><b>&gt; </b></p>
<p>Single Identity – the ECU is programmed with only one configuration set. </p>
<p><b>&gt; </b></p>
<p>Multi Identity – the ECU is programmed with multiple configuration sets. At ECU start up </p>
<p>there will be only one of them selected as active (exclusive configuration selection). </p>
<p><i>Multi Identity Mode is not available with this version of the DEM. </i></p>
<p><b>&gt; </b></p>
<p>Vehicle System Group (VSG) – the ECU is programmed with multiple configuration sets, </p>
<p>where as one of them is specified as base variant. At ECU start up the base variant will </p>
<p>be always active (automatically used in DEM). Optionally the application can select one </p>
<p>or more from the available configuration sets to be active too (additive configuration </p>
<p>selection). </p>
<p> </p>
<p>For more details about the different kinds of the configuration use cases, please refer to </p>
<p>the following chapters and to the related chapters of the DCM Technical Reference. </p>
<p> </p>
<p><b>7.1.2 </b></p>
<p><b>Single-Identity Mode </b></p>
<p>If the single-identity operation mode has been selected, DEM uses a statically assigned </p>
<p>configuration set which is linked at ECU compile and link time. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>92 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>DEM </p>
<p>BSW </p>
<p>APPL </p>
<p>DCM </p>
<p>DEM  </p>
<p>Event CFG </p>
<p>Figure 7-1 </p>
<p>DEM single identity mode </p>
<p>In this case DEM has only one diagnostic configuration set. </p>
<p> </p>
<p><b>7.1.2.1 </b></p>
<p><b>Configuration in CANdela </b></p>
<p><b>ation in CANdela </b></p>
<p>You  just  need  to  prepare  the  corresponding  CDD  variant  for  your  ECU  configuration  in </p>
<p>CANdelaStudio as usual.</p>
<p> </p>
<p>You  just  need  to  prepare  the  corresponding  CDD  variant  for  your  ECU  configuration  in </p>
<p>CANdelaStudio as usual.</p>
<p> </p>
<p><b>7.1.2.2 </b></p>
<p><b>Configuration in GENy </b></p>
<p><b>7.1.2.2 </b></p>
<p><b>Configuration in GENy </b></p>
<p>Import the CDD file and the corresponding CDD variant in GENy (refer to chapter <i>8.2.2.1 </i></p>
<p>Single Identity Mode). </p>
<p>Import the CDD file and the corresponding CDD variant in GENy (refer to chapter <i>8.2.2.1 </i></p>
<p>Single Identity Mode). </p>
<p>  </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>93 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>7.1.3 </b></p>
<p><b>Vehicle System Group (VSG) Mode </b></p>
<p>In Vehicle System Group (VSG) mode, DEM has the following characteristics: </p>
<p><b>&gt; </b></p>
<p>Allows to support multiple diagnostic configuration variants – each variant reflects a </p>
<p>VSG from the imported CDD file, and additionally there is a base variant that contains </p>
<p>all services that does not belong to any VSG. </p>
<p><b>&gt; </b></p>
<p>One or several configuration variants can be simultaneously activated during the ECU </p>
<p>initialization. The base variant is always active. </p>
<p>All VSGs are specified by a single variant of a CDD (see chapter <i>7.1.3.1</i>). The common </p>
<p>part of all VSGs will build the <i>base variant</i>. The difference of each VSG in relation to the </p>
<p><i>base  variant </i> will  build  a <i> diagnostic  configuration  variant</i>.  At  startup,  the  ECU  will  be </p>
<p>configured with the <i>base variant </i>plus zero or more <i>diagnostic configuration variants</i>. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM </p>
<p>BSW </p>
<p><i>Add. </i>DEM  </p>
<p>Event CFG </p>
<p>APPL </p>
<p>DCM </p>
<p><i>Base </i>DEM </p>
<p>Event CFG </p>
<p>additional to base </p>
<p>(optional)</p>
<p>∑ </p>
<p> </p>
<p>Figure 7-2 </p>
<p>DEM Vehicle System Group (VSG) mode </p>
<p> </p>
<p><b>7.1.3.1 </b></p>
<p><b>Configuration in CANdela </b></p>
<p>Please follow the steps below on how to configure VSG in CANdelaStudio. </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>94 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>1. </p>
<p>Defining all available VSGs for the actual ECU. </p>
<p>In CANdelaStudio, select the Vehicle System Groups view and add all necessary VSGs </p>
<p>into the VSG pool. </p>
<p> </p>
<p>Figure 7-3 </p>
<p>Defining VSGs in CANdelaStudio </p>
<p>The name of the created VSGs will be used later by DEM for the diagnostic configuration </p>
<p>constants that the DEM application shall use during the configuration activation phase (see </p>
<p>chapter <i>6.2.2.4 Dem_InitDiagnosticVariant</i>). </p>
<p>Each DTC can be assigned to one or more VSGs. </p>
<p> </p>
<p>Figure 7-4 </p>
<p>Assigning VSGs to a DTC in CANdelaStudio</p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>95 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>If  a  DTC  is  part  of  all  defined  VSGs  (or  in  none  of  them)  it  will  be  put  into  the <i> base  variant</i>, </p>
<p>otherwise it will be put into the configured additive </p>
<p><i>diagnostic configuration variant(s)</i></p>
<p>. </p>
<p>In the example above it will become part of additive variant “VSG2” and of “VSG3” – it is not part of </p>
<p>the additive variant “VSG1”. </p>
<p>The DTC is available, when you start-up your ECU in these modes: </p>
<p><b>&gt; </b> Base variant + VSG2 </p>
<p><b>&gt; </b> Base variant + VSG3 </p>
<p><b>&gt; </b> Base variant + VSG1 + VSG2 </p>
<p><b>&gt; </b> Base variant + VSG2 + VSG3 </p>
<p>It is not available, </p>
<p>when you start-up your ECU in that mode:</p>
<p> </p>
<p><b>&gt; </b> Base variant only </p>
<p><b>&gt; </b> Base variant + VSG1 </p>
<p> </p>
<p><b>7.1.3.2 </b></p>
<p><b>Configuration in GENy </b></p>
<p>Import the CDD file in GENy (refer to chapter <i>8.2.2.2 Vehicle System Group </i>(VSG) Mode). </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>96 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>8 </b></p>
<p><b>Configuration </b></p>
<p>GENy  is  the  configuration  tool  for  all  MICROSAR  components.  CANdelaStudio  is  the </p>
<p>expert  tool  for  diagnostic  communication  managed  by  the  DCM. All  diagnostic  services </p>
<p>used by the DCM can be configured there. The DCM and the DEM work closely together </p>
<p>so  significant  attributes  of  the  DEM  can  be  configured  in  CANdelaStudio  as  well  as  in </p>
<p>GENy. </p>
<p>In the DEM the attributes can be configured with the following methods: </p>
<p><b>&gt; </b> Configuration in CANdelaStudio, for a detailed description see 8.1 </p>
<p><b>&gt; </b> Configuration in GENy, for a detailed description see 8.1.3.1 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The configuration made in CANdelaStudio can be used for automatic configuration in </p>
<p>GENy – see 8.2.2.3. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The structure of the template (CDDT) and the qualifier of all relevant attributes and </p>
<p>parameters is predefined for correct import of CDD files in GENy. Any modification </p>
<p>might result in unrecognized values during the import. </p>
<p>The DIAG_ASRDEM_VECTOR 2.08.00 is released for CDD-Template </p>
<p>. </p>
<p>Please check that your CDD founds on the correct CDDT in CANdelaStudio menu </p>
<p>“File” &gt; “Properties…” &gt; “Document Info”. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.1 </b></p>
<p><b>Configuration with CANdelaStudio </b></p>
<p>The following attributes can  be  configured  in  the  diagnostic instance “Fault Memory” for </p>
<p>the DEM. </p>
<p><b>8.1.1 </b></p>
<p><b>DTC Settings </b></p>
<p>In  the  DTCStatusAvailabilityMask  table  you  can  configure  the  reported  status  bits  which </p>
<p>are used for all DTCs. </p>
<p>In the DTC Table you can create DTCs and make the needed settings for them. See the </p>
<p>following table to find the analogy between the CANdela attributes and the GENy notations </p>
<p>(the attributes not used for the configuration are not mentioned here). </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>97 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>DTC Table </b></p>
<p>CANdelaStudio  </p>
<p>GENy </p>
<p>DTC  </p>
<p>DTC </p>
<p>Errortext shortname  </p>
<p>Symbolic Name </p>
<p>Operation Cycle  </p>
<p>Operation Cycle Ref </p>
<p>Self Healing (Aging) </p>
<p>Healing Allowed </p>
<p>Healing Cycle  </p>
<p>Healing Cycle Ref </p>
<p>Healing Cycles  </p>
<p>Healing Cycle Counter </p>
<p>Monitor Initialization Function </p>
<p>Init Monitor Name, will be: </p>
<p>CBInitEvt<i>_&lt;Symbolic Name&gt; </i></p>
<p>DTC Priority  </p>
<p>Event Priority </p>
<p>DTC Severity </p>
<p>DTC Severity </p>
<p>Pre-Debounce Algorithm </p>
<p>Pre Debounce Name </p>
<p>Count-In step size </p>
<p>Count In Step Size </p>
<p>Count-Out step size </p>
<p>Count Out Step Size </p>
<p>Use Jump-Up (Prefailed) </p>
<p>Jump Up </p>
<p>Use Jump-Down (Prepassed) </p>
<p>Jump Down </p>
<p>Set WarningIndicator Bit at fault </p>
<p>DTC Support Warning Indicator </p>
<p>Functional Unit </p>
<p>DTC Functional Unit – fixed to 0xFF </p>
<p>DTC Debounce Failed Timeout Value </p>
<p>Failed Timeout Value [ms] </p>
<p>DTC Debounce Passed Timeout Value </p>
<p>Passed Timeout Value [ms] </p>
<p>Table 8-1  </p>
<p>Equivalence of DTC Settings in CANdelaStudio and GENy </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Several BSW errors are predefined for your project. These errors are typically internal </p>
<p>and therefore, no DTC number is configured and no additional data will be stored when </p>
<p>the event becomes failed. In GENy, many settings of BSW errors are greyed out and </p>
<p>can not be changed. </p>
<p>To change settings of BSW errors, you must configure them via CANdelaStudio. Use </p>
<p>the “Symbolic Name” of the BSW error as “Errortext shortname” and make your </p>
<p>configurations. During the import of the CDD in GENy (see 8.2.2.3) the settings of that </p>
<p>BSW error will be overwritten. To avoid inconsistencies, all imported settings will be </p>
<p>write-protected (i.e. greyed out) in GENy. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>98 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>In Vehicle System Group (VSG) mode (see chapter <i>7.1.3</i>) all DTCs created in GENy </p>
<p>are put into the <i>base variant</i>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>8.1.2 </b></p>
<p><b>Freeze Frame Types (Snapshot Records) </b></p>
<p>Snapshot records can be assigned to the single DTCs. They consist of one ore more DIDs </p>
<p>(Data </p>
<p>Identifiers). </p>
<p>To </p>
<p>configure </p>
<p>the </p>
<p>snapshot </p>
<p>record </p>
<p>data, </p>
<p>follow </p>
<p>the </p>
<p>subsequent </p>
<p>description: </p>
<p><b>&gt; </b> Ensure that the required DIDs are available in a data identifier diagnostic class e.g. </p>
<p>“Read Only Data Identifiers”. Create a new diagnostic instance with the required </p>
<p>identifier if necessary: </p>
<p></p>
<p> </p>
<p>Right-Mouse-Button on “Read Only Data Identifiers”, add new diagnostic instance </p>
<p></p>
<p> </p>
<p>Configure name and DID </p>
<p></p>
<p> </p>
<p>Create a new Packet data type for this DID (configure name and size), copy or reuse </p>
<p>an existing Packet data type </p>
<p><b>&gt; </b> Assign the needed DIDs to the DTCs via Right-Mouse-Button menu “New DID </p>
<p>reference” (tab “Snapshot Record” of diagnostic instance “Fault Memory”). </p>
<p><b>8.1.3 </b></p>
<p><b>Extended Records </b></p>
<p>The configured extended data record package is used for all DTCs. </p>
<p><b>&gt; </b> Ensure that the data types with the required extended records are available. Otherwise </p>
<p>create a new data type “Text Table” or extend an existing one with the missing extended </p>
<p>record numbers (e.g. data type “ExtendedDataRecordNumber). </p>
<p><b>&gt; </b> Assign the data type including the required extended data record numbers in tab </p>
<p>“ExtendedDataRecordNumber”. </p>
<p><b>8.1.3.1 </b></p>
<p><b>OccurrenceCounter </b></p>
<p>For using the internally implemented occurrence counter your CDD must base on a CDDT </p>
<p>that offers this feature. See description below, how to check for the correct CDD.  </p>
<p>The  extended  data  record  “OccurrenceCounter”  shall  be  predefined  in  the  CDD  of  your </p>
<p>delivery. The record has some constraints: </p>
<p></p>
<p> </p>
<p>it must contain only one data element, and </p>
<p></p>
<p> </p>
<p>this data element must be of Datatype “Occurrence Counter”, which is a 1 Byte </p>
<p>unsigned data that was specifically flagged in the CDDT. </p>
<p>The record number for the extended data record can be modified by the user. It defaults to </p>
<p>Extended Record Number 0x01. </p>
<p>If this extended data record exists, the internal implementation for the Occurrence Counter </p>
<p>will  be  activated,  you  will  get  an  API  for  the  BSW  modules  to  read  the  counter  (see </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>99 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>6.2.3.14) and you will get an additional operation for the PortInterface DiagnosticMonitor </p>
<p>for access via the RTE (see 6.6.1.1.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>If this extended record does not exist or above constraints are not fulfilled, the internal </p>
<p>implementation of the occurrence counter will be deactivated. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>When  the  “OccurrenceCounter”  is  missing  in  your  CDD  (but  supported  by  the  CDDT), </p>
<p>please follow the subsequent description to add the counter: </p>
<p><b>&gt; </b> Ensure that the datatype “Occurrence Counter” exists. Create a new “raw value” if </p>
<p>necessary: </p>
<p></p>
<p> </p>
<p>Right-Mouse-Button in the list of the Data Types, add “New Data Type” “Raw Value” </p>
<p></p>
<p> </p>
<p>In tab “General” configure name (“Occurrence Counter”) and qualifier </p>
<p>(“OccurrenceCounter”) </p>
<p></p>
<p> </p>
<p>In tab “id Raw value” configure Length (Byte:Bit) “1:0” and “Encoding” with </p>
<p>“Unsigned” </p>
<p><b>&gt; </b> Assign this data type to the extended record you want to use as occurrence counter ( in </p>
<p>diagnostic class “Fault Memory”, tab “ExtendedDataRecord”) </p>
<p> </p>
<p>Figure 8-1 </p>
<p>OccurrenceCounter </p>
<p>When  you  followed  above  sequence  but  the  internal  implementation  of  the  occurrence </p>
<p>counter is still not available, please prove following, to evaluate if the feature is missing in </p>
<p>your CDDT. </p>
<p>In GENy open the DEM’s extended data record view: </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>100 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>In the right side of the window, the internal OccurrenceCounter will look like: </p>
<p> </p>
<p>Å</p>
<p> Correct: No Function here</p>
<p> </p>
<p>Figure 8-2 </p>
<p>This CDD supports the internal Occurrence Counter </p>
<p> </p>
<p>When  the  CDD/CDDT  does <b> not  support </b> the  internal  OccurrenceCounter,  the  window </p>
<p>contains an additional row “</p>
<p><b>Get Ext Data Record Fnc</b></p>
<p>“. In this case you must change your </p>
<p>CDDT or upgrade your CDD to use the internal counter. </p>
<p> </p>
<p>Å</p>
<p> Wrong: External Function </p>
<p>Figure 8-3 </p>
<p>This CDD does NOT support the internal Occurrence Counter </p>
<p> </p>
<p><b>8.1.4 </b></p>
<p><b>Pre de-bounce algorithms </b></p>
<p>The DEM offers the algorithms </p>
<p><b>&gt; </b></p>
<p>Counter based </p>
<p><b>&gt; </b></p>
<p>Time based </p>
<p>The CDD setting “Application based” is not supported. During import, the counter based </p>
<p>algorithm is used instead and GENy will report an error message for the wrong configured </p>
<p>DTC. </p>
<p>For implementing an external de-bouncing, choose the counter based algorithm with step </p>
<p>size  “1”.  When  you  start  the  application  based,  external  de-bouncing,  send  the  event </p>
<p>status PRE_FAILED respectively PRE_PASSED as trigger to the DEM to correctly initialize </p>
<p>the FaultDetectionCounter. At end of application based de-bouncing, report the final event </p>
<p>status to DEM as PASSED respectively FAILED. </p>
<p> </p>
<p><b>8.2 </b></p>
<p><b>Configuration with GENy </b></p>
<p>The DEM is configured with the help of the configuration tool GENy. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>101 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>8.2.1 </b></p>
<p><b>Start the Configuration </b></p>
<p>To configure the DEM select this component in the system configuration window. The DEM </p>
<p>should be visible in the tree view. </p>
<p><b>8.2.2 </b></p>
<p><b>Import CDD </b></p>
<p>Independent of the used variant mode (Single Identity or Vehicle System Group (VSG)), </p>
<p>the used CDD(s) are configured with component DCM for both, the DEM and the DCM. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>When you switch off the DCM, the virtual component “Diagnostic Configuration” will </p>
<p>pop up instead. Use this component to configure the imported CDD files and diagnostic </p>
<p>variants: </p>
<p> </p>
<p> </p>
<p>Note: For supporting Multiple Identity Mode (see chapter <i>7.1.3 Vehicle System Group </i></p>
<p><i>(VSG) Mode</i>) together with ECU-C file format to store the configuration, the use of </p>
<p>Vector’s DCM is mandatory. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.2.1 </b></p>
<p><b>Single Identity Mode </b></p>
<p>First you have to put the DCM GENy configurator in single-identity mode: </p>
<p> </p>
<p>Figure 8-4 </p>
<p>Switching DCM/DEM in GENy to single-identity mode </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>102 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Now  you  have  to  specify  the  CDD  file  and  a  CDD  variant  for  the  first  diagnostic </p>
<p>configuration. </p>
<p> </p>
<p>Figure 8-5 </p>
<p>Select the CDD and the variant in the CDD </p>
<p> </p>
<p><b>8.2.2.2 </b></p>
<p><b>Vehicle System Group (VSG) Mode </b></p>
<p>Here  are  the  steps  you  have  to  follow  in  order  to  configure  multi-identity  mode  (Vehicle </p>
<p>System Group – VSG) in GENy. </p>
<p> </p>
<p>1. </p>
<p>Select multi-identity mode “VSG Mode” for DCM and DEM  </p>
<p>First you have to put the DCM GENy configurator in multi-identity mode: </p>
<p> </p>
<p>Figure 8-6 </p>
<p>Switching DCM in GENy to VSG mode </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>103 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Now import the CDD file and specify the CDD-variant containing the VSGs in GENy. </p>
<p> </p>
<p>Figure 8-7 </p>
<p>Select the CDD and the variant in the CDD </p>
<p> </p>
<p><b>8.2.2.3 </b></p>
<p><b>Automatic Configuration via CANdelaStudio Files </b></p>
<p>For automatic configuration via CANdelaStudio file (*.CDD) here some remarks. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Not all settings of the DEM can be done via CANdelaStudio and not all properties can </p>
<p>be imported automatically. The GENy import message refers to possible errors. They </p>
<p>shall not cause an erratic behaviour. The DEM settings have to be verified and if </p>
<p>necessary extended manually. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The settings of BSW errors will be overwritten, if this event is configured in the CDD, </p>
<p>too (i.e. in the CDD exists a DTC with the name of the BSW error as “Errortext </p>
<p>shortname” - see chapter 8.1.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To avoid inconsistencies, all imported settings from the CDD will be write-protected in </p>
<p>GENy. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>&gt; </b> You can reselect the “CANdela Variant” to re-import the *.CDD-file. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>In CANdelaStudio there are no equivalents to Trigger Functions. For setting these </p>
<p>elements see following chapters. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Later imports may overwrite manual modifications in the GENy configuration. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>104 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.3 </b></p>
<p><b>Tree View </b></p>
<p>With the tree view the different tables can be accessed. </p>
<p> </p>
<p> </p>
<p>Figure 8-8 </p>
<p>Tree View </p>
<p>By pressing the + you will open the tree and see the currently defined objects. </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>105 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>8.2.4 </b></p>
<p><b>Main Configuration Window </b></p>
<p> </p>
<p>Figure 8-9 </p>
<p>Main Configuration Window  </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>106 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>The main configuration window is separated in different sections. For a detailed description </p>
<p>see the following chapters. </p>
<p><b>8.2.5 </b></p>
<p><b>Common </b></p>
<p>These switches are informational and show the current settings of the delivered DEM </p>
<p>library files. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The precompiled settings cannot be changed, due to compatibility with the delivered </p>
<p>library files. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>When you received source files of the DEM, the Development Error Detection (“Dev </p>
<p>Error Detect”) can be switched off or on. When this option is switched on, development </p>
<p>errors are reported to the development error tracer (DET). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.6 </b></p>
<p><b>Software Component Template </b></p>
<p><i><b>Use RTE: </b></i>RTE-support can be en-/disabled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>When you received library files of the DEM, please validate that the size of event ID </p>
<p>data type is not different between DEM types and RTE created types when changing </p>
<p>this setting. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>When enabling the RTE-support please ensure that there is at least one external event </p>
<p>configured. Map the associated port interfaces via DaVinci Network Designer. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The RTE-generated data type of the DEM “Dem_EventIdType” will be removed by the </p>
<p>RTE if there is no event with event destination other than internal. That optimization will </p>
<p>lead to a compile-error because the DEM needs that data type anyway. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Software Component Name: </b></i>Used in the service port export as service component </p>
<p>template name. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Change this name if you try to import the Dem components of several ECUs and have </p>
<p>problems with name clashes. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>107 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Use Dcm Compatible Ports:  </b></i></p>
<p>If this option is enabled, the port interface 'CallbackGetDataValueByDataID' is replaced by </p>
<p>a separate port interface CallbackGetDataValue_&lt;DID&gt; per DID. </p>
<p>The operation GetDataValueByDataIdentifier is redefined to be compatible to the DCM </p>
<p>counterpart ReadData. </p>
<p>This makes it possible to trigger the same runnable with both operations. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>To work correctly, the runnable may not return neither E_PENDING nor E_NOT_OK </p>
<p>and may not depend upon CheckConditionRead being called before the runnable is </p>
<p>triggered. </p>
<p>In case of an error the SWC shall return E_OK and fill the whole data buffer with 0xFF </p>
<p>bytes instead of returning E_NOT_OK. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>If the option is disabled, the ports are generated as defined by AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>This option has no effect if the RTE support is disabled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.7 </b></p>
<p><b>Postbuild Settings </b></p>
<p><i><b>Postbuild Start Address: </b></i>Enter the start address of your post-build configurable data of </p>
<p>the DEM. </p>
<p>See [8] for more information. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Configuration variant post-build is not supported (see chapter 3 for supported </p>
<p>configuration variant(s). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.8 </b></p>
<p><b>Miscellaneous </b></p>
<p><i><b>Dem Version: </b></i>Version of the DEM embedded source. </p>
<p><i><b>Task Time [ms]: </b></i>Enter the time period for the scheduling of the Dem_MainFunction [ms]. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>This specified time must be provided by the ECU manager. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Support Fim Notification API: </b></i>As the FIM is part of the AUTOSAR system, the FIM will </p>
<p>be notified of event changes. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>108 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><i><b>DTC origin “Primary Memory” supported: </b></i>If enabled, this origin is available at the ECU. </p>
<p><i><b>Status Availability Mask: </b></i>The status availability mask as configured in the CDD </p>
<p><i><b>Snapshots Per DTC:</b></i></p>
<p> </p>
<p>Number of stored Snapshot Records that can simultaneously be </p>
<p>stored for each DTC. This is the sum of the first occurred and most recent snapshot </p>
<p>records stored. </p>
<p><i><b>First non-permanent snapshot: </b></i>First snapshot that will be overwritten when all snapshot </p>
<p>slots are filled once. This will produce so called &quot;most recent&quot; snapshots. The snapshot </p>
<p>slots are numbered zero (0) bases. </p>
<p>Examples: </p>
<p>- </p>
<p>If you enter 2, you will get two &quot;First Occurred&quot; snapshots, the remaining &quot;Most Recent&quot; </p>
<p>snapshots (= 'Number of FreezeFrame Snapshots' - 2) will be overwritten when the </p>
<p>event matures. </p>
<p>- </p>
<p>If you enter 0 here, there are no permanent &quot;First Occurred&quot; snapshots, all (= 'Number </p>
<p>of FreezeFrame Snapshots' - 0) snapshot slots are used for the latest occurrences of </p>
<p>the event (pure &quot;Most Recent&quot;). </p>
<p><i><b>Max Number Event Entry Prm: </b></i>The storage capability of failed events and their </p>
<p>environmental data is limited. The maximum size can be adjusted by this value. </p>
<p><i><b>Type Of DTC Supported: </b></i>The DTC type is fixed by preconfiguration. </p>
<p><b>8.2.9 </b></p>
<p><b>BSW Error Buffer </b></p>
<p>During start-up phase the BSW Modules report their errors with a buffered API </p>
<p>(</p>
<p>Dem_ReportError()</p>
<p>) until the DEM is fully functional (call of </p>
<p>Dem_Init()</p>
<p>). </p>
<p><i><b>Bsw Error Buffer Size: </b></i>Up to this number of events occurring before initialization of the </p>
<p>DEM module can be stored in an error queue. Those events are processed by the DEM </p>
<p>after the initialization process has completed. </p>
<p>Priority will not be checked. </p>
<p><i><b>Add Error Buffer Size: </b></i>In addition to the number of BSW events stored in the </p>
<p>BswErrorBuffer, up to this number of operation cycle start events can be stored in the start </p>
<p>up queue. </p>
<p>The value should match the number of different operation cycles of those BSW events that </p>
<p>can occur during system initialization. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>After the startup phase the buffers (for events and operation cycles) are joined and </p>
<p>reused to log event based API calls (see chapter 4.4). These actions will be executed </p>
<p>during the next call of </p>
<p>Dem_MainFunction()</p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>8.2.10 </b></p>
<p><b>DTC Groups </b></p>
<p>All available DTC groups are shown here and their represented DTC number can be </p>
<p>adapted there. Unused DTC groups do not need to have a DTC number set. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>109 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>8.2.11 </b></p>
<p><b>NvRam Block IDs </b></p>
<p>The NvM-API mentioned in 6.2.2.3 (</p>
<p>NvM_SetRamBlockStatus()</p>
<p>) accesses the NvRAM </p>
<p>blocks configured in the NvRAM manager.  </p>
<p><i><b>Manually add an NvRAM BlockID: </b></i>This option is to configure a <i><b>non-existing </b></i>NvRAM </p>
<p>BlockID for use with the DEM. </p>
<p>Pressing this button will only create a symbolic name for an NvRAM Block in the NvM </p>
<p>configuration, so you can choose that block when selecting the NvRAM Block ID in the </p>
<p>next settings. </p>
<p>This NvRAM Block ID is only used as a placeholder for GENy configuration and will <i><b>not </b></i>be </p>
<p>exported to an EcuC file when it is created here. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Please ensure that the NvRAM BlockID is completely configured in the NvRAM </p>
<p>manager later, if you choose that ID in the following settings! </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>NvRAM Block ID / Core NvRam Block: </b></i>The drop down list contains all available </p>
<p>(configured) NvM Block IDs. Select one for the DEM to store its non-volatile data at. </p>
<p>GENy will configure the following attributes in the </p>
<p>NvM/NvmBlockDescriptor</p>
<p> in the </p>
<p>EcuC file: </p>
<p>NvmRamBlockDataAddress</p>
<p> is set to </p>
<p>Dem_NvData</p>
<p> </p>
<p>NvmInitBlockCallback</p>
<p> is set to </p>
<p>Dem_NvDataInit</p>
<p> (see ch. <i>6.4.1</i>) </p>
<p>NvmSelectBlockForReadall</p>
<p> is set to </p>
<p>true.</p>
<p> </p>
<p>If the chosen NvRAM Block ID was placeholder only (“manually added”), it now becomes a </p>
<p><i><b>partly configured </b></i>NvRAM block after saving the EcuC file. Don’t forget to configure the </p>
<p>leftover parts! </p>
<p><b>8.2.12 </b></p>
<p><b>Manual Configuration </b></p>
<p>The different configuration elements can either be added in the main configuration window  </p>
<p> </p>
<p> </p>
<p>Figure 8-10 </p>
<p>Manual Configuration of the DEM via Main Configuration Window  </p>
<p>or by using Right-Mouse-Button in the left side tree view. </p>
<p><b> </b></p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>110 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p> </p>
<p>Figure 8-11 </p>
<p>Manual Configuration of the DEM via Right-Mouse-Button in Tree View </p>
<p><i><b>Create New Operation Cycle: </b></i>A new Operation Cycle can be added. </p>
<p><i><b>Create New Data Object: </b></i>A new Data Object can be added. </p>
<p><i><b>Create New Extended Data Record: </b></i>A new Extended Data Record can be added. </p>
<p><i><b>Create New Indicator: </b></i>A new Indicator can be added. </p>
<p><i><b>Create New Event: </b></i>A new Event can be added. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>For configuring an event, you need an operation cycle and indicator(s) if required. To </p>
<p>accelerate the configuration, please check that the necessary objects do exist before </p>
<p>creating a new event. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>With Vehicle System Group (VSG) mode (see chapter <i>7.1.3</i>) each event manually </p>
<p>created in GENy is put into the <i>base variant</i>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.1 </b></p>
<p><b>Operation Cycles Window </b></p>
<p>AUTOSAR predefines 4 Operation Cycles which are preconfigured. You can add your own </p>
<p>cycles here by using the Right-Mouse-Button in the tree view or by pressing the “Add </p>
<p>Operation Cycle” button in the main configuration window. </p>
<p> </p>
<p> </p>
<p>Figure 8-12 </p>
<p>Operation Cycles Window </p>
<p>The set “Symbolic Name” for this operation cycle can be used to identify this operation </p>
<p>cycle in a more human readable way. In the generated source there will be created a </p>
<p>#define using this name. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>111 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The AUTOSAR configuration model does not permit the definition of new, independent </p>
<p>cycles. You can only create new labels (symbolic names) for existing cycles. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.2 </b></p>
<p><b>Data Object Window </b></p>
<p>A data object describes one DataIdentifier – including its symbolic name, Data ID and Data </p>
<p>Size. For each data object a separate port interface can be created by adding individual </p>
<p>Port Prototype Name. If the same Port Prototype Name is used a common port interface </p>
<p>will be used. </p>
<p> </p>
<p>Figure 8-13 </p>
<p>Data Object Window </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>To get DCM compatible ports, use the option “Use Dcm Compatible Ports” described in </p>
<p>chapter 8.2.6. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.3 </b></p>
<p><b>Extended Data Records </b></p>
<p>The following ExtendedData Record can be imported via CDD (configuration see 8.1.3.1): </p>
<p> </p>
<p>Figure 8-14 </p>
<p>ExtendedData Records  </p>
<p><i><b>OccurrenceCounter: </b></i></p>
<p>This  ExtendedData  Record  will  be  available  when  a  CDD  configured  as  described  in </p>
<p>chapter 8.1.3.1 has been imported. It has a fixed size of 1 Byte (unsigned). The record </p>
<p>number is configurable in the CDD. You can neither change the size and the name of this </p>
<p>ExtendedData Record nor remove it from the configuration. </p>
<p>For this ExtendedData Record, an internal function of the DEM exists and therefore, no </p>
<p>port prototype must be configured. </p>
<p><i><b>Optional: further, user defined Data Records: </b></i></p>
<p>After adding a new record you must define the (1 Byte) record number and the size of this </p>
<p>record. The data values for ExtendedData Records are provided by the SWC. Therefore </p>
<p>the  callback  function  that  is  written  into  Port  Prototype  Name  field  will  be  called,  if  it  is </p>
<p>necessary to update the Extended Data Record of any event.  </p>
<p>The </p>
<p>suggestion </p>
<p>of </p>
<p>GENy </p>
<p>for </p>
<p>the </p>
<p>function </p>
<p>name </p>
<p>(Get </p>
<p>Ext </p>
<p>Data </p>
<p>Record </p>
<p>Fnc) </p>
<p>is </p>
<p>CBExtDataRec_&lt;</p>
<p>RecordNumber</p>
<p>&gt;.  In  spite  of AUTOSAR  configuration,  which  limits  the </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>112 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>name of the port interface to CBExtDataRec_&lt;</p>
<p>RecordNumber</p>
<p>&gt;, you can set the full name </p>
<p>of the function here. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The user defined extended records will be updated each time the event gets failed </p>
<p>(status bit “testFailed” changes from 0 to 1), when all storage conditions are fulfilled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The biggest extended data record must fit in the configured page buffer of the DCM. </p>
<p>See technical reference of the DCM for more details. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.4 </b></p>
<p><b>Indicator Window </b></p>
<p>AUTOSAR does not have any predefined Indicators and if your ECU doesn’t need them, </p>
<p>you needn’t define any. </p>
<p> </p>
<p>To define the first Indicator you can either press in the main configuration window the </p>
<p>button “Add Indicator” or use in the left side tree view the Right-Mouse-Button option “Add </p>
<p>New Indicator”. </p>
<p>After defining the first Indicator you can also use Right-Mouse-Button in the Indicator </p>
<p>window to add further Indicators: </p>
<p> </p>
<p> </p>
<p>Figure 8-15 </p>
<p>Indicator Window </p>
<p>Enter a symbolic name and assign an IndicatorID. </p>
<p> </p>
<p>The set “Symbolic Name” of this Indicator can be used to identify it in a more human </p>
<p>readable way. In the generated source there will be created a #define using this name. </p>
<p> </p>
<p><b>8.2.12.5 </b></p>
<p><b>Event Configuration Window </b></p>
<p>When  starting  with  a  new  configuration,  typically  there  exist  some  preset  events. These </p>
<p>are required by other AUTOSAR SW-C modules and are typically configured as “Internal </p>
<p>Event”:  They  have  no  DTC  number  assigned  thus  cannot  be  requested  externally  by </p>
<p>diagnostic services. They don’t store environmental data with them (as such could not be </p>
<p>read via diagnostics) but they have an event status that can be used by FIM. </p>
<p>Such  predefined  internal  events  have  greyed  out  the  “Symbolic  Name”;  they  cannot  be </p>
<p>removed from the configuration. </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>113 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Starting with Dem version 2.14.00, the interpretation of the “Symbolic Name” was </p>
<p>modified to act closer to the AUTOSAR requirements: </p>
<p>When creating #defines for EventID and IndicatorID, the Dem will now add prefix </p>
<p>Dem_</p>
<p> </p>
<p>to the configured Symbolic Names to avoid namespace clashes. See your release </p>
<p>notes for more details. </p>
<p>Example: the symbolic name for the event CAN_E_TIMEOUT will now result in file </p>
<p>Dem_IntErrId.h to a line like that: </p>
<p>#</p>
<p>define Dem_CAN_E_TIMEOUT       42</p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p>Figure 8-16 </p>
<p>Event Configuration Window </p>
<p>To  define  your  own  event,  use  one  of  the  3  choices:  press  in  the  main  configuration </p>
<p>window  the  button  “Add  Event”,  use  in  the  left  side  tree  view  the  Right-Mouse-Button </p>
<p>option </p>
<p>“Add </p>
<p>New </p>
<p>Event” </p>
<p>or </p>
<p>(as </p>
<p>seen </p>
<p>above) </p>
<p>use </p>
<p>Right-Mouse-Button </p>
<p>in </p>
<p>the </p>
<p>event </p>
<p>configuration window itself. </p>
<p>By selecting the created event in the left side tree-view, you can configure the event. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>114 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>For configuring an event, you need an operation cycle and indicator(s) if required. To </p>
<p>accelerate the configuration, please check that the necessary objects mentioned above </p>
<p>do exist before creating a new event. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The DEM requires at least one external event (assign a DTC Number to at least one </p>
<p>event). Otherwise the RTE will not generate the</p>
<p> typedef Dem_EventIdType</p>
<p> </p>
<p>and the compilation will not be possible. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>115 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p> </p>
<p>Figure 8-17 </p>
<p>Configurable Options of an Event  </p>
<p>All  event  specific  parameters  have  to  be  adapted  in  this  window.  Preconfigured  options </p>
<p>may not be changed. </p>
<p><i><b>Event Kind: </b></i></p>
<p>Define  the  origin  of  the  event  (i.e.  who  is  setting/modifying  the  event  data)  SWC  (SW-</p>
<p>Component) or BSW (Basic software). </p>
<p>Events  of  Kind  SWC  will  offer  a  Port  Interface  “Diagnostic  Monitor”  to  set  and  read  the </p>
<p>event data via RTE. Such events must be set via RTE/Dem_SetEventStatus only. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>116 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>Events of Kind BSW will be queued in the Dem and worked in Dem’s cyclic task to get a </p>
<p>defined </p>
<p>call </p>
<p>context </p>
<p>(for </p>
<p>notifications </p>
<p>and </p>
<p>callouts). </p>
<p>Such </p>
<p>events </p>
<p>must </p>
<p>be </p>
<p>set </p>
<p>via </p>
<p>Dem_ReportErrorStatus only. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Either modify an event only through a monitor on application level (i.e. above the RTE) </p>
<p>and select “Event Kind: SWC” here, or through a monitor on basic software level and </p>
<p>select “Event Kind: BSW” here. Prevent modification from both sides for an event – </p>
<p>else you may run into data corruption and undefined behavior resulting from infrequent </p>
<p>simultaneous access. </p>
<p>Do not select “Event Kind: SWC” for BSW events and do not manually add a </p>
<p>PortInterface (e.g. in DaVinci) for BSW events, for example to be able to use </p>
<p>GetEventStatus via RTE: you will sporadically get incomplete event status when </p>
<p>reading these events and you will sporadically corrupt DEM internal data when writing </p>
<p>such events which can trigger undefined behavior. See chapter <i>5.5 Call Context </i>for </p>
<p>some background info. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><i><b>Symbolic Name: </b></i></p>
<p>The names can only be changed with own added events. The names of pre-added events </p>
<p>cannot be changed. </p>
<p><i><b>Operation Cycle Ref: </b></i></p>
<p>An operation cycle has to be added to an event. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Only if the operation cycle is started, the status of the event can be changed. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Healing Allowed: </b></i></p>
<p>Use this configuration switch to choose, if it will be possible to heal this event or not. </p>
<p><i><b>Healing Cycle Ref: </b></i></p>
<p>The cycle used for healing can be set here. Usually the “Operation Cycle” is chosen. </p>
<p><i><b>Healing Cycle Counter: </b></i></p>
<p>If an event can be healed, the necessary count of healing cycles until the event is healed </p>
<p>can be adapted here. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The healing cycles are only counted, when the event is tested ‘passed’ during that </p>
<p>operation cycle. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Init Monitor Name: </b></i></p>
<p>This  function  will  be  called  to  inform  the  monitor  function  if  the  operation  cycle  for  this </p>
<p>event is (re-)started (DEM_INIT_MONITOR_RESTART) or if the event is cleared from the </p>
<p>event memory (DEM_INIT_MONITOR_CLEAR). </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>117 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>In </p>
<p>spite </p>
<p>of  AUTOSAR </p>
<p>configuration, </p>
<p>which </p>
<p>limits </p>
<p>the </p>
<p>name  of  the  port  interface  to </p>
<p>CBInitEvt_&lt;</p>
<p>EventName</p>
<p>&gt;, you can set the full name of the function here.  </p>
<p>When  you  are  importing  from  CDD,  the  default  name  will  be </p>
<p>CBInitEvt<i>_&lt;Symbolic </i></p>
<p><i>Name&gt;</i></p>
<p>. You may change the name after the import. </p>
<p><i><b>Event Priority: </b></i></p>
<p>The  priority  value  influences  the  displacement  strategy  if  the  storage  buffer  is  full.  The </p>
<p>event with the lowest priority will be discarded, when the new event has a higher priority. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Different DTCs with equal priority value are permitted. The priorities are limited to </p>
<p>range 0…255 as required by AUTOSAR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>Event Destination: </b></i></p>
<p>The  event  destination  is  currently  restricted  to  the  primary  memory,  because  the  other </p>
<p>memory locations are not supported. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>If an event has <b>no DTC number </b>assigned, it becomes an <b>INTERNAL EVENT </b>which </p>
<p>cannot be accessed via diagnostic services and which does not store environmental </p>
<p>data! This is the default for all BSW errors. </p>
<p>INTERNAL EVENTs do have an event status, which is used by the FIM. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>8.2.12.5.1 </b></p>
<p><b>DTC Settings </b></p>
<p><i><b>DTC: </b></i></p>
<p>This number is the external representation of the event. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>If an event has <b>no DTC number </b>assigned, it becomes an <b>INTERNAL EVENT </b>which </p>
<p>cannot be accessed via diagnostic services and which does not store environmental </p>
<p>data! This is the default for all BSW errors. </p>
<p>INTERNAL EVENTs do have an event status, which is used by FIM. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Each event can get just one DTC number. Event - DTC is a 1:1 correlation (or 1:0 for </p>
<p>internal events). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><i><b>DTC Group: </b></i></p>
<p>The DTC group will automatically be assigned to an event, based on the configured DTC </p>
<p>number and the available DTC groups. </p>
<p><i><b>DTC Severity: </b></i></p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>118 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>The severity can be selected here. </p>
<p><i><b>DTC Kind: </b></i></p>
<p>Until OBD is supported, the DTC kind is fixed to ‘NORMAL’ DTCs. </p>
<p><i><b>DTC Support Warning Indicator: </b></i></p>
<p>If this parameter is enabled Bit 7 ‘WarningIndicatorRequested’ of the DTC status will be set </p>
<p>when the DTC is failed (Bit 0 ‘TestFailed’ is set). </p>
<p><i><b>DTC Functional Unit: </b></i></p>
<p>This </p>
<p>parameter </p>
<p>is </p>
<p>necessary </p>
<p>for </p>
<p>the </p>
<p>report </p>
<p>of </p>
<p>severity </p>
<p>information. </p>
<p>It </p>
<p>identifies </p>
<p>the </p>
<p>corresponding basic vehicle / system function which reports the DTC. </p>
<p><b>8.2.12.5.2 </b></p>
<p><b>Event Pre-Debouncing </b></p>
<p><i><b>Pre Debounce Algorithm Class: </b></i></p>
<p>The  current  DEM  version  supports  the  ‘counter  based’  and  ‘timer  based’  de-bounce </p>
<p>algorithm.  </p>
<p><i><b>Count In Step Size (counter based):  </b></i></p>
<p>This value represents the step size by which the DTC fault detection counter is increased </p>
<p>for each ‘prefailed’ call. Reaching value +127 will make an event become ‘failed’. </p>
<p><i><b>Count Out Step Size (counter based):  </b></i></p>
<p>This value represents the step size by which the DTC fault detection counter is decreased </p>
<p>for each ‘prepassed’ call. Reaching value -128 will make an event become ‘passed’. </p>
<p><i><b>Failed Timeout Value (timer based):  </b></i></p>
<p>This value represents the time which has to elapse until an event which was reported with </p>
<p>‘prefailed’ become ‘failed’. </p>
<p><i><b>Passed Timeout Value (timer based):  </b></i></p>
<p>This value represents the time which has to elapse until an event which was reported with </p>
<p>‘prepassed’ become ‘passed’. </p>
<p><i><b>Jump Up (counter based): </b></i></p>
<p>If  the  direction  of  the  DTC  fault  detection  counting  will  change  from  decrementing  to </p>
<p>incrementing </p>
<p>and </p>
<p>the </p>
<p>value </p>
<p>is </p>
<p>below </p>
<p>zero, </p>
<p>a </p>
<p>jump </p>
<p>to </p>
<p>zero </p>
<p>will </p>
<p>be </p>
<p>made </p>
<p>before </p>
<p>incrementing. </p>
<p><i><b>Jump Down (counter based): </b></i></p>
<p>If  the  direction  of  the  DTC  fault  detection  counting  will  change  from  incrementing  to </p>
<p>decrementing </p>
<p>and </p>
<p>the </p>
<p>value </p>
<p>is </p>
<p>above </p>
<p>zero, </p>
<p>a </p>
<p>jump </p>
<p>to </p>
<p>zero </p>
<p>will </p>
<p>be </p>
<p>made </p>
<p>before </p>
<p>decrementing. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>AUTOSAR forbids using Jump-Down if Jump-Up was deactivated. Rationale in [1]: </p>
<p>“‘passed’ results could be faster obtained than ‘failed’ results. This is critical from legal </p>
<p>point of view.” </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.5.3 </b></p>
<p><b>Snapshot Records (FreezeFrames) </b></p>
<p><i><b>FF Prestorage Supported: </b></i></p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>119 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>If  this  parameter  is  enabled,  the  prestorage  of  snapshot  records  is  supported  by  the </p>
<p>assigned event. </p>
<p><i><b>Create New Snapshot Record: </b></i></p>
<p>To create a new snapshot record, click the button in the event configuration window (see </p>
<p>Figure 8-17) or use the right-mouse-button option in the tree window. </p>
<p> </p>
<p> </p>
<p>Figure 8-18 </p>
<p>Create New Snapshot Record </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>For defining a snapshot record, you need data objects. To accelerate the configuration, </p>
<p>please check that the necessary data objects do exist before creating a new snapshot </p>
<p>record. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>Each  snapshot  record  includes  a  list  of  data  objects.  You  can  use  one  data  object  in </p>
<p>several  snapshot  records  and  each  snapshot  record  may  have  any  number  of  data </p>
<p>objects. </p>
<p> </p>
<p>Figure 8-19 </p>
<p>Snapshot Record Window </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>All configured data objects of one event will be reported in one snapshot record. The </p>
<p>snapshot record number of each stored snapshot record will be incremented per event </p>
<p>(first confirmed snapshot record: 0x01, second confirmed snapshot record: 0x02,…). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The complete snapshot record must fit in the configured page buffer of the DCM. See </p>
<p>technical reference of the DCM for more details. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.12.5.4 </b></p>
<p><b>Extended Data Records </b></p>
<p>All  (external)  events  will  use  the  identical  set  of  Extended  Data  Records  imported  via </p>
<p>CANdelaStudio CDD file. To modify the set please refer chapter 8.2.12.3 <i>Extended Data </i></p>
<p><i>Records </i>or 8.1.3 <i>Extended Records </i>via CANdela. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>120 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>8.2.12.5.5 </b></p>
<p><b>Indicators </b></p>
<p><i><b>Linked Indicator: </b></i></p>
<p>If the event has status ‘failed’ (Bit 0 ‘TestFailed’ is set), this can be shown by one (or more) </p>
<p>indicator(s). Choose one of the indicators created before from the drop down box. </p>
<p><i><b>Indicator Behavior: </b></i></p>
<p>Select to the required behaviour ‘active’ or ‘blinking’ for each linked indicator. </p>
<p><b>8.2.12.5.6 </b></p>
<p><b>TriggerOnEvent Callback Functions </b></p>
<p>If the event status is changing one or multiple trigger functions can be called. The event </p>
<p>status reports all supported status bits. </p>
<p>The </p>
<p>suggestion </p>
<p>of </p>
<p>GENy </p>
<p>for </p>
<p>the </p>
<p>function </p>
<p>name </p>
<p>(Port </p>
<p>Prototype </p>
<p>Name) </p>
<p>is </p>
<p>CBStatusEvt_</p>
<p>&lt;EventSymbolicName&gt;</p>
<p>.  In  spite  of AUTOSAR  configuration,  which  limits </p>
<p>the name of the port interface to CBStatusEvt_</p>
<p>&lt;EventName&gt;</p>
<p>, you can set the full name of </p>
<p>the function here. </p>
<p><b>8.2.12.5.7 </b></p>
<p><b>TriggerOnDtc Callback Functions </b></p>
<p>If  the  DTC  status  is  changing  one  or  multiple  trigger  functions  can  be  called. The  DTC </p>
<p>status </p>
<p>reports </p>
<p>all </p>
<p>supported </p>
<p>status </p>
<p>bits </p>
<p>but </p>
<p>the </p>
<p>bits </p>
<p>disabled </p>
<p>by </p>
<p>the </p>
<p>DTCStatusAvailabilityMask (see 8.1.1). </p>
<p>The </p>
<p>suggestion </p>
<p>of </p>
<p>GENy </p>
<p>for </p>
<p>the </p>
<p>function </p>
<p>name </p>
<p>(Port </p>
<p>Prototype </p>
<p>Name) </p>
<p>is </p>
<p>CBStatusDTC_</p>
<p>&lt;EventSymbolicName&gt;</p>
<p>. In spite of AUTOSAR configuration, which limits </p>
<p>the name of the port interface to CBStatusDTC_</p>
<p>&lt;EventName&gt;</p>
<p>, you can set the full name </p>
<p>of the function here. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>The TriggerOnDtc callback functions can only be configured for events with a DTC </p>
<p>Number. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>8.2.13 </b></p>
<p><b>Software Component Template </b></p>
<p>When  the  RTE  is  part  of  the  configuration,  GENy  generates  during  each  generation </p>
<p>process  a  software  component  template.  The  name  of  the  software  component  can  be </p>
<p>specified  in  GENy  with  the  configuration  parameter  “Software  Component  Name”.  The </p>
<p>name of the XML file consists of the software components name with the postfix “_swc” </p>
<p>and  the  file  extension  “.arxml”  (&lt;SoftwareComponentName&gt;_swc.arxml).  The  default  is </p>
<p>“Dem_swc.arxml”. </p>
<p>The software component template contains the AUTOSAR service port description for the </p>
<p>ports  provided  by  DEM  and  can  be  used  by  the  RTE  to  provide  these  ports  to  the </p>
<p>application. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>121 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>9 </b></p>
<p><b>AUTOSAR Standard Compliance </b></p>
<p><b>9.1 </b></p>
<p><b>Deviations </b></p>
<p><b>9.1.1 </b></p>
<p><b>APIs and Features not Supported </b></p>
<p>See chapter 4.1. </p>
<p><b>9.1.2 </b></p>
<p><b>AUTOSAR Defined APIs that Differ in this Implementation </b></p>
<p><b>9.1.2.1 </b></p>
<p><b>Service Dem_ClearDTC </b></p>
<p>When </p>
<p>the </p>
<p>API </p>
<p>is </p>
<p>called </p>
<p>with </p>
<p>the </p>
<p>wrong </p>
<p>DTCKind, </p>
<p>the </p>
<p>return </p>
<p>value </p>
<p>is </p>
<p>DEM_CLEAR_WRONG_DTC. </p>
<p>See chapter 6.2.5.3.1 </p>
<p><b>9.1.2.2 </b></p>
<p><b>Service Dem_SetEventStatus </b></p>
<p>The  return  value  DEM_E_QUEUE_OVERFLOW  has  been  defined  additionally  to  the </p>
<p>return values described in [1]. </p>
<p>See chapter 6.2.3.1. </p>
<p><b>9.1.2.3 </b></p>
<p><b>Service Dem_ResetEventStatus </b></p>
<p>The  return  value  DEM_E_QUEUE_OVERFLOW  has  been  defined  additionally  to  the </p>
<p>return values described in [1]. </p>
<p>See chapter 6.2.3.2. </p>
<p><b>9.1.2.4 </b></p>
<p><b>Service Dem_SetOperationCycleState </b></p>
<p>The  return  value  DEM_E_QUEUE_OVERFLOW  has  been  defined  additionally  to  the </p>
<p>return values described in [1]. </p>
<p>See chapter 6.2.3.5. </p>
<p><b>9.1.2.5 </b></p>
<p><b>Service Dem_ReportErrorStatus </b></p>
<p>The development error value DEM_E_QUEUE_OVERFLOW has been defined additionally </p>
<p>to the development error values described in [1]. </p>
<p>See chapter 6.2.4.1. </p>
<p><b>9.1.2.6 </b></p>
<p><b>Interface Rte_Call_Dem_&lt;ConfiguredName&gt;_DTCStatusChanged </b></p>
<p>The parameter DTCKind has been defined additionally to the parameters described in [1]. </p>
<p>See chapter 6.5.1.3. </p>
<p><b>9.1.3 </b></p>
<p><b>Require Ports not Supported </b></p>
<p>CallbackInitMonitorForFunction and CallbackGetFaultDetectCounter – see chapter 6.6.1.2. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>122 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>9.2 </b></p>
<p><b>Additions/ Extensions </b></p>
<p><b>9.2.1 </b></p>
<p><b>Development Error Reporting – Include Structure </b></p>
<p>The include structure described by AUTOSAR is extended, when the development error </p>
<p>reporting is activated. </p>
<p>See chapter 4.6.1. </p>
<p><b>9.2.2 </b></p>
<p><b>Development Error Reporting – Internal Debug Codes </b></p>
<p>The following error codes are reported additionally to the errors defined in [1]: </p>
<p>Internal debug codes – see chapter 4.6.1. </p>
<p><b>9.2.3 </b></p>
<p><b>Service Dem_GetOccurrenceCounter </b></p>
<p>The API </p>
<p>Dem_GetOccurrenceCounter()</p>
<p> is an extension to AUTOSAR. It can be used </p>
<p>to request the current occurrence counter for a given event. </p>
<p>See chapter 6.2.3.146.2.3.14. </p>
<p><b>9.2.4 </b></p>
<p><b>Name Description of Configurable Interfaces (Notifications) </b></p>
<p>AUTOSAR  requires  specific  names  for  the  notifications.  In  GENy  these  names  are </p>
<p>suggested, but can fully be set by the user. </p>
<p>See chapter 8.2.12. </p>
<p><b>9.2.5 </b></p>
<p><b>Interface Rte_Call_Dem_&lt;ConfiguredName&gt;_GetDataValueByDataIdentifier </b></p>
<p>It is possible to use DCM compatible port interfaces. This is an extension to AUTOSAR. </p>
<p>See chapter 8.2.6. </p>
<p><b>9.2.6 </b></p>
<p><b>Port Names Length Limitation </b></p>
<p>AUTOSAR limits the length of port names to 31 characters. In contrast naming </p>
<p>conventions require port names longer than 31 characters. </p>
<p>See Bugzilla 16927. </p>
<p><b>9.2.7 </b></p>
<p><b>Version Information </b></p>
<p>The return parameters for the </p>
<p>Dem_GetVersionInfo()</p>
<p> API are defined unequally. The </p>
<p>implemented version is described in chapter 6.2.1. </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>123 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>9.3 </b></p>
<p><b>Limitations </b></p>
<p><b>9.3.1 </b></p>
<p><b>Limits Checked During Configuration </b></p>
<p>See not supported features in chapter 4.1: </p>
<p>- </p>
<p>event combination is not supported </p>
<p>- </p>
<p>the mapping of events to DTCs is “1 to 1” or “1 to 0” and not “n to 1” or “1 to n” </p>
<p>- </p>
<p>until  OBD  is  supported,  the  DTC  kind  is  fixed  to  ‘NORMAL’  DTCs  (see  chapter </p>
<p>8.2.12.5.1) </p>
<p>- </p>
<p>the </p>
<p>event </p>
<p>destinations </p>
<p>are </p>
<p>currently </p>
<p>restricted </p>
<p>to </p>
<p>‘PRIMARY_MEMORY’ </p>
<p>or </p>
<p>‘INTERNAL’, because the other memory locations are not supported (see chapter </p>
<p>8.2.12.5) </p>
<p>- </p>
<p>the  pre-debounce  algorithm  is  fixed  to  ‘Counter  based’  for  all  DTCs  (see  chapter </p>
<p>8.2.12.5.2) </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>124 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>10  Glossary and Abbreviations </b></p>
<p><b>10.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p>Callback Function </p>
<p>Callback functions are implemented by the Dem and can be invoked by </p>
<p>other modules. </p>
<p>Callout Function </p>
<p>At its configurable interfaces the DEM defines callout functions to ask for </p>
<p>data values. The declarations of the callout functions are provided by the </p>
<p>BSW module. It is the integrator's task to provide the corresponding </p>
<p>function definitions. </p>
<p>Notification </p>
<p>At its configurable interfaces the Dem defines notifications that can be </p>
<p>mapped to callback functions provided by other modules. The mapping is </p>
<p>not statically defined by the Dem but can be performed at configuration </p>
<p>time. </p>
<p> </p>
<p> </p>
<p>Event Kind “BSW” </p>
<p>A basic software component will set the event via API call </p>
<p>Dem_ReportErrorStatus. To achieve data consistency, the Dem will </p>
<p>queue such triggers and work them in its cyclic task. Never try to set such </p>
<p>DTCs via API Dem_SetEventStatus – you may get undefined behavior. </p>
<p>Do not manually add a Port Interface “Diagnostic Monitor” to such events.</p>
<p>Event Kind “SWC” </p>
<p>A software component will set the event via RTE (and therefore API </p>
<p>Dem_SetEventStatus). GENy will generate a Port Interface “Diagnostic </p>
<p>Monitor” (see chapter 6.6.1.1.1) for events having Event Kind “SWC” to </p>
<p>implement that use case, and to allow the read access to the event’s </p>
<p>status. </p>
<p>External Event </p>
<p>External events have a DTC Number assigned, so they can be read via </p>
<p>diagnostic request. Therefore each external event must have configured </p>
<p>the mandatory Extended Data Records. </p>
<p>The data records are stored in the Primary Memory for the ChronoStack </p>
<p>(and in Mirror/Secondary Memory for the Historical Stack). </p>
<p>Internal Event </p>
<p>Internal events do not have a DTC Number assigned, so they can not be </p>
<p>read via diagnostic request and thus are invisible for an external tester. </p>
<p>The Dem offers no API resp. Port Interface to read Extended Data </p>
<p>Records for other software inside the ECU, so internal events do not </p>
<p>need to store such data. </p>
<p>Therefore internal will only store the DTC status but no other data. </p>
<p> </p>
<p> </p>
<p>CANdelaStudio </p>
<p>Tool to compile, edit and display diagnostic data descriptions for control </p>
<p>units in the automotive area. </p>
<p>GENy </p>
<p>Generation tool for CANbedded and MICROSAR components. </p>
<p>Table 10-1  </p>
<p>Glossary </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>125 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p><b>10.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p>API </p>
<p>Application Programming Interface </p>
<p> </p>
<p>AUTOSAR </p>
<p>Automotive Open System Architecture </p>
<p>BSW </p>
<p>Basic Software </p>
<p>CDD </p>
<p>CANdela Diagnostic Data </p>
<p>DCM </p>
<p>Diagnostic Communication Manager </p>
<p>DEM </p>
<p>Diagnostic Event Manager </p>
<p>DET </p>
<p>Development Error Tracer </p>
<p>DID </p>
<p>Data Identifier </p>
<p>DTC </p>
<p>Diagnostic Trouble Code </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>ECU-SM </p>
<p>ECU State Manager </p>
<p>FIM </p>
<p>Function Inhibition Manager </p>
<p>HIS </p>
<p>Hersteller Initiative Software </p>
<p>IUMPR </p>
<p>In Use Monitoring Performance Ratio </p>
<p>MICROSAR </p>
<p>Microcontroller Open System Architecture (the Vector AUTOSAR </p>
<p>solution) </p>
<p>NvRAM </p>
<p>Non-volatile RAM </p>
<p>OBD </p>
<p>Onboard Diagnostics </p>
<p>OS </p>
<p>Operating System </p>
<p>RTE </p>
<p>Runtime Environment </p>
<p>SWC </p>
<p>Software Component </p>
<p>SWS </p>
<p>Software Specification </p>
<p>Table 10-2  </p>
<p>Abbreviations </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>126 / 127</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (DEM)  </p>
<p> </p>
<p>©</p>
<p>2010, Vector Informatik GmbH </p>
<p>Version: 2.2.0 </p>
<p>based on template version 3.2 </p>
<p>127 / 127</p>
<p><b>11  Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p>&gt;   News </p>
<p>&gt;   Products </p>
<p>&gt;   Demo software </p>
<p>&gt;   Support </p>
<p>&gt;   Training data </p>
<p>&gt;   Addresses </p>
<p> </p>
<p><b>www.vector.com </b></p>
</body>
</html>
{% endraw %}