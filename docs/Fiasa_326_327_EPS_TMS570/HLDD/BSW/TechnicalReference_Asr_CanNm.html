---
layout: default
title: TechnicalReference_Asr_CanNm
nav_order: 5
parent: Fiasa_326_327_EPS_TMS570
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR CAN Network Management </b></p>
<p>Technical Reference </p>
<p> </p>
<p>CAN NM </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Markus Drescher </p>
<p>Version </p>
<p>4.18.00 </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>2 / 99 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>Oliver Hornung </p>
<p>2007-12-10 </p>
<p>4.0.0 </p>
<p>ESCAN00023633: Update Documentation </p>
<p>for AUTOSAR Release 3 </p>
<p>Oliver Hornung </p>
<p>2008-02-01 </p>
<p>4.1.0 </p>
<p>Added Coordination Extension; Updated </p>
<p>configuration. </p>
<p>Oliver Hornung </p>
<p>2008-03-11 </p>
<p>4.2.0 </p>
<p>ESCAN00025282: Configuration changes </p>
<p>Oliver Hornung </p>
<p>2008-04-02 </p>
<p>4.2.1 </p>
<p>Corrected Coordination Extension </p>
<p>Oliver Hornung </p>
<p>2008-04-21 </p>
<p>4.3.0 </p>
<p>ESCAN00025499: Renamed Technical </p>
<p>Reference </p>
<p>Oliver Hornung </p>
<p>2008-05-02 </p>
<p>4.3.1 </p>
<p>Corrected Memory Mapping </p>
<p>Oliver Hornung </p>
<p>2008-11-28 </p>
<p>4.4.0 </p>
<p>ESCAN00031692: Adapted Configuration </p>
<p>and API </p>
<p>Oliver Hornung </p>
<p>2009-03-31 </p>
<p>4.5.0 </p>
<p>ESCAN00034277: Re-structured document; </p>
<p>added chapter with service functions that </p>
<p>are used by CAN NM. </p>
<p>Oliver Hornung </p>
<p>2009-07-31 </p>
<p>4.06.00 </p>
<p>ESCAN00036641: Documented changed </p>
<p>behavior when requesting and releasing bus </p>
<p>communication in state Bus Sleep. </p>
<p>ESCAN00036642: Documented Multiple </p>
<p>ECU Support </p>
<p>Oliver Hornung </p>
<p>2009-09-17 </p>
<p>4.06.01 </p>
<p>ESCAN00037225: Added hint for message </p>
<p>length configuration </p>
<p>Oliver Hornung </p>
<p>2009-11-27 </p>
<p>4.07.00 </p>
<p>ESCAN00037848: Added feature description </p>
<p>‘NM user data via Com’ </p>
<p>Clarified restart behavior (ESCAN00037081) </p>
<p>Added note for message layout </p>
<p>configuration (ESCAN00039378) </p>
<p>Oliver Hornung </p>
<p>2010-03-03 </p>
<p>4.07.01 </p>
<p>ESCAN00041215: Corrected GENy module </p>
<p>name; adapted database attribute </p>
<p>description for “NmType” </p>
<p>Oliver Hornung </p>
<p>2010-03-30 </p>
<p>4.08.00 </p>
<p>ESCAN00041850: Added QNX Support </p>
<p>Oliver Hornung </p>
<p>2010-04-30 </p>
<p>4.09.00 </p>
<p>ESCAN00042564: Added Extended Bus </p>
<p>Synchronization </p>
<p>Oliver Hornung </p>
<p>2010-06-23 </p>
<p>4.10.00 </p>
<p>ESCAN00043403: Added ‘Check Limp </p>
<p>Home’ API description </p>
<p>Oliver Hornung </p>
<p>2010-07-21 </p>
<p>4.11.00 </p>
<p>ESCAN00043887: Added ‘Gateway </p>
<p>Extension Support’ description </p>
<p>Daniel Hof </p>
<p>2010-08-11 </p>
<p>4.12.00 </p>
<p>Added descriptions for: </p>
<p>ESCAN00043787: Active Wake-up Bit </p>
<p>ESCAN00043772: Car Wake-up </p>
<p>ESCAN00043794: Partial Networking </p>
<p>ESCAN00043785: Fast Wake-up </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>3 / 99 </p>
<p>Oliver Hornung </p>
<p>2011-02-10 </p>
<p>4.13.00 </p>
<p>ESCAN00045764: Adapted DET and DEM </p>
<p>error description </p>
<p>ESCAN00045879 Reworked Partial </p>
<p>Networking description </p>
<p>ESCAN00046097: Added description for </p>
<p>usage of PduInfoType </p>
<p>ESCAN00046915 Adapted description for </p>
<p>Fast Wake-up (Immediate Nm </p>
<p>Transmissions) </p>
<p>ESCAN00047362 Added descriptions of </p>
<p>critical section codes </p>
<p>ESCAN00047497 Added description for </p>
<p>usage in multiple configuration setups </p>
<p>Markus Drescher </p>
<p>2011-05-26 </p>
<p>4.13.01 </p>
<p>ESCAN00051145: Added description for </p>
<p>‘Dem2Det Enabled’ switch and updated </p>
<p>Error Handling </p>
<p>Markus Drescher </p>
<p>2011-07-04 </p>
<p>4.13.02 </p>
<p>ESCAN00051912: Adapted description for </p>
<p>state transitions from Prepare Bus Sleep to </p>
<p>Network Mode, adapted </p>
<p>CanNm_PassiveStartUp API description </p>
<p>ESCAN00051972: Updated Include </p>
<p>Structure figure </p>
<p>Markus Drescher </p>
<p>2011-06-30 </p>
<p>4.14.00 </p>
<p>ESCAN00048297: Added description for </p>
<p>Callbacks for Partial Networking </p>
<p>ESCAN00051150: Adapted description of </p>
<p>‘Usage of PduInfoType’ </p>
<p>Markus Drescher </p>
<p>2012-01-12 </p>
<p>4.15.00 </p>
<p>ESCAN00053603: Removed VStdLib and </p>
<p>DrvCan critical section handling </p>
<p>ESCAN00054369: Adapted description of </p>
<p>‘Msg Timeout Time’ </p>
<p>ESCAN00054839: Added description for </p>
<p>Support for RX PDUs with different lengths </p>
<p>Markus Drescher </p>
<p>2012-06-20 </p>
<p>4.16.00 </p>
<p>ESCAN00059530: Adapted API descriptions </p>
<p>for availability of the functions in chapters </p>
<p>5.5.2.5, 5.5.2.7.1, 5.5.2.8.1, 5.5.2.9.1; </p>
<p>adapted chapter 5.6 </p>
<p>Markus Drescher </p>
<p>2012-09-06 </p>
<p>4.17.00 </p>
<p>ESCAN00059456: Updated version of </p>
<p>reference document [3] </p>
<p>ESCAN00059750: Added descriptions of the </p>
<p>values written by CanNm_GetState (chapter </p>
<p>5.5.2.2) </p>
<p>ESCAN00059987: Added caution box to </p>
<p>chapter 3.23 about the ‘Com User Data </p>
<p>Enabled’ configuration setting </p>
<p>ESCAN00060186: Reworked chapter 3.5.5 </p>
<p>ESCAN00060200: Updated chapters 3.13 </p>
<p>and 6.3.2, created chapter 6.3.2.1. </p>
<p>ESCAN00061255: Fixed name of </p>
<p>CanNm_TxConfirmation (chapter 5.7.1.2) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>4 / 99 </p>
<p>Markus Drescher </p>
<p>2013-05-08 </p>
<p>4.18.00 </p>
<p>ESCAN00061017: Adapted chapter 6.3.1 </p>
<p>ESCAN00061692: Adapted Multiple ECU </p>
<p>Use Case descriptions for NM User Data via  </p>
<p>Com (chapters 3.13, 3.15.1) </p>
<p>ESCAN00065299: Improved send behavior </p>
<p>descriptions in chapter 3.5.3 and Immediate </p>
<p>Nm Transmission feature descriptions in </p>
<p>chapter 3.20 and 3.21 </p>
<p>ESCAN00065569: Adapted chapter 3.23.5 </p>
<p>and 6.3.2 </p>
<p>ESCAN00065570: Extended chapter 3.15 </p>
<p>ESCAN00065637: Adapted chapter 5.5.1.1 </p>
<p>ESCAN00067267: Added chapter </p>
<p>‘Component History’, adapted chapters 2 </p>
<p>and 3, merged chapter 7 with chapter 3, </p>
<p>swapped chapters 5 and 6, removed </p>
<p>‘Compiler Abstraction and Memory Mapping’ </p>
<p>from chapter 4, various improvements </p>
<p>ESCAN00067268: Replaced </p>
<p>Nm_PrepareBusSleep by </p>
<p>Nm_PrepareBusSleepMode </p>
<p>Table 1-1  </p>
<p>History of the Document </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1] </p>
<p>AUTOSAR </p>
<p>SRS AUTOSAR Network Management </p>
<p>2.1.0 </p>
<p>[2] </p>
<p>AUTOSAR </p>
<p>SWS NM Interface </p>
<p>1.2.0 </p>
<p>[3] </p>
<p>AUTOSAR </p>
<p>SWS CAN NM </p>
<p>3.4.0 </p>
<p>[4] </p>
<p>AUTOSAR </p>
<p>SWS Development Error Tracer </p>
<p>2.2.2 </p>
<p>[5] </p>
<p>AUTOSAR </p>
<p>SWS Diagnostic Event Manager </p>
<p>3.2.0 </p>
<p>[6] </p>
<p>AUTOSAR </p>
<p>SWS CAN Interface </p>
<p>3.3.0 </p>
<p>[7] </p>
<p>AUTOSAR </p>
<p>SWS BSW Scheduler </p>
<p>1.2.0 </p>
<p>[8] </p>
<p>Vector </p>
<p>AN-AND-1-108 Glossary of CAN Protocol Terminology </p>
<p>http://www.vector-informatik.de </p>
<p>1.0.0 </p>
<p>[9] </p>
<p>Vector </p>
<p>Technical Reference Identity Manager </p>
<p>≥ 1.1.5 </p>
<p>[10] </p>
<p>Vector </p>
<p>Technical Reference MICROSAR PDU Router </p>
<p>≥ 3.12.02 </p>
<p>[11] </p>
<p>Vector </p>
<p>AN-ISC-8-1118 MICROSAR BSW Compatibility Check </p>
<p>1.0.0 </p>
<p>[12] </p>
<p>AUTOSAR </p>
<p>AUTOSAR_BasicSoftwareModules.pdf </p>
<p>1.5.0 </p>
<p>Table 1-2  </p>
<p>Reference Documents </p>
<p> </p>
<p> </p>
<p><b>Please note </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>5 / 99 </p>
<p>specified in your questionnaire, Vector’s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>6 / 99 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Component History ...................................................................................................... 12</b></p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Introduction .................................................................................................................. 13</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Naming Conventions .............................................................................................. 13</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Architecture Overview ............................................................................................ 13</p>
<p> </p>
<p>2.2.1</p>
<p> </p>
<p>Architecture of AUTOSAR Software .............................................................. 13</p>
<p> </p>
<p>2.2.2</p>
<p> </p>
<p>Architecture of AUTOSAR Network Management .......................................... 14</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Functional Description ................................................................................................ 16</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Overview of the Functional Scope .......................................................................... 16</p>
<p> </p>
<p>3.1.1</p>
<p> </p>
<p>Deviations Against AUTOSAR 3.2.2 .............................................................. 16</p>
<p> </p>
<p>3.1.1.1</p>
<p> </p>
<p>Initialization ............................................................................................ 16</p>
<p> </p>
<p>3.1.1.2</p>
<p> </p>
<p>PDU ID Used as Argument for CanNm_TxConfirmation ......................... 17</p>
<p> </p>
<p>3.1.1.3</p>
<p> </p>
<p>Dependencies between Configuration Parameters ................................. 17</p>
<p> </p>
<p>3.1.1.4</p>
<p> </p>
<p>Coordinator Synchronization Support ..................................................... 17</p>
<p> </p>
<p>3.1.1.5</p>
<p> </p>
<p>NM User Data via Com ........................................................................... 17</p>
<p> </p>
<p>3.1.1.6</p>
<p> </p>
<p>Active Wake-up Bit Support .................................................................... 17</p>
<p> </p>
<p>3.1.1.7</p>
<p> </p>
<p>Redundant BSWMD Parameters ............................................................ 17</p>
<p> </p>
<p>3.1.1.8</p>
<p> </p>
<p>Unsupported Features ............................................................................ 18</p>
<p> </p>
<p>3.1.2</p>
<p> </p>
<p>Additions/ Extensions .................................................................................... 18</p>
<p> </p>
<p>3.1.2.1</p>
<p> </p>
<p>Link-Time Support for Channels ............................................................. 18</p>
<p> </p>
<p>3.1.2.2</p>
<p> </p>
<p>Single Channel Optimization .................................................................. 18</p>
<p> </p>
<p>3.1.2.3</p>
<p> </p>
<p>Memory Initialization ............................................................................... 18</p>
<p> </p>
<p>3.1.2.4</p>
<p> </p>
<p>Error Reporting to Diagnostic Event Manager ........................................ 18</p>
<p> </p>
<p>3.1.2.5</p>
<p> </p>
<p>Disable Transmission Error Reporting .................................................... 18</p>
<p> </p>
<p>3.1.2.6</p>
<p> </p>
<p>Limp Home Indication ............................................................................. 19</p>
<p> </p>
<p>3.1.2.7</p>
<p> </p>
<p>Extended Remote Sleep Indication ......................................................... 19</p>
<p> </p>
<p>3.1.2.8</p>
<p> </p>
<p>Multiple ECU Support ............................................................................. 19</p>
<p> </p>
<p>3.1.2.9</p>
<p> </p>
<p>QNX Support .......................................................................................... 19</p>
<p> </p>
<p>3.1.2.10</p>
<p> </p>
<p>Extended Bus Synchronization ............................................................... 19</p>
<p> </p>
<p>3.1.2.11</p>
<p> </p>
<p>Gateway Extension Support ................................................................... 19</p>
<p> </p>
<p>3.1.2.12</p>
<p> </p>
<p>Dem2Det Enabled .................................................................................. 19</p>
<p> </p>
<p>3.1.2.13</p>
<p> </p>
<p>Message Reception with Different PDU Lengths .................................... 19</p>
<p> </p>
<p>3.1.2.14</p>
<p> </p>
<p>Deactivation of Partial Networking during Run-Time ............................... 19</p>
<p> </p>
<p>3.1.2.15</p>
<p> </p>
<p>Features Provided Beyond the AUTOSAR Standard .............................. 20</p>
<p> </p>
<p>3.1.3</p>
<p> </p>
<p>Limitations ..................................................................................................... 20</p>
<p> </p>
<p>3.1.3.1</p>
<p> </p>
<p>Ranges of Timers ................................................................................... 20</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Network Management Mechanism ......................................................................... 21</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>Passive Mode ......................................................................................................... 22</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>7 / 99 </p>
<p>3.4</p>
<p> </p>
<p>Operation Modes and States .................................................................................. 22</p>
<p> </p>
<p>3.4.1</p>
<p> </p>
<p>Network Mode ............................................................................................... 23</p>
<p> </p>
<p>3.4.1.1</p>
<p> </p>
<p>Repeat Message State ........................................................................... 24</p>
<p> </p>
<p>3.4.1.2</p>
<p> </p>
<p>Normal Operation State .......................................................................... 24</p>
<p> </p>
<p>3.4.1.3</p>
<p> </p>
<p>Ready Sleep State ................................................................................. 24</p>
<p> </p>
<p>3.4.2</p>
<p> </p>
<p>Prepare Bus-Sleep Mode .............................................................................. 24</p>
<p> </p>
<p>3.4.3</p>
<p> </p>
<p>Bus-Sleep Mode ............................................................................................ 25</p>
<p> </p>
<p>3.4.4</p>
<p> </p>
<p>Wake-up Registration .................................................................................... 25</p>
<p> </p>
<p>3.4.5</p>
<p> </p>
<p>User Data Handling ....................................................................................... 26</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Network Management Message Transmission and Reception ............................... 26</p>
<p> </p>
<p>3.5.1</p>
<p> </p>
<p>AUTOSAR CAN Interface.............................................................................. 26</p>
<p> </p>
<p>3.5.2</p>
<p> </p>
<p>PDU Message Layout ................................................................................... 26</p>
<p> </p>
<p>3.5.3</p>
<p> </p>
<p>Message Transmissions ................................................................................ 27</p>
<p> </p>
<p>3.5.4</p>
<p> </p>
<p>Bus Load Reduction ...................................................................................... 28</p>
<p> </p>
<p>3.5.5</p>
<p> </p>
<p>Support for RX PDUs with Different Lengths ................................................. 28</p>
<p> </p>
<p>3.6</p>
<p> </p>
<p>Node Detection ...................................................................................................... 29</p>
<p> </p>
<p>3.7</p>
<p> </p>
<p>NM PDU Receive Indication ................................................................................... 29</p>
<p> </p>
<p>3.8</p>
<p> </p>
<p>Communication Control .......................................................................................... 29</p>
<p> </p>
<p>3.9</p>
<p> </p>
<p>Gateway Functionality ............................................................................................ 30</p>
<p> </p>
<p>3.9.1</p>
<p> </p>
<p>Remote Sleep Indication and Cancellation .................................................... 30</p>
<p> </p>
<p>3.9.2</p>
<p> </p>
<p>Extended Remote Sleep Indication and Cancellation .................................... 30</p>
<p> </p>
<p>3.9.3</p>
<p> </p>
<p>Bus Synchronization ..................................................................................... 30</p>
<p> </p>
<p>3.10</p>
<p> </p>
<p>Limp Home Indication and Cancellation ................................................................. 30</p>
<p> </p>
<p>3.11</p>
<p> </p>
<p>Coordinator Synchronization Support ..................................................................... 31</p>
<p> </p>
<p>3.12</p>
<p> </p>
<p>Error Handling ........................................................................................................ 32</p>
<p> </p>
<p>3.12.1</p>
<p> </p>
<p>Development Error Detection ........................................................................ 32</p>
<p> </p>
<p>3.12.1.1</p>
<p> </p>
<p>Det_ReportError ..................................................................................... 32</p>
<p> </p>
<p>3.12.1.2</p>
<p> </p>
<p>Error Codes ............................................................................................ 32</p>
<p> </p>
<p>3.12.2</p>
<p> </p>
<p>Diagnostic Event Manager ............................................................................ 32</p>
<p> </p>
<p>3.12.2.1</p>
<p> </p>
<p>Dem_ReportErrorStatus ......................................................................... 33</p>
<p> </p>
<p>3.12.2.2</p>
<p> </p>
<p>Error Codes ............................................................................................ 33</p>
<p> </p>
<p>3.13</p>
<p> </p>
<p>Multiple ECU Support ............................................................................................. 33</p>
<p> </p>
<p>3.14</p>
<p> </p>
<p>Multiple Configuration Support ............................................................................... 34</p>
<p> </p>
<p>3.15</p>
<p> </p>
<p>NM User Data via Com .......................................................................................... 34</p>
<p> </p>
<p>3.15.1</p>
<p> </p>
<p>Configuration Preconditions in an AUTOSAR ECU Configuration .................. 35</p>
<p> </p>
<p>3.15.1.1</p>
<p> </p>
<p>Caveats for Multiple ECU Support .......................................................... 37</p>
<p> </p>
<p>3.15.2</p>
<p> </p>
<p>Configuration Preconditions in a DBC Based Configuration .......................... 37</p>
<p> </p>
<p>3.16</p>
<p> </p>
<p>QNX Support .......................................................................................................... 37</p>
<p> </p>
<p>3.17</p>
<p> </p>
<p>Extended Bus Synchronization ............................................................................... 38</p>
<p> </p>
<p>3.18</p>
<p> </p>
<p>Gateway Extension Support ................................................................................... 38</p>
<p> </p>
<p>3.19</p>
<p> </p>
<p>Active Wake-up Handling ....................................................................................... 39</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>8 / 99 </p>
<p>3.20</p>
<p> </p>
<p>Immediate Nm Transmissions ................................................................................ 39</p>
<p> </p>
<p>3.21</p>
<p> </p>
<p>Immediate Restart Enabled .................................................................................... 40</p>
<p> </p>
<p>3.22</p>
<p> </p>
<p>Car Wake-up .......................................................................................................... 41</p>
<p> </p>
<p>3.22.1</p>
<p> </p>
<p>Rx-Path ......................................................................................................... 41</p>
<p> </p>
<p>3.22.2</p>
<p> </p>
<p>Tx-Path ......................................................................................................... 41</p>
<p> </p>
<p>3.23</p>
<p> </p>
<p>Partial Networking .................................................................................................. 42</p>
<p> </p>
<p>3.23.1</p>
<p> </p>
<p>Availability of Partial Network Request Information ....................................... 42</p>
<p> </p>
<p>3.23.2</p>
<p> </p>
<p>Transmission of the CRI Bit in the NM User Data .......................................... 42</p>
<p> </p>
<p>3.23.3</p>
<p> </p>
<p>Filter Algorithm for Received NM Messages .................................................. 42</p>
<p> </p>
<p>3.23.4</p>
<p> </p>
<p>Aggregation of Requested Partial Networks .................................................. 43</p>
<p> </p>
<p>3.23.5</p>
<p> </p>
<p>Spontaneous Sending of NM Messages........................................................ 43</p>
<p> </p>
<p>3.23.5.1</p>
<p> </p>
<p>Using Com Transmission on Change Mechanism .................................. 44</p>
<p> </p>
<p>3.23.5.2</p>
<p> </p>
<p>Using NM Request and Immediate Nm Transmission ............................. 44</p>
<p> </p>
<p>3.23.6</p>
<p> </p>
<p>Deactivation of Partial Networking during Run-Time ...................................... 44</p>
<p> </p>
<p>3.24</p>
<p> </p>
<p>Usage of PduInfoType ............................................................................................ 44</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Integration .................................................................................................................... 45</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Files ....................................................................................................................... 45</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Include Structure .................................................................................................... 46</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Version Changes .................................................................................................... 46</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Initialization ............................................................................................................ 46</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>Main Functions ....................................................................................................... 47</p>
<p> </p>
<p>4.6</p>
<p> </p>
<p>Critical Sections ..................................................................................................... 48</p>
<p> </p>
<p>4.7</p>
<p> </p>
<p>Critical Section Codes ............................................................................................ 48</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>API Description ............................................................................................................ 50</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>API Categories ....................................................................................................... 50</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Data Types ............................................................................................................. 50</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Global Variables ..................................................................................................... 50</p>
<p> </p>
<p>5.4</p>
<p> </p>
<p>Global Constants .................................................................................................... 50</p>
<p> </p>
<p>5.4.1</p>
<p> </p>
<p>AUTOSAR Specification Version ................................................................... 50</p>
<p> </p>
<p>5.4.2</p>
<p> </p>
<p>Component Versions ..................................................................................... 51</p>
<p> </p>
<p>5.4.3</p>
<p> </p>
<p>Vendor and Module ID ................................................................................... 51</p>
<p> </p>
<p>5.5</p>
<p> </p>
<p>Services Provided by CAN NM ............................................................................... 52</p>
<p> </p>
<p>5.5.1</p>
<p> </p>
<p>Administrative Functions ............................................................................... 52</p>
<p> </p>
<p>5.5.1.1</p>
<p> </p>
<p>CanNm_Init: Initialization of CAN NM ..................................................... 52</p>
<p> </p>
<p>5.5.1.2</p>
<p> </p>
<p>CanNm_MainFunction: Channel Specific Main Functions of CAN NM .... 53</p>
<p> </p>
<p>5.5.2</p>
<p> </p>
<p>Service Functions of CAN NM ....................................................................... 54</p>
<p> </p>
<p>5.5.2.1</p>
<p> </p>
<p>CanNm_GetVersionInfo: Version Information API ................................... 54</p>
<p> </p>
<p>5.5.2.2</p>
<p> </p>
<p>CanNm_GetState: Get the State of the Network Management ............... 55</p>
<p> </p>
<p>5.5.2.3</p>
<p> </p>
<p>CanNm_PassiveStartUp: Wake up Network Management ..................... 56</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>9 / 99 </p>
<p>5.5.2.4</p>
<p> </p>
<p>Wake-up Registration ............................................................................. 57</p>
<p> </p>
<p>5.5.2.4.1</p>
<p> </p>
<p>CanNm_NetworkRequest: Request the Network ............................. 57</p>
<p> </p>
<p>5.5.2.4.2</p>
<p> </p>
<p>CanNm_NetworkRelease: Release the Network .............................. 58</p>
<p> </p>
<p>5.5.2.5</p>
<p> </p>
<p>Communication Control Service ............................................................. 59</p>
<p> </p>
<p>5.5.2.5.1</p>
<p> </p>
<p>CanNm_DisableCommunication: Disable NM Message </p>
<p>Transmission ................................................................................... 59</p>
<p> </p>
<p>5.5.2.5.2</p>
<p> </p>
<p>CanNm_EnableCommunication: Enable NM Message </p>
<p>Transmission ................................................................................... 60</p>
<p> </p>
<p>5.5.2.6</p>
<p> </p>
<p>User Data Handling ................................................................................ 61</p>
<p> </p>
<p>5.5.2.6.1</p>
<p> </p>
<p>CanNm_SetUserData: Set User Data .............................................. 61</p>
<p> </p>
<p>5.5.2.6.2</p>
<p> </p>
<p>CanNm_GetUserData: Get User Data ............................................. 62</p>
<p> </p>
<p>5.5.2.6.3</p>
<p> </p>
<p>CanNm_GetPduData: Get NM Pdu Data ......................................... 63</p>
<p> </p>
<p>5.5.2.7</p>
<p> </p>
<p>Node Detection....................................................................................... 64</p>
<p> </p>
<p>5.5.2.7.1</p>
<p> </p>
<p>CanNm_RepeatMessageRequest: Set Repeat Message </p>
<p>Request Bit ...................................................................................... 64</p>
<p> </p>
<p>5.5.2.7.2</p>
<p> </p>
<p>CanNm_GetNodeIdentifier: Get Source Node Identifier ................... 65</p>
<p> </p>
<p>5.5.2.7.3</p>
<p> </p>
<p>CanNm_GetLocalNodeIdentifier: Get Local Source Node </p>
<p>Identifier .......................................................................................... 66</p>
<p> </p>
<p>5.5.2.8</p>
<p> </p>
<p>Bus Synchronization ............................................................................... 67</p>
<p> </p>
<p>5.5.2.8.1</p>
<p> </p>
<p>CanNm_RequestBusSynchronization: Synchronization of </p>
<p>Networks ......................................................................................... 67</p>
<p> </p>
<p>5.5.2.9</p>
<p> </p>
<p>Remote Sleep Indication ........................................................................ 68</p>
<p> </p>
<p>5.5.2.9.1</p>
<p> </p>
<p>CanNm_CheckRemoteSleepIndication: Check for Remote </p>
<p>Sleep Indication ............................................................................... 68</p>
<p> </p>
<p>5.5.2.10</p>
<p> </p>
<p>NM Message Transmission Request ...................................................... 69</p>
<p> </p>
<p>5.5.2.10.1</p>
<p> </p>
<p>CanNm_Transmit: Spontaneous NM Message Transmission .......... 69</p>
<p> </p>
<p>5.5.2.11</p>
<p> </p>
<p>Partial Networking .................................................................................. 70</p>
<p> </p>
<p>5.5.2.11.1</p>
<p> </p>
<p>CanNm_ConfirmPnAvailability: Notification for activating the PN </p>
<p>filter functionality .............................................................................. 70</p>
<p> </p>
<p>5.5.3</p>
<p> </p>
<p>Vector extensions .......................................................................................... 71</p>
<p> </p>
<p>5.5.3.1</p>
<p> </p>
<p>CanNm_InitMemory: Memory Initialization ............................................. 71</p>
<p> </p>
<p>5.5.3.2</p>
<p> </p>
<p>CanNm_SetCoordBits: Set Coordination Bits in the CBV ....................... 72</p>
<p> </p>
<p>5.5.3.3</p>
<p> </p>
<p>CanNm_CheckLimpHomeIndication: Check the Limp Home Status ....... 73</p>
<p> </p>
<p>5.5.3.4</p>
<p> </p>
<p>CanNm_SetDiagGwReqId: Diagnostic Gateway ID Request .................. 74</p>
<p> </p>
<p>5.5.3.5</p>
<p> </p>
<p>CanNm_DisablePNActivationState: Disable Partial Networking ............. 74</p>
<p> </p>
<p>5.6</p>
<p> </p>
<p>Services Used by CAN NM .................................................................................... 75</p>
<p> </p>
<p>5.7</p>
<p> </p>
<p>Callbacks Provided by CAN NM ............................................................................. 75</p>
<p> </p>
<p>5.7.1</p>
<p> </p>
<p>Callback Functions from CAN Interface ......................................................... 75</p>
<p> </p>
<p>5.7.1.1</p>
<p> </p>
<p>CanNm_RxIndication: NM Message Indication ....................................... 75</p>
<p> </p>
<p>5.7.1.2</p>
<p> </p>
<p>CanNm_TxConfirmation: NM Message Confirmation Function ............... 77</p>
<p> </p>
<p>5.8</p>
<p> </p>
<p>Callback Functions used by CAN NM ..................................................................... 77</p>
<p> </p>
<p>5.8.1</p>
<p> </p>
<p>Service Callback Functions of CAN NM ........................................................ 77</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>10 / 99 </p>
<p>5.8.2</p>
<p> </p>
<p>Additional Service Callback Functions of CAN NM ........................................ 78</p>
<p> </p>
<p>5.8.2.1</p>
<p> </p>
<p>Callbacks for Limp Home Indication ....................................................... 78</p>
<p> </p>
<p>5.8.2.2</p>
<p> </p>
<p>Callbacks for Coordination Extension ..................................................... 78</p>
<p> </p>
<p>5.8.2.3</p>
<p> </p>
<p>Callbacks for Gateway Extension Support .............................................. 78</p>
<p> </p>
<p>5.8.2.4</p>
<p> </p>
<p>Callbacks for Partial Networking ............................................................. 78</p>
<p> </p>
<p>5.8.2.5</p>
<p> </p>
<p>Generator Compatibility Error ................................................................. 79</p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>Configuration................................................................................................................ 80</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Configuration Variants ............................................................................................ 80</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Configuration in Data Base ..................................................................................... 80</p>
<p> </p>
<p>6.3</p>
<p> </p>
<p>Configuration with GENy ........................................................................................ 82</p>
<p> </p>
<p>6.3.1</p>
<p> </p>
<p>Component Configuration ............................................................................. 84</p>
<p> </p>
<p>6.3.2</p>
<p> </p>
<p>Channel Configuration ................................................................................... 90</p>
<p> </p>
<p>6.3.2.1</p>
<p> </p>
<p>Identity Specific Channel Configuration .................................................. 94</p>
<p> </p>
<p>6.3.3</p>
<p> </p>
<p>Timing Restrictions ........................................................................................ 96</p>
<p> </p>
<p>6.3.4</p>
<p> </p>
<p>NM Message Structure Configuration Notes ................................................. 96</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Glossary and Abbreviations ........................................................................................ 97</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Glossary ................................................................................................................. 97</p>
<p> </p>
<p>7.2</p>
<p> </p>
<p>Abbreviations ......................................................................................................... 97</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>Contact.......................................................................................................................... 99</b></p>
<p> </p>
<p> </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>Architecture of AUTOSAR Stack ............................................................... 14</p>
<p> </p>
<p>Figure 2-2</p>
<p> </p>
<p>Interface to Adjacent Modules of the CAN NM .......................................... 15</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>State Diagram of CAN NM from SWS CAN NM [3] ................................... 22</p>
<p> </p>
<p>Figure 3-2</p>
<p> </p>
<p>Usual Behavior of NM Transmissions when Repeat Message is entered .. 27</p>
<p> </p>
<p>Figure 3-3</p>
<p> </p>
<p>Immediate Transmission due to Signal Change inside User Data I-PDU .. 35</p>
<p> </p>
<p>Figure 3-4</p>
<p> </p>
<p>Immediate Nm Transmissions ................................................................... 39</p>
<p> </p>
<p>Figure 3-5</p>
<p> </p>
<p>Behavior for NM Transmissions if Immediate Restart Enabled is ON ........ 41</p>
<p> </p>
<p>Figure 4-1</p>
<p> </p>
<p>Include Structure of CAN NM .................................................................... 46</p>
<p> </p>
<p>Figure 6-1</p>
<p> </p>
<p>Component Selection in GENy ................................................................. 83</p>
<p> </p>
<p>Figure 6-2</p>
<p> </p>
<p>Component Configuration CAN NM .......................................................... 84</p>
<p> </p>
<p>Figure 6-3</p>
<p> </p>
<p>Channel Configuration CAN NM ............................................................... 91</p>
<p> </p>
<p>Figure 6-4</p>
<p> </p>
<p>Identity-Specific Channel Configuration CAN NM ..................................... 95</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 1-1 </p>
<p> </p>
<p>History of the Document ............................................................................. 4</p>
<p> </p>
<p>Table 1-2 </p>
<p> </p>
<p>Reference Documents ................................................................................ 4</p>
<p> </p>
<p>Table 1-1 </p>
<p> </p>
<p>Component history.................................................................................... 12</p>
<p> </p>
<p>Table 2-1 </p>
<p> </p>
<p>Naming Conventions ................................................................................ 13</p>
<p> </p>
<p>Table 3-1 </p>
<p> </p>
<p>Supported AUTOSAR standard conform features ..................................... 16</p>
<p> </p>
<p>Table 3-2 </p>
<p> </p>
<p>Not supported AUTOSAR standard conform features ............................... 18</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>11 / 99 </p>
<p>Table 3-3 </p>
<p> </p>
<p>Features provided beyond the AUTOSAR standard .................................. 20</p>
<p> </p>
<p>Table 3-4 </p>
<p> </p>
<p>PDU NM Message Layout ........................................................................ 26</p>
<p> </p>
<p>Table 3-5 </p>
<p> </p>
<p>NM Coordination Bits ................................................................................ 31</p>
<p> </p>
<p>Table 3-6 </p>
<p> </p>
<p>DET Error Codes of CAN NM ................................................................... 32</p>
<p> </p>
<p>Table 3-7 </p>
<p> </p>
<p>DEM Error Codes of CAN NM .................................................................. 33</p>
<p> </p>
<p>Table 3-8 </p>
<p> </p>
<p>Configuration Precondition Overview for AUTOSAR ECU Configurations . 36</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>CAN NM Integration Files ......................................................................... 45</p>
<p> </p>
<p>Table 4-2 </p>
<p> </p>
<p>Critical Section Codes .............................................................................. 49</p>
<p> </p>
<p>Table 5-1 </p>
<p> </p>
<p>Data Types ............................................................................................... 50</p>
<p> </p>
<p>Table 5-2 </p>
<p> </p>
<p>Specification Version API Data ................................................................. 51</p>
<p> </p>
<p>Table 5-3 </p>
<p> </p>
<p>Component Version API Data ................................................................... 51</p>
<p> </p>
<p>Table 5-4 </p>
<p> </p>
<p>Vendor/Module ID ..................................................................................... 51</p>
<p> </p>
<p>Table 5-5 </p>
<p> </p>
<p>Services Used by the CAN NM ................................................................. 75</p>
<p> </p>
<p>Table 6-1 </p>
<p> </p>
<p>Database Attributes for CAN NM .............................................................. 82</p>
<p> </p>
<p>Table 6-2 </p>
<p> </p>
<p>Component Configuration CAN NM .......................................................... 89</p>
<p> </p>
<p>Table 6-3 </p>
<p> </p>
<p>Channel Configuration CAN NM ............................................................... 94</p>
<p> </p>
<p>Table 6-4 </p>
<p> </p>
<p>Identity-Specific Channel Configuration CAN NM ..................................... 95</p>
<p> </p>
<p>Table 6-5 </p>
<p> </p>
<p>CAN NM Timing Restrictions .................................................................... 96</p>
<p> </p>
<p>Table 7-1 </p>
<p> </p>
<p>Glossary ................................................................................................... 97</p>
<p> </p>
<p>Table 7-2 </p>
<p> </p>
<p>Abbreviations ............................................................................................ 98</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>12 / 99 </p>
<p><b>1 </b></p>
<p><b>Component History </b></p>
<p>The </p>
<p>component </p>
<p>history </p>
<p>gives </p>
<p>an </p>
<p>overview </p>
<p>over </p>
<p>the </p>
<p>important </p>
<p>milestones </p>
<p>that </p>
<p>are </p>
<p>supported in the different versions of the component.  </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>1.00.00 </p>
<p>Creation for AUTOSAR 1.0 </p>
<p>3.00.00 </p>
<p>Adaption for AUTOSAR 2.1 </p>
<p>4.00.00 </p>
<p>Adaption for AUTOSAR 3.0 </p>
<p>4.01.00 </p>
<p>Added Coordinator Synchronization Support </p>
<p>4.02.00 </p>
<p>Support variant link-time for the number of channels </p>
<p>Extended Coordinator Synchronization Support </p>
<p>4.09.00 </p>
<p>Multiple ECU Support </p>
<p>4.12.00 </p>
<p>Added ‘User Data via Com’ Feature </p>
<p>4.14.00 </p>
<p>Added ‘QNX Support’ Feature </p>
<p>4.15.00 </p>
<p>Added ‘Extended Bus Synchronization’ Feature </p>
<p>4.16.00 </p>
<p>Added ‘Limp Home Indication and Cancellation’ Feature </p>
<p>4.17.00 </p>
<p>Added ‘Gateway Extension Support’ Feature </p>
<p>4.19.00 </p>
<p>Added ‘Partial Networking’ Feature  </p>
<p>Added ‘Car Wakeup’ Feature  </p>
<p>Added ‘Active Wakeup Bit’ Feature </p>
<p>Added ‘Immediate Transmissions’ Feature </p>
<p>4.22.00 </p>
<p>Adapted ‘Msg Timeout’ Handling </p>
<p>Added Support for RX PDUs with different lengths </p>
<p>4.26.00 </p>
<p>Added ‘Disable Partial Networking During Initialization’ Feature </p>
<p>Table 1-1  </p>
<p>Component history </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>13 / 99 </p>
<p><b>2 </b></p>
<p><b>Introduction </b></p>
<p>This </p>
<p>document </p>
<p>describes </p>
<p>the </p>
<p>concept, </p>
<p>features, </p>
<p>API </p>
<p>and </p>
<p>the </p>
<p>configuration </p>
<p>of </p>
<p>the </p>
<p>AUTOSAR  CAN  Network  Management  as  specified  in  [3].  Also  the  integration  of  the </p>
<p>Network Management into the Vector CANbedded stack is covered by this document.  </p>
<p>The FlexRay Network Management is not covered by this document. </p>
<p><b>Supported AUTOSAR Release*: </b></p>
<p>3 </p>
<p><b>Supported Configuration Variants: </b></p>
<p>pre-compile, link-time, post-build </p>
<p><b>Vendor ID: </b></p>
<p>CANNM_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>CANNM_MODULE_ID   </p>
<p>31 decimal </p>
<p>(according to ref. [12]) </p>
<p>* For the precise AUTOSAR Release 3.x please see the release specific documentation.  </p>
<p> </p>
<p> </p>
<p>Please  note  that  in  this  document  the  term Application  is  not  used  strictly  for  the  user </p>
<p>software but also for any higher software layer, like e.g. a Communication Control Layer. </p>
<p>Therefore, Application refers to any of the software components using the CAN NM. </p>
<p>For further information please also refer to the AUTOSAR SWS specifications referenced </p>
<p>in the section ‘Reference Documents’. </p>
<p><b>2.1 </b></p>
<p><b>Naming Conventions </b></p>
<p>The  names  of  the  service  functions  provided  by  the  NM  Interface  and  CAN  NM  always </p>
<p>start with a prefix that denominates the software component where the service is located. </p>
<p>E.g. a service that starts with ‘</p>
<p>CanNm_</p>
<p>’ is implemented within the CAN NM. </p>
<p><b>Naming conventions </b></p>
<p>Nm_ </p>
<p>Services of NM Interface. </p>
<p>CanNm_ </p>
<p>Services of CAN NM. </p>
<p>Det_ </p>
<p>Services of Development Error Tracer. </p>
<p>Dem_ </p>
<p>Services of Diagnostic Event Manager. </p>
<p>Table 2-1  </p>
<p>Naming Conventions </p>
<p>Nodes  which  are  configured  to  be  passive  will  be  also  referred  to  as  passive  nodes. </p>
<p>Accordingly nodes that are not passive will be termed as active nodes.  </p>
<p><b>2.2 </b></p>
<p><b>Architecture Overview </b></p>
<p><b>2.2.1 </b></p>
<p><b>Architecture of AUTOSAR Software </b></p>
<p>The following figure shows where the CAN NM is located in the AUTOSAR architecture. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>14 / 99 </p>
<p> </p>
<p>Figure 2-1 </p>
<p>Architecture of AUTOSAR Stack </p>
<p><b>2.2.2 </b></p>
<p><b>Architecture of AUTOSAR Network Management </b></p>
<p>The AUTOSAR Network Management consists of three modules: </p>
<p><b>&gt; </b></p>
<p>NM Interface</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>CAN NM </p>
<p><b>&gt; </b></p>
<p>FlexRay NM</p>
<p>1</p>
<p> </p>
<p>The NM Interface schedules function calls from the application to the respective module </p>
<p>for  each  channel,  e.g.  for  a  CAN  channel  the  corresponding  CAN  NM  function  will  be </p>
<p>called. CAN NM exclusively interacts with the NM Interface. </p>
<p>The  communication  bus  specific  functionality  is  incorporated  in  the  corresponding  bus-</p>
<p>specific NM. The CAN-specific part implements the network management algorithm and is </p>
<p>responsible for the transmission of NM messages on the communication bus by interacting </p>
<p>with the AUTOSAR CAN Interface. </p>
<p>The  next  figure  shows  the  interfaces  to  adjacent  modules  of  the  CAN  NM.  These </p>
<p>interfaces are described in chapter 5, ‘API Description’. </p>
<p>                                            </p>
<p>1</p>
<p> Not covered by this document. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>15 / 99 </p>
<p> </p>
<p>Figure 2-2 </p>
<p>Interface to Adjacent Modules of the CAN NM </p>
<p>Applications do not access the services of the BSW modules directly. They use the service </p>
<p>ports provided by the BSW modules via the RTE. Since the CAN NM has no service ports, </p>
<p>the CAN NM cannot be accessed via RTE by the application. </p>
<p> </p>
<p><b>class Architecture</b></p>
<p><b>PduR</b></p>
<p><b>CanSM</b></p>
<p><b>Dem</b></p>
<p><b>Nm</b></p>
<p><b>CanIf</b></p>
<p><b>CanNm</b></p>
<p><b>Det</b></p>
<p><b>SchM</b></p>
<p><b>EcuM</b></p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>0..1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<p>1</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>16 / 99 </p>
<p><b>3 </b></p>
<p><b>Functional Description </b></p>
<p><b>3.1 </b></p>
<p><b>Overview of the Functional Scope </b></p>
<p>The Network Management is a network comprehensive protocol that provides services for </p>
<p>the organization of the network. It is a decentralized and direct network management. That </p>
<p>means  that  every  ECU  transmits  a  special  network  management  message,  which  is </p>
<p>reserved for the network management only. </p>
<p>The features listed in the following tables cover the complete functionality specified for the </p>
<p>CanNm. </p>
<p>The AUTOSAR  standard  functionality  is  specified  in  [3],  the  corresponding  features  are </p>
<p>listed in the tables </p>
<p><b>&gt; </b></p>
<p>Table 3-1   Supported AUTOSAR standard conform features  </p>
<p><b>&gt; </b></p>
<p>Table 3-2   Not supported AUTOSAR standard conform features </p>
<p>Vector  Informatik  provides  further  CanNm  functionality  beyond  the AUTOSAR  standard. </p>
<p>The corresponding features are listed in the table </p>
<p><b>&gt; </b></p>
<p>Table 3-3   Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p>The following features specified in [3] are supported: </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p>Controlled transition of all ECUs to bus-sleep mode and vice versa.  </p>
<p>User Data Handling </p>
<p>Node Detection </p>
<p>Remote Sleep Indication </p>
<p>Passive Mode Support </p>
<p>Multiple ECU Support </p>
<p>Multiple Configuration Support </p>
<p>NM User Data via Com </p>
<p>Active Wake-up Bit </p>
<p>Immediate Nm Transmissions </p>
<p>Car Wake-up </p>
<p>Partial Networking </p>
<p>Usage of PduInfoType </p>
<p>Table 3-1  </p>
<p>Supported AUTOSAR standard conform features </p>
<p><b>3.1.1 </b></p>
<p><b>Deviations Against AUTOSAR 3.2.2 </b></p>
<p><b>3.1.1.1 </b></p>
<p><b>Initialization </b></p>
<p>If  RAM  is  not </p>
<p>implicitly  initialized  by  the </p>
<p>start-up  code  of  the  project,  the  function </p>
<p>CanNm_InitMemory</p>
<p> has to be called to ensure that all relevant variables are initialized </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>17 / 99 </p>
<p>correctly (e.g. the state machine for checking if the module is initialized) as specified by </p>
<p>AUTOSAR.  </p>
<p><b>3.1.1.2 </b></p>
<p><b>PDU ID Used as Argument for CanNm_TxConfirmation </b></p>
<p>The  CAN  Interface  specification  [6]  and  the  CAN  NM  specification  [3]  have  different </p>
<p>interpretations belonging the value of the API parameter </p>
<p>canNmTxPduId</p>
<p> of the function </p>
<p>CanNm_TxConfirmation</p>
<p>. </p>
<p>To </p>
<p>avoid </p>
<p>inconsistencies </p>
<p>this </p>
<p>implementation </p>
<p>adopts </p>
<p>the </p>
<p>interpretation of the CAN Interface specification where this parameter refers not to the NM </p>
<p>channel handle but to the PDU ID. </p>
<p><b>3.1.1.3 </b></p>
<p><b>Dependencies between Configuration Parameters </b></p>
<p>Following additional dependencies between configuration parameters are added to avoid </p>
<p>bad configurations:  </p>
<p><b>&gt; </b></p>
<p>CANNM_COM_CONTROL_ENABLED</p>
<p> must be set to </p>
<p>STD_OFF</p>
<p> for passive nodes. </p>
<p><b>&gt; </b></p>
<p>CANNM_NODE_DETECTION_ENABLED</p>
<p> must be set to </p>
<p>STD_OFF</p>
<p> for passive nodes. </p>
<p><b>3.1.1.4 </b></p>
<p><b>Coordinator Synchronization Support </b></p>
<p>There are APIs of the Coordinator Synchronization Support that are not supported. This </p>
<p>includes: </p>
<p><b>&gt; </b></p>
<p>The usage of </p>
<p>Nm_CoordReadyToSleepIndication</p>
<p> (indication is done through </p>
<p>Nm_ActiveCoordIndication</p>
<p> instead)  </p>
<p><b>&gt; </b></p>
<p>The provision of the </p>
<p>CanNm_SetSleepReadyBit</p>
<p> function (</p>
<p>CanNm_SetCoordBits</p>
<p> </p>
<p>may be used instead to indicate the value of the Sleep Ready bit) </p>
<p><b>&gt; </b></p>
<p>The BSWMD parameter </p>
<p>CanNmCoordinatorSyncSupport</p>
<p> does not exist. Instead, </p>
<p>the preprocessor define in the code depends on the value of the corresponding </p>
<p>parameter in the NM Interface. </p>
<p><b>3.1.1.5 </b></p>
<p><b>NM User Data via Com </b></p>
<p>The </p>
<p>BSWMD </p>
<p>parameter </p>
<p>CanNmComUserDataSupport</p>
<p> </p>
<p>is </p>
<p>called </p>
<p>CanNmComUserDataEnabled</p>
<p> instead. </p>
<p><b>3.1.1.6 </b></p>
<p><b>Active Wake-up Bit Support </b></p>
<p>The  BSWMD  parameter </p>
<p>CanNmActiveWakeupBitEnabled</p>
<p>  is  not  located  inside  the </p>
<p>CanNmGlobalConfig</p>
<p> container but inside </p>
<p>CanNmChannelConfig</p>
<p> container. </p>
<p><b>3.1.1.7 </b></p>
<p><b>Redundant BSWMD Parameters </b></p>
<p>The </p>
<p>following </p>
<p>BSWMD </p>
<p>parameters </p>
<p>are </p>
<p>redundant </p>
<p>to </p>
<p>other </p>
<p>parameters, </p>
<p>but </p>
<p>are </p>
<p>nevertheless mandatory since they were mandatory in previous versions of [3]: </p>
<p><b>&gt; </b></p>
<p>The multiplicity of the </p>
<p>CanNmNumberOfChannels</p>
<p> parameter is 1..1, but should be </p>
<p>0..1 instead according to [3]. </p>
<p><b>&gt; </b></p>
<p>The multiplicity of the </p>
<p>CanNmUserDataLentgh</p>
<p>2</p>
<p> parameter is 1..1, but should be 0..1 </p>
<p>instead according to [3]. </p>
<p>                                            </p>
<p>2</p>
<p> Typo is intended (parameter name according to AUTOSAR) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>18 / 99 </p>
<p><b>3.1.1.8 </b></p>
<p><b>Unsupported Features </b></p>
<p>The following features specified in [3] are not supported: </p>
<p><b>Not Supported AUTOSAR Standard Conform Features </b></p>
<p>- </p>
<p>Table 3-2  </p>
<p>Not supported AUTOSAR standard conform features </p>
<p><b>3.1.2 </b></p>
<p><b>Additions/ Extensions </b></p>
<p>The following extensions of the CAN NM software specifications ([3]) are available within </p>
<p>the  Network  Management  embedded  software  components.  If  required,  the  extensions </p>
<p>have to be enabled during configuration. </p>
<p><b>3.1.2.1 </b></p>
<p><b>Link-Time Support for Channels </b></p>
<p>In [3] the number of channels is a pre-compile parameter and cannot be changed at link-</p>
<p>time. For a better library support it must be possible to change the number of channels at </p>
<p>link-time. Therefore the implementation of the CAN NM supports link-time changes of the </p>
<p>channels. </p>
<p><b>3.1.2.2 </b></p>
<p><b>Single Channel Optimization </b></p>
<p>For single channel systems it is possible to optimize the source code for saving precious </p>
<p>resources  (ROM,  RAM  and  CPU  load).  This  optimization  is  only  possible  when  source </p>
<p>code </p>
<p>is </p>
<p>available. </p>
<p>For </p>
<p>the </p>
<p>configuration </p>
<p>please </p>
<p>refer </p>
<p>to </p>
<p>chapter </p>
<p>6.3.1 </p>
<p>‘Component </p>
<p>Configuration’. </p>
<p>Please </p>
<p>note </p>
<p>that </p>
<p>single </p>
<p>channel </p>
<p>optimization </p>
<p>can </p>
<p>only </p>
<p>be </p>
<p>enabled </p>
<p>in </p>
<p>pre-compile </p>
<p>configurations. The value must not be changed at link-time. If single-channel optimization </p>
<p>is enabled and the configuration variant is link-time the number of CAN NM channels must </p>
<p>not be changed. </p>
<p><b>3.1.2.3 </b></p>
<p><b>Memory Initialization </b></p>
<p>AUTOSAR  expects  the  start-up  code  to  automatically  initialize  RAM.  Due  to  not  every </p>
<p>startup code of embedded targets reinitializes all variables correctly it may happen that the </p>
<p>state  of  a  variable  may  be  not  initialized,  when  this  should  be  the  case.  To  avoid  this </p>
<p>problem  the  Vector AUTOSAR NM  provides  additional functions to  initialize  the  relevant </p>
<p>variables of the CAN NM. </p>
<p>Refer also to chapter 5.5.3.1 ‘CanNm_InitMemory: Memory Initialization’. </p>
<p><b>3.1.2.4 </b></p>
<p><b>Error Reporting to Diagnostic Event Manager </b></p>
<p>According to the AUTOSAR specifications error reporting to the Diagnostic Event Manager </p>
<p>is  mandatory.  If  the AUTOSAR  NM  is  used  in  environments  without  a  Diagnostic  Event </p>
<p>Manager  it  should  be  possible  to  deactivate  the  error  reporting.  Therefore  the  switch </p>
<p>CANNM_PROD_ERROR_DETECT</p>
<p>  has  been  added  (refer also to  chapter  6.3.1  ‘Component </p>
<p>Configuration’). </p>
<p><b>3.1.2.5 </b></p>
<p><b>Disable Transmission Error Reporting </b></p>
<p>The  error  reporting  for  the  following  transmission  errors  can  be  disabled  (refer  also  to </p>
<p>chapter 6.3.1 ‘Component Configuration’): </p>
<p><b>&gt; </b></p>
<p>CANNM_E_DEV_NETWORK_TIMEOUT</p>
<p> (DET) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>19 / 99 </p>
<p><b>&gt; </b></p>
<p>CANNM_E_NETWORK_TIMEOUT</p>
<p> (DEM) </p>
<p><b>&gt; </b></p>
<p>CANNM_E_CANIF_TRANSMIT_ERROR</p>
<p> (DEM) </p>
<p><b>3.1.2.6 </b></p>
<p><b>Limp Home Indication </b></p>
<p>This additional feature allows the detection and cancellation of Limp Home, i.e. if no NM </p>
<p>message could be received and transmitted for a certain amount of time (see also chapter </p>
<p>3.10  ‘Limp  Home  Indication  and  Cancellation’).  Please  note  that  this  feature  is  OEM-</p>
<p>specific and not available by default. If available it can be activated or deactivated in the </p>
<p>configuration. Also refer to chapter 6 ‘Configuration’. </p>
<p><b>3.1.2.7 </b></p>
<p><b>Extended Remote Sleep Indication </b></p>
<p>This additional feature allows checking the remote sleep state also in the Repeat Message </p>
<p>state  (see  also  chapter  3.9.2  ‘Extended  Remote  Sleep  Indication  and  Cancellation’). </p>
<p>Please note that this feature is OEM-specific and not available by default. If available it can </p>
<p>be activated or deactivated in the configuration. Also refer to chapter 6 ‘Configuration’. </p>
<p><b>3.1.2.8 </b></p>
<p><b>Multiple ECU Support </b></p>
<p>The CAN NM supports Multiple ECU configuration when the configuration in GENy is done </p>
<p>with an AUTOSAR ECU configuration file. Refer to chapter 3.13 ‘Multiple ECU Support’ for </p>
<p>more information. </p>
<p><b>3.1.2.9 </b></p>
<p><b>QNX Support </b></p>
<p>The  CAN  NM  supports  context  switch.  Refer  to  chapter  3.16  ‘QNX  Support’  for  more </p>
<p>information. </p>
<p><b>3.1.2.10 </b></p>
<p><b>Extended Bus Synchronization </b></p>
<p>The </p>
<p>CAN </p>
<p>NM </p>
<p>supports </p>
<p>the </p>
<p>possibility </p>
<p>to </p>
<p>enable </p>
<p>the </p>
<p>API </p>
<p>‘</p>
<p>CanNm_RequestBusSynchronization</p>
<p>’ </p>
<p>additionally. </p>
<p>More </p>
<p>details </p>
<p>can </p>
<p>be </p>
<p>found </p>
<p>in </p>
<p>chapter 3.17 ‘Extended Bus Synchronization’. </p>
<p><b>3.1.2.11 </b></p>
<p><b>Gateway Extension Support </b></p>
<p>The  CAN  NM  provides  support  for  the  ‘Gateway  Extension’  functionality  in  the  NM </p>
<p>Interface. Refer to chapter 3.18 ‘Gateway Extension Support’ for further information. </p>
<p><b>3.1.2.12 </b></p>
<p><b>Dem2Det Enabled </b></p>
<p>The CAN NM provides support for the different Dem/Det error requirements specified in </p>
<p>AUTOSAR  Release  3.0,  3.1  and  3.2.  Refer  to  chapter  3.12  ‘Error  Handling’  for  further </p>
<p>information. </p>
<p><b>3.1.2.13 </b></p>
<p><b>Message Reception with Different PDU Lengths </b></p>
<p>The CAN NM supports the reception of PDUs with different lengths. Refer to chapter 3.5.5 </p>
<p>‘Support for RX PDUs with Different Lengths’ for further information. </p>
<p><b>3.1.2.14 </b></p>
<p><b>Deactivation of Partial Networking during Run-Time </b></p>
<p>The FlexRay NM supports the deactivation of Partial Networking during run-time. Refer to </p>
<p>chapter 3.23.6 and 5.4.3.2 for details. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>20 / 99 </p>
<p><b>3.1.2.15 </b></p>
<p><b>Features Provided Beyond the AUTOSAR Standard</b></p>
<p><b> </b></p>
<p>The following features are provided beyond the AUTOSAR standard: </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Link-Time Support for Channels </p>
<p>Single Channel Optimization </p>
<p>Memory Initialization </p>
<p>Error Reporting to the Diagnostic Event Manager </p>
<p>Disable Transmission Error Reporting </p>
<p>Limp Home Indication </p>
<p>Extended Remote Sleep Indication </p>
<p>Multiple ECU Support </p>
<p>QNX Support </p>
<p>Extended Bus Synchronization </p>
<p>Gateway Extension Support </p>
<p>Dem2Det Enabled </p>
<p>Message Reception with Different PDU Lengths </p>
<p>AUTOSAR Monitoring and Debugging Run-Time Measurement </p>
<p>Deactivation of Partial Networking during Run-Time </p>
<p>Table 3-3  </p>
<p>Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Some of these additional non-AUTOSAR features are only available if they are </p>
<p>explicitly ordered by the customer. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.1.3 </b></p>
<p><b>Limitations </b></p>
<p><b>3.1.3.1 </b></p>
<p><b>Ranges of Timers </b></p>
<p>The ranges for the following timers are limited concerning the specified range: </p>
<p><b>&gt; </b></p>
<p>NM Timeout Timer: 1..65535 ms </p>
<p><b>&gt; </b></p>
<p>Remote Sleep Indication Timer: 1..65535 ms (if remote sleep indication is enabled) </p>
<p><b>&gt; </b></p>
<p>NM message Cycle Time: 1..65535 ms </p>
<p><b>&gt; </b></p>
<p>NM message Reduced Time: 1..65535 ms </p>
<p><b>&gt; </b></p>
<p>NM message Tx Timeout Time: 1..65535 ms </p>
<p>All timers should be multiples of the main functions cycle time. </p>
<p>The following provides a detailed description of the functional scope. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>21 / 99 </p>
<p><b>3.2 </b></p>
<p><b>Network Management Mechanism </b></p>
<p>As  described  above  the AUTOSAR  NM  is  a  decentralized  direct  network  management. </p>
<p>This means that every network node has the same functionality and performs state and </p>
<p>operation  mode  changes  self-sufficient  depending  on  the  internal  state  and  whether </p>
<p>network management messages are still received. </p>
<p>The network management mechanism is quite simple: </p>
<p><b>&gt; </b></p>
<p>Every network node transmits its NM messages only as long as it needs to </p>
<p>communicate with other network nodes. Normally bus-communication is required as </p>
<p>long as KL15 is set or during follow-up. </p>
<p><b>&gt; </b></p>
<p>If there is no more network node in the whole network that need to communicate with </p>
<p>other network nodes, any node transmits no more NM messages. </p>
<p><b>&gt; </b></p>
<p>Each network node performs a transition to bus-sleep mode a certain time after the </p>
<p>last NM message has been transmitted by any node. Therefore all nodes will go to </p>
<p>bus-sleep mode together. </p>
<p><b>&gt; </b></p>
<p>If any network node requires bus-communication at any time it can wake up the whole </p>
<p>network by transmitting NM messages. </p>
<p> </p>
<p> </p>
<p><b>Caution </b></p>
<p>The transmission of application messages, e.g. transmitted by the Com, does not stop </p>
<p>immediately after the last NM message has been transmitted. </p>
<p> </p>
<p> </p>
<p><b>FAQ</b> </p>
<p>The application is in charge of the decision whether the bus communication is required </p>
<p>or not. </p>
<p> </p>
<p>The following figure shows the state diagram of the CAN NM. The events are calls of CAN </p>
<p>NM functions by the application or data link layer or the timeout of internal timers. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>22 / 99 </p>
<p> </p>
<p>Figure 3-1 </p>
<p>State Diagram of CAN NM from SWS CAN NM [3] </p>
<p><b>3.3 </b></p>
<p><b>Passive Mode </b></p>
<p>Nodes in passive mode cannot transmit NM messages and therefore they do not actively </p>
<p>participate in the network. Due to that, passive nodes cannot request the network and they </p>
<p>change  immediately  from  Repeat  Message  State  to  Ready  Sleep  State,  i.e.  the  repeat </p>
<p>message time is configured to zero. </p>
<p>This  mode  can  be  used  for  nodes  that  do  not  need  to  keep  the  bus  awake  to  save </p>
<p>resources.  </p>
<p><b>3.4 </b></p>
<p><b>Operation Modes and States </b></p>
<p>The AUTOSAR NM consists of three operation modes: </p>
<p><b>&gt; </b></p>
<p>Network Mode </p>
<p><b>&gt; </b></p>
<p>Prepare Bus-Sleep Mode </p>
<p><b>&gt; </b></p>
<p>Bus-Sleep Mode </p>
<p>The NM Interface is notified about changes of the operation mode by calling the following </p>
<p>functions: </p>
<p><b>stm State Machine</b></p>
<p><b>Network Mode</b></p>
<p><b>Bus-Sleep Mode</b></p>
<p><b>Prepare-Bus-Sleep Mode</b></p>
<p><b>Repeat Message</b></p>
<p><b>Ready Sleep</b></p>
<p><b>Normal Operation</b></p>
<p>Power On</p>
<p>Power Off</p>
<p>Repeat Message Timer expires [Network released]</p>
<p>/Stop Transmission of NM</p>
<p>Network requested/PassiveStartUp/Rx Nm Msg</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkMode</p>
<p>Start Transmission of NM messages</p>
<p>Can_TriggerTransmission (immediate restart +</p>
<p>Nw Req only)</p>
<p>Nm Message received or transmitted</p>
<p>/Restart NM Timeout Timer</p>
<p>Repeat Message Request or</p>
<p>Repeat Msg Bit Indication</p>
<p>/Start Transmission of NM</p>
<p>Repeat Message Request or</p>
<p>Repeat Msg Bit Indication</p>
<p>/Start Transmission of NM</p>
<p>/Initialize NM</p>
<p>Network requested or</p>
<p>PassiveStartUp</p>
<p>/Start NM Timeout</p>
<p>Timer</p>
<p>Notify NetworkMode</p>
<p>Start Transmission of NM</p>
<p>messages</p>
<p>NM Timeout Timer expires</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkTimeout</p>
<p>Nm Msg received</p>
<p>/Notify NetworkStart Indication</p>
<p>Repeat Message Timer</p>
<p>expires [Network requested]</p>
<p>NM Timeout Timer expires</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkTimeout</p>
<p>Network released</p>
<p>/Stop</p>
<p>Transmission of</p>
<p>NM</p>
<p>Network requested</p>
<p>/Start</p>
<p>Transmission of</p>
<p>NM</p>
<p>NM Timeout Timer</p>
<p>expires</p>
<p>/Notify</p>
<p>PrepareBus-SleepMode</p>
<p>Wait Bus Sleep Timer expires</p>
<p>/Notify Nm_BusSleep Mode</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>23 / 99 </p>
<p>Entering Bus-Sleep Mode: </p>
<p>void <b>Nm_BusSleepMode </b>( const NetworkHandleType nmChannelHandle </p>
<p>)</p>
<p> </p>
<p>(5.8.1) </p>
<p>Entering Network Mode: </p>
<p>void <b>Nm_NetworkMode </b>( const NetworkHandleType nmChannelHandle )</p>
<p> (5.8.1) </p>
<p>Leaving Network Mode: </p>
<p>void <b>Nm_PrepareBusSleepMode </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.1</p>
<p>) </p>
<p>Information about the current state and the current mode is provided by the service call </p>
<p>CanNm_GetState</p>
<p> (chapter 5.5.2.2). </p>
<p>The  CAN  NM  notifies  changes  of  the  current  state  to  the  NM  Interface  by  calling  the </p>
<p>optional function </p>
<p>void <b>Nm_StateChangeNotification </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>const Nm_StateType nmPreviousState, </p>
<p> </p>
<p>const Nm_StateType nmCurrentState ) </p>
<p>(5.8.1) </p>
<p><b>3.4.1 </b></p>
<p><b>Network Mode </b></p>
<p>The Network Mode comprises three states: </p>
<p><b>&gt; </b></p>
<p>Repeat Message </p>
<p><b>&gt; </b></p>
<p>Normal Operation </p>
<p><b>&gt; </b></p>
<p>Ready Sleep </p>
<p>This  is  the  mode  in  that  the  ECU  is  ‘online’  and  participates  in  the  network.  The </p>
<p>participation in the network is active or passive depending on the state: </p>
<p><b>&gt; </b></p>
<p>Active participation: a node keeps the network awake (Repeat Message State and </p>
<p>Normal Operation State). </p>
<p><b>&gt; </b></p>
<p>Passive participation: a node is ready for sleep (Ready Sleep State) and any other </p>
<p>node keeps the network alive. </p>
<p>The application is notified about entering the Network Mode by a call of the function: </p>
<p>void <b>Nm_NetworkMode </b>( const NetworkHandleType nmChannelHandle )</p>
<p>(5.8.1) </p>
<p>The  NM  Interface  notifies  leaving  the  Network  Mode  to  the  application  by  a  call  of  the </p>
<p>function: </p>
<p>void <b>Nm_PrepareBusSleepMode </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.1) </p>
<p> </p>
<p> </p>
<p><b>Info</b> </p>
<p>The Com is active during Network Mode. It is started upon entry and stopped upon exit </p>
<p>of Network Mode. I.e. application messages are transmitted and received within Network </p>
<p>Mode! </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>24 / 99 </p>
<p><b>3.4.1.1 </b></p>
<p><b>Repeat Message State </b></p>
<p>The Repeat Message State is entered: </p>
<p><b>&gt; </b></p>
<p>If a NM message has been received in Prepare Bus-Sleep Mode. </p>
<p><b>&gt; </b></p>
<p>If the network has been requested by a call of </p>
<p>CanNm_NetworkRequest</p>
<p> in Bus-</p>
<p>Sleep or Prepare Bus-Sleep Mode. </p>
<p><b>&gt; </b></p>
<p>If the network is woken up from Bus-Sleep Mode or from Prepare Bus-Sleep Mode by </p>
<p>a call of </p>
<p>CanNm_PassiveStartUp</p>
<p>. </p>
<p><b>&gt; </b></p>
<p>If any network node (including itself) has requested node detection in Ready Sleep or </p>
<p>Normal Operation State. </p>
<p>In Repeat Message State the NM messages are transmitted cyclically regardless whether </p>
<p>bus load reduction is enabled or disabled. </p>
<p>The Repeat Message State is left after a certain customizable time. </p>
<p>Depending on the bus-communication need of the application Normal Operation State or </p>
<p>Ready Sleep State is entered upon exit of Repeat Message State. </p>
<p><b>3.4.1.2 </b></p>
<p><b>Normal Operation State </b></p>
<p>The network management stays in Normal Operation State until the bus-communication is </p>
<p>released.  The  local  bus-communication  request  of  the  application  is  distributed  in  the </p>
<p>network by the transmission of NM messages. </p>
<p><b>3.4.1.3 </b></p>
<p><b>Ready Sleep State </b></p>
<p>The network management stays in Ready Sleep State as long as the application does not </p>
<p>request  bus-communication  and  the  application  of  any  other  node  still  requests  bus-</p>
<p>communication (by transmitting NM messages). </p>
<p>A certain customizable time after the last network node has released bus-communication a </p>
<p>transition to Prepare Bus-Sleep Mode is performed (i.e. Network Mode is left). </p>
<p><b>3.4.2 </b></p>
<p><b>Prepare Bus-Sleep Mode </b></p>
<p>The  transmission of  application messages  is stopped  when  entering  Prepare  Bus-Sleep </p>
<p>Mode.  The  bus  activity  is  calmed  down  (pending  message  are  still  transmitted)  in  this </p>
<p>mode and finally there is no more activity on the bus. </p>
<p>After the ‘wait bus sleep time’ the drop out of Prepare Bus-Sleep Mode to Bus-Sleep Mode </p>
<p>the NM Interface is notified by the service call: </p>
<p>void <b>Nm_BusSleepMode </b>( const NetworkHandleType nmChannelHandle </p>
<p>) </p>
<p>(5.8.1</p>
<p>)</p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Caution </b></p>
<p>When entering Bus-Sleep Mode the physical bus interface has to be put in sleep mode. </p>
<p>On CAN channels the transceiver and the CAN-Controller have to be put in sleep mode. </p>
<p>This is done by the ComM. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>25 / 99 </p>
<p>The Prepare Bus-Sleep Mode is left to Network Mode upon successful reception of a NM </p>
<p>message or if the network has been requested by a call of </p>
<p>CanNm_NetworkRequest</p>
<p> or if </p>
<p>the network has been woken up by a call of </p>
<p>CanNm_PassiveStartUp</p>
<p>. </p>
<p><b>3.4.3 </b></p>
<p><b>Bus-Sleep Mode </b></p>
<p>All network nodes perform a transition to bus-sleep mode at almost the same time, if no </p>
<p>NM message is lost and there hasn’t been a wake-up by any node. </p>
<p>The bus-sleep mode is left (wake-up) by a call of </p>
<p>Nm_ReturnType <b>CanNm_PassiveStartUp </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.5.2.3) </p>
<p>or if the network has been requested by a call of </p>
<p>Nm_ReturnType <b>CanNm_NetworkRequest </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle</p>
<p> )  </p>
<p>(5.5.2.4.1) </p>
<p>In  both  cases  Repeat  Message  State  will  be  entered  (see  Chapter </p>
<p>3.4.1.1  ‘Repeat </p>
<p>Message State’). </p>
<p>If a NM message is received in Bus-Sleep Mode the service </p>
<p>void <b>Nm_NetworkStartIndication </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.1) </p>
<p>is called by CAN NM. </p>
<p><b>3.4.4 </b></p>
<p><b>Wake-up Registration </b></p>
<p>The </p>
<p>network </p>
<p>management </p>
<p>needs </p>
<p>to </p>
<p>know </p>
<p>whether </p>
<p>the </p>
<p>application </p>
<p>requires </p>
<p>bus </p>
<p>communication. Per default the network management does not actively participate in the </p>
<p>network. The active participation in the network is requested by the service </p>
<p>Nm_ReturnType <b>CanNm_NetworkRequest </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p> </p>
<p>(5.5.2.4.1) </p>
<p>Calling  this  function  in  Bus-Sleep  Mode  starts  the  network  and  leads  to  a  transition  to </p>
<p>Repeat Message State (see Chapter 3.4.3 ‘Bus-Sleep Mode’). </p>
<p>If bus communication is not required anymore it can be released with the service </p>
<p>Nm_ReturnType <b>CanNm_NetworkRelease </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.5.2.4.2) </p>
<p> </p>
<p><b>Caution </b></p>
<p>When the communication control service is used the bus-communication shall not be </p>
<p>released as long as the NM message transmission ability is disabled. </p>
<p> </p>
<p>Note that a bus-communication request is handled within the next task. Nevertheless it is </p>
<p>ensured that a communication request always leads to start-up even if the communication </p>
<p>is  released  before  the  next  task  is  executed.  Within  Network  Mode  a  fast  toggling  (i.e. </p>
<p>without  task  execution  in  between)  of  the  communication  status  does  not  lead  to  any </p>
<p>action. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>26 / 99 </p>
<p><b>3.4.5 </b></p>
<p><b>User Data Handling </b></p>
<p>The user data for the NM message transmitted next on the bus can be set by the service: </p>
<p>Nm_ReturnType <b>CanNm_SetUserData </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>const uint8* nmUserDataPtr )  </p>
<p>(5.5.2.6.1) </p>
<p>The service  </p>
<p>Nm_ReturnType <b>CanNm_GetUserData </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>uint8* nmUserDataPtr )  </p>
<p>(5.5.2.6.2) </p>
<p>allows reading the user data of the last received message on the bus. </p>
<p>As the NM PDU layout is completely configurable, the user data placement depends on </p>
<p>the given configuration.  </p>
<p>The PDU layout and the content of the user data itself are OEM specific and therefore </p>
<p>provided by the OEM. </p>
<p>Note that for setting of NM user data a second possibility can be configured. Refer to </p>
<p>chapter 3.15 ‘NM User Data via Com’ for more information. If the feature ‘NM User Data </p>
<p>via Com’ is used the API </p>
<p>CanNm_SetUserData()</p>
<p> is not available. </p>
<p><b>3.5 </b></p>
<p><b>Network Management Message Transmission and Reception </b></p>
<p><b>3.5.1 </b></p>
<p><b>AUTOSAR CAN Interface </b></p>
<p>The  network  management  requests  the  transmission  of  NM  messages  by  calling  the </p>
<p>service </p>
<p>CanIf_Transmit</p>
<p>. The application has to take care of the user data. For details </p>
<p>refer to chapter 3.4.5 ‘User Data Handling’. </p>
<p>The successful transmission of every network management message is confirmed by the </p>
<p>CAN Interface with the service </p>
<p>void <b>CanNm_TxConfirmation </b>( PduIdType canNmTxPduId ) </p>
<p>(5.7.1.2) </p>
<p>The CAN Interface indicates the reception of NM message by calling the service  </p>
<p>void <b>CanNm_RxIndication </b>( PduIdType canNmRxPduId, </p>
<p> </p>
<p>const PduInfoType* PduInfoPtr ) </p>
<p>(5.7.1.1) </p>
<p><b>3.5.2 </b></p>
<p><b>PDU Message Layout </b></p>
<p>The default PDU Message Layout is described in the following table: </p>
<p> </p>
<p>Bit 7 </p>
<p>Bit 6 </p>
<p>Bit 5 </p>
<p>Bit 4 </p>
<p>Bit 3 </p>
<p>Bit 2 </p>
<p>Bit 1 </p>
<p>Bit 0 </p>
<p>Byte 7 </p>
<p>User data 5 </p>
<p>Byte 6 </p>
<p>User data 4 </p>
<p>Byte 5 </p>
<p>User data 3 </p>
<p>Byte 4 </p>
<p>User data 2 </p>
<p>Byte 3 </p>
<p>User data 1 </p>
<p>Byte 2 </p>
<p>User data 0 </p>
<p>Byte 1 </p>
<p>Source Node Identifier </p>
<p>Byte 0 </p>
<p>Control Bit Vector </p>
<p>Table 3-4  </p>
<p>PDU NM Message Layout </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>27 / 99 </p>
<p>The  number  of  User  Data  Bytes  as  well  as  the  positions  of  the  Control  Bit  Vector  and </p>
<p>Source Node Identifier can be configured arbitrarily but depend on the availability of the </p>
<p>corresponding  features  (User  Data  Support  /  Node  Detection  of  Coordinator  Extension </p>
<p>Support / Node Identifier).  </p>
<p>Refer to chapter 6.3 ‘Configuration with GENy’ for more details about the configuration. </p>
<p><b>3.5.3 </b></p>
<p><b>Message Transmissions </b></p>
<p>A standard sequence for NM message transmissions when Repeat Message is entered is </p>
<p>depicted in Figure 3-2. </p>
<p> </p>
<p>Figure 3-2 </p>
<p>Usual Behavior of NM Transmissions when Repeat Message is entered </p>
<p>The first NM message is transmitted when ‘Msg Cycle Offset’ ms has been elapsed after </p>
<p>Repeat Message has been entered. The next NM message will be transmitted after Msg </p>
<p>Cycle Time has been elapsed. The configuration settings that influence this behavior are: </p>
<p><b>&gt; </b></p>
<p>‘Msg Cycle Offset’: time before the transmission of the first NM message </p>
<p><b>&gt; </b></p>
<p>‘Msg Cycle Time’: time between each message transmission </p>
<p><b>&gt; </b></p>
<p>‘Immediate Restart Enabled’: if enabled, an additional NM message will be sent </p>
<p>immediately upon an active request (CanNm_NetworkRequest was called) from </p>
<p>Prepare Bus Sleep to Repeat Message (see also chapter 3.21) in case ‘Msg Cycle </p>
<p>Offset’ is greater than zero </p>
<p><b>&gt; </b></p>
<p>‘Immediate Nm Transmissions’: if this setting is greater than zero, an immediate NM </p>
<p>message will be sent when Repeat Message is entered due to an active request. The </p>
<p>interval between NM messages will be different for the next (‘Immediate Nm </p>
<p>Transmissions’ - 1) NM messages to be sent. Refer to chapter 3.20 for more details. </p>
<p><b>&gt; </b></p>
<p>‘Repeat Message Time’: this setting determines for how long CanNm shall keep the </p>
<p>Repeat Message state. If the node has been requested passively, the next state will be </p>
<p>Ready Sleep. </p>
<p>A detailed description of these configuration parameters is given in chapter 6.3.1 and </p>
<p>6.3.2. </p>
<p>Note that the NM message is sent as long as the NM state is ‘Repeat Message’ or ‘Normal </p>
<p>Operation’. For details about these states, see also chapter 3.4.1. </p>
<p> </p>
<p>t</p>
<p>Bus Sleep or</p>
<p>Prepare Bus Sleep</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Usual behavior without immediate transmissions</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_PassiveStartUp or</p>
<p>CanNm_NetworkRequest</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>28 / 99 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The lower layer (e.g. CAN Interface) may reject the send request if Network Mode has </p>
<p>just been entered. </p>
<p>CanNm usually does not retry to issue the send request of the NM message. There are </p>
<p>features, which may enable retries in certain conditions: </p>
<p>If ‘Immediate Nm Transmissions’ are greater than zero, the rejected send request is not </p>
<p>considered as ‘Immediate Transmission’ (see chapter 3.20). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.5.4 </b></p>
<p><b>Bus Load Reduction </b></p>
<p>The bus load reduction is started automatically if enabled and when Normal Operation </p>
<p>state is entered. When Normal Operation state is left, bus load reduction algorithm is </p>
<p>stopped. </p>
<p><b>3.5.5 </b></p>
<p><b>Support for RX PDUs with Different Lengths </b></p>
<p>The  CanNm  supports  messages  with  different  lengths  (DLCs).  This  support  can  be </p>
<p>enabled  by  disabling  the  ‘Adjust  CanIf  RangeConfig  DLCCheck’  setting  in  the  module </p>
<p>configuration. </p>
<p> </p>
<p><b>Info</b> </p>
<p>The ‘Adjust CanIf RangeConfig DLCCheck’ setting is most likely pre-configured and </p>
<p>cannot be changed inside GENy. Probably it is not even visible in the CanNm module </p>
<p>settings. </p>
<p>The setting is enabled, if a macro definition of </p>
<p>CANNM_CANIF_RANGE_CONFIG_DLC_CHECK can be found in CanNm_Cfg.h. </p>
<p>If the ‘Adjust CanIf RangeConfig DLCCheck’ setting is disabled, you can enter within the </p>
<p>CanIf  configuration  (see  also  the  description  of  the  ‘DLC  Check’  feature  in  [6])  the </p>
<p>minimum DLC value that shall be accepted for NM messages. Smaller messages will then </p>
<p>be discarded. Messages with same DLC or greater DLC will be received and forwarded to </p>
<p>the NM. </p>
<p>If  the  ‘Adjust  CanIf  RangeConfig  DLCCheck’  setting  is  enabled,  the  value  in  the  CanIf </p>
<p>configuration will be automatically set by the NM to 'Pdu Length' and cannot be changed </p>
<p>by the user. Therefore only NM messages where the DLC is equal to (or greater than) ‘Pdu </p>
<p>Length’ will be accepted by CanNm. </p>
<p>In all cases, CanNm evaluates only bytes within the NM messages up to ‘Pdu Length’, i.e. </p>
<p>in case the received NM message length is greater than the configured ‘Pdu Length’ the </p>
<p>respective  bytes  will  be  ignored.  For  smaller  messages  than  ‘Pdu  Length’,  the  missing </p>
<p>bytes are considered as being zero. </p>
<p>Examples: </p>
<p>The length of a received message is 8, ‘Pdu Length’ is configured to 6. In this case, the </p>
<p>last two user data bytes are not further processed by CanNm (e.g. CanNm_GetUserData </p>
<p>does  not  return  data  for  these  two  bytes).  The  message  is  accepted  regardless  of  the </p>
<p>‘Adjust CanIf RangeConfig DLCCheck’ setting. </p>
<p>The length of a received message is 4, ‘Pdu Length’ is configured to 6. In this case, bytes </p>
<p>4  and  5  are  considered  as  being  zero  (e.g.  CanNm_GetUserData  returns  0  for  these </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>29 / 99 </p>
<p>bytes). The message is not accepted at all if the ‘Adjust CanIf RangeConfig DLCCheck’ </p>
<p>setting is enabled, because the minimum required DLC for accepting the message is set to </p>
<p>‘Pdu Length’ = 6. </p>
<p>In  summary,  the  minimum  required  number  of  bytes  for  a  received  NM  message  that </p>
<p>should  be  processed  by  CanNm  has  to  be  configured  by  using  the  CanIf  DLC  Check </p>
<p>feature [6]. If ‘Adjust CanIf RangeConfig DLCCheck’ is disabled, the user may configure </p>
<p>the CanIf DLC Check by himself/herself, otherwise it is handled automatically by CanNm. </p>
<p>Refer to chapter 6.3 ‘Configuration with GENy’ for more details about the configuration. </p>
<p><b>3.6 </b></p>
<p><b>Node Detection </b></p>
<p>In order to detect which nodes are currently present within the network, this mechanism </p>
<p>can be used. If a network node requests node detection, the requesting node performs a </p>
<p>transition to Repeat Message State and sets the Repeat Message Bit within the NM PDU. </p>
<p>Upon  reception  of  the  Repeat  Message  Bit  all  network  nodes  perform  a  transition  to </p>
<p>Repeat  Message  State.  This  allows  the  requesting  node  to  collect  all  source  node </p>
<p>identifiers from active nodes. </p>
<p>The local source node identifier can be retrieved by the service </p>
<p>Nm_ReturnType <b>CanNm_GetLocalNodeIdentifier </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>uint8* const nmNodeIdPtr ) </p>
<p>(5.5.2.7.3) </p>
<p>The source node identifier from the last received message can be retrieved by the service </p>
<p>Nm_ReturnType <b>CanNm_GetNodeIdentifier </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>uint8* const nmNodeIdPtr ) </p>
<p>(5.5.2.7.2) </p>
<p><b>3.7 </b></p>
<p><b>NM PDU Receive Indication </b></p>
<p>The  NM  Interface  is  notified  about  the  reception  of  an  NM  message  by  the  optional </p>
<p>function </p>
<p>void <b>Nm_PduRxIndication </b>(  const NetworkHandleType </p>
<p> </p>
<p> </p>
<p> </p>
<p>nmChannelHandle )</p>
<p> </p>
<p>(5.8.1) </p>
<p>The CAN NM notifies the callback directly to the NM Interface in context of the function </p>
<p>CanNm_RxIndication</p>
<p> (see chapter 5.7.1.1). </p>
<p><b>3.8 </b></p>
<p><b>Communication Control </b></p>
<p>In </p>
<p>order </p>
<p>to </p>
<p>support </p>
<p>ISO </p>
<p>14229 </p>
<p>Communication </p>
<p>Control </p>
<p>Service </p>
<p>$28 </p>
<p>the </p>
<p>network </p>
<p>management  has  a  message  transmission  control  status,  which  allows  disabling  the </p>
<p>transmission  of  NM  messages  while  bus-communication  is  requested.  Therefore  the </p>
<p>function </p>
<p>Nm_ReturnType <b>CanNm_DisableCommunication </b>( </p>
<p> </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p> </p>
<p>(5.5.2.5.1) </p>
<p>can be called. The transmission of NM messages will be stopped within the next CAN NM </p>
<p>main function call. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>30 / 99 </p>
<p>The NM PDU transmission ability is enabled again by the service </p>
<p>Nm_ReturnType <b>CanNm_EnableCommunication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p> </p>
<p>(5.5.2.5.2) </p>
<p> </p>
<p><b>Caution </b></p>
<p>An ECU shall not shut down if the NM PDU transmission ability is disabled. </p>
<p> </p>
<p><b>3.9 </b></p>
<p><b>Gateway Functionality </b></p>
<p><b>3.9.1 </b></p>
<p><b>Remote Sleep Indication and Cancellation </b></p>
<p>In  order  to  synchronize  networks  it  might  be  necessary  to  get  an  indication  whether  no </p>
<p>more  network  nodes  require  bus-communication.  This  is  the  so-called  ‘Remote  Sleep </p>
<p>Indication’. The start of the remote sleep indication is indicated by </p>
<p>void <b>Nm_RemoteSleepIndication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.1) </p>
<p>If any NM message is received during Normal Operation State or Ready Sleep State after </p>
<p>the remote sleep indication the service ‘Remote Sleep Cancellation’ is called: </p>
<p>void <b>Nm_RemoteSleepCancellation </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.1) </p>
<p>It is also possible to retrieve the current remote sleep state by calling the service: </p>
<p>void <b>CanNm_CheckRemoteSleepIndication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>boolean* const nmRemoteSleepIndPtr ) </p>
<p>(5.5.2.9.1) </p>
<p>Remote sleep indication can only be checked in Ready Sleep state and Normal Operation </p>
<p>state. </p>
<p><b>3.9.2 </b></p>
<p><b>Extended Remote Sleep Indication and Cancellation </b></p>
<p>For a gateway it might be necessary to check the remote sleep indication status also in the </p>
<p>Repeat  Message  State.  Therefore  this  feature  can  be  enabled  if  the  ‘Remote  Sleep </p>
<p>Indication’ is enabled. </p>
<p>Please note that this feature is additional and can only be enabled if explicitly available. </p>
<p><b>3.9.3 </b></p>
<p><b>Bus Synchronization </b></p>
<p>In  order to  synchronize  networks  for a  synchronized  shutdown  it  might  be  necessary  to </p>
<p>transmit an asynchronous NM message to reset the network timers. This can be done by </p>
<p>calling the service:  </p>
<p>Nm_ReturnType <b>CanNm_RequestBusSynchronization </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.5.2.8.1) </p>
<p>However this service shall only be called within Network Mode. </p>
<p><b>3.10 </b></p>
<p><b>Limp Home Indication and Cancellation </b></p>
<p>If in Normal Operation state a NM message could not be transmitted and no NM message </p>
<p>is  received  for  a  configurable  amount  of  time AUTOSAR  just  provides  the  possibility  of </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>31 / 99 </p>
<p>error reporting to the DET and DEM if error reporting is enabled. Therefore the CAN NM </p>
<p>provides the possibility of an additional error reporting via the callback </p>
<p>void <b>Nm_LimpHomeIndication </b>(  </p>
<p> </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.2.1) </p>
<p>to the upper layer. </p>
<p>If  a  NM  message  was  successfully  transmitted  or  received  or  the  Network  Mode  is  left </p>
<p>after ‘Limp Home Indication’ the NM Interface is notified by calling </p>
<p>void <b>Nm_LimpHomeCancelation </b>(  </p>
<p> </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.8.2.1) </p>
<p>Additionally the Limp Home status can be checked by a call of </p>
<p>Nm_ReturnType <b>CanNm_CheckLimpHomeIndication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>boolean* const nmLimpHomeIndPtr ) </p>
<p>(5.8.2.1) </p>
<p>Please  note  that this feature  is additional  and  can only  be  enabled  if explicitly  available </p>
<p>(see also chapter 3.1 ‘Overview of the Functional Scope’). </p>
<p><b>3.11 </b></p>
<p><b>Coordinator Synchronization Support </b></p>
<p>For supporting the NM Interface Coordination Extension with more than one coordinator </p>
<p>connected to the same channel it is necessary to provide three additional bits in the CBV. </p>
<p>Therefore the service call </p>
<p>Nm_ReturnType <b>CanNm_SetCoordBits </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>const uint8 nmCoordBits ) </p>
<p>(5.5.3.2) </p>
<p>allows to set and clear those bits. The following table shows all values for setting those bits </p>
<p>and the corresponding symbol defined in the </p>
<p>NmStack_Types.h</p>
<p>: </p>
<p><b>Value </b></p>
<p><b>Symbol </b></p>
<p><b>Corresponding Bit </b></p>
<p>0x08 </p>
<p>NM_COORD_BIT_SLEEP </p>
<p>Announce Sleep Bit; Bit 3 in the CBV </p>
<p>0x06 </p>
<p>NM_COORD_BIT_PRIO_MASK </p>
<p>Two Priority Bits; Bit 1 and 2 in the CBV </p>
<p>0x0E </p>
<p>NM_COORD_BIT_MASK </p>
<p>All three Coordination Bits; Bit 1 – 3 in the CBV </p>
<p>Table 3-5  </p>
<p>NM Coordination Bits </p>
<p>For clearing the bits any value that does not contain one of the three coordination bits set </p>
<p>can be used, e.g. 0x00. </p>
<p>If a message is received where at least the priority bits are set, the following callback to </p>
<p>the NM Interface is called correspondingly: </p>
<p>void <b>Nm_ActiveCoordIndication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>const uint8 nmCoordPrio, </p>
<p> </p>
<p> </p>
<p>const uint8 nmSleepInd )  </p>
<p>(5.8.2.2) </p>
<p>Please note that this feature is additional and can only be enabled if explicitly available. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>32 / 99 </p>
<p> </p>
<p><b>Caution </b></p>
<p>The ‘Coordinator Extension Support’ requires the Control Bit Vector. </p>
<p>Therefore this feature has to be enabled if the Coordination Extension Support is used. </p>
<p> </p>
<p><b>3.12 </b></p>
<p><b>Error Handling </b></p>
<p><b>3.12.1 </b></p>
<p><b>Development Error Detection </b></p>
<p>Reporting  of  development  errors  is  configurable  (refer  to  chapter </p>
<p>6.3.1  ‘Component </p>
<p>Configuration’). </p>
<p><b>3.12.1.1 </b></p>
<p><b>Det_ReportError </b></p>
<p>Development errors are reported by the service </p>
<p>void <b>Det_ReportError </b>(  </p>
<p> </p>
<p>uint16 ModuleId, uint8 InstanceId, </p>
<p> </p>
<p>uint8 ApiId, uint8 ErrorId ) </p>
<p>(5.6) </p>
<p>Please </p>
<p>refer </p>
<p>to </p>
<p>the </p>
<p>documentation </p>
<p>of </p>
<p>the </p>
<p>development </p>
<p>error </p>
<p>tracer </p>
<p>[4] </p>
<p>for </p>
<p>further </p>
<p>information and a detailed description of the API. The module Id, API Ids and error Ids can </p>
<p>be found within the software components’ header file. </p>
<p><b>3.12.1.2 </b></p>
<p><b>Error Codes </b></p>
<p>CAN NM reports the following error codes to the Development Error Tracer: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x01 </p>
<p>CANNM_E_NO_INIT </p>
<p>API service used without module initialization. </p>
<p>0x02 </p>
<p>CANNM_E_INVALID_CHANNEL </p>
<p>API service used with wrong channel handle. </p>
<p>0x03 </p>
<p>CANNM_E_INIT_FAILED</p>
<p>3</p>
<p> </p>
<p>NM initialization has failed. </p>
<p>0x05 </p>
<p>CANNM_E_CANIF_TRANSMIT_ERROR</p>
<p>3</p>
<p> </p>
<p>Call of function </p>
<p>CanIf_Transmit</p>
<p> has failed. </p>
<p>0x11 </p>
<p>CANNM_E_DEV_NETWORK_TIMEOUT </p>
<p>NM-Timeout Timer has abnormally expired </p>
<p>outside of the Ready Sleep State. </p>
<p>0x12 </p>
<p>CANNM_E_NULL_POINTER</p>
<p>4</p>
<p> </p>
<p>Null pointer has been passed as an argument. </p>
<p>0x20 </p>
<p>CANNM_E_RXINDICATION_DLC_ERROR</p>
<p>5</p>
<p> </p>
<p>DLC of received NM message does not match </p>
<p>with configured PDU Length. </p>
<p>0x21 </p>
<p>CANNM_E_PDUR_TRIGGERTX_ERROR</p>
<p>5</p>
<p> </p>
<p>Call of function PduR_TriggerTransmit failed. </p>
<p>Table 3-6  </p>
<p>DET Error Codes of CAN NM </p>
<p><b>3.12.2 </b></p>
<p><b>Diagnostic Event Manager </b></p>
<p>Production </p>
<p>errors </p>
<p>are </p>
<p>reported </p>
<p>to </p>
<p>the </p>
<p>diagnostic </p>
<p>event </p>
<p>manager </p>
<p>if </p>
<p>the </p>
<p>CANNM_PROD_ERROR_DETECT</p>
<p> </p>
<p>switch </p>
<p>is </p>
<p>set </p>
<p>to </p>
<p>STD_ON </p>
<p>(refer </p>
<p>to </p>
<p>chapter </p>
<p>6.3.1 </p>
<p>‘Component Configuration’). </p>
<p>                                            </p>
<p>3</p>
<p> This error is only reported if the ‘Dem2Det Enabled’ switch is enabled. The error is specified as </p>
<p>development error in AUTOSAR Release 3.2. </p>
<p>4</p>
<p> Error does not apply to the function </p>
<p>CanNm_Init</p>
<p>. </p>
<p>5</p>
<p> Vector extension </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>33 / 99 </p>
<p><b>3.12.2.1 </b></p>
<p><b>Dem_ReportErrorStatus </b></p>
<p>Reporting errors to the diagnostic event manager is done by the service </p>
<p>void <b>Dem_ReportErrorStatus </b>(  </p>
<p> </p>
<p>uint8 ErrorId, uint8 StatusId ) </p>
<p>(5.6) </p>
<p>Please </p>
<p>refer </p>
<p>to </p>
<p>the </p>
<p>documentation </p>
<p>of </p>
<p>the </p>
<p>diagnostic </p>
<p>event </p>
<p>manager </p>
<p>[5] </p>
<p>for </p>
<p>further </p>
<p>information and a detailed description of the API. The error Ids and the status Ids can be </p>
<p>found within the diagnostic event manager components’ header file. </p>
<p><b>3.12.2.2 </b></p>
<p><b>Error Codes </b></p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>CANNM_E_INIT_FAILED</p>
<p>6</p>
<p> </p>
<p>NM initialization has failed. </p>
<p>CANNM_E_CANIF_TRANSMIT_ERROR</p>
<p>6</p>
<p> </p>
<p>Call of Can Interface function </p>
<p>CanIf_Transmit</p>
<p> </p>
<p>has failed </p>
<p>CANNM_E_NETWORK_TIMEOUT </p>
<p>NM-Timeout Timer has abnormally expired outside </p>
<p>of the Ready Sleep State. </p>
<p>Table 3-7  </p>
<p>DEM Error Codes of CAN NM </p>
<p><b>3.13 </b></p>
<p><b>Multiple ECU Support </b></p>
<p>The CAN NM supports Multiple ECU configuration when the configuration in GENy is done </p>
<p>with  an  AUTOSAR  ECU  configuration  file.  Refer  to  [9]  for  more  information  about  the </p>
<p>Multiple ECU feature. </p>
<p>When this feature is used by applying an appropriate ECU configuration file in GENy, the </p>
<p>generated  code  will  contain  multiple  configuration  structures.  When  initializing  the  CAN </p>
<p>NM  the  active  ECU  must  be  chosen by  passing  the  corresponding  pointer to  the  active </p>
<p>configuration within the initialization function </p>
<p>void <b>CanNm_Init </b>(  </p>
<p> </p>
<p>const CanNm_ConfigType * const nmConfigPtr ) </p>
<p>(5.5.1.1) </p>
<p>Refer also to chapter 4.4 ‘Initialization’. </p>
<p>For CAN NM the ‘Msg Cycle Offset’, the ‘Msg Reduced Time’, the CAN NM transmission </p>
<p>message handle (i.e. for each ECU instance one CAN NM message must be available in </p>
<p>the  configuration)  and  the  parameter  ‘Node  Id’  are  different  depending  on  the  active </p>
<p>configuration. </p>
<p>Refer to chapter 6.3.2 for more details about these configuration settings. </p>
<p>                                            </p>
<p>6</p>
<p> This error is only reported if the ‘Dem2Det Enabled’ switch is disabled. The error is specified as production </p>
<p>error in AUTOSAR Release 3.0 and Release 3.1. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>34 / 99 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Note that if the NM User Data via Com feature (see also chapter 3.15) is used in </p>
<p>combination with the Multiple ECU Support, a PDU Overlay has to be created for the </p>
<p>NM User Data TX I-PDU. Refer to chapter 3.15.1.1 for details. </p>
<p>The PDU Overlay has to be used, because the NM User Data TX I-PDU is always the </p>
<p>same object independent of the currently active ECU (determined by the pointer value </p>
<p>passed to CanNm_Init). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.14 </b></p>
<p><b>Multiple Configuration Support </b></p>
<p>The CAN NM can be used in multiple configuration environments when the configuration in </p>
<p>GENy is done with an AUTOSAR ECU configuration file. No special support is provided </p>
<p>except  that  the  main  function  can  be  called  even  if  the  initialization  was  not  performed </p>
<p>because CAN NM is not active in the chosen identity. In such a case the main function </p>
<p>does  not  perform  any  actions.  Also  no  DET  error  is  notified  (refer  to  chapter  3.12.1 </p>
<p>‘Development Error Detection’). </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The CAN NM implementation assumes that no function (except the main function) will </p>
<p>be called for channels that are not active in the selected identity. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>In  contradiction  to  the feature  ‘Multiple  ECU  Support’  only  one  configuration  is available </p>
<p>which has to be used for all identities. </p>
<p><b>3.15 </b></p>
<p><b>NM User Data via Com </b></p>
<p>The CAN NM supports the possibility to write the NM user data via Com signals. Therefore </p>
<p>the signals have to be provided within an extra I-PDU in the configuration. The CAN NM </p>
<p>updates its transmission buffer each time before sending a NM message with the current </p>
<p>data. Therefore it calls the function: </p>
<p>void <b>PduR_CanNmTriggerTransmit </b>(  </p>
<p> </p>
<p>PduIdType ComTxPduId, uint8 * CanNmSduPtr ) </p>
<p>(5.6) </p>
<p>When the NM message has been successfully transmitted the confirmation is forwarded to </p>
<p>by calling the function: </p>
<p>void <b>PduR_CanNmTxConfirmation </b>(  </p>
<p> </p>
<p>PduIdType ComTxPduId ) </p>
<p>(5.6) </p>
<p>Depending on the signal and I-PDU configuration a signal change can lead to a request for </p>
<p>an immediate NM message transmission by calling the function </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>35 / 99 </p>
<p>void <b>CanNm_Transmit </b>(  </p>
<p> </p>
<p>PduIdType CanNmTxPduId, </p>
<p> </p>
<p>const PduInfoType * PduInfoPtr ) </p>
<p>(5.5.2.10.1) </p>
<p>The  CAN  NM  then  transmits  the  changed  data  in  the  next  main  function  when  the </p>
<p>transmission of NM messages is allowed. This behavior is given in Figure 3-3. Afterwards </p>
<p>the message cycle timer is restarted, i.e. the cyclic message transmission raster changes. </p>
<p>The  spontaneous  transmission  through  CanNm_Transmit  is  allowed  in  the  NM  states </p>
<p>Repeat Message and Normal Operation if and only if </p>
<p><b>&gt; </b></p>
<p>‘Pn Enabled’ is ON and ‘Pn Handle Multiple Network Requests’ is OFF AND/OR </p>
<p><b>&gt; </b></p>
<p>‘Car Wake Up Rx Enabled’ is ON. </p>
<p> </p>
<p>Figure 3-3 </p>
<p>Immediate Transmission due to Signal Change inside User Data I-PDU </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Note that this feature can be currently only configured when using an AUTOSAR ECU </p>
<p>configuration file. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>The  following  chapters  describe  more  detailed  the  configuration  preconditions  of  this </p>
<p>feature.  How this feature is configured in GENy can be found in chapter  6.3.2 ‘Channel </p>
<p>Configuration’. </p>
<p>Note that some additional configuration for this feature has to be done in the PDU router. </p>
<p>Refer to [10] for details. </p>
<p><b>3.15.1 </b></p>
<p><b>Configuration Preconditions in an AUTOSAR ECU Configuration </b></p>
<p>For using the feature ‘NM User Data via Com’ some additional configuration content within </p>
<p>the AUTOSAR  system  description  extract  is  necessary.  The  following  table  provides  an </p>
<p>overview of the items that have to be added to the system description. </p>
<p><b>Configuration Element </b></p>
<p><b>Description </b></p>
<p>Signal I-PDU </p>
<p>For each NM message one signal I-PDU must be configured. An </p>
<p>appropriate signal mapping to the I-Signals has to be defined here. I-</p>
<p>PDUs are defined in the ECU-specific part. </p>
<p>t</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with CanNm_Transmit usage</p>
<p>0</p>
<p>Repeat Message</p>
<p>Normal Operation</p>
<p>...</p>
<p>CanNm_Transmit</p>
<p>Msg Cycle Time</p>
<p>CanNm_Transmit</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>36 / 99 </p>
<p><b>Configuration Element </b></p>
<p><b>Description </b></p>
<p>I-Signal </p>
<p>Multiple system signals can be defined for each NM message. At </p>
<p>least one signal is required. I-Signals are defined in the ECU-specific </p>
<p>part and refer to a system signal. </p>
<p>System Signal </p>
<p>For each I-Signal a corresponding system signal is necessary which </p>
<p>defines length, data type and initial value. </p>
<p>I-PDU Port </p>
<p>For each I-PDU an I-PDU port with the communication direction </p>
<p>‘OUT’ is required. </p>
<p>Signal Port </p>
<p>For each signal a signal port with the communication direction ‘OUT’ </p>
<p>is required. </p>
<p>I-PDU Triggering </p>
<p>For each I-PDU an I-PDU triggering is required that references to the </p>
<p>corresponding I-PDU port and the signal I-PDU. </p>
<p>Signal Triggering </p>
<p>For each I-Signal a signal triggering is required that references to the </p>
<p>corresponding signal port and I-Signal. </p>
<p>Table 3-8  </p>
<p>Configuration Precondition Overview for AUTOSAR ECU Configurations </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Changing the AUTOSAR System Description or AUTOSAR ECU Extract is usually not </p>
<p>the task of the user. This is the task of the OEM. </p>
<p>Note that the AUTOSAR System Description and AUTOSAR ECU Extracts may even </p>
<p>be generated by the Vector toolchain from other input files (e.g. dbc) and these files </p>
<p>already contain this information. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Additional a  reference  from  the  NM  PDU  to  the  related  I-PDU  with  the  signals  must  be </p>
<p>established. This can be accomplished by </p>
<p><b>&gt; </b></p>
<p>adding ‘Admin Data’ to the NM PDU. This applies to ECU Extracts for AUTOSAR </p>
<p>versions less than 3.2. The following an example of how this should be done: </p>
<p>&lt;NM-PDU&gt; </p>
<p> </p>
<p>&lt;SHORT-NAME&gt;NM_PDU&lt;/SHORT-NAME&gt; </p>
<p> </p>
<p>&lt;ADMIN-DATA&gt; </p>
<p> </p>
<p> </p>
<p>&lt;SDGS&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;SDG GID=&quot;DV:SIGNAL-I-PDU-REF&quot;&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p> &lt;SD&gt;/ECU/PDUS/APPL_NM_UD_1_TGW&lt;/SD&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;/SDG&gt; </p>
<p> </p>
<p> </p>
<p>&lt;/SDGS&gt; </p>
<p> </p>
<p>&lt;/ADMIN-DATA&gt; </p>
<p> </p>
<p>&lt;LENGTH&gt;64&lt;/LENGTH&gt; </p>
<p>&lt;/NM-PDU&gt; </p>
<p><b>&gt; </b></p>
<p>adding ‘ISignalToIPduMappings’ to the NM PDU. This applies to ECU Extracts for </p>
<p>AUTOSAR versions greater than or equal to 3.2. Note that the Vector toolchain </p>
<p>automatically creates a Signal I-PDU containing the signals provided in the </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>37 / 99 </p>
<p>‘ISignalToIPduMappings’ list in the AUTOSAR ECU Configuration. The short name of </p>
<p>this created I-PDU is the concatenation of the short name of the NM-PDU and the </p>
<p>suffix ‘_UD’. The following example demonstrates how this should be done </p>
<p>(NM_PDU_UD will be the short name of the Signal I-PDU): </p>
<p>&lt;NM-PDU&gt; </p>
<p>  &lt;SHORT-NAME&gt;NM_PDU&lt;/SHORT-NAME&gt; </p>
<p>  &lt;LENGTH&gt;8&lt;/LENGTH&gt; </p>
<p>  &lt;I-SIGNAL-TO-I-PDU-MAPPINGS&gt; </p>
<p>    &lt;I-SIGNAL-TO-I-PDU-MAPPING&gt; </p>
<p>      &lt;SHORT-NAME&gt;NM_USR_DT&lt;/SHORT-NAME&gt; </p>
<p>        &lt;PACKING-BYTE-ORDER&gt;MOST-SIGNIFICANT-BYTE-LAST&lt;/PACKING-</p>
<p>BYTE-ORDER&gt; </p>
<p>        &lt;SIGNAL-REF DEST=&quot;I-</p>
<p>SIGNAL&quot;&gt;/ISignal/NM_USR_DT_SIGNAL&lt;/SIGNAL-REF&gt; </p>
<p>        &lt;START-POSITION&gt;32&lt;/START-POSITION&gt; </p>
<p>    &lt;/I-SIGNAL-TO-I-PDU-MAPPING&gt; </p>
<p>  &lt;/I-SIGNAL-TO-I-PDU-MAPPINGS&gt; </p>
<p>&lt;/NM-PDU&gt; </p>
<p><b>3.15.1.1 </b></p>
<p><b>Caveats for Multiple ECU Support </b></p>
<p>If  Multiple  ECU  Support  is  used  in  the  ECU  Configuration,  a  PDU  Overlay  has  to  be </p>
<p>created by the user for the NM TX PDU. Refer to [9] for details about creating such a PDU </p>
<p>Overlay for the Physical Multiple ECU Use Case. </p>
<p>For  AUTOSAR  versions  3.2  the  Signal  I-PDU  which  has  to  be  configured  for  a  PDU </p>
<p>Overlay  cannot  be  found  directly  inside  the  ECU  Extract,  it  is  created  by  the  Vector </p>
<p>toolchain  during  the  creation  of  the AUTOSAR  ECUC.  The  short  name  of  the  NM-PDU </p>
<p>(“NM_PDU” in the example above) has to be used for configuring the PDU Overlay. </p>
<p><b>3.15.2 </b></p>
<p><b>Configuration Preconditions in a DBC Based Configuration </b></p>
<p>The configuration of this feature via DBC is not supported. </p>
<p><b>3.16 </b></p>
<p><b>QNX Support </b></p>
<p>The AUTOSAR CAN NM provides QNX support. </p>
<p>This feature can be used in ECUs where the main operating system has a long booting </p>
<p>time  and  until  the  system  has  booted  a  so  called  mini-driver  containing  parts  of  the </p>
<p>communication </p>
<p>stack </p>
<p>takes </p>
<p>care </p>
<p>of </p>
<p>the </p>
<p>basic </p>
<p>communication </p>
<p>tasks.  After </p>
<p>the </p>
<p>main </p>
<p>operating  system  is  running  the  state  of  the  mini-driver  shall  be  transferred  so  that  the </p>
<p>main  system  can  take  over  the  already  started  communication.  Therefore  the  API  for </p>
<p>getting the module context has to be available in the mini-driver and the API for the setting </p>
<p>of the module context has to be available in the main system. </p>
<p>This feature is not described in detail here as it is part of the Vector QNX wrapper module </p>
<p>and shall only be used by this module. Details can be found in the corresponding technical </p>
<p>reference of the QNX wrapper module. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>38 / 99 </p>
<p><b>3.17 </b></p>
<p><b>Extended Bus Synchronization </b></p>
<p>If </p>
<p>this </p>
<p>feature </p>
<p>is </p>
<p>enabled </p>
<p>the </p>
<p>following </p>
<p>API </p>
<p>is </p>
<p>available </p>
<p>independently </p>
<p>from </p>
<p>‘Bus </p>
<p>Synchronization Enabled’: </p>
<p>void <b>CanNm_RequestBusSynchronization </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle ) </p>
<p>(5.5.2.8.1) </p>
<p>This API can be used by the application to perform additional NM message transmissions </p>
<p>in the start-up phase to reduce start-up delays of other nodes. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The API shall only be called by the application during start-up phase. It is strictly </p>
<p>recommended to call this API not when the NM already has entered ‘Ready Sleep </p>
<p>State’, especially when the coordination feature is used. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>This  feature  is  optional  and  has  to  be  configured  (refer  to  chapter  6.3.1  ‘Component </p>
<p>Configuration’). </p>
<p><b>3.18 </b></p>
<p><b>Gateway Extension Support </b></p>
<p>The  gateway  extension  support  contains  two  optional  features  that  can  be  enabled </p>
<p>separately in the configuration, the ‘NM Gateway Extension Support’ and the ‘Diagnostic </p>
<p>Gateway Extension Support’. </p>
<p>When  ‘NM  Gateway  Extension  Support’  or  ‘Diagnostic  Gateway  Extension  Support’  is </p>
<p>enabled then CAN NM provides the following additional callback to the application each </p>
<p>time a NM message is received: </p>
<p>void </p>
<p><b>Nm_GwPduRxIndication</b></p>
<p><b> </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>uint8 nmNodeId, uint8 nmReqId, uint8 nmReqCh ) </p>
<p>(5.8.2.3) </p>
<p>Within this callback the node identifier, byte 4 (requested identifier) and byte 5 (requested </p>
<p>channels) of the NM message are passed to the NM Interface. </p>
<p>When ‘Diagnostic Gateway Extension Support’ is enabled then additionally the following </p>
<p>service function is provided by the CAN NM:  </p>
<p>Nm_ReturnType </p>
<p><b>CanNm_SetDiagGwReqId</b></p>
<p><b> </b>( uint8 nmReqId ) </p>
<p>(5.5.3.4) </p>
<p>If this function is called by the NM Interface CAN NM sets byte 4 in the NM transmission </p>
<p>data buffer with the passed identifier and requests an additional NM message transmission </p>
<p>on all CAN NM channels. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>39 / 99 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Note that an additional NM message transmission can only be performed when the </p>
<p>CAN NM is in state ‘Repeat Message’ or ‘Normal Operation’. Otherwise the request is </p>
<p>discarded. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>More  information  about  the  configuration  of  the  features  can  be  found  in  chapter  6.3.1 </p>
<p>‘Component Configuration’. </p>
<p><b>3.19 </b></p>
<p><b>Active Wake-up Handling </b></p>
<p>The mode  change from Bus-Sleep  Mode  or  Prepare Bus-Sleep Mode to  Network Mode </p>
<p>triggered  by </p>
<p>CanNm_NetworkRequest()</p>
<p>  is  specified  as  “Active  Wake-up”.  Upon  an </p>
<p>Active Wake-up the CAN NM sets the active wake-up bit within the Control Bit Vector at bit </p>
<p>position 4. </p>
<p>This  feature  is  optional  and  has  to  be  configured.  For  configuration  information  refer  to </p>
<p>chapter 6.3.1 ‘Component Configuration’ and chapter 6.3.2 ‘Channel Configuration’. </p>
<p><b>3.20 </b></p>
<p><b>Immediate Nm Transmissions </b></p>
<p>If an Active Wake-up occurs the CAN NM transmits the first NM message immediately (the </p>
<p>NM message offset time is ignored) when entering Repeat Message State. For the next </p>
<p>NM  messages  CAN  NM  uses  a  faster  NM  message  cycle  time.  Afterwards  it  uses  the </p>
<p>normal NM message cycle time. This behavior is illustrated in Figure 3-4. </p>
<p> </p>
<p>Figure 3-4 </p>
<p>Immediate Nm Transmissions </p>
<p>The  number  of  ‘Immediate  Nm  Transmissions’  is  the  number  that  is  configured  for  this </p>
<p>parameter </p>
<p>in </p>
<p>the </p>
<p>channel </p>
<p>settings </p>
<p>in </p>
<p>GENy </p>
<p>(see </p>
<p>also </p>
<p>chapter </p>
<p>6.3.2 </p>
<p>‘Channel </p>
<p>Configuration’). As it can be seen in Figure 3-4, after the first Immediate Nm Transmission </p>
<p>the interval between the NM messages is ‘Immediate Nm CycleTime’ for <i>(n-1) </i>times. Then, </p>
<p>the usual interval ‘Msg Cycle Time’ is used again. </p>
<p>Note  that  “Any  state  except  Repeat  Message”  in  Figure  3-4  refers  to  ‘Bus  Sleep’  and </p>
<p>‘Prepare Bus Sleep’. If the setting ‘Pn Handle Multiple Network Requests’ is ON, it also </p>
<p>refers to ‘Ready Sleep’ and ‘Normal Operation’. </p>
<p>t</p>
<p>Any state except</p>
<p>Repeat Message</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with n := Immediate Nm Transmissions &gt; 0</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_NetworkRequest</p>
<p>1st</p>
<p>2nd</p>
<p>3rd</p>
<p>(n-1)th</p>
<p>nth</p>
<p>Msg Cycle Time</p>
<p>...</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>40 / 99 </p>
<p>This  feature  is  optional  and  has  to  be  enabled  in  the  configuration.  The  amount  of </p>
<p>messages </p>
<p>that </p>
<p>are </p>
<p>transmitted </p>
<p>faster </p>
<p>(‘Immediate </p>
<p>Nm  Transmissions’) </p>
<p>and </p>
<p>the </p>
<p>fast </p>
<p>message cycle time (‘Immediate Nm CycleTime’) can also be configured. Refer to chapter </p>
<p>6.3.1 </p>
<p>‘Component </p>
<p>Configuration’ </p>
<p>and </p>
<p>chapter </p>
<p>6.3.2 </p>
<p>‘Channel </p>
<p>Configuration’ </p>
<p>for </p>
<p>configuration details. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>This feature should not be confused with the possibility for an immediate transmission if </p>
<p>the ‘Com User Data Enabled’ feature is on (chapter 3.15) and should also not be </p>
<p>confused with the ‘Immediate Restart Enabled’ feature described in the following </p>
<p>chapter. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If the send request of an ‘immediate transmission’ is rejected by the lower layer (e.g. </p>
<p>CanIf), the rejected send request is not considered as ‘immediate transmission’. That </p>
<p>means that the counter that counts the number of ‘immediate transmissions’ </p>
<p><i>ImmediateNmMsgCount </i>is not decremented. </p>
<p>Example: Let ‘Immediate Nm Transmissions’ := 2. The initial counter value of </p>
<p><i>ImmediateNmMsgCount </i>is 1. </p>
<p>1. </p>
<p>When Repeat Message has just been entered, the first transmission request </p>
<p><i>TReq</i></p>
<p><i>A</i></p>
<p> is rejected. <i>ImmediateNmMsgCount </i>is not decremented. </p>
<p>2. </p>
<p>CanNm waits ‘Immediate Msg CycleTime’ (first interval <i>t</i></p>
<p><i>int1st</i></p>
<p>). </p>
<p>3. </p>
<p>CanNm sends the NM message successfully. <i>ImmediateNmMsgCount </i>is </p>
<p>decremented to 0. </p>
<p>4. </p>
<p>CanNm waits ‘Immediate Msg CycleTime’ again (second interval <i>t</i></p>
<p><i>int2nd</i></p>
<p>). </p>
<p>5. </p>
<p>CanNm sends the next NM message successfully. </p>
<p>6. </p>
<p>Then ‘Msg Cycle Time’ is waited until the next NM message is sent because </p>
<p><i>ImmediateNmMsgCount </i>is already 0. </p>
<p>If the first NM transmission request <i>TReq</i></p>
<p><i>A</i></p>
<p> was successful (step 1), the second interval </p>
<p>time <i>t</i></p>
<p><i>int2nd</i></p>
<p> would be ‘Msg Cycle Time’ instead of ‘Immediate Msg CycleTime’. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.21 </b></p>
<p><b>Immediate Restart Enabled </b></p>
<p>This feature enables the possibility to send an additional NM message upon the transition </p>
<p>from Prepare Bus Sleep to Repeat Message if and only if the network is requested actively </p>
<p>(e.g. there is a request for Full Communication in ComM). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>41 / 99 </p>
<p> </p>
<p>Figure 3-5 </p>
<p>Behavior for NM Transmissions if Immediate Restart Enabled is ON </p>
<p>This  behavior  is  depicted  in  Figure  3-5.  Note  that  the  only  difference  to  the  standard </p>
<p>transmission  behavior  (i.e.  ‘Immediate  Restart  Enabled’  would  be  OFF,  for  the  behavior </p>
<p>see  also  chapter  3.5.3)  is  the  additional  NM  message  right  after  Repeat  Message  has </p>
<p>been entered. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The additional NM message is only sent if the ‘Msg Cycle Offset’ setting is greater than </p>
<p>0 and if ‘Immediate Nm Transmissions’ = 0 (refer to chapter 3.20 for details). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.22 </b></p>
<p><b>Car Wake-up </b></p>
<p>Every  ECU  shall  be  able  to  wake  up  all  other  ECUs  of  the  car.  This  wake-up  request </p>
<p>information is contained in the NM message user data of an ECU. The central gateway </p>
<p>ECU </p>
<p>evaluates </p>
<p>the </p>
<p>Car </p>
<p>Wake-up </p>
<p>request </p>
<p>information </p>
<p>and </p>
<p>wakes </p>
<p>up </p>
<p>all </p>
<p>connected </p>
<p>communication channels. </p>
<p>This </p>
<p>feature </p>
<p>is </p>
<p>optional </p>
<p>and </p>
<p>has </p>
<p>to </p>
<p>be </p>
<p>configured. </p>
<p>Further </p>
<p>information </p>
<p>about </p>
<p>the </p>
<p>configuration can be found in chapter 6.3.1 ‘Component Configuration’ and chapter 6.3.2 </p>
<p>‘Channel Configuration’. </p>
<p><b>3.22.1 </b></p>
<p><b>Rx-Path </b></p>
<p>If  the  CAN  NM  receives  a  NM  message  it  evaluates  the  user  data  content.  If  the  Car </p>
<p>Wake-up Bit is set and the Node ID passes a filter (if Node ID filter is enabled) the CAN </p>
<p>NM notifies the NM via the following callback function: </p>
<p>void </p>
<p><b>Nm_CarWakeUpIndication</b></p>
<p><b> </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle</p>
<p> ) </p>
<p>(5.8.1) </p>
<p> </p>
<p><b>3.22.2 </b></p>
<p><b>Tx-Path </b></p>
<p>For the transmission of the Car Wake-up Bit it has to be set at the corresponding location </p>
<p>within  the  NM  user  data.  If  the  feature  ‘NM  User  Data  via  Com’  is  used  and  the </p>
<p>corresponding signal and I-PDU are configured for directly transmitting a changed signal </p>
<p>the information is sent immediately. Refer also to chapter 3.15 ‘NM User Data via Com’. </p>
<p>t</p>
<p>Prepare Bus Sleep</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with Immediate Restart Enabled</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_NetworkRequest</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>42 / 99 </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>It is recommended to use the feature ‘NM User Data via Com’ for the transmission </p>
<p>path. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.23 </b></p>
<p><b>Partial Networking </b></p>
<p>To </p>
<p>reduce </p>
<p>the </p>
<p>power </p>
<p>consumption </p>
<p>of </p>
<p>ECUs </p>
<p>it </p>
<p>shall </p>
<p>be </p>
<p>possible </p>
<p>to </p>
<p>switch </p>
<p>off </p>
<p>the </p>
<p>communication  stack  during  active  bus  communication.  To  control  the  shutdown  and </p>
<p>wake-up of such ECUs the CAN NM provides an additional algorithm. The NM message </p>
<p>user  data  contains  the  information  which  partial  networks  (PN)  are  requested.  This </p>
<p>information is evaluated by the CAN NM and provided to the upper layer in an aggregated </p>
<p>form by updating the content of additional I-PDUs in the Com. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The configuration setting ‘Com User Data Enabled’ has to be enabled to use the Partial </p>
<p>Networking feature. Refer to chapter 3.15 for more details about the ‘NM User Data via </p>
<p>Com’ feature. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Algorithm details are described in the following sub-chapters. </p>
<p>This  feature  and  all  of  its  sub-features  are  optional  and  have  to  be  configured.  For </p>
<p>configuration  information  refer  to  chapter  6.3.1  ‘Component  Configuration’  and  chapter </p>
<p>6.3.2 ‘Channel Configuration’. </p>
<p><b>3.23.1 </b></p>
<p><b>Availability of Partial Network Request Information </b></p>
<p>To distinguish between NM messages containing PN cluster request information (CRI) and </p>
<p>NM messages without CRI a special bit in the control bit vector (bit 6) is used. Only if this </p>
<p>bit is set the NM message contains PN information and will be processed by the algorithm. </p>
<p><b>3.23.2 </b></p>
<p><b>Transmission of the CRI Bit in the NM User Data </b></p>
<p>The  CAN  NM  sets  the  CRI  Bit  at  bit  position  6  in  the  Control  Bit  Vector  to  1  for  each </p>
<p>channel if the Partial Networking feature is enabled on the corresponding channel. </p>
<p><b>3.23.3 </b></p>
<p><b>Filter Algorithm for Received NM Messages </b></p>
<p>NM messages that are not relevant for an ECU with PN must be dropped. Therefore the </p>
<p>content of received NM messages is evaluated after the filter algorithm described in this </p>
<p>section has been activated. Otherwise the usual way of receiving messages is being used. </p>
<p>The filter is disabled after the initialization of the CAN NM module. The message reception </p>
<p>filter  is  being  activated  after  a  call  of  CanNm_ConfirmPnAvailability  (refer  to  chapter </p>
<p>5.5.2.11.1 </p>
<p>‘CanNm_ConfirmPnAvailability: </p>
<p>Notification </p>
<p>for </p>
<p>activating </p>
<p>the </p>
<p>PN </p>
<p>filter </p>
<p>functionality’  for  further  details).  If  Bus  Sleep  Mode  is  being  entered,  the  filter  is  being </p>
<p>disabled. The filter algorithm works as follows: </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>43 / 99 </p>
<p>If the CRI bit is cleared the NM message is not relevant for the ECU. </p>
<p>If  the  CRI  bit  is  set  the  CAN  NM  evaluates  the  CRI  content  of  the  NM  message.  The </p>
<p>location and the length of the CRI in the NM user data can be configured. Each bit within </p>
<p>the  CRI  content  represents  one  cluster. The  corresponding  cluster  is  being  requested  if </p>
<p>and only if the bit that belongs to the cluster is set. Because not every cluster is relevant </p>
<p>for the ECU a configurable PN filter mask is applied to the CRI content. Irrelevant cluster </p>
<p>requests can be ignored by setting the corresponding bit in the filter to 0. If at least one bit </p>
<p>within  the  received  PN  information  matches  with  a  bit  in  the  PN  filter  mask  the  NM </p>
<p>message is relevant for the ECU, otherwise the NM message is not relevant for the ECU. </p>
<p>If a NM message is not relevant and the configuration parameter ’All Nm Messages Keep </p>
<p>Awake’ is true the standard NM message reception handling is done,  otherwise the NM </p>
<p>message is ignored. </p>
<p>If a NM message is relevant the CAN NM performs the standard NM message reception </p>
<p>and  additionally  the  filtered  PN  content  of  this  message  is  used  for  the  further  PN </p>
<p>algorithm. </p>
<p><b>3.23.4 </b></p>
<p><b>Aggregation of Requested Partial Networks </b></p>
<p>The  CAN  NM  aggregates  requested  PN  information  by  two  slightly  different  algorithms. </p>
<p>First  the  external  (received)  and  internal  (sent)  PN  requests  are  aggregated  over  all </p>
<p>networks  (channels)  to  a  combined  state  called  External  Internal  Requests Aggregated </p>
<p>(EIRA). Second only the external (received) PN requests are aggregated for each network </p>
<p>to  the  so  called  External  Requests  Aggregated  (ERA)  state.  Both  algorithms  can  be </p>
<p>activated independently in the configuration.  </p>
<p>For the EIRA algorithm every received or sent NM message on any network is evaluated </p>
<p>and  the  relevant  PN  information  (according  to  the  PN  filter  mask  and  the  CRI  bit)  is </p>
<p>combined  to  one  aggregated  state.  Therefore  this  state  contains  the  information  which </p>
<p>partial networks are active on the whole ECU. </p>
<p>The ERA algorithm performs the evaluation of the received NM messages and storage of </p>
<p>the relevant PN information (according to the PN filter mask and the CRI bit) per network. </p>
<p>Therefore the ERA state contains for each network the information which partial networks </p>
<p>are requested by other ECUs and have to be active due to external needs. </p>
<p>Whenever a cluster is requested the first time (i.e. a bit is set the first time within this PN </p>
<p>information) the new request is stored and a timer is started. When the request is repeated </p>
<p>before  the  timer  elapses  the  timer  is  restarted.  When  the  timer  elapses  the  request  is </p>
<p>deleted. </p>
<p>Any change (storing or deleting a request) within the EIRA or ERA leads to an update of </p>
<p>the  content  of  the  EIRA  or  ERA  I-PDU  in  the  Com.  Therefore  the  following  function  is </p>
<p>called with the corresponding EIRA or ERA PDU handle: </p>
<p>void <b>PduR_CanNmRxIndication </b>(  </p>
<p> </p>
<p>PduIdType ComTxPduId, uint8 * CanNmSduPtr ) </p>
<p>(5.6) </p>
<p>Note that one ERA I-PDU exists for each network. </p>
<p><b>3.23.5 </b></p>
<p><b>Spontaneous Sending of NM Messages </b></p>
<p>When  a  new  PN  is  internally  requested  the  corresponding  bit  in  the  NM  message  user </p>
<p>data  will  be  set.  This  request  must  be  immediately  visible  on  the  bus  by  sending  the </p>
<p>updated user data content as fast as possible. Therefore two mechanisms can be used. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>44 / 99 </p>
<p><b>3.23.5.1 </b></p>
<p><b>Using Com Transmission on Change Mechanism </b></p>
<p>When  the  NM  user  data  is  set  via  Com  the  signals  can  be  configured  for  immediate </p>
<p>transmission  on  change.  This  would  lead  to  one  additional  NM  message  transmission </p>
<p>whenever the content of the signal changes. Refer also to chapter 3.15 ‘NM User Data via </p>
<p>Com’. </p>
<p>To  enable  this  behavior,  the  setting  ‘Pn  Handle  Multiple  Network  Requests’  has  to  be </p>
<p>turned OFF (see also chapter 6.3.2). </p>
<p><b>3.23.5.2 </b></p>
<p><b>Using NM Request and Immediate Nm Transmission </b></p>
<p>When CAN NM is in Network Mode and the upper layer requests network again by calling </p>
<p>the function  ‘CanNm_NetworkRequest’  (see  chapter  5.5.2.4.1  ‘CanNm_NetworkRequest: </p>
<p>Request  the  Network’  for  details)  the  CAN  NM  performs  a  state  transition  to  Repeat </p>
<p>Message.  This  leads  to  an  immediate  transmission  of  the  NM  message  followed  by </p>
<p>several transmissions with a faster cycle time. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Note that the feature ‘Immediate Nm Transmission’ (refer to chapter 3.20 ‘Immediate </p>
<p>Nm Transmissions’) must be enabled when using this mechanism for spontaneous </p>
<p>sending of NM messages. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Note that this mechanism will only be active if PN feature is enabled. </p>
<p>To  enable  this  behavior,  the  setting  ‘Pn  Handle  Multiple  Network  Requests’  has  to  be </p>
<p>turned ON (see also chapter 6.3.2). </p>
<p><b>3.23.6 </b></p>
<p><b>Deactivation of Partial Networking during Run-Time </b></p>
<p>The whole Partial Network feature can be deactivated on all CAN NM channels during run-</p>
<p>time. To accomplish this, the function CanNm_DisablePNActivationState has to be called </p>
<p>after CanNm_Init and before the first call of CanNm_MainFunction_X.  </p>
<p>This allows the deactivation on all CAN NM channels. </p>
<p><b>3.24 </b></p>
<p><b>Usage of PduInfoType </b></p>
<p>Since AUTOSAR Release 3.2 APIs to the PduR or from the CanIf dealing with user data </p>
<p>shall  use  only  the  PduInfoType  for  passing  data  instead  of  passing  only  the  data. </p>
<p>PduInfoType does not only contain the pointer to the data buffer but also the length of the </p>
<p>passed  data.  Additionally  the  transmission  triggering  functions  shall  return  a  value  to </p>
<p>indicate whether the user data handling could be performed or failed. </p>
<p>This API type with PduInfoType parameters is supported by the CAN NM. The other API </p>
<p>type used in AUTOSAR Releases 3.0 and 3.1 is no longer supported by the CAN NM. </p>
<p>The CanNm calls or implements the following APIs that are affected by this feature: </p>
<p><b>&gt; </b></p>
<p>CanNm_RxIndication (refer to chapter 5.7.1.1 for details) </p>
<p><b>&gt; </b></p>
<p>PduR_CanNmTriggerTransmit (refer to chapter 5.6 for details) </p>
<p><b>&gt; </b></p>
<p>PduR_CanNmRxIndication (refer to chapter 5.6 for details) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>45 / 99 </p>
<p><b>4 </b></p>
<p><b>Integration </b></p>
<p><b>4.1 </b></p>
<p><b>Files </b></p>
<p>The CAN NM consists of the following files: </p>
<p><b>Files of CAN NM </b></p>
<p><b> </b></p>
<p>CanNm.c </p>
<p>Source code of CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm.h </p>
<p>API of CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Cbk.h </p>
<p>API of CAN NM callback functions. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Cfg.c </p>
<p>Pre-compile variant configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Cfg.h </p>
<p>Configuration header file for CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Lcfg.c </p>
<p>Link-time variant Configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Lcfg.h </p>
<p>Link-time variant Configuration header file. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Pbcfg.c </p>
<p>Post-build variant Configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>CanNm_Pbcfg.h </p>
<p>Post-build variant Configuration header file. </p>
<p>The user <b>must not </b>change this file! </p>
<p> </p>
<p>Table 4-1  </p>
<p>CAN NM Integration Files </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>46 / 99 </p>
<p><b>4.2 </b></p>
<p><b>Include Structure </b></p>
<p> </p>
<p>Figure 4-1 </p>
<p>Include Structure of CAN NM </p>
<p><b>4.3 </b></p>
<p><b>Version Changes </b></p>
<p>Changes and the release versions of the CAN NM are listed at the beginning of the header </p>
<p>and source code. </p>
<p><b>4.4 </b></p>
<p><b>Initialization </b></p>
<p>Before the CAN NM can be used it has to be initialized by the application. The initialization </p>
<p>has to be carried out before any other functionality of the CAN NM is executed. It shall </p>
<p>take  place  after  initialization  of  the  CAN  Interface  and  prior  to  initialization  of  the  NM </p>
<p>Interface. </p>
<p>Also refer to chapter 5.5.1.1 ‘CanNm_Init: Initialization of CAN NM’. </p>
<p><b>class IncludeStructure</b></p>
<p>CanNm_Cbk.h</p>
<p>CanIf.h</p>
<p>CanNm.c</p>
<p>CanNm.h</p>
<p>CanNm_Cfg.c</p>
<p>CanNm_Cfg.h</p>
<p>CanNm_Lcfg.c</p>
<p>CanNm_PBcfg.c</p>
<p>CanSM_Cbk.h</p>
<p>ComStack_Types.h</p>
<p>Compiler.h</p>
<p>Compiler_Cfg.h</p>
<p>Dem.h</p>
<p>Det.h</p>
<p>EcuM_Cbk.h</p>
<p>MemMap.h</p>
<p>NmStack_Types.h</p>
<p>Nm_Cbk.h</p>
<p>PduR_CanNm.h</p>
<p>SchM_CanNm.h</p>
<p>Std_Types.h</p>
<p>Platform_Types.h</p>
<p>v_ver.h</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>47 / 99 </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The CAN NM assumes that some variables are initialized with zero at start-up. If the </p>
<p>embedded target does not initialize RAM within the start-up code the function </p>
<p>‘CanNm_InitMemory’ has to be called during start-up and before the initialization is </p>
<p>performed. Refer also to chapter 3.1.2.3 ‘Memory Initialization’. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In an AUTOSAR environment where the ECU Manager is used, the initialization is </p>
<p>performed within the ECU Manager. When using the feature ‘Multiple ECU Support’ </p>
<p>multiple configurations exist and depending on which identity shall be active the correct </p>
<p>one has to be chosen. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In a CANbedded environment where the CCL is used the initialization is performed by </p>
<p>the CCL. ‘Multiple ECU Support’ is not possible in a CANbedded environment. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.5 </b></p>
<p><b>Main Functions </b></p>
<p>CAN NM contains one or more main functions that have to be called cyclic on task level. </p>
<p>Default  timing  value  therefore  is  10  milliseconds.  The  main  functions  are </p>
<p>generated </p>
<p>according to the number of CAN NM channels and have to be called individually for each </p>
<p>channel. The call cycle time value for the main functions has to be set in the configuration </p>
<p>settings (refer to chapter 6.3.2 ‘Channel Configuration’). It is not relevant in which order the </p>
<p>main functions are called.  </p>
<p>For  further  information  refer  also  to  chapter  5.5.1.2  ‘CanNm_MainFunction:  Channel </p>
<p>Specific Main Functions of CAN NM’. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In an AUTOSAR environment where the BSW Scheduler (SchM) is used the main </p>
<p>functions are called by the SchM and must not be called by the application. If the SchM </p>
<p>is available in GENy, the configuration of the cyclic task timing is automatically updated </p>
<p>in the SchM when setting / changing the cycle time in the CAN NM configuration. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>48 / 99 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In a CANbedded environment where the CCL is used the main functions are called by </p>
<p>the CCL and must not be called by the application. The CCL is in charge to call the </p>
<p>CAN NM with the correct cycle time. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.6 </b></p>
<p><b>Critical Sections </b></p>
<p>The AUTOSAR standard provides with the BSW Scheduler (SchM) a BSW module, which </p>
<p>handles entering and leaving critical sections. </p>
<p>Critical sections are supported by the BSW Scheduler. </p>
<p>It is recommended to use the critical section support of the BSW Scheduler. In this case </p>
<p>the CAN NM calls the following function when entering a critical section: </p>
<p>void <b>SchM_Enter_CanNm </b>( uint8 ExclusiveArea ) </p>
<p>(5.6) </p>
<p>When the critical section is left the following function is called by the CAN NM: </p>
<p>void <b>SchM_Exit_CanNm </b>( uint8 ExclusiveArea ) </p>
<p>(5.6) </p>
<p>The critical section (exclusive area) codes passed to these functions have to be defined </p>
<p>and mapped to corresponding interrupt locks by the BSW Scheduler. This can be done in </p>
<p>GENy at the BSW Scheduler configuration page. The corresponding sections are already </p>
<p>entered there and have to be adapted to the correct interrupt locking mechanism. Details </p>
<p>which section needs what kind of interrupt lock are provided in chapter 4.7 ‘Critical Section </p>
<p>Codes’. </p>
<p>For more information about the BSW Scheduler please refer to [7]. </p>
<p><b>4.7 </b></p>
<p><b>Critical Section Codes </b></p>
<p>Since  the  BSW  Scheduler  is  used  for  critical  sections  (see  also  chapter  4.6  ‘Critical </p>
<p>Sections’) </p>
<p>the </p>
<p>CAN </p>
<p>NM </p>
<p>uses </p>
<p>several </p>
<p>critical </p>
<p>section </p>
<p>codes </p>
<p>which </p>
<p>must </p>
<p>lead </p>
<p>to </p>
<p>corresponding interrupt locks. The mapping is described in the following table: </p>
<p><b>Critical Section Define </b></p>
<p><b>Interrupt Lock </b></p>
<p>CANNM_EXCLUSIVE_AREA_0</p>
<p> </p>
<p>No interruption by any interrupt is allowed. Therefore this section </p>
<p>must always lock global interrupts. </p>
<p>CANNM_EXCLUSIVE_AREA_1 </p>
<p>No interruption of CanNm_MainFunction by CanNm_SetUserData, </p>
<p>CanNm_SetCoordBits or CanNm_SetDiagGwReqId allowed. </p>
<p>This means that global interrupts have to be used for this section </p>
<p>only if CanNm_MainFunction can be interrupted by one of the </p>
<p>following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_SetUserData </p>
<p><b>&gt; </b></p>
<p>CanNm_SetCoordBits </p>
<p><b>&gt; </b></p>
<p>CanNm_SetDiagGwReqId </p>
<p>Otherwise no interrupt locks are necessary. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>49 / 99 </p>
<p>CANNM_EXCLUSIVE_AREA_2 </p>
<p>No interruption of CanNm_SetUserData by CanNm_MainFunction </p>
<p>allowed. </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_SetUserData can be interrupted by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_MainFunction </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_3 </p>
<p>No interruption of CanNm_SetCoordBits by CanNm_MainFunction </p>
<p>allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_SetCoordBits can be interrupted by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_MainFunction </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_4 </p>
<p>No interruption of CanNm_RxIndication by CanNm_GetUserData or </p>
<p>CanNm_GetPduData allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_RxIndication can be interrupted by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_GetUserData </p>
<p><b>&gt; </b></p>
<p>CanNm_GetPduData </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_5 </p>
<p>No interruption of CanNm_GetUserData or CanNm_GetPduData by </p>
<p>CanNm_RxIndication allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_GetUserData or CanNm_GetPduData can be interrupted </p>
<p>by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_RxIndication </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>Table 4-2  </p>
<p>Critical Section Codes </p>
<p>For API details refer to chapter 5 ‘API Description’. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>50 / 99 </p>
<p><b>5 </b></p>
<p><b>API Description </b></p>
<p><b>5.1 </b></p>
<p><b>API Categories </b></p>
<p>The AUTOSAR Network Management supports a multi-channel indexed API. However in </p>
<p>single channel configurations this API can be optimized in order to save runtime (refer to </p>
<p>chapter 3.1.2.2 ‘Single Channel Optimization’). </p>
<p><b>5.2 </b></p>
<p><b>Data Types </b></p>
<p>The software module CAN NM uses the standard AUTOSAR data types that are defined </p>
<p>within </p>
<p>Std_Types.h</p>
<p> </p>
<p>and </p>
<p>the </p>
<p>platform </p>
<p>specific </p>
<p>data </p>
<p>types </p>
<p>that </p>
<p>are </p>
<p>defined </p>
<p>within </p>
<p>Platform_Types.h</p>
<p>.  Furthermore  the  standard  AUTOSAR  NM  Stack  Types  defined </p>
<p>within </p>
<p>NmStack_Types.h</p>
<p> are used. </p>
<p>CAN NM also uses the Communication Stack Types defined within </p>
<p>ComStack_Types.h</p>
<p>. </p>
<p>Additionally the following software module specific data types are used for configuration </p>
<p>purposes: </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p>CanNm_LChannelConfigType<b> </b></p>
<p>struct </p>
<p>Structure for all channel specific </p>
<p>configuration parameters that are at most </p>
<p>link-time able. </p>
<p>CanNm_LConfigType </p>
<p>struct </p>
<p>Structure for configuration parameters that </p>
<p>are at most link-time able. Contains the </p>
<p>channel specific parameters. </p>
<p>CanNm_PbChannelConfigType </p>
<p>struct </p>
<p>Structure for channel specific configuration </p>
<p>parameters that are post-build able. </p>
<p>CanNm_ConfigType</p>
<p> </p>
<p>struct </p>
<p>Structure for configuration parameters which </p>
<p>are post-build able. Contains the channel </p>
<p>specific parameters. </p>
<p>Table 5-1  </p>
<p>Data Types </p>
<p>These data types are defined within the software components configuration header file. </p>
<p><b>5.3 </b></p>
<p><b>Global Variables </b></p>
<p>There are no global variables within CAN NM. </p>
<p><b>5.4 </b></p>
<p><b>Global Constants </b></p>
<p><b>5.4.1 </b></p>
<p><b>AUTOSAR Specification Version </b></p>
<p>The version of AUTOSAR specification on which the appropriate implementation is based </p>
<p>on is provided by three BCD coded defines: </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>51 / 99 </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p>CANNM_AR_MAJOR_VERSION</p>
<p> </p>
<p>BCD </p>
<p>Contains the major specification version number. </p>
<p>CANNM_AR_MINOR_VERSION</p>
<p> </p>
<p>BCD </p>
<p>Contains the minor specification version number. </p>
<p>CANNM_AR_PATCH_VERSION </p>
<p>BCD </p>
<p>Contains the patch level specification version number. </p>
<p>Table 5-2  </p>
<p>Specification Version API Data </p>
<p><b>5.4.2 </b></p>
<p><b>Component Versions </b></p>
<p>The  source  code  versions  of  CAN  NM  are  provided  by  three  BCD  coded  macros  (and </p>
<p>additionally as constants): </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p>CANNM_SW_MAJOR_VERSION </p>
<p>(CanNm_MainVersion)</p>
<p> </p>
<p>BCD </p>
<p>Contains the major component version number. </p>
<p>CANNM_SW_MINOR_VERSION </p>
<p>(CanNm_SubVersion)</p>
<p> </p>
<p>BCD </p>
<p>Contains the minor component version number. </p>
<p>CANNM_SW_PATCH_VERSION </p>
<p>(CanNm_ReleaseVersion) </p>
<p>BCD </p>
<p>Contains the patch level component version number. </p>
<p>Table 5-3  </p>
<p>Component Version API Data </p>
<p>These constants are declared as external and can be read by the application at any time. </p>
<p><b>5.4.3 </b></p>
<p><b>Vendor and Module ID </b></p>
<p>CAN NM provides the vendor identifier according to AUTOSAR as defines: </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p><b>Value </b></p>
<p>CANNM_VENDOR_ID</p>
<p> </p>
<p>- </p>
<p>Vendor ID according to AUTOSAR. </p>
<p>30 </p>
<p>CANNM_MODULE_ID</p>
<p> </p>
<p>- </p>
<p>Module ID according to AUTOSAR. </p>
<p>31 </p>
<p>Table 5-4  </p>
<p>Vendor/Module ID </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>52 / 99 </p>
<p><b>5.5 </b></p>
<p><b>Services Provided by CAN NM </b></p>
<p><b>5.5.1 </b></p>
<p><b>Administrative Functions </b></p>
<p><b>5.5.1.1 </b></p>
<p><b>CanNm_Init: Initialization of CAN NM </b></p>
<p><b>CanNm_Init </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_Init </b>( const CanNm_ConfigType * const nmConfigPtr )<b> </b></p>
<p><b>Parameter </b></p>
<p>nmConfigPtr</p>
<p> </p>
<p>Configuration Pointer </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x00 </p>
<p><b>Functional Description </b></p>
<p>Initialization of CAN NM. </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>During the execution of the function </p>
<p>CanNm_Init()</p>
<p>, it has to be ensured that the execution </p>
<p>is not interrupted by any other function of the CanNm module. This can for instance be </p>
<p>accomplished by </p>
<p><b>&gt; </b></p>
<p>global interrupt locks OR </p>
<p><b>&gt; </b></p>
<p>CAN interrupt locks. </p>
<p><b>&gt; </b></p>
<p>Call context: task level. </p>
<p><b>&gt; </b></p>
<p>Not re-entrant. </p>
<p><b>&gt; </b></p>
<p>This service has to be called after initialization of CAN Interface and before calling any NM </p>
<p>service. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>53 / 99 </p>
<p><b>5.5.1.2 </b></p>
<p><b>CanNm_MainFunction: Channel Specific Main Functions of CAN NM </b></p>
<p><b>CanNm_MainFunction </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_MainFunction_X </b>( void )<b> </b></p>
<p>(with X=0… Number of CAN NM channels)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>- </p>
<p>- </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x13 </p>
<p><b>Functional Description </b></p>
<p>Main functions of CAN NM. </p>
<p>For each CAN NM channel one main function is generated that has to be called with the corresponding </p>
<p>channel handle as postfix. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>These functions have to be called cyclically on task level. </p>
<p><b>&gt; </b></p>
<p>Call context: task level. </p>
<p><b>&gt; </b></p>
<p>Not re-entrant. </p>
<p><b>&gt; </b></p>
<p>If these services are already called by the OS, SchM or the CCL they must not be called by </p>
<p>the application. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>54 / 99 </p>
<p><b>5.5.2 </b></p>
<p><b>Service Functions of CAN NM </b></p>
<p><b>5.5.2.1 </b></p>
<p><b>CanNm_GetVersionInfo: Version Information API </b></p>
<p><b>CanNm_GetVersionInfo </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_GetVersionInfo </b>( Std_VersionInfoType* NmVerInfoPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>NmVerInfoPtr</p>
<p><b> </b></p>
<p>Pointer where the Version Information shall be copied to </p>
<p><b>Return code </b></p>
<p>-</p>
<p><b> </b></p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xF1 </p>
<p><b>Functional Description </b></p>
<p>This service returns the version information of this module. The version information includes the Module Id, </p>
<p>the Vendor Id, the Instance Id and the vendor specific version numbers (BSW00407). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_VERSION_INFO_API is STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>55 / 99 </p>
<p> </p>
<p><b>Caution </b></p>
<p>Since there is no interface from CAN NM to any higher software layer except DET, DEM </p>
<p>or NM Interface the following services must not be called by ComM, CCL or the </p>
<p>application! </p>
<p> </p>
<p><b>5.5.2.2 </b></p>
<p><b>CanNm_GetState: Get the State of the Network Management </b></p>
<p><b>CanNm_GetState </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_GetState </b>( const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>Nm_StateType * const  </p>
<p>nmStatePtr, </p>
<p> </p>
<p>Nm_ModeType * const  </p>
<p>nmModePtr ) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmStatePtr </p>
<p>Pointer where state of the network management shall be copied to </p>
<p>nmModePtr </p>
<p>Pointer where the mode of the network management shall be copied to </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Getting of NM state has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x0B </p>
<p><b>Functional Description </b></p>
<p>Get the state and the mode of the network management. </p>
<p>One of the following state values is written to the variable where nmStatePtr points to: </p>
<p>&gt; </p>
<p>NM_STATE_BUS_SLEEP</p>
<p>  </p>
<p>(Bus Sleep) </p>
<p>&gt; </p>
<p>NM_STATE_PREPARE_BUS_SLEEP</p>
<p>   (Prepare Bus Sleep) </p>
<p>&gt; </p>
<p>NM_STATE_READY_SLEEP</p>
<p>  </p>
<p>(Ready Sleep) </p>
<p>&gt; </p>
<p>NM_STATE_NORMAL_OPERATION</p>
<p>  </p>
<p>(Normal Operation) </p>
<p>&gt; </p>
<p>NM_STATE_REPEAT_MESSAGE</p>
<p>  </p>
<p>(Repeat Message) </p>
<p>One of the following mode values is written to the variable where nmModePtr points to: </p>
<p>&gt; </p>
<p>NM_MODE_BUS_SLEEP</p>
<p>  </p>
<p>(Bus Sleep Mode) </p>
<p>&gt; </p>
<p>NM_MODE_PREPARE_BUS_SLEEP</p>
<p>  </p>
<p>(Prepare Bus Sleep Mode) </p>
<p>&gt; </p>
<p>NM_MODE_NETWORK</p>
<p>  </p>
<p>(Network Mode) </p>
<p>For details about the states and modes refer to chapter 3.4. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>56 / 99 </p>
<p><b>5.5.2.3 </b></p>
<p><b>CanNm_PassiveStartUp: Wake up Network Management </b></p>
<p><b>CanNm_PassiveStartUp </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_PassiveStartUp </b>( const NetworkHandleType nmChannelHandle )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Start of Network Management has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Start of Network Management is currently not executed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x01 </p>
<p><b>Functional Description </b></p>
<p>Passive startup of the CAN NM state machine. It triggers the transition from the Bus Sleep Mode / Prepare </p>
<p>Bus Sleep Mode to the Network Mode (Repeat Message State). This service has no effect if the current </p>
<p>state is not Bus Sleep Mode / Prepare Bus Sleep Mode. In that case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>57 / 99 </p>
<p><b>5.5.2.4 </b></p>
<p><b>Wake-up Registration </b></p>
<p><b>5.5.2.4.1 </b></p>
<p><b>CanNm_NetworkRequest: Request the Network </b></p>
<p><b>CanNm_NetworkRequest </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_NetworkRequest </b>( const NetworkHandleType nmChannelHandle )<b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Requesting the network has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x02 </p>
<p><b>Functional Description </b></p>
<p>Request the network if the ECU needs to communicate on the bus. </p>
<p>If ‘Pn Feature’ is enabled a network request within the network mode leads to a state transition to repeat </p>
<p>message. Refer to chapter 3.23.5.2 ‘Using NM Request and Immediate Nm Transmission’ for details. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>Not available for passive nodes (</p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p>) </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>58 / 99 </p>
<p><b>5.5.2.4.2 </b></p>
<p><b>CanNm_NetworkRelease: Release the Network </b></p>
<p><b>CanNm_NetworkRelease </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_NetworkRelease</b></p>
<p>  </p>
<p>( const NetworkHandleType nmChannelHandle )<b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Releasing the network has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Releasing the network is currently not executed. </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x03 </p>
<p><b>Functional Description </b></p>
<p>Release the network if the ECU doesn’t have to communicate on the bus. This service has no effect if the </p>
<p>NM Message Transmission is disabled. In that case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>Not available for passive nodes (</p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p>) </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>59 / 99 </p>
<p><b>5.5.2.5 </b></p>
<p><b>Communication Control Service </b></p>
<p><b>5.5.2.5.1 </b></p>
<p><b>CanNm_DisableCommunication: Disable NM Message Transmission </b></p>
<p><b>CanNm_DisableCommunication </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_DisableCommunication </b>( </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Disabling NM message transmission has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Disabling NM message transmission is currently not executed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x0C </p>
<p><b>Functional Description </b></p>
<p>Disable transmission of NM messages. This service has no effect if the current state is not Normal </p>
<p>Operation State and the network is not requested. In that case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_COM_CONTROL_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> and </p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_OFF.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>60 / 99 </p>
<p><b>5.5.2.5.2 </b></p>
<p><b>CanNm_EnableCommunication: Enable NM Message Transmission </b></p>
<p><b>CanNm_EnableCommunication </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_EnableCommunication </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Enabling NM message transmission has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Enabling NM message transmission is currently not executed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x0D </p>
<p><b>Functional Description </b></p>
<p>Enable transmission of NM messages. This service has no effect if the NM Message Transmission is not </p>
<p>disabled. In that case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_COM_CONTROL_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> and </p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_OFF.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>61 / 99 </p>
<p><b>5.5.2.6 </b></p>
<p><b>User Data Handling </b></p>
<p><b>5.5.2.6.1 </b></p>
<p><b>CanNm_SetUserData: Set User Data </b></p>
<p><b>CanNm_SetUserData </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_SetUserData </b>(</p>
<p> </p>
<p>const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>const uint8* const  </p>
<p>nmUserDataPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmUserDataPtr </p>
<p>Pointer to the user data for the next NM message </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Setting of user data has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x04 </p>
<p><b>Functional Description </b></p>
<p>Set user data for NM messages transmitted next on the bus. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_USER_DATA_ENABLED</p>
<p> is </p>
<p>STD_ON </p>
<p><b>&gt; </b></p>
<p>Not available for passive nodes (</p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p>) or if </p>
<p>CANNM_COM_USER_DATA_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>62 / 99 </p>
<p><b>5.5.2.6.2 </b></p>
<p><b>CanNm_GetUserData: Get User Data </b></p>
<p><b>CanNm_GetUserData </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_GetUserData </b>(</p>
<p> </p>
<p>const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8* const  </p>
<p>nmUserDataPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmUserDataPtr </p>
<p>Pointer where user data out of the last received NM message shall be copied to </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Getting of user data has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x05 </p>
<p><b>Functional Description </b></p>
<p>Get user data from the last received NM message on the bus. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_USER_DATA_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>63 / 99 </p>
<p><b>5.5.2.6.3 </b></p>
<p><b>CanNm_GetPduData: Get NM Pdu Data </b></p>
<p><b>CanNm_GetPduData </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_GetPduData </b>(  const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8* const  </p>
<p>nmPduDataPtr ) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmPduDataPtr </p>
<p>Pointer where the NM Pdu Data shall be copied to </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Getting of NM Pdu Data has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x0A </p>
<p><b>Functional Description </b></p>
<p>Get the whole PDU data of the last received NM message. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_NODE_ID_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> or </p>
<p>CANNM_USER_DATA_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>64 / 99 </p>
<p><b>5.5.2.7 </b></p>
<p><b>Node Detection </b></p>
<p><b>5.5.2.7.1 </b></p>
<p><b>CanNm_RepeatMessageRequest: Set Repeat Message Request Bit </b></p>
<p><b>CanNm_RepeatMessageRequest </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_RepeatMessageRequest </b>(  </p>
<p> </p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Requesting of node detection has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Requesting of node detection is currently not executed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x08 </p>
<p><b>Functional Description </b></p>
<p>Set Repeat Message Request Bit for NM messages transmitted next on the bus. This service has no effect </p>
<p>if the current state is not Ready Sleep State or Normal Operation State. In that case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> </p>
<p>is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only reentrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_NODE_DETECTION_ENABLED</p>
<p> is</p>
<p> STD_ON</p>
<p> and </p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_OFF.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>65 / 99 </p>
<p><b>5.5.2.7.2 </b></p>
<p><b>CanNm_GetNodeIdentifier: Get Source Node Identifier </b></p>
<p><b>CanNm_GetNodeIdentifier </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_GetNodeIdentifier </b>(</p>
<p> </p>
<p> </p>
<p>const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8* const  </p>
<p>nmNodeIdPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmNodeIdPtr </p>
<p>Pointer where node identifier out of the last received NM message is copied </p>
<p>to. </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Getting of the node identifier from the last NM message has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x06 </p>
<p><b>Functional Description </b></p>
<p>Get Node Identifier of the last received NM message. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_NODE_ID_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>66 / 99 </p>
<p><b>5.5.2.7.3 </b></p>
<p><b>CanNm_GetLocalNodeIdentifier: Get Local Source Node Identifier </b></p>
<p><b>CanNm_GetLocalNodeIdentifier </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_GetLocalNodeIdentifier </b>( </p>
<p> </p>
<p>const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8* const  </p>
<p>nmNodeIdPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmNodeIdPtr </p>
<p>Pointer where the node identifier of the local node shall be copied. </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Getting of node identifier of the local node has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x07 </p>
<p><b>Functional Description </b></p>
<p>Get Node Identifier of the local node. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_NODE_ID_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>67 / 99 </p>
<p><b>5.5.2.8 </b></p>
<p><b>Bus Synchronization </b></p>
<p><b>5.5.2.8.1 </b></p>
<p><b>CanNm_RequestBusSynchronization: Synchronization of Networks </b></p>
<p><b>CanNm_RequestBusSynchronization </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_RequestBusSynchronization (</b></p>
<p><b> </b></p>
<p><b> </b></p>
<p>const NetworkHandleType nmChannelHandle )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Requesting of bus synchronization has failed </p>
<p>NM_E_NOT_EXECUTED </p>
<p>Requesting of bus synchronization is currently not executed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xC0 </p>
<p><b>Functional Description </b></p>
<p>Request bus synchronization. This service has no effect if the current mode is not Network Mode. In that </p>
<p>case </p>
<p>NM_E_NOT_EXECUTED</p>
<p> is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task level only </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if (</p>
<p>CANNM_BUS_SYNCHRONIZATION_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> or if </p>
<p>CANNM_EXT_BUS_SYNCHRONIZATION</p>
<p> is defined) and if </p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> </p>
<p>is </p>
<p>STD_OFF.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>68 / 99 </p>
<p><b>5.5.2.9 </b></p>
<p><b>Remote Sleep Indication </b></p>
<p><b>5.5.2.9.1 </b></p>
<p><b>CanNm_CheckRemoteSleepIndication: Check for Remote Sleep </b></p>
<p><b>Indication </b></p>
<p><b>CanNm_CheckRemoteSleepIndication </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_CheckRemoteSleepIndication </b>(</p>
<p> </p>
<p> </p>
<p>const NetworkHandleType   nmChannelHandle, </p>
<p> </p>
<p>boolean* const  </p>
<p>nmRemoteSleepIndPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmRemoteSleepIndPtr </p>
<p>Pointer where check result of remote sleep indication shall be copied to </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Checking of remote sleep indication has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xD0 </p>
<p><b>Functional Description </b></p>
<p>Check if remote sleep indication takes place or not. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_REMOTE_SLEEP_IND_ENABLED</p>
<p> is</p>
<p> STD_ON</p>
<p> and </p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_OFF.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>69 / 99 </p>
<p><b>5.5.2.10 </b></p>
<p><b>NM Message Transmission Request </b></p>
<p><b>5.5.2.10.1 </b></p>
<p><b>CanNm_Transmit: Spontaneous NM Message Transmission </b></p>
<p><b>CanNm_Transmit </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_Transmit </b>(</p>
<p> </p>
<p>PduIdType CanNmTxPduId, </p>
<p> </p>
<p>const PduInfoType* PduInfoPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>CanNmTxPduId</p>
<p><b> </b></p>
<p>Identification of the NM user data PDU </p>
<p>PduInfoPtr </p>
<p>Pointer to the Pdu data which shall be transmitted </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Requesting NM message transmission has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x14 </p>
<p><b>Functional Description </b></p>
<p>The CanNm transmits a NM message within the next main function. The NM message timer will be restarted. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by PDU Router </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_COM_USER_DATA_ENABLED </p>
<p>is</p>
<p> STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>70 / 99 </p>
<p><b>5.5.2.11 </b></p>
<p><b>Partial Networking </b></p>
<p><b>5.5.2.11.1 </b></p>
<p><b>CanNm_ConfirmPnAvailability: Notification for activating the PN filter </b></p>
<p><b>functionality </b></p>
<p><b>CanNm_ConfirmPnAvailability </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_ConfirmPnAvailability </b>( const NetworkHandleType nmChannelHandle )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x16 </p>
<p><b>Functional Description </b></p>
<p>This function is called by CanSM to indicate that the PN filter functionality on the indicated NM channel shall </p>
<p>be enabled. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by CANSM </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_PN_FEATURE_ENABLED </p>
<p>is</p>
<p> STD_ON</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>71 / 99 </p>
<p><b>5.5.3 </b></p>
<p><b>Vector extensions </b></p>
<p><b>5.5.3.1 </b></p>
<p><b>CanNm_InitMemory: Memory Initialization </b></p>
<p><b>CanNm_InitMemory </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_InitMemory </b>( void ) </p>
<p><b>Parameter </b></p>
<p>- </p>
<p>- </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>If RAM is not automatically initialized at start-up, this function must be called from start-up code to ensure </p>
<p>that variables which must be initialized with a certain value (e.g. initialization status with UNINIT value) are </p>
<p>set to those values. Refer also to chapter 3.1.2.3 ‘Memory Initialization’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>The function </p>
<p>CanNm_InitMemory()</p>
<p> has to be called with disabled global interrupts. </p>
<p><b>&gt; </b></p>
<p>Call context: task level. </p>
<p><b>&gt; </b></p>
<p>Not re-entrant. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>72 / 99 </p>
<p><b>5.5.3.2 </b></p>
<p><b>CanNm_SetCoordBits: Set Coordination Bits in the CBV </b></p>
<p><b>CanNm_SetCoordBits </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_SetCoordBits </b>( const NetworkHandleType nmChannelHandle, </p>
<p> </p>
<p>const uint8 nmCoordBits )<b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Identification of the physical channel </p>
<p>nmCoordBits </p>
<p>Additional coordination bits to set </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x15 </p>
<p><b>Functional Description </b></p>
<p>Set the additional coordination bits within the control bit vector. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task level only </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is only available if </p>
<p>CANNM_ENABLE_COORD_SYNC </p>
<p>is defined. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>73 / 99 </p>
<p><b>5.5.3.3 </b></p>
<p><b>CanNm_CheckLimpHomeIndication: Check the Limp Home Status </b></p>
<p><b>CanNm_CheckLimpHomeIndication </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_CheckLimpHomeIndication </b>(</p>
<p> </p>
<p> </p>
<p>const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>boolean* const  </p>
<p>nmLimpHomeIndPtr )</p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p>nmChannelHandle</p>
<p><b> </b></p>
<p>Identification of the physical channel </p>
<p>nmLimpHomeIndPtr </p>
<p>Pointer where check result of limp home status shall be copied to </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p><b> </b></p>
<p>No error </p>
<p>NM_E_NOT_OK </p>
<p>Checking of limp home status has failed </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xFB </p>
<p><b>Functional Description </b></p>
<p>Check if CAN NM entered limp home state or not. For details refer to chapter 3.10 ‘Limp Home Indication </p>
<p>and Cancellation’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task level only </p>
<p><b>&gt; </b></p>
<p>Re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is enabled if </p>
<p>CANNM_LIMP_HOME_INDICATION</p>
<p> is</p>
<p> defined.</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>74 / 99 </p>
<p><b>5.5.3.4 </b></p>
<p><b>CanNm_SetDiagGwReqId: Diagnostic Gateway ID Request </b></p>
<p><b>CanNm_SetDiagGwReqId </b></p>
<p><b>Prototype </b></p>
<p>Nm_ReturnType <b>CanNm_SetDiagGwReqId </b>( uint8 nmReqId ) </p>
<p><b>Parameter </b></p>
<p>nmReqId </p>
<p>Identifier requested to be transmitted on all channels </p>
<p><b>Return code </b></p>
<p>NM_E_OK</p>
<p> </p>
<p>No error </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xFC </p>
<p><b>Functional Description </b></p>
<p>Set the identifier in byte 4 of the NM transmission message and request an additional message </p>
<p>transmission. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Not re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by NM Interface </p>
<p><b>&gt; </b></p>
<p>This function is only available if ‘Diagnostic Gateway Extension Support’ is enabled. </p>
<p><b>5.5.3.5 </b></p>
<p><b>CanNm_DisablePNActivationState: Disable Partial Networking </b></p>
<p><b>CanNm_DisablePNActivationState </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_DisablePNActivationState </b>( void ) </p>
<p><b>Parameter </b></p>
<p>- </p>
<p>- </p>
<p><b>Return code </b></p>
<p>-</p>
<p> </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0xFD </p>
<p><b>Functional Description </b></p>
<p>This function may be called directly after CanNm_Init to completely disable any PN functionality </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>The function has to be called after </p>
<p>CanNm_Init()</p>
<p> (see also chapter 5.5.1.1) and before the </p>
<p>first call of </p>
<p>CanNm_MainFunction_X()</p>
<p> (see also chapter 5.5.1.2). </p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Not re-entrant </p>
<p><b>&gt; </b></p>
<p>Called by Application </p>
<p><b>&gt; </b></p>
<p>This function is only available if ‘Pn Feature Enabled’ is enabled. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>75 / 99 </p>
<p><b>5.6 </b></p>
<p><b>Services Used by CAN NM </b></p>
<p>In the following table services provided by other components, which are used by the CAN </p>
<p>NM are listed. For details about prototype and functionality refer to the documentation of </p>
<p>the providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>DET </p>
<p>Det_ReportError</p>
<p>7</p>
<p> </p>
<p>DEM </p>
<p>Dem_ReportErrorStatus</p>
<p>8</p>
<p> </p>
<p>SchM </p>
<p>SchM_Enter_CanNm</p>
<p>9</p>
<p> </p>
<p>SchM_Exit_CanNm</p>
<p>9</p>
<p> </p>
<p>CanIf </p>
<p>CanIf_Transmit</p>
<p>10</p>
<p> </p>
<p>PduR </p>
<p>PduR_CanNmTriggerTransmit</p>
<p>10 11</p>
<p> </p>
<p>PduR_CanNmTxConfirmation</p>
<p>10 11 12</p>
<p> </p>
<p>PduR_CanNmRxIndication</p>
<p>13</p>
<p> </p>
<p>Table 5-5  </p>
<p>Services Used by the CAN NM </p>
<p> </p>
<p><b>5.7 </b></p>
<p><b>Callbacks Provided by CAN NM </b></p>
<p><b>5.7.1 </b></p>
<p><b>Callback Functions from CAN Interface </b></p>
<p><b>5.7.1.1 </b></p>
<p><b>CanNm_RxIndication: NM Message Indication </b></p>
<p><b>CanNm_RxIndication </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_RxIndication </b>(  PduIdType  </p>
<p>canNmRxPduId, </p>
<p> </p>
<p>const PduInfoType * PduInfoPtr )<b> </b></p>
<p><b>Parameter </b></p>
<p>canNmRxPduId </p>
<p>Identification of the network through PDU-ID </p>
<p>PduInfoPtr </p>
<p>Pointer to a PduInfoType struct containing data and length of the received </p>
<p>CAN NM SDU </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x10 </p>
<p>                                            </p>
<p>7</p>
<p> Service only used if the feature ‘Dev Error Detect’ is enabled </p>
<p>8</p>
<p> Service only used if the feature ‘Prod Error Detect’ is enabled </p>
<p>9</p>
<p> Service only used if the critical section handling is done by the BSW Scheduler </p>
<p>10</p>
<p> Service only used if the feature ‘Passive Mode’ is disabled </p>
<p>11</p>
<p> Service only used if the feature ‘NM User Data via Com’ is enabled. </p>
<p>12</p>
<p> Service only used if the feature ‘Immediate Txconf Enabled’ is disabled. </p>
<p>13</p>
<p> Service only used if the features ‘Pn Eira Calc Enabled’ or ‘Pn Era Calc Enabled’ is enabled. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>76 / 99 </p>
<p><b>Functional Description </b></p>
<p>Indication that a CAN NM L-PDU (NM messages) has been successfully received. The API parameter </p>
<p>canNmRxPduId</p>
<p> refers to the NM channel handle, i.e. a mapping from PduId to NM channel handle is not </p>
<p>necessary. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by CanIf </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>77 / 99 </p>
<p><b>5.7.1.2 </b></p>
<p><b>CanNm_TxConfirmation: NM Message Confirmation Function </b></p>
<p><b>CanNm_TxConfirmation </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_TxConfirmation </b>( PduIdType canNmTxPduId ) </p>
<p><b>Parameter </b></p>
<p>canNmTxPduId</p>
<p><b> </b></p>
<p>ID of CAN NM L-PDU that has been transmitted. </p>
<p><b>Return code </b></p>
<p>-</p>
<p><b> </b></p>
<p>- </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>0x0F </p>
<p><b>Functional Description </b></p>
<p>Notification of the successful transmission of a NM message (L-PDU). The API parameter </p>
<p>canNmTxPduId</p>
<p> </p>
<p>refers not to the NM channel handle and a mapping from PduId to NM channel handle is done by the CAN </p>
<p>NM (refer also to chapter 3.1.1.2 ‘PDU ID Used as Argument for CanNm_TxConfirmation’). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Call context: task and interrupt level </p>
<p><b>&gt; </b></p>
<p>Only re-entrant with different channel handles </p>
<p><b>&gt; </b></p>
<p>Called by CanIf </p>
<p><b>&gt; </b></p>
<p>Not available for passive nodes (</p>
<p>CANNM_PASSIVE_MODE_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p>) or if </p>
<p>CANNM_IMMEDIATE_TXCONF_ENABLED</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p> </p>
<p><b>5.8 </b></p>
<p><b>Callback Functions used by CAN NM </b></p>
<p><b>5.8.1 </b></p>
<p><b>Service Callback Functions of CAN NM </b></p>
<p>The  following,  partly  optional,  service  callback  functions  of  CAN  NM  are  implemented </p>
<p>within the NM Interface. Please refer to the document of the NM Interface component for a </p>
<p>detailed description of these services: </p>
<p>void <b>Nm_NetworkStartIndication</b>(  const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_NetworkMode</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_PrepareBusSleepMode</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_BusSleepMode</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_RepeatMessageIndication</b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_RemoteSleepIndication</b>(  const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_RemoteSleepCancellation</b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_StateChangeNotification</b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>78 / 99 </p>
<p> </p>
<p>const Nm_StateType </p>
<p> </p>
<p>nmPreviousState,  </p>
<p> </p>
<p>const Nm_StateType </p>
<p> </p>
<p>nmCurrentState ) </p>
<p>void <b>Nm_PduRxIndication</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_TxTimeoutException</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_CarWakeUpIndication</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>These  functions  are  called  from  task  level  except  the </p>
<p>Nm_PduRxIndication  and </p>
<p>Nm_CarWakeUpIndication</p>
<p>, which can be called from interrupt or from task level. </p>
<p><b>5.8.2 </b></p>
<p><b>Additional Service Callback Functions of CAN NM </b></p>
<p>The  service  callbacks  described  in  this  chapter  are  additionally  called  by  the  CAN  NM </p>
<p>when the corresponding feature is available. </p>
<p><b>5.8.2.1 </b></p>
<p><b>Callbacks for Limp Home Indication </b></p>
<p>The following two callbacks are provided for Limp Home detection / cancellation: </p>
<p>void <b>Nm_LimpHomeIndication</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>void <b>Nm_LimpHomeCancelation</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle ) </p>
<p>These functions are called from task level. </p>
<p><b>5.8.2.2 </b></p>
<p><b>Callbacks for Coordination Extension </b></p>
<p>The  following  callback  is  provided  to  the  NM  Interface  if  the  Coordination  Extension  is </p>
<p>used: </p>
<p>void <b>Nm_ActiveCoordIndication</b>(  const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>const uint8 nmCoordPrio, </p>
<p> </p>
<p>const uint8 nmSleepInd) </p>
<p>This function is called from interrupt or task level. </p>
<p><b>5.8.2.3 </b></p>
<p><b>Callbacks for Gateway Extension Support </b></p>
<p>The  following  callback  is  provided  by  CAN  NM  if  the  Gateway  Extension  Support  is </p>
<p>enabled:  </p>
<p>void <b>Nm_GwPduRxIndication</b>(  </p>
<p>const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>uint8 nmNodeId, </p>
<p> </p>
<p>uint8 nmReqId, </p>
<p> </p>
<p>uint8 nmReqCh) </p>
<p>This function is called from interrupt or task level. </p>
<p><b>5.8.2.4 </b></p>
<p><b>Callbacks for Partial Networking </b></p>
<p>The following callback is provided by CAN NM if the Partial Networking Feature is enabled: </p>
<p>void <b>CanSM_TxTimeoutException</b>(  NetworkHandleType Channel ) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>79 / 99 </p>
<p>This function is called from task level. </p>
<p><b>5.8.2.5 </b></p>
<p><b>Generator Compatibility Error </b></p>
<p>The  following  callback  has  to  be  provided  by  the  ECU  Manager  if  the  Version  Check </p>
<p>feature is not explicitly suppressed or if the CRC Check feature is enabled: </p>
<p>void <b>EcuM_GeneratorCompatibilityError</b>( </p>
<p> </p>
<p>uint16 ModuleId,  </p>
<p> </p>
<p>uint8 InstanceId ) </p>
<p>This function is called during the initialization, i.e. from task level, of the CAN NM if the </p>
<p>Generator Version Check or the CRC Check fails. </p>
<p>Refer to [11] for more information. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>80 / 99 </p>
<p><b>6 </b></p>
<p><b>Configuration </b></p>
<p>AUTOSAR </p>
<p>CAN </p>
<p>NM </p>
<p>supports </p>
<p>three </p>
<p>different </p>
<p>configuration </p>
<p>variants: </p>
<p>pre-compile </p>
<p>configuration, </p>
<p>link-time </p>
<p>configuration </p>
<p>and </p>
<p>post-build </p>
<p>configuration. </p>
<p>Pre-compile </p>
<p>configuration  can only  be  carried out  if  source  code  is  available.  Link-time  configuration </p>
<p>and  post-build  configuration  are  only  reasonable  if  source  code  is  not  available,  i.e.  the </p>
<p>components are available as object code or library.   </p>
<p>It depends on the OEM and license whether pre-compile configuration with source code or </p>
<p>link-time / post-build configuration with object code and library has to be used. </p>
<p>In the CanNm the attributes can be configured according to/ with the following methods/ </p>
<p>tools: </p>
<p><b>&gt; </b> Configuration in Database, for a detailed description see 6.2 </p>
<p><b>&gt; </b> Configuration in GENy, for a detailed description see 6.3 </p>
<p><b>6.1 </b></p>
<p><b>Configuration Variants </b></p>
<p>The CanNm supports the configuration variants </p>
<p><b>&gt; </b></p>
<p>VARIANT-PRE-COMPILE </p>
<p><b>&gt; </b></p>
<p>VARIANT-LINK-TIME </p>
<p><b>&gt; </b></p>
<p>VARIANT-POST-BUILD </p>
<p>The </p>
<p>configuration </p>
<p>classes </p>
<p>of </p>
<p>the </p>
<p>CanNm </p>
<p>parameters </p>
<p>depend </p>
<p>on </p>
<p>the </p>
<p>supported </p>
<p>configuration variants. For their definitions please see the CanNm_bswmd.arxml file. </p>
<p><b>6.2 </b></p>
<p><b>Configuration in Data Base </b></p>
<p>The following table provides a list of database attributes that apply only to CAN NM. </p>
<p><b>Attribute </b></p>
<p><b>Object </b></p>
<p><b>Type </b></p>
<p><b>Value </b></p>
<p><b>Default </b></p>
<p><b>Description </b></p>
<p>NmType</p>
<p>14</p>
<p> </p>
<p>Network </p>
<p>String </p>
<p>“NmAsr”, </p>
<p>“&lt;OEM&gt;-</p>
<p>OSEK” </p>
<p>None </p>
<p>This attribute defines the </p>
<p>type of the NM. To allow the </p>
<p>configuration of OSEK NM </p>
<p>and CAN NM within the </p>
<p>same ECU the CAN NM </p>
<p>also accepts a valid OSEK </p>
<p>NM value. </p>
<p>Note that for OSEK NM this </p>
<p>type is OEM-specific. </p>
<p>NmAsrNode</p>
<p>14</p>
<p> </p>
<p>Node </p>
<p>Enumer</p>
<p>ation </p>
<p>No, yes </p>
<p>No </p>
<p>This attribute defines </p>
<p>whether the corresponding </p>
<p>node uses the AUTOSAR </p>
<p>NM (“Yes&quot;”) or not (“No”). </p>
<p>NmAsrMessage</p>
<p>14</p>
<p> </p>
<p>Message </p>
<p>Enumer</p>
<p>ation </p>
<p>No, yes </p>
<p>No </p>
<p>This attribute defines </p>
<p>whether the corresponding </p>
<p>                                            </p>
<p>14</p>
<p> Database attribute is required if GENy is used for the configuration. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>81 / 99 </p>
<p>message is an AUTOSAR </p>
<p>NM message (“Yes&quot;) or not </p>
<p>(“No”). </p>
<p>NmAsrMessageCount</p>
<p>14</p>
<p> </p>
<p>Network </p>
<p>Integer </p>
<p>1..256 </p>
<p>128 </p>
<p>This attribute defines the </p>
<p>maximum number of NM </p>
<p>message received by the </p>
<p>NM (Message Range).  </p>
<p>There is the requirement </p>
<p>that the value of attribute </p>
<p>NmAsrMessageCount</p>
<p> is 2</p>
<p>n</p>
<p> </p>
<p>(where n is a natural </p>
<p>number). </p>
<p>NmAsrBaseAddress</p>
<p>14</p>
<p> </p>
<p>Network </p>
<p>Hex </p>
<p>0..7FF </p>
<p>0x500 </p>
<p>This attribute defines the </p>
<p>base address of the NM </p>
<p>messages (e.g. 0x500). </p>
<p>Only a certain number of </p>
<p>nodes can participate in the </p>
<p>NM. The CAN identifiers of </p>
<p>NM messages are kept in a </p>
<p>certain range. This range </p>
<p>starts with the ID given by </p>
<p>attribute </p>
<p>NmAsrBaseAddress</p>
<p>. The </p>
<p>size of the range is given by </p>
<p>attribute </p>
<p>NmAsrMessageCount</p>
<p>. </p>
<p>There is a general </p>
<p>requirement that the value </p>
<p>of attribute </p>
<p>NmAsrBaseAddress</p>
<p> must </p>
<p>be chosen in a way that </p>
<p>masking is possible. This </p>
<p>can be achieved if </p>
<p>NmAsrBaseAddress</p>
<p> is an </p>
<p>integer multiple of the </p>
<p>attribute </p>
<p>NmAsrMessageCount</p>
<p>. </p>
<p>NmAsrNodeIdentifier</p>
<p>1</p>
<p>4</p>
<p> </p>
<p>Node </p>
<p>Hex </p>
<p>0..FF </p>
<p>0 </p>
<p>This attribute defines the </p>
<p>Source Node Identifier´, </p>
<p>which is transmitted in the </p>
<p>corresponding NM message </p>
<p>byte if activated. </p>
<p>NmAsrTimeoutTime </p>
<p>Network </p>
<p>Integer </p>
<p>1..65535 </p>
<p>1000 </p>
<p>This attribute defines the </p>
<p>NM Message Timeout Time </p>
<p>(see also Chapter 6.3.2 </p>
<p>‘Channel Configuration’) </p>
<p>NmAsrWaitBusSleepTim</p>
<p>e </p>
<p>Network </p>
<p>Integer </p>
<p>0..65535 </p>
<p>750 </p>
<p>This attribute defines the </p>
<p>Wait Bus-Sleep Time (see </p>
<p>also Chapter 6.3.2 ‘Channel </p>
<p>Configuration’) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>82 / 99 </p>
<p>NmAsrRepeatMessageTi</p>
<p>me </p>
<p>Network </p>
<p>Integer </p>
<p>0..65535 </p>
<p>400 </p>
<p>This attribute defines the </p>
<p>Repeat Message Time (see </p>
<p>also Chapter 6.3.2 ‘Channel </p>
<p>Configuration’) </p>
<p>NmAsrCanMsgCycleTime </p>
<p>Network </p>
<p>Integer </p>
<p>1..65535 </p>
<p>100 </p>
<p>This attribute defines the </p>
<p>NM Message Cycle Time </p>
<p>(see also Chapter 6.3.2 </p>
<p>‘Channel Configuration’) </p>
<p>NmAsrCanMsgCycleOffs</p>
<p>et </p>
<p>Node </p>
<p>Integer </p>
<p>0..65535 </p>
<p>0 </p>
<p>This attribute defines the </p>
<p>NM Message Tx Offset </p>
<p>Time (see also Chapter </p>
<p>6.3.2 ‘Channel </p>
<p>Configuration’). </p>
<p>This attribute has to be set </p>
<p>less than </p>
<p>NmAsrCanMsgCycleTime</p>
<p>.</p>
<p> </p>
<p>NmAsrCanMsgReducedTi</p>
<p>me </p>
<p>Node </p>
<p>Integer </p>
<p>1..65535 </p>
<p>50 </p>
<p>This attribute defines the </p>
<p>NM Message Node Specific </p>
<p>Reduced Cycle Time (see </p>
<p>also Chapter 6.3.2 ‘Channel </p>
<p>Configuration’).  </p>
<p>This attribute is node-</p>
<p>specific and has to be set </p>
<p>greater than ½ * </p>
<p>NmAsrCanMsgCycleTime </p>
<p>but less than </p>
<p>NmAsrCanMsgCycleTime</p>
<p>.</p>
<p> </p>
<p>Table 6-1  </p>
<p>Database Attributes for CAN NM </p>
<p><b>6.3 </b></p>
<p><b>Configuration with GENy </b></p>
<p>The </p>
<p>configuration </p>
<p>of </p>
<p>the </p>
<p>AUTOSAR </p>
<p>Network </p>
<p>Management </p>
<p>is </p>
<p>performed </p>
<p>with </p>
<p>the </p>
<p>generation tool GENy. </p>
<p>It is strongly recommend using the database attributes listed in chapter 6.2 ‘Configuration </p>
<p>in Data Base’. Some attributes are mandatory for the usage of CAN NM. Please note that </p>
<p>the configuration items gathered from the database are disabled and grayed and cannot </p>
<p>be overwritten by the user. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>83 / 99 </p>
<p> </p>
<p>Figure 6-1 </p>
<p>Component Selection in GENy </p>
<p>In order to configure the AUTOSAR  CAN Network Management component  it has to be </p>
<p>activated on the designated channels: </p>
<p>CanNm</p>
<p>. </p>
<p>The  activation  of  CAN  NM  requires  the  activation  of  the  CAN  Interface  ([6])  or  of  a </p>
<p>CANbedded CAN Driver on the same channel. </p>
<p>The component has ECU specific and channel specific settings that have to be customized </p>
<p>separately. The detailed configuration is described in the following chapters. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>Note that not all parameters described in the following chapters may be visible or </p>
<p>available in your configuration. This depends mainly on the available features (refer </p>
<p>also to chapter 3.1 ‘Overview of the Functional Scope’) and the OEM pre-configuration. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>84 / 99 </p>
<p><b>6.3.1 </b></p>
<p><b>Component Configuration </b></p>
<p> </p>
<p>Figure 6-2 </p>
<p>Component Configuration CAN NM </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>85 / 99 </p>
<p><b>Configuration options </b></p>
<p><b>Value </b></p>
<p><b>Description </b></p>
<p>Common </p>
<p>Configuration Variant </p>
<p><b>&gt; </b></p>
<p>Variant 1 </p>
<p><b>&gt; </b></p>
<p>Variant 2 </p>
<p><b>&gt; </b></p>
<p>Variant 3 </p>
<p>Set the AUTOSAR Configuration Variant (Variant 1: </p>
<p>Pre-compile configuration; Variant 2: Link-time </p>
<p>configuration; Variant 3: Post-build configuration). </p>
<p>Version Info API</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the version information </p>
<p>functionality. </p>
<p>Dev Error Detection</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate error reporting to the </p>
<p>development error detection. </p>
<p>The development error detection comprises </p>
<p>amongst others channel parameter checks and </p>
<p>check of initialization upon every service call. </p>
<p>It is strongly recommended to disable this option in </p>
<p>production code. </p>
<p>Prod Error Detect</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate error reporting to the diagnostic </p>
<p>event manager </p>
<p>User Config File </p>
<p>String </p>
<p>Enter the path of a user config file. </p>
<p>The user config file is pasted at the end of the </p>
<p>configuration file </p>
<p>CanNm_Cfg.h</p>
<p> during the </p>
<p>generation process. </p>
<p>It can be used to manually customize the CAN NM. </p>
<p>Post-build configuration</p>
<p>16</p>
<p> </p>
<p>Module Start Address </p>
<p>Memory </p>
<p>Address </p>
<p>Set the Start Address of the module’s post-build </p>
<p>configuration (location in the memory). </p>
<p> </p>
<p>NM Options </p>
<p>Bus Synchronization Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate bus synchronization (gateway </p>
<p>functionality). It can only be enabled if Passive </p>
<p>Mode is disabled. </p>
<p>Node Detection Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate node detection support. It can </p>
<p>only be enabled if Passive Mode is disabled and </p>
<p>Node Identifier is enabled. </p>
<p>Node Id Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate node identifier support. </p>
<p>PDU Rx Indication Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate PDU receive indication </p>
<p>functionality. </p>
<p>Remote Sleep Ind Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate remote sleep indication </p>
<p>(gateway functionality). It can only be enabled if </p>
<p>Passive Mode is disabled. </p>
<p>State Change Ind Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate state change notification </p>
<p>functionality. </p>
<p>                                            </p>
<p>15</p>
<p> Pre-compile parameter, which should be pre-configured in link-time configurations </p>
<p>16</p>
<p> Only available when post-build configuration variant is selected. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>86 / 99 </p>
<p>User Data Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the user data support. </p>
<p>Car Wup Rx Feature Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Car Wake-up support. </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated on each channel </p>
<p>(parameter ‘Car Wake Up Rx Enabled’, see chapter </p>
<p>6.3.2 ‘Channel Configuration’). </p>
<p>Refer to chapter 3.22 ‘Car Wake-up’ for feature </p>
<p>details. </p>
<p>Car Wup Filter Feature </p>
<p>Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Car Wake-up Node ID Filter </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated on each channel </p>
<p>(parameter ‘Car Wake Up Filter Enabled’, see </p>
<p>chapter 6.3.2 ‘Channel Configuration’). </p>
<p>Passive Mode Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate passive mode. </p>
<p> </p>
<p> </p>
<p>Partial Networking </p>
<p>Pn Feature Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Partial Networking feature </p>
<p>availability.  </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated on each channel </p>
<p>(parameter ‘Pn Enabled’, see chapter 6.3.2 </p>
<p>‘Channel Configuration’). </p>
<p>Refer to chapter 3.23 ‘Partial Networking’ for feature </p>
<p>details. </p>
<p>Pn Era Calc Feature Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Partial Networking ERA </p>
<p>algorithm availability.  </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated on each channel </p>
<p>(parameter ‘Pn Era Calc Enabled’, see chapter 6.3.2 </p>
<p>‘Channel Configuration’). </p>
<p>Pn Eira Calc Feature </p>
<p>Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Partial Networking EIRA </p>
<p>algorithm availability. </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated (parameter ‘Pn Eira Calc </p>
<p>Enabled’, see below). </p>
<p>Pn Eira Calc Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the Partial Networking EIRA </p>
<p>algorithm. </p>
<p>Pn Eira Rx N-Sdu Ref </p>
<p>Combo Box </p>
<p>Select the Name of the Com PDU where the PN </p>
<p>information of the EIRA algorithm is provided. </p>
<p>Pn Reset Time [s] </p>
<p>0..65.535 </p>
<p>Configure the timeout value for not repeated PN </p>
<p>clusters. Value is the same for EIRA and ERA </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>87 / 99 </p>
<p>algorithm. </p>
<p>Pn Info Offset </p>
<p>1..7 </p>
<p>Set the offset where the PN information within the </p>
<p>NM PDU starts. </p>
<p>Pn Info Length </p>
<p>0..7 </p>
<p>Set the length of the PN information within the NM </p>
<p>PDU. </p>
<p> </p>
<p> </p>
<p> </p>
<p>Pn Filter Mask Bytes </p>
<p>Pn Filter Mask Byte 0 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the first PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 0 </p>
<p>Pn Filter Mask Byte 1 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the second PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 1 </p>
<p>Pn Filter Mask Byte 2 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the third PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 2 </p>
<p>Pn Filter Mask Byte 3 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the fourth PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 3 </p>
<p>Pn Filter Mask Byte 4 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the fifth PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 4 </p>
<p>Pn Filter Mask Byte 5 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the sixth PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 5 </p>
<p>Pn Filter Mask Byte 6 Value </p>
<p>0x0..0xFF </p>
<p>Configure the filter mask value for the seventh PN </p>
<p>information byte. </p>
<p>Note that this parameter is only available if ‘Pn Info </p>
<p>Length’ &gt; 6 </p>
<p> </p>
<p>AMD Runtime Measurement </p>
<p>AMD Runtime Measurement</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>This parameter defines if AMD Runtime </p>
<p>Measurement (RTM) is enabled for this module. </p>
<p> </p>
<p>CAN NM Options </p>
<p>Bus Load Reduction Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the bus load reduction </p>
<p>algorithm. It can only be enabled if Passive Mode is </p>
<p>disabled. </p>
<p>Com Control Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate communication control service. </p>
<p>It can only be enabled if Passive Mode is disabled. </p>
<p>Immediate Restart Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate immediate restart. It can only be </p>
<p>enabled if Passive Mode is disabled. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>88 / 99 </p>
<p>Immediate Txconf Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate immediate transmission </p>
<p>confirmation. It can only be enabled if Passive Mode </p>
<p>is disabled. </p>
<p>Repeat Msg Ind Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate callback to NM Interface if a </p>
<p>state change to Repeat Message due to a repeat </p>
<p>message bit or a repeat message request occurred. </p>
<p>Immediate Nm Tx Feature </p>
<p>Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate Immediate Nm Transmission </p>
<p>feature. </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally configured on each channel </p>
<p>(parameter ‘Immediate NM Transmissions’ and </p>
<p>‘Immediate Nm Cycle Time’, see chapter 6.3.2 </p>
<p>‘Channel Configuration’). </p>
<p>Refer to chapter 3.20 ‘Immediate Nm Transmissions’ </p>
<p>for feature details. </p>
<p>Active Wup Bit Feature </p>
<p>Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the transmission of the active </p>
<p>wake-up bit within the NM user data. </p>
<p>Note that this parameter just enables the availability </p>
<p>of this feature in the code but the algorithm has to </p>
<p>be additionally activated on each channel </p>
<p>(parameter ‘Active Wake-up Bit Enabled’, see </p>
<p>chapter 6.3.2 ‘Channel Configuration’). </p>
<p>Refer to chapter 3.19 ‘Active Wake-up Handling’ for </p>
<p>algorithm details. </p>
<p> </p>
<p>CAN NM Extensions </p>
<p>Single Channel Optimization</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate optimization of the code in </p>
<p>single channel pre-compile configurations. </p>
<p>Refer to chapter 3.1.2.2 ‘Single Channel </p>
<p>Optimization’. </p>
<p>Disable Transmission Error </p>
<p>Reporting</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the deactivation of the </p>
<p>transmission error reporting. </p>
<p>If activated the following errors are not reported: </p>
<p><b>&gt; </b></p>
<p>CANNM_E_DEV_NETWORK_TIMEOUT</p>
<p> </p>
<p><b>&gt; </b></p>
<p>CANNM_E_NETWORK_TIMEOUT</p>
<p> </p>
<p><b>&gt; </b></p>
<p>CANNM_E_CANIF_TRANSMIT_ERROR</p>
<p> </p>
<p>Ext Remote Sleep Indication</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the extended remote sleep </p>
<p>indication. It can only be enabled if the ‘Remote </p>
<p>Sleep Indication’ is enabled. </p>
<p>Limp Home Indication</p>
<p>15,17</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the limp home indication. It can </p>
<p>only be enabled if Passive Mode is disabled. </p>
<p>Com User Data Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘NM User Data via </p>
<p>Com’. It can only be enabled if Passive Mode is </p>
<p>disabled. Refer to chapter 3.15 ‘NM User Data via </p>
<p>Com’ for more information. </p>
<p>                                            </p>
<p>17</p>
<p> This configuration item is only relevant if the Limp Home Indication feature is available. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>89 / 99 </p>
<p>Ext Bus Synchronization</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘Extended Bus </p>
<p>Synchronization’. Refer to chapter 3.17 ‘Extended </p>
<p>Bus Synchronization’ for more information. </p>
<p>NM Gateway Extension </p>
<p>Support</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘NM Gateway </p>
<p>Extension Support’. Refer to chapter 3.18 ‘Gateway </p>
<p>Extension Support’ for further information. </p>
<p>Diagnostic Gateway Extension </p>
<p>Support</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘Diagnostic Gateway </p>
<p>Extension Support’. Refer to chapter 3.18 ‘Gateway </p>
<p>Extension Support’ for further information. </p>
<p>Dem2Det Enabled</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘Dem2Det Enabled’. </p>
<p>Refer to chapter 3.12 ‘Error Handling’ for further </p>
<p>information. </p>
<p>Adjust CanIf RangeConfig </p>
<p>DLCCheck</p>
<p>15</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate the feature ‘Adjust CanIf </p>
<p>RangeConfig DLCCheck’. Refer to chapter 3.5.5 </p>
<p>‘Support for RX PDUs with Different Lengths’ for </p>
<p>further information. </p>
<p>Table 6-2  </p>
<p>Component Configuration CAN NM </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>90 / 99 </p>
<p><b>6.3.2 </b></p>
<p><b>Channel Configuration </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>91 / 99 </p>
<p>Figure 6-3 </p>
<p>Channel Configuration CAN NM </p>
<p><b>Configuration options </b></p>
<p><b>Value </b></p>
<p><b>Description </b></p>
<p>General Settings </p>
<p>Bus System Type </p>
<p>Read Only </p>
<p>Bus system type for the specific channel. </p>
<p>Manufacturer </p>
<p>Read Only </p>
<p>Manufacturer according to the database. </p>
<p>Miscellaneous </p>
<p> </p>
<p>Network Settings </p>
<p>NM Message Count </p>
<p>1..256 </p>
<p>Set the number of CAN Ids that are reserved for the </p>
<p>network management only. This value determines </p>
<p>the filter mask value of the NM range configuration. </p>
<p>For a proper configuration this value must be a </p>
<p>power of 2. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>NM Base Address </p>
<p>0x0..0x1FFF</p>
<p>FFFF </p>
<p>Set the base address of network management ID </p>
<p>range. This value determines the range base </p>
<p>address (code) value of the NM range </p>
<p>configurations. For a proper configuration this value </p>
<p>must be a multiple of the parameter’ Nm Message </p>
<p>Count’. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Node Id </p>
<p>Read Only </p>
<p>Configure the source node identifier. This value is </p>
<p>transmitted within the NM message. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Note that this setting may be invisible </p>
<p>in the channel settings if you have a </p>
<p>Multiple ECU configuration. The setting </p>
<p>is visible instead in the identity specific </p>
<p>channel settings (see also chapter </p>
<p>6.3.2.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Integration </p>
<p>Main Function Period [ms] </p>
<p>1..255 </p>
<p>Set the call cycle time value of the main function for </p>
<p>the respective channel. The default value is 10. </p>
<p> </p>
<p>CAN Network Management Algorithm </p>
<p>Msg Cycle Time [ms] </p>
<p>1..65535 </p>
<p>Set the cycle time of the NM message in the </p>
<p>periodic transmission mode. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Msg Timeout Time [ms] </p>
<p>1..65535 </p>
<p>Set the transmission timeout time of NM message in </p>
<p>ms. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>92 / 99 </p>
<p>If there is no transmission confirmation by the CAN </p>
<p>Interface within this timeout, the CAN NM module </p>
<p>shall give an error notification. </p>
<p>Timeout Time [ms] </p>
<p>1..65535 </p>
<p>Configure the timeout for the reception and </p>
<p>transmission of Network Management Messages. </p>
<p>If in Normal Operation State the network node does </p>
<p>not require the bus anymore and no more NM </p>
<p>messages are received a transition to 'Prepare Bus-</p>
<p>Sleep' is performed. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Wait Bus Sleep Time [ms] </p>
<p>0..65535 </p>
<p>Configure the timeout for bus calm down phase </p>
<p>(Prepare Bus-Sleep Mode) in ms. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Repeat Message Time [ms] </p>
<p>0..65535 </p>
<p>Set the timeout for Repeat Message State in ms. </p>
<p>The Repeat Message State is entered when </p>
<p>entering Network Mode and also used for the ’Node </p>
<p>Detection’ (refer to chapter chapter 3.6 ‘Node </p>
<p>Detection’ for further information). </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Msg Cycle Offset [ms] </p>
<p>0..65535 </p>
<p>Configure the message transmission offset time in </p>
<p>the periodic transmission mode (start delay). </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Note that this setting may be invisible </p>
<p>in the channel settings if you have a </p>
<p>Multiple ECU configuration. The setting </p>
<p>is visible instead in the identity specific </p>
<p>channel settings (see also chapter </p>
<p>6.3.2.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>NM Options </p>
<p>Channel Active </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate a NM channel. If deactivated the </p>
<p>channel will be set to Uninitialized. </p>
<p> </p>
<p> </p>
<p>Nm Message Structure </p>
<p>Pdu Length </p>
<p>0..8 </p>
<p>Configure the length of the NM message. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The PDU Length should be configured </p>
<p>equally in all nodes within the same </p>
<p>network (channel). Background: The </p>
<p>CAN NM expects this length for all </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>93 / 99 </p>
<p>received messages unless the support </p>
<p>for RX PDUs with different lengths is </p>
<p>active (see chapter 3.5.5 ‘Support for RX </p>
<p>PDUs with Different Lengths’ for further </p>
<p>details). If the support for RX PDUs with </p>
<p>different lengths is not used, the range </p>
<p>filter in the CAN Interface is configured </p>
<p>adequately and NM messages with a </p>
<p>smaller size will not be received. </p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Pdu Nid Position </p>
<p><b>&gt; </b></p>
<p>Byte 0 </p>
<p><b>&gt; </b></p>
<p>Byte 1 </p>
<p><b>&gt; </b></p>
<p>Off </p>
<p>Set the position of the node identifier in the NM </p>
<p>message. This parameter depends on ‘PDU Length’ </p>
<p>and ‘PDU Control Bit Vector Position’. </p>
<p>Pdu Cbv Position </p>
<p><b>&gt; </b></p>
<p>Byte 0 </p>
<p><b>&gt; </b></p>
<p>Byte 1 </p>
<p><b>&gt; </b></p>
<p>Off </p>
<p>Set the position of the control bit vector in the NM </p>
<p>message. This parameter depends on ‘PDU Length’ </p>
<p>and ‘PDU Node Identifier Position’. </p>
<p>User Data Length </p>
<p>Read Only </p>
<p>This parameter provides information about the </p>
<p>current user data length. It is determined by the </p>
<p>settings of ‘PDU Length’, ‘PDU Node Identifier </p>
<p>Position’ and ‘PDU Control Bit Vector Position’. </p>
<p> </p>
<p> </p>
<p>Remote Sleep Indication </p>
<p>Remote Sleep Ind Time [ms] </p>
<p>1..65535 </p>
<p>Configure timeout for Remote Sleep Indication. </p>
<p> </p>
<p> </p>
<p>Bus Load Reduction </p>
<p>Msg Reduced Time [ms] </p>
<p>1..65535 </p>
<p>Node specific reduced bus cycle time [ms] in the </p>
<p>periodic transmission mode with bus load reduction. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Note that this setting may be invisible </p>
<p>in the channel settings if you have a </p>
<p>Multiple ECU configuration. The setting </p>
<p>is visible instead in the identity specific </p>
<p>channel settings (see also chapter </p>
<p>6.3.2.1). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Bus Load Reduction Active </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/Deactivate bus load reduction usage for </p>
<p>this channel. </p>
<p>This option is not configurable if ‘Bus Load </p>
<p>Reduction’ is disabled. </p>
<p> </p>
<p> </p>
<p>Car Wake Up </p>
<p>Car Wake Up Rx Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable  </p>
<p>Activate/deactivate the Car Wake-up handling for </p>
<p>this channel. </p>
<p>Car Wake Up Byte Position </p>
<p>0..7 </p>
<p>Set the Car Wake-up byte position within the NM </p>
<p>user data. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>94 / 99 </p>
<p>Car Wake Up Bit Position </p>
<p>0..7 </p>
<p>Set the Car Wake-up bit position within the ‘Car </p>
<p>Wake Up Byte’. </p>
<p>Car Wake Up Filter Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable  </p>
<p>Activate/deactivate the Car Wake-up Node ID </p>
<p>filtering for this channel. </p>
<p>Car Wake Up Filter Node ID </p>
<p>0..255 </p>
<p>Configure the Car Wake-up Node ID for this </p>
<p>channel. </p>
<p> </p>
<p> </p>
<p>Active Wake Up </p>
<p>Immediate Nm Transmissions </p>
<p>0..255 </p>
<p>Configure the number of NM messages which shall </p>
<p>be transmitted with the Immediate Nm Cycle Time </p>
<p>upon Active Wake-up. </p>
<p>If zero is configured the normal transmission </p>
<p>handling is performed. </p>
<p>Immediate Nm Cycle Time </p>
<p>[ms] </p>
<p>1..65535 </p>
<p>Configure the NM message cycle time which shall </p>
<p>be used upon Active Wake-up. </p>
<p>Active Wake Up Bit Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/deactivate the setting of the active wake-up </p>
<p>bit within the NM user data for this channel. </p>
<p> </p>
<p> </p>
<p>Partial Networking </p>
<p>Pn Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/deactivate the Partial Networking algorithm </p>
<p>for this channel. </p>
<p>Pn Era Calc Enabled </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/deactivate the Partial Networking ERA </p>
<p>algorithm for this channel. </p>
<p>Pn Era Rx N-Sdu Ref </p>
<p>Combo Box </p>
<p>Select the name of the Com PDU where the PN </p>
<p>information of the ERA algorithm is provided. </p>
<p>All Nm Messages Keep Awake </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>Activate/deactivate that all NM messages keep the </p>
<p>channel awake. </p>
<p>Pn Handle Multiple Network </p>
<p>Requests </p>
<p><b>&gt; </b></p>
<p>Enable </p>
<p><b>&gt; </b></p>
<p>Disable </p>
<p>This parameter enables/disables the behavior </p>
<p>whether CanNm_NetworkRequest calls have an </p>
<p>effect in Network Mode. If disabled </p>
<p>CanNm_NetworkRequest is ignored in Network </p>
<p>Mode. If enabled CanNm_NetworkRequest triggers </p>
<p>a change from Network Mode to Repeat Message. </p>
<p> </p>
<p>CAN NM Extensions </p>
<p>NM User Data I-PDU </p>
<p>Read Only </p>
<p>Name of the Com PDU where the NM user data can </p>
<p>be set if feature ‘Com User Data Enabled’ is </p>
<p>enabled. </p>
<p>This parameter must be part of the database. It </p>
<p>cannot be configured manually. </p>
<p>Table 6-3  </p>
<p>Channel Configuration CAN NM </p>
<p><b>6.3.2.1 </b></p>
<p><b>Identity Specific Channel Configuration </b></p>
<p>If a Multiple ECU Configuration (see also chapter  3.13) is opened in GENy, the settings </p>
<p>provided in the following figure and Table 6-4 may be configured for each identity. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>95 / 99 </p>
<p> </p>
<p>Figure 6-4 </p>
<p>Identity-Specific Channel Configuration CAN NM </p>
<p><b>Configuration options </b></p>
<p><b>Value </b></p>
<p><b>Description </b></p>
<p>Miscellaneous </p>
<p> </p>
<p>Network Settings </p>
<p>Node Id </p>
<p>Read Only </p>
<p>Configure the source node identifier. This value is </p>
<p>transmitted within the NM message. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p> </p>
<p>CAN Network Management Algorithm </p>
<p>Msg Cycle Offset [ms] </p>
<p>0..65535 </p>
<p>Configure the message transmission offset time in </p>
<p>the periodic transmission mode (start delay). </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p> </p>
<p> </p>
<p>Bus Load Reduction </p>
<p>Msg Reduced Time [ms] </p>
<p>1..65535 </p>
<p>Node specific reduced bus cycle time [ms] in the </p>
<p>periodic transmission mode with bus load reduction. </p>
<p>Value is set automatically and is read-only if </p>
<p>provided by the database. </p>
<p>Table 6-4  </p>
<p>Identity-Specific Channel Configuration CAN NM </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>96 / 99 </p>
<p><b>6.3.3 </b></p>
<p><b>Timing Restrictions </b></p>
<p>The following table contains timing constraints that are recommended to ensure that the </p>
<p>corresponding algorithms will work correctly: </p>
<p><b>Timing Parameter </b></p>
<p><b>Restrictions </b></p>
<p>Msg Cycle Offset </p>
<p>&lt; Msg Cycle Time </p>
<p>Msg Timeout Time </p>
<p>&lt; Msg Cycle Time </p>
<p>&lt; Msg Reduced Time if Bus Load Reduction Active is enabled </p>
<p>Timeout Time </p>
<p>&gt;&gt; Msg Cycle Time </p>
<p>Repeat Message Time </p>
<p>= 0 if Passive Mode Enabled is enabled </p>
<p>Msg Reduced Time </p>
<p>&gt;= ( Msg Cycle Time / 2 ) </p>
<p>&lt; Msg Cycle Time </p>
<p>Remote Sleep Indication Time </p>
<p>&gt; NM Message Cycle Time </p>
<p>Pn Reset Time </p>
<p>&gt; Msg Cycle Time </p>
<p>&lt; Timeout Time </p>
<p>Table 6-5  </p>
<p>CAN NM Timing Restrictions </p>
<p>Note that all timers should be integer multiples of the ‘Main Function Period’. </p>
<p><b>6.3.4 </b></p>
<p><b>NM Message Structure Configuration Notes </b></p>
<p>It is possible to enable user data, source node identifier and control bit vector within the </p>
<p>message layout (channel configuration) without having the corresponding feature enabled </p>
<p>in the component configuration. In such case no API is available to write or read the NM </p>
<p>message bytes and the default values will be transmitted (0x00 for source node identifier </p>
<p>and control bit vector, 0xFF for user data bytes). </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>97 / 99 </p>
<p><b>7 </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p>Also refer to [8] for a list of common abbreviations and terms. </p>
<p><b>7.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p><b>Confirmation </b></p>
<p>Notification by the data link layer on asynchronous successful </p>
<p>transmission of a CAN message </p>
<p><b>Identifier </b></p>
<p>Identifies a CAN message </p>
<p><b>Indication </b></p>
<p>Notification by the data link layer on asynchronous reception of a CAN </p>
<p>message </p>
<p><b>Message </b></p>
<p>One or more signals are assigned to each message. </p>
<p><b>Signal </b></p>
<p>Signals describe the significance of the individual data segments within a </p>
<p>message. Typically bits, bytes or words are used for data segments but </p>
<p>individual bit combinations are also possible. In the CAN database, each </p>
<p>data segment is assigned a symbolic name, a value range, a conversion </p>
<p>formula and a physical unit, as well as a list of receiving nodes. </p>
<p>Table 7-1  </p>
<p>Glossary </p>
<p> </p>
<p><b>7.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p><b>API </b></p>
<p><b>A</b>pplication <b>P</b>rogramming <b>I</b>nterface </p>
<p><b>AUTOSAR </b></p>
<p><b>Aut</b>omotive <b>O</b>pen <b>S</b>ystem <b>Ar</b>chitecture </p>
<p><b>CAN </b></p>
<p><b>C</b>ontroller <b>A</b>rea <b>N</b>etwork </p>
<p><b>CCL </b></p>
<p><b>C</b>ommunication <b>C</b>ontrol <b>L</b>ayer </p>
<p><b>ComM </b></p>
<p><b>C</b>ommunication <b>M</b>anager </p>
<p><b>CRI </b></p>
<p>Partial Network <b>C</b>luster <b>R</b>equest <b>I</b>nformation </p>
<p><b>DET </b></p>
<p><b>D</b>evelopment <b>E</b>rror <b>T</b>racer </p>
<p><b>DEM </b></p>
<p><b>D</b>iagnostic <b>E</b>vent <b>M</b>anager </p>
<p><b>DLC </b></p>
<p><b>D</b>ata <b>L</b>ength <b>C</b>ode (Number of data bytes of a CAN message) </p>
<p><b>DLL </b></p>
<p><b>D</b>ata <b>l</b>ink <b>l</b>ayer </p>
<p><b>ECU </b></p>
<p><b>E</b>lectronic <b>C</b>ontrol <b>U</b>nit </p>
<p><b>EIRA </b></p>
<p><b>E</b>xternal <b>I</b>nternal <b>R</b>equests <b>A</b>ggregated </p>
<p><b>ERA </b></p>
<p><b>E</b>xternal <b>R</b>equests <b>A</b>ggregated </p>
<p><b>ID </b></p>
<p><b>Id</b>entifier (of a CAN message) </p>
<p><b>IL </b></p>
<p><b>I</b>nteraction <b>L</b>ayer </p>
<p><b>ISR </b></p>
<p><b>I</b>nterrupt <b>S</b>ervice <b>R</b>outine </p>
<p><b>KL15 </b></p>
<p><b>Kl</b>emme <b>15 (German) – Clamp 15: Ignition On/Off </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>98 / 99 </p>
<p><b>KL30 </b></p>
<p><b>Kl</b>emme <b>30 (German) – Clamp 30: Battery voltage </b></p>
<p><b>KL31 </b></p>
<p><b>Kl</b>emme <b>31 (German) – Clamp 31: Ground (GND) </b></p>
<p><b>MISRA </b></p>
<p><b>M</b>otor <b>I</b>ndustry <b>S</b>oftware <b>R</b>eliability <b>A</b>ssociation </p>
<p><b>NM </b></p>
<p><b>N</b>etwork <b>M</b>anagement  </p>
<p><b>PDU </b></p>
<p><b>P</b>rotocol <b>D</b>ata <b>U</b>nit </p>
<p><b>PN </b></p>
<p><b>P</b>artial <b>N</b>etwork / <b>P</b>artial <b>N</b>etworking </p>
<p><b>RAM </b></p>
<p><b>R</b>andom <b>A</b>ccess <b>M</b>emory </p>
<p><b>RI </b></p>
<p><b>R</b>eference <b>I</b>mplementation </p>
<p>(Reference Implementation of the CAN-Driver High Level part) </p>
<p><b>ROM </b></p>
<p><b>R</b>ead <b>O</b>nly <b>M</b>emory </p>
<p><b>SchM </b></p>
<p><b>Sch</b>edule <b>M</b>anager (BSW Scheduler) </p>
<p>Table 7-2  </p>
<p>Abbreviations </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management  </p>
<p> </p>
<p>2013, Vector Informatik GmbH </p>
<p>Version: 4.18.00 </p>
<p>based on template version 3.4 </p>
<p>99 / 99 </p>
<p><b>8 </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p>&gt;   News </p>
<p>&gt;   Products </p>
<p>&gt;   Demo software </p>
<p>&gt;   Support </p>
<p>&gt;   Training data </p>
<p>&gt;   Addresses </p>
<p> </p>
<p><b>www.vector.com </b></p>
</body>
</html>
{% endraw %}